
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.15">
    
    
      
        <title>Workshop - Quarkus</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#welcome" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Quarkus" class="md-header__button md-logo" aria-label="Quarkus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Quarkus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Workshop
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Quarkus" class="md-nav__button md-logo" aria-label="Quarkus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Quarkus
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Workshop
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Workshop
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#welcome" class="md-nav__link">
    <span class="md-ellipsis">
      Welcome
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Welcome">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presenting-the-workshop" class="md-nav__link">
    <span class="md-ellipsis">
      Presenting the Workshop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Presenting the Workshop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-will-you-be-developing" class="md-nav__link">
    <span class="md-ellipsis">
      What Will You Be Developing?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-does-this-workshop-work" class="md-nav__link">
    <span class="md-ellipsis">
      How Does This Workshop Work?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-do-you-have-to-do" class="md-nav__link">
    <span class="md-ellipsis">
      What Do You Have to Do?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Software Requirements
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-software" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Software
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jdk-21" class="md-nav__link">
    <span class="md-ellipsis">
      JDK 21
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jq" class="md-nav__link">
    <span class="md-ellipsis">
      jq
    </span>
  </a>
  
    <nav class="md-nav" aria-label="jq">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-jq" class="md-nav__link">
    <span class="md-ellipsis">
      Installing jq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-jq-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for jq Installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openai-or-azure-openai-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAI or Azure OpenAI Subscriptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAI or Azure OpenAI Subscriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openai" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-openai" class="md-nav__link">
    <span class="md-ellipsis">
      Azure OpenAI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsl" class="md-nav__link">
    <span class="md-ellipsis">
      WSL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WSL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-wsl" class="md-nav__link">
    <span class="md-ellipsis">
      Installing WSL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-for-the-workshop" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing for the Workshop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparing for the Workshop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-workshop-scaffolding" class="md-nav__link">
    <span class="md-ellipsis">
      Download the workshop scaffolding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Download the workshop scaffolding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#super-heroes-application" class="md-nav__link">
    <span class="md-ellipsis">
      Super Heroes Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Checking Ports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready" class="md-nav__link">
    <span class="md-ellipsis">
      Ready?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-classical-resthttp-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a classical REST/HTTP Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a classical REST/HTTP Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#villain-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Villain Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Villain Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrapping-the-villain-rest-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping the Villain REST Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-villain-resource" class="md-nav__link">
    <span class="md-ellipsis">
      The Villain Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Development Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packaging-and-running-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging and Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transactions-and-orm" class="md-nav__link">
    <span class="md-ellipsis">
      Transactions and ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transactions and ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-postgresql-dependency-hibernate-with-panache-and-hibernate-validator" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the PostgreSQL Dependency, Hibernate with Panache and Hibernate Validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#villain-entity" class="md-nav__link">
    <span class="md-ellipsis">
      Villain Entity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Villain Entity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-hibernate" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Hibernate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#villain-service" class="md-nav__link">
    <span class="md-ellipsis">
      Villain Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-a-database-in-dev-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing a database in dev mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#villainresource-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      VillainResource Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-data" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crud-tests-in-villainresourcetest" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD Tests in VillainResourceTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-production-package" class="md-nav__link">
    <span class="md-ellipsis">
      Building production package
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building production package">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packaging-and-running-the-application_1" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging and running the application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-villain-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the Villain Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring the Villain Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-quarkus-listening-port" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Quarkus Listening Port
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-configuration-value" class="md-nav__link">
    <span class="md-ellipsis">
      Injecting Configuration Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-and-testing-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running and Testing the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-api" class="md-nav__link">
    <span class="md-ellipsis">
      Open API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_2" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-openapi-extension" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the OpenAPI extension
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-api_1" class="md-nav__link">
    <span class="md-ellipsis">
      Open API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizing-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing the Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customized-contract" class="md-nav__link">
    <span class="md-ellipsis">
      Customized Contract
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openapi-tests-in-villainresourcetest" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAPI Tests in VillainResourceTest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whats-quarkus" class="md-nav__link">
    <span class="md-ellipsis">
      What’s Quarkus?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quarkus-augmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Quarkus Augmentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Application Lifecycle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_3" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Profiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reactive" class="md-nav__link">
    <span class="md-ellipsis">
      Reactive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reactive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-reactive" class="md-nav__link">
    <span class="md-ellipsis">
      Why reactive?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hero-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Hero Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hero Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_4" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-hero-entity" class="md-nav__link">
    <span class="md-ellipsis">
      The Hero entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uni-api-in-2-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      Uni API in 2 minutes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-hero-resource" class="md-nav__link">
    <span class="md-ellipsis">
      The Hero Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-reactive-access-to-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the reactive access to the database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-heroes" class="md-nav__link">
    <span class="md-ellipsis">
      Importing heroes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-heroes" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the heroes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-testing-and-packaging-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running, Testing and Packaging the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-microservice-to-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      From Microservice to Microservices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="From Microservice to Microservices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Fight Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fight Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrapping-the-fight-rest-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping the Fight REST Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-structure_5" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fight-entity" class="md-nav__link">
    <span class="md-ellipsis">
      Fight Entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fighters-bean" class="md-nav__link">
    <span class="md-ellipsis">
      Fighters Bean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightservice-transactional-service" class="md-nav__link">
    <span class="md-ellipsis">
      FightService Transactional Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightresource-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      FightResource Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightresourcetest-test-class" class="md-nav__link">
    <span class="md-ellipsis">
      FightResourceTest Test Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-testing-and-packaging-the-application_1" class="md-nav__link">
    <span class="md-ellipsis">
      Running, Testing and Packaging the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quinoa" class="md-nav__link">
    <span class="md-ellipsis">
      Quinoa?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-web-application" class="md-nav__link">
    <span class="md-ellipsis">
      The Web Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Web Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-the-web-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Web Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#live-coding-the-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Live coding the UI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cors" class="md-nav__link">
    <span class="md-ellipsis">
      CORS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-communication-fault-tolerance" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP communication &amp; Fault Tolerance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP communication & Fault Tolerance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rest-client" class="md-nav__link">
    <span class="md-ellipsis">
      REST Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="REST Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_6" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-reactive-rest-client-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the Reactive REST Client Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightservice-invoking-external-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      FightService Invoking External Microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the Interfaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-rest-client-invocation" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring REST Client Invocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-the-test-with-mock-support" class="md-nav__link">
    <span class="md-ellipsis">
      Updating the Test with Mock Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updating the Test with Mock Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mocking-a-villain-service" class="md-nav__link">
    <span class="md-ellipsis">
      Mocking a Villain service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mocking-a-hero-service" class="md-nav__link">
    <span class="md-ellipsis">
      Mocking a Hero service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Fallbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fallbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-the-fault-tolerance-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the Fault Tolerance Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-fallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Fallbacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application_1" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Timeout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-timeouts" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Timeouts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application_2" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Contract testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contract testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumer-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Consumer tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Consumer tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-the-first-contract-test" class="md-nav__link">
    <span class="md-ellipsis">
      Writing the first contract test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-contract" class="md-nav__link">
    <span class="md-ellipsis">
      The contract
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provider-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Provider tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Provider tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sharing-the-contract" class="md-nav__link">
    <span class="md-ellipsis">
      Sharing the contract
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-the-test" class="md-nav__link">
    <span class="md-ellipsis">
      Writing the test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#states" class="md-nav__link">
    <span class="md-ellipsis">
      States
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#artificial-intelligence" class="md-nav__link">
    <span class="md-ellipsis">
      Artificial Intelligence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Artificial Intelligence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whats-semantic-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      What’s Semantic Kernel?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narration-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Narration Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Narration Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_7" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-semantic-kernel-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Semantic Kernel dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-fight-bean" class="md-nav__link">
    <span class="md-ellipsis">
      The Fight bean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-narration-rest-resource" class="md-nav__link">
    <span class="md-ellipsis">
      The Narration REST Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-semantic-kernel-narration-service" class="md-nav__link">
    <span class="md-ellipsis">
      The Semantic Kernel Narration service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-narration-skill" class="md-nav__link">
    <span class="md-ellipsis">
      The Narration skill
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-openaiazure-openai-access" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring OpenAI/Azure OpenAI access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-narration-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Narration Microservice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-narration-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Narration Microservice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-narration-microservice-from-the-fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Invoking the Narration Microservice from the Fight Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Invoking the Narration Microservice from the Fight Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-narration-to-the-fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Adding narration to the Fight Microservice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-and-mock-the-narration-microservice-invocation" class="md-nav__link">
    <span class="md-ellipsis">
      Test and mock the Narration microservice invocation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-testing-and-packaging-the-application_2" class="md-nav__link">
    <span class="md-ellipsis">
      Running, Testing and Packaging the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-driven-and-reactive-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Event-driven and Reactive microservices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Event-driven and Reactive microservices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages-to-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages to Kafka
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Messages to Kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_8" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-the-reactive-messaging-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Adding the Reactive Messaging Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-imperative-and-reactive-using-an-emitter" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting Imperative and Reactive Using an Emitter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to Kafka
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages-from-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages from Kafka
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Receiving Messages from Kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_9" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrapping-the-statistics-rest-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping the Statistics REST Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consuming-fight" class="md-nav__link">
    <span class="md-ellipsis">
      Consuming Fight
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Computing Statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-messages-from-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Reading Messages from Kafka
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-events-on-websockets" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Events on WebSockets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Events on WebSockets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-teamstats-websocket" class="md-nav__link">
    <span class="md-ellipsis">
      The TeamStats WebSocket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-topwinner-websocket" class="md-nav__link">
    <span class="md-ellipsis">
      The TopWinner WebSocket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-ui" class="md-nav__link">
    <span class="md-ellipsis">
      The UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application_3" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-native-executables" class="md-nav__link">
    <span class="md-ellipsis">
      Building Native Executables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Native Executables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-native-executables-with-quarkus" class="md-nav__link">
    <span class="md-ellipsis">
      Building Native Executables with Quarkus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-native-executables-for-our-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Building Native Executables for our Microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application-in-native-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application in Native mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-containers-with-quarkus" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers with Quarkus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-containers-for-our-microservices-in-jvm-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers for our Microservices in JVM Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-jvm-mode-containers-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Running JVM Mode Containers Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-containers-for-our-microservices-in-native-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers for our Microservices in Native Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-native-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Building native containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-native-mode-containers-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Running Native Mode Containers Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-container-running-a-native-executable" class="md-nav__link">
    <span class="md-ellipsis">
      Building a container running a native executable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-with-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying with Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploying with Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-on-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying on Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploying on Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-the-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-the-hero-villain-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the Hero &amp; Villain microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-the-fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the Fight microservice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-container-to-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      From Container to Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="From Container to Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-to-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying to Kubernetes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-to-open-shift" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying to Open Shift
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache-maven-39x" class="md-nav__link">
    <span class="md-ellipsis">
      Apache Maven 3.9.x
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Apache Maven 3.9.x">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Maven
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-maven-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for Maven Installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-maven-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Some Maven Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curl" class="md-nav__link">
    <span class="md-ellipsis">
      cURL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cURL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-curl" class="md-nav__link">
    <span class="md-ellipsis">
      Installing cURL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-curl-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for cURL Installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-curl-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Some cURL Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warming-the-caches" class="md-nav__link">
    <span class="md-ellipsis">
      Warming the caches
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warming the caches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#warming-up-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Warming up Maven
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warming up Maven">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-workshop-scaffolding_1" class="md-nav__link">
    <span class="md-ellipsis">
      Download the workshop scaffolding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-the-maven-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Download the Maven dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warming-up-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Warming up Docker images
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#welcome" class="md-nav__link">
    <span class="md-ellipsis">
      Welcome
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Welcome">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presenting-the-workshop" class="md-nav__link">
    <span class="md-ellipsis">
      Presenting the Workshop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Presenting the Workshop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-will-you-be-developing" class="md-nav__link">
    <span class="md-ellipsis">
      What Will You Be Developing?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-does-this-workshop-work" class="md-nav__link">
    <span class="md-ellipsis">
      How Does This Workshop Work?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-do-you-have-to-do" class="md-nav__link">
    <span class="md-ellipsis">
      What Do You Have to Do?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#software-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Software Requirements
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-software" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Software
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jdk-21" class="md-nav__link">
    <span class="md-ellipsis">
      JDK 21
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jq" class="md-nav__link">
    <span class="md-ellipsis">
      jq
    </span>
  </a>
  
    <nav class="md-nav" aria-label="jq">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-jq" class="md-nav__link">
    <span class="md-ellipsis">
      Installing jq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-jq-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for jq Installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openai-or-azure-openai-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAI or Azure OpenAI Subscriptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenAI or Azure OpenAI Subscriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openai" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-openai" class="md-nav__link">
    <span class="md-ellipsis">
      Azure OpenAI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wsl" class="md-nav__link">
    <span class="md-ellipsis">
      WSL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WSL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-wsl" class="md-nav__link">
    <span class="md-ellipsis">
      Installing WSL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-for-the-workshop" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing for the Workshop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparing for the Workshop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-workshop-scaffolding" class="md-nav__link">
    <span class="md-ellipsis">
      Download the workshop scaffolding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Download the workshop scaffolding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#super-heroes-application" class="md-nav__link">
    <span class="md-ellipsis">
      Super Heroes Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Checking Ports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready" class="md-nav__link">
    <span class="md-ellipsis">
      Ready?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-classical-resthttp-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a classical REST/HTTP Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a classical REST/HTTP Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#villain-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Villain Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Villain Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrapping-the-villain-rest-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping the Villain REST Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-villain-resource" class="md-nav__link">
    <span class="md-ellipsis">
      The Villain Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Development Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packaging-and-running-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging and Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transactions-and-orm" class="md-nav__link">
    <span class="md-ellipsis">
      Transactions and ORM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transactions and ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-postgresql-dependency-hibernate-with-panache-and-hibernate-validator" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the PostgreSQL Dependency, Hibernate with Panache and Hibernate Validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#villain-entity" class="md-nav__link">
    <span class="md-ellipsis">
      Villain Entity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Villain Entity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-hibernate" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Hibernate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#villain-service" class="md-nav__link">
    <span class="md-ellipsis">
      Villain Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-a-database-in-dev-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing a database in dev mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#villainresource-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      VillainResource Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-data" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crud-tests-in-villainresourcetest" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD Tests in VillainResourceTest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-production-package" class="md-nav__link">
    <span class="md-ellipsis">
      Building production package
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building production package">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packaging-and-running-the-application_1" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging and running the application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-villain-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the Villain Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring the Villain Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-quarkus-listening-port" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Quarkus Listening Port
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-configuration-value" class="md-nav__link">
    <span class="md-ellipsis">
      Injecting Configuration Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-and-testing-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running and Testing the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-api" class="md-nav__link">
    <span class="md-ellipsis">
      Open API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_2" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-openapi-extension" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the OpenAPI extension
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-api_1" class="md-nav__link">
    <span class="md-ellipsis">
      Open API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#customizing-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing the Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customized-contract" class="md-nav__link">
    <span class="md-ellipsis">
      Customized Contract
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openapi-tests-in-villainresourcetest" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAPI Tests in VillainResourceTest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whats-quarkus" class="md-nav__link">
    <span class="md-ellipsis">
      What’s Quarkus?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quarkus-augmentation" class="md-nav__link">
    <span class="md-ellipsis">
      Quarkus Augmentation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Application Lifecycle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_3" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-profiles" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Profiles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reactive" class="md-nav__link">
    <span class="md-ellipsis">
      Reactive
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reactive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-reactive" class="md-nav__link">
    <span class="md-ellipsis">
      Why reactive?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hero-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Hero Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hero Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_4" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-hero-entity" class="md-nav__link">
    <span class="md-ellipsis">
      The Hero entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uni-api-in-2-minutes" class="md-nav__link">
    <span class="md-ellipsis">
      Uni API in 2 minutes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-hero-resource" class="md-nav__link">
    <span class="md-ellipsis">
      The Hero Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-reactive-access-to-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the reactive access to the database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-heroes" class="md-nav__link">
    <span class="md-ellipsis">
      Importing heroes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-heroes" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the heroes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-testing-and-packaging-the-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running, Testing and Packaging the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-microservice-to-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      From Microservice to Microservices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="From Microservice to Microservices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Fight Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fight Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrapping-the-fight-rest-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping the Fight REST Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-structure_5" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fight-entity" class="md-nav__link">
    <span class="md-ellipsis">
      Fight Entity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fighters-bean" class="md-nav__link">
    <span class="md-ellipsis">
      Fighters Bean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightservice-transactional-service" class="md-nav__link">
    <span class="md-ellipsis">
      FightService Transactional Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightresource-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      FightResource Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightresourcetest-test-class" class="md-nav__link">
    <span class="md-ellipsis">
      FightResourceTest Test Class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-testing-and-packaging-the-application_1" class="md-nav__link">
    <span class="md-ellipsis">
      Running, Testing and Packaging the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      User Interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quinoa" class="md-nav__link">
    <span class="md-ellipsis">
      Quinoa?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-web-application" class="md-nav__link">
    <span class="md-ellipsis">
      The Web Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Web Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-the-web-application" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Web Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#live-coding-the-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Live coding the UI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cors" class="md-nav__link">
    <span class="md-ellipsis">
      CORS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-communication-fault-tolerance" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP communication &amp; Fault Tolerance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP communication & Fault Tolerance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rest-client" class="md-nav__link">
    <span class="md-ellipsis">
      REST Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="REST Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_6" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-reactive-rest-client-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the Reactive REST Client Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fightservice-invoking-external-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      FightService Invoking External Microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the Interfaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-rest-client-invocation" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring REST Client Invocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-the-test-with-mock-support" class="md-nav__link">
    <span class="md-ellipsis">
      Updating the Test with Mock Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updating the Test with Mock Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mocking-a-villain-service" class="md-nav__link">
    <span class="md-ellipsis">
      Mocking a Villain service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mocking-a-hero-service" class="md-nav__link">
    <span class="md-ellipsis">
      Mocking a Hero service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Fallbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fallbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-the-fault-tolerance-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Installing the Fault Tolerance Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-fallbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Fallbacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application_1" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Timeout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-timeouts" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Timeouts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application_2" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Contract testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contract testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumer-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Consumer tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Consumer tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-the-first-contract-test" class="md-nav__link">
    <span class="md-ellipsis">
      Writing the first contract test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-contract" class="md-nav__link">
    <span class="md-ellipsis">
      The contract
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provider-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Provider tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Provider tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sharing-the-contract" class="md-nav__link">
    <span class="md-ellipsis">
      Sharing the contract
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-the-test" class="md-nav__link">
    <span class="md-ellipsis">
      Writing the test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#states" class="md-nav__link">
    <span class="md-ellipsis">
      States
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#artificial-intelligence" class="md-nav__link">
    <span class="md-ellipsis">
      Artificial Intelligence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Artificial Intelligence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whats-semantic-kernel" class="md-nav__link">
    <span class="md-ellipsis">
      What’s Semantic Kernel?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#narration-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Narration Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Narration Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_7" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-semantic-kernel-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Add the Semantic Kernel dependencies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-fight-bean" class="md-nav__link">
    <span class="md-ellipsis">
      The Fight bean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-narration-rest-resource" class="md-nav__link">
    <span class="md-ellipsis">
      The Narration REST Resource
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-semantic-kernel-narration-service" class="md-nav__link">
    <span class="md-ellipsis">
      The Semantic Kernel Narration service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-narration-skill" class="md-nav__link">
    <span class="md-ellipsis">
      The Narration skill
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-openaiazure-openai-access" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring OpenAI/Azure OpenAI access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-the-narration-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the Narration Microservice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-narration-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Narration Microservice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-narration-microservice-from-the-fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Invoking the Narration Microservice from the Fight Microservice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Invoking the Narration Microservice from the Fight Microservice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-narration-to-the-fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Adding narration to the Fight Microservice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-and-mock-the-narration-microservice-invocation" class="md-nav__link">
    <span class="md-ellipsis">
      Test and mock the Narration microservice invocation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-testing-and-packaging-the-application_2" class="md-nav__link">
    <span class="md-ellipsis">
      Running, Testing and Packaging the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-driven-and-reactive-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Event-driven and Reactive microservices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Event-driven and Reactive microservices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages-to-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages to Kafka
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Messages to Kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_8" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-the-reactive-messaging-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Adding the Reactive Messaging Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-imperative-and-reactive-using-an-emitter" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting Imperative and Reactive Using an Emitter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to Kafka
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages-from-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages from Kafka
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Receiving Messages from Kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure_9" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrapping-the-statistics-rest-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping the Statistics REST Endpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consuming-fight" class="md-nav__link">
    <span class="md-ellipsis">
      Consuming Fight
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Computing Statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-messages-from-kafka" class="md-nav__link">
    <span class="md-ellipsis">
      Reading Messages from Kafka
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sending-events-on-websockets" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Events on WebSockets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sending Events on WebSockets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-teamstats-websocket" class="md-nav__link">
    <span class="md-ellipsis">
      The TeamStats WebSocket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-topwinner-websocket" class="md-nav__link">
    <span class="md-ellipsis">
      The TopWinner WebSocket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-ui" class="md-nav__link">
    <span class="md-ellipsis">
      The UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application_3" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-native-executables" class="md-nav__link">
    <span class="md-ellipsis">
      Building Native Executables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Native Executables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-native-executables-with-quarkus" class="md-nav__link">
    <span class="md-ellipsis">
      Building Native Executables with Quarkus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-native-executables-for-our-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Building Native Executables for our Microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-application-in-native-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Application in Native mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Building Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-containers-with-quarkus" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers with Quarkus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-containers-for-our-microservices-in-jvm-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers for our Microservices in JVM Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-jvm-mode-containers-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Running JVM Mode Containers Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-containers-for-our-microservices-in-native-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Building Containers for our Microservices in Native Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-native-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Building native containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-native-mode-containers-locally" class="md-nav__link">
    <span class="md-ellipsis">
      Running Native Mode Containers Locally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-container-running-a-native-executable" class="md-nav__link">
    <span class="md-ellipsis">
      Building a container running a native executable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-with-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying with Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploying with Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-on-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying on Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deploying on Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploying-the-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the infrastructure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-the-hero-villain-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the Hero &amp; Villain microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-the-fight-microservice" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying the Fight microservice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-container-to-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      From Container to Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="From Container to Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-to-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying to Kubernetes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploying-to-open-shift" class="md-nav__link">
    <span class="md-ellipsis">
      Deploying to Open Shift
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache-maven-39x" class="md-nav__link">
    <span class="md-ellipsis">
      Apache Maven 3.9.x
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Apache Maven 3.9.x">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Maven
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-maven-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for Maven Installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-maven-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Some Maven Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curl" class="md-nav__link">
    <span class="md-ellipsis">
      cURL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="cURL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-curl" class="md-nav__link">
    <span class="md-ellipsis">
      Installing cURL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-curl-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for cURL Installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#some-curl-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Some cURL Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warming-the-caches" class="md-nav__link">
    <span class="md-ellipsis">
      Warming the caches
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warming the caches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#warming-up-maven" class="md-nav__link">
    <span class="md-ellipsis">
      Warming up Maven
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warming up Maven">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-workshop-scaffolding_1" class="md-nav__link">
    <span class="md-ellipsis">
      Download the workshop scaffolding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download-the-maven-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Download the Maven dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warming-up-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Warming up Docker images
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Workshop</h1>

<h2 id="welcome">Welcome</h2>
<hr />
<p>Let’s start from the beginning. Quarkus. What’s Quarkus? That’s a pretty good question and probably a good start. If you go to the <a href="https://quarkus.io/">Quarkus web site</a>, you’ll read that Quarkus is "<em>A Kubernetes Native Java stack tailored for OpenJDK HotSpot &amp; GraalVM, crafted from the best of breed Java libraries and standards</em>." This description is somewhat unclear but does an outstanding job at using bankable keywords. It’s also written: "<em>Supersonic Subatomic Java</em>." This is a way of saying that Quarkus is really fast, and it’s really light. But what does Quarkus <em>do</em>?</p>
<p>In practice, Quarkus is a stack to develop distributed systems and modern applications in Java, Kotlin, or Scala. Quarkus applications are tailored for the Cloud, containers, and Kubernetes. That does not mean you can’t use Quarkus in other environments, there are no limits, but the principles infused in Quarkus have made containerization of applications more efficient. In this workshop, we will explain what Quarkus is and because the best way to understand Quarkus is to use it, build a set of microservices with it. Again, Quarkus is not limited to microservices, but it’s a generally well-understood type of architecture.</p>
<p>This workshop offers attendees an intro-level, hands-on session with Quarkus, from the first line of code to making services, to consuming them, and finally to assembling everything in a consistent system. But, what are we going to build? Well, it’s going to be a set of microservices:</p>
<ul>
<li>
<p>Using Quarkus</p>
</li>
<li>
<p>Using blocking and non-blocking HTTP invocations</p>
</li>
<li>
<p>With some parts of the dark side of microservices (resilience, health, etc)</p>
</li>
<li>
<p>Use an event-based architecture using Apache Kafka</p>
</li>
<li>
<p>Use OpenAI to introduce some artificial intelligence</p>
</li>
<li>
<p>Answer the ultimate question: are super-heroes stronger than super-villains?</p>
</li>
</ul>
<p>This workshop is a BYOL (<em>Bring Your Own Laptop</em>) session, so bring your Windows, OSX, or Linux laptop. You just need JDK 21 on your machine and Docker (having Apache Maven 3.9.x installed is optional as you will rely on the Apache Maven Wrapper). On Mac and Windows, Docker for <em>x</em> is recommended instead of the Docker toolbox setup. On Windows it is also recommended to have WSL (<a href="https://docs.microsoft.com/windows/wsl">Windows Subsystem for Linux</a>) installed.</p>
<p>What you are going to learn:</p>
<ul>
<li>
<p>What is Quarkus, and how you can use it</p>
</li>
<li>
<p>How to build an HTTP endpoint (REST API) with Quarkus</p>
</li>
<li>
<p>How to access a relational database</p>
</li>
<li>
<p>How you can use Swagger and OpenAPI</p>
</li>
<li>
<p>How you test your microservice</p>
</li>
<li>
<p>How to build a reactive microservice, including reactive data access</p>
</li>
<li>
<p>How you improve the resilience of your service</p>
</li>
<li>
<p>How to invoke OpenAI/Azure OpenAI APIs using Semantic Kernel</p>
</li>
<li>
<p>How to build event-driven microservices with Kafka</p>
</li>
<li>
<p>How to build use contract testing so we are sure our microservices are fully functional</p>
</li>
<li>
<p>How to build native executable</p>
</li>
<li>
<p>How to containerize our microservices</p>
</li>
<li>
<p>How to deploy the microservices to Kubernetes</p>
</li>
<li>
<p>And much more!</p>
</li>
</ul>
<h3 id="presenting-the-workshop">Presenting the Workshop</h3>
<p>This workshop should give you a practical introduction to Quarkus. You will practice all the needed tools to develop an entire microservice architecture, mixing classical HTTP, reactive and event-based microservices. You will finish by extending the capabilities of Quarkus and learn more about the ability to create native executables.</p>
<p>The idea is that you leave this workshop with a good understanding of what Quarkus is, what it is not, and how it can help you in your projects. Then, you’ll be prepared to investigate a bit more and, hopefully, contribute.</p>
<h4 id="what-will-you-be-developing">What Will You Be Developing?</h4>
<p>In this workshop, you will develop an application that allows superheroes to fight against supervillains. You will be developing several microservices communicating with each other:</p>
<ul>
<li>
<p><em>Super Hero UI</em>: a React application to pick up a random superhero, a random supervillain, and makes them fight. The Super Hero UI is exposed via Quarkus and invokes the Fight REST API</p>
</li>
<li>
<p><em>Villain REST API</em>: A classical HTTP microservice exposing CRUD operations on Villains, stored in a PostgreSQL database</p>
</li>
<li>
<p><em>Hero REST API</em>: A reactive HTTP microservice exposing CRUD operations on Heroes, stored in a Postgres database</p>
</li>
<li>
<p><em>Narration REST API</em>: This microservice talks to OpenAI/Azure OpenAI to generate a random narration of the fight.</p>
</li>
<li>
<p><em>Fight REST API</em>: This REST API invokes the Hero and Villain APIs to get a random superhero and supervillain. It also invokes the Narration API to get a random narration of the fight. Each fight is, then, stored in a PostgreSQL database. This microservice can be developed using both the classical (<em>imperative</em>) or reactive approach. Invocations to the other microservices are protected using resilience patterns (retry, timeout, circuit-breakers)</p>
</li>
<li>
<p><em>Statistics</em>: Each fight is asynchronously sent (via Kafka) to the Statistics microservice. It has an HTML + JQuery UI displaying all the statistics.</p>
</li>
</ul>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-c0de534704725416649644985d95733a.png" /></p>
<p>The main UI allows you to pick up one random Hero and Villain by clicking on "New Fighters." Then it’s just a matter of clicking on "Fight!" to get them to fight. If you click on "Narrate the Fight", you will have some AI-generated text describing the fight. The table at the bottom shows the list of the previous fights.</p>
<p><img alt="react ui ai" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/react-ui-ai.png" /></p>
<p>The Statistics UI shows the number of fights per hero and villain.</p>
<p><img alt="react ui stats" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/react-ui-stats.png" /></p>
<h4 id="how-does-this-workshop-work">How Does This Workshop Work?</h4>
<p>You have this material in your hands (either electronically or printed), and you can now follow it step by step. The structure of this workshop is as follows:</p>
<ul>
<li>
<p><em>Installing all the needed tools</em>: in this section, you will install all the tools and code to be able to develop, compile and execute our application</p>
</li>
<li>
<p><em>Developing microservices with Quarkus</em>: in this section, you will develop a microservice architecture by creating several Maven projects, write some Java code, add JPA entities, JAX-RS REST endpoints, write some tests, use a React web application, and all that on Quarkus</p>
</li>
<li>
<p><em>Artificial Intelligence</em>: in this section, you will use OpenAI or Azure OpenAI to invoke an AI so you can generate a random narration of the fight</p>
</li>
<li>
<p><em>Event-driven and Reactive microservices</em>: in this section, you will create a reactive microservice and an event-driven microservice using Kafka</p>
</li>
<li>
<p><em>Build native executables</em>: in this section, you will build native executables of all the microservices thanks to GraalVM</p>
</li>
<li>
<p><em>Containers</em>: in this section, you will create Docker images of all the microservices</p>
</li>
<li>
<p><em>Cloud</em>: once the microservices are all containerize, you can deploy them to Kubernetes</p>
</li>
</ul>
<p>If you already have the tools installed, skip the <em>Installing all the needed tools</em> section and jump to the section <em>Developing with Quarkus</em>, and start hacking some code and add-ons. This "à la carte" mode lets you make the most of this 6-hour long hands-on lab.</p>
<h4 id="what-do-you-have-to-do">What Do You Have to Do?</h4>
<p>This workshop should be as self-explanatory as possible. So your job is to follow the instructions by yourself, do what you are supposed to do, and do not hesitate to ask for any clarification or assistance; that’s why the team is here.</p>
<p>Oh, and be ready to have some fun!</p>
<h4 id="software-requirements">Software Requirements</h4>
<p>First of all, make sure you have a 64-bit computer with admin rights (so you can install all the needed tools) and at least 8Gb of RAM (as some tools need a few resources).</p>
<p>This workshop will make use of the following software, tools, frameworks that you will need to install and know (more or less) how it works:</p>
<ul>
<li>
<p>Any IDE you feel comfortable with (eg. Intellij IDEA, Eclipse IDE, VS Code..)</p>
</li>
<li>
<p>JDK 21</p>
</li>
<li>
<p>java 21 Mandrel</p>
</li>
<li>
<p>Docker or Podman</p>
</li>
<li>
<p>cURL (should already be installed in your OS) and <code>jq</code></p>
</li>
<li>
<p>OpenAI or Azure OpenAI keys</p>
</li>
</ul>
<p>The following section focuses on how to install and set up the needed software. You can skip the next section if you have already installed all the prerequisites.</p>
<table><tbody><tr><td><i title="Warning"></i></td><td><p>This workshop assumes a bash shell. If you run on Windows, in particular, adjust the commands accordingly or install WSL.</p></td></tr></tbody></table>

<h3 id="installing-software">Installing Software</h3>
<h4 id="jdk-21">JDK 21</h4>
<p>Essential for the development and execution of this workshop is the <em>Java Development Kit</em> (JDK) The JDK includes several tools such as a compiler (<code>javac</code>), a virtual machine, a documentation generator (`JavaDoc), monitoring tools (Visual VM) and so on. The code in this workshop uses JDK 21 (also compatible with Java 17.</p>
<h4 id="docker">docker</h4>
<p>Already done in index page.</p>
<h4 id="jq">jq</h4>
<p>Very often, when using cURL to invoke a RESTful web service, we get some JSON payload. cURL does not format this JSON so that you will get a flat String such as:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>curl<span class="w"> </span>http://localhost:8083/api/heroes
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="o">[{</span><span class="s2">&quot;id&quot;</span>:<span class="s2">&quot;1&quot;</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;Chewbacca&quot;</span>,<span class="s2">&quot;level&quot;</span>:<span class="s2">&quot;14&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:<span class="s2">&quot;2&quot;</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;Wonder Woman&quot;</span>,<span class="s2">&quot;level&quot;</span>:<span class="s2">&quot;15&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;id&quot;</span>:<span class="s2">&quot;3&quot;</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;Anakin Skywalker&quot;</span>,<span class="s2">&quot;level&quot;</span>:<span class="s2">&quot;8&quot;</span><span class="o">}]</span>
</span></code></pre></div>
<p>But what we want is to format the JSON payload, so it is easier to read. For that, there is a neat utility tool called <code>jq</code> that we could use. <code>jq</code> is a tool for processing JSON inputs, applying the given filter to its JSON text inputs, and producing the filter’s results as JSON on standard output</p>
<h5 id="installing-jq">Installing jq</h5>
<h5 id="checking-for-jq-installation">Checking for jq Installation</h5>
<p>Once installed, it’s just a matter of piping the cURL output to jq like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>curl<span class="w"> </span>http://localhost:8083/api/heroes<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="o">[</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="o">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;1&quot;</span>,
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Chewbacca&quot;</span>,
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="s2">&quot;lastName&quot;</span>:<span class="w"> </span><span class="s2">&quot;14&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="o">}</span>,
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="o">{</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;2&quot;</span>,
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Wonder Woman&quot;</span>,
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="s2">&quot;lastName&quot;</span>:<span class="w"> </span><span class="s2">&quot;15&quot;</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">  </span><span class="o">}</span>,
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">  </span><span class="o">{</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;3&quot;</span>,
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Anakin Skywalker&quot;</span>,
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span><span class="s2">&quot;lastName&quot;</span>:<span class="w"> </span><span class="s2">&quot;8&quot;</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="o">]</span>
</span></code></pre></div>
<h4 id="openai-or-azure-openai-subscriptions">OpenAI or Azure OpenAI Subscriptions</h4>
<p>The Narration microservice needs to access an AI service to generate the text narrating the fight. You can choose between OpenAI or Azure OpenAI. Azure OpenAI, or "OpenAI on Azure" is a service that provides REST API access to OpenAI’s models, including the GPT-4, GPT-3, Codex and Embeddings series. The difference between OpenAI and Azure OpenAI is that it runs on Azure global infrastructure, which meets your production needs for critical enterprise security, compliance, and regional availability.</p>
<h5 id="openai">OpenAI</h5>
<p><a href="https://openai.com/">OpenAI</a> is a leading artificial intelligence research organization creating cutting-edge AI technologies. OpenAI offers a range of APIs that enable developers to integrate AI capabilities into their applications. Some of these APIs include:</p>
<ul>
<li>
<p>GPT API: This API provides access to the GPT-3 and 4 language model</p>
</li>
<li>
<p>Codex API: This API provides access to the Codex model, which is a language model trained on a dataset of public code</p>
</li>
<li>
<p>DALL-E API: This API provides access to the DALL-E model, which is a language model trained on a dataset of text-image pairs</p>
</li>
</ul>
<p>We will be using the GPT-3 API to generate the text narrating the fight.</p>
<p>First, you need to have an OpenAI subscription and then generate an API key. Then you need to ge the organisation id and key to invoke the API. To get the organisation id, go to <a href="https://platform.openai.com/account/org-settings">OpenAI organisation settings</a> and copy the organisation id.:</p>
<p><img alt="openai org" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/openai-org.png" /></p>
<p>Then, to get the API key, go to <a href="https://platform.openai.com/account/api-keys">OpenAI API keys</a> and copy the API key:</p>
<p><img alt="openai key" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/openai-key.png" /></p>
<p><img alt="openai fund" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/openai-fund.png" /></p>
<h5 id="azure-openai">Azure OpenAI</h5>
<p>If you already have an Azure subscription, you can use it to create an <a href="https://azure.microsoft.com/products/ai-services/openai-service">Azure OpenAI</a> resource. Otherwise, you can create a <a href="https://azure.microsoft.com/free">free Azure subscription</a> and use it to create an Azure OpenAI resource. Then, you need to use the Azure OpenAI service to generate the API key and endpoint URL. You can either do that using the <a href="https://portal.azure.com/">Azure Portal</a> or the <a href="https://learn.microsoft.com/cli/azure/">Azure CLI</a>.</p>
<p>The easiest being use the Azure CLI, we recommend that you <a href="https://learn.microsoft.com/cli/azure/install-azure-cli">install it</a> and use it to create the Azure OpenAI resource and generate the API key and endpoint URL. Once Azure CLI is installed and you have your Azure subscription, sign in to your Azure account:</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>If you have several Azure subscription, make sure you are using the right one. For that, you can execute the following command to list all your subscriptions and set the one you want to use:</p><div><pre><code data-lang="shell">az account list --output table
az account set --subscription <subscription-id>
az account show</code></pre></div></td></tr></tbody></table>

<p>Then, execute the following command to create the Azure OpenAI resources:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Setting up environment variables...&quot;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;----------------------------------&quot;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nv">PROJECT</span><span class="o">=</span><span class="s2">&quot;&lt;give-your-project-a-name&gt;&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="s2">&quot;rg-</span><span class="nv">$PROJECT</span><span class="s2">&quot;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nv">LOCATION</span><span class="o">=</span><span class="s2">&quot;eastus&quot;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nv">TAG</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PROJECT</span><span class="s2">&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="nv">COGNITIVE_SERVICE</span><span class="o">=</span><span class="s2">&quot;cognit-</span><span class="nv">$PROJECT</span><span class="s2">&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="nv">COGNITIVE_DEPLOYMENT</span><span class="o">=</span><span class="s2">&quot;gpt35turbo&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating the resource group...&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;------------------------------&quot;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">  </span>--location<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOCATION</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">  </span>--tags<span class="w"> </span><span class="nv">system</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TAG</span><span class="s2">&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating the Cognitive Service...&quot;</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;---------------------------------&quot;</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>az<span class="w"> </span>cognitiveservices<span class="w"> </span>account<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_SERVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">  </span>--location<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOCATION</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">  </span>--custom-domain<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_SERVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">  </span>--tags<span class="w"> </span><span class="nv">system</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TAG</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">  </span>--kind<span class="w"> </span><span class="s2">&quot;OpenAI&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">  </span>--sku<span class="w"> </span><span class="s2">&quot;S0&quot;</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deploying the model...&quot;</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;----------------------&quot;</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>az<span class="w"> </span>cognitiveservices<span class="w"> </span>account<span class="w"> </span>deployment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_SERVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">  </span>--deployment-name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_DEPLOYMENT</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">  </span>--model-name<span class="w"> </span><span class="s2">&quot;gpt-35-turbo&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="w">  </span>--model-version<span class="w"> </span><span class="s2">&quot;0301&quot;</span><span class="w">  </span><span class="se">\</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">  </span>--model-format<span class="w"> </span><span class="s2">&quot;OpenAI&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">  </span>--sku-capacity<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">  </span>--sku-name<span class="w"> </span><span class="s2">&quot;Standard&quot;</span>
</span></code></pre></div>
<p>This script will create the Azure OpenAI resource and deploy the model. Once the script has executed, you can use the following command to get the API key and endpoint URL. You will need these properties later one when you will configure the Narration microservice:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Storing the key and endpoint in environment variables...&quot;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--------------------------------------------------------&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nv">AZUREOPENAI_KEY</span><span class="o">=</span><span class="k">$(</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span>az<span class="w"> </span>cognitiveservices<span class="w"> </span>account<span class="w"> </span>keys<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_SERVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.key1
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="k">)</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="nv">AZUREOPENAI_ENDPOINT</span><span class="o">=</span><span class="k">$(</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span>az<span class="w"> </span>cognitiveservices<span class="w"> </span>account<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_SERVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>.properties.endpoint
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="k">)</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="c1"># Set the properties</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--------------------------------------------------&quot;</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The following properties can be copied to either the rest-narration/src/main/resources/conf.properties or to the ~/.sk/conf.properties file:&quot;</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--------------------------------------------------&quot;</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;client.azureopenai.key=</span><span class="nv">$AZUREOPENAI_KEY</span><span class="s2">&quot;</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;client.azureopenai.endpoint=</span><span class="nv">$AZUREOPENAI_ENDPOINT</span><span class="s2">&quot;</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;client.azureopenai.deploymentname=</span><span class="nv">$COGNITIVE_DEPLOYMENT</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p>Once you’ve finished the workshop, remember to delete the Azure OpenAI resources to avoid being charged for it:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Clean up</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>az<span class="w"> </span>group<span class="w"> </span>delete<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span>--yes
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>az<span class="w"> </span>cognitiveservices<span class="w"> </span>account<span class="w"> </span>purge<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_SERVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span>--location<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOCATION</span><span class="s2">&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>az<span class="w"> </span>cognitiveservices<span class="w"> </span>account<span class="w"> </span>delete<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$COGNITIVE_SERVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESOURCE_GROUP</span><span class="s2">&quot;</span>
</span></code></pre></div>
<h4 id="wsl">WSL</h4>
<p><a href="https://docs.microsoft.com/windows/wsl">Windows Subsystem for Linux</a> (WSL) lets developers run a GNU/Linux environment — including most command-line tools, utilities, and applications — directly on Windows, unmodified, without the overhead of a traditional virtual machine or dual-boot setup.</p>
<table><tbody><tr><td><i title="Warning"></i></td><td><p>If you are using Windows, it is recommended to install WSL as all the commands use bash.</p></td></tr></tbody></table>

<h5 id="installing-wsl">Installing WSL</h5>
<p>You can install everything you need to run Windows Subsystem for Linux (WSL) by entering this command in an administrator PowerShell or Windows Command Prompt and then restarting your machine:</p>
<p>This command will enable the required optional components, download the latest Linux kernel, set WSL 2 as your default, and install a Linux distribution for you (Ubuntu by default).</p>
<p>The first time you launch a newly installed Linux distribution, a console window will open and you’ll be asked to wait for files to de-compress and be stored on your machine. All future launches should take less than a second.</p>
<h4 id="recap">Recap</h4>
<p>Before going further, make sure the following commands work on your machine.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>java<span class="w"> </span>-version
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nv">$GRAALVM_HOME</span>/bin/native-image<span class="w"> </span>--version
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>curl<span class="w"> </span>--version
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>docker<span class="w"> </span>version
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>docker<span class="w"> </span>compose<span class="w"> </span>version
</span></code></pre></div>
<p>We have not mentioned cURL up to now, because most modern operating systems ship with it pre-installed.</p>
<p>And also make sure to have your OpenAI or Azure credentials ready if you want to develop the "Narration" microservice.</p>
<h3 id="preparing-for-the-workshop">Preparing for the Workshop</h3>
<p>In this workshop, you will be developing an application dealing with Super Heroes (and Super-Villains 🦹) as well as Quarkus extensions. The code will be separated into two different directories:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-212f96fa2bf7640c4a678243922e2fe6.png" /></p>
<h4 id="download-the-workshop-scaffolding">Download the workshop scaffolding</h4>
<p>Clone or download the <a href="https://github.com/johan-die/workshop-super-hero">repository</a> squeleton.</p>
<h5 id="super-heroes-application">Super Heroes Application</h5>
<p>Under the <code>super-heroes</code> directory you will find the entire Super Hero application spread throughout a set of subdirectories, each one containing a microservice or some tooling. The final structure will be the following (don’t worry if you don’t have all this yet, this is what we’re aiming towards):</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-fb06ca44d555cf95f35d7c92f3d3c4a9.png" /></p>
<p>Most of these subdirectories are Maven projects and follow the Maven directory structure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-00ca08a1d306588270267e5ef81e7d5a.png" /></p>
<h4 id="checking-ports">Checking Ports</h4>
<p>During this workshop, we will use several ports.</p>
<p>Use <code>lsof</code> to make sure the following ports are free, so you don’t run into any conflicts.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:8080<span class="w">    </span><span class="c1"># UI</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:8082<span class="w">    </span><span class="c1"># Fight REST API</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:8083<span class="w">    </span><span class="c1"># Hero REST API</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:8084<span class="w">    </span><span class="c1"># Villain REST API</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:8085<span class="w">    </span><span class="c1"># Statistics REST API</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:8086<span class="w">    </span><span class="c1"># Narration REST API</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:5432<span class="w">    </span><span class="c1"># Postgres</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:2181<span class="w">    </span><span class="c1"># Zookeeper</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>lsof<span class="w"> </span>-i<span class="w"> </span>tcp:9092<span class="w">    </span><span class="c1"># Kafka</span>
</span></code></pre></div>
<p>For windows : <code>netstat -ano |findstr :8080</code></p>
<h4 id="ready">Ready?</h4>
<p>After the prerequisites have been installed and the environment has been checked, it’s now time to write some code!</p>
<h2 id="creating-a-classical-resthttp-microservice">Creating a <em>classical</em> REST/HTTP Microservice</h2>
<hr />
<p>At the heart of the Super-Hero application comes Villains! You can’t have superheroes without super-villains.</p>
<p>We need to expose a REST API allowing CRUD operations on villains. This microservice is, let’s say, a <em>classical</em> REST microservice. It uses HTTP to expose a REST API and internally store data into a database. It’s using the <em>imperative</em> development model.</p>
<p>The <em>fight</em> microservice will use this service.</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-ae227f1604103413b163428e53fd2ef7.png" /></p>
<p>In the following sections, you learn:</p>
<ul>
<li>
<p>How to create a new Quarkus application</p>
</li>
<li>
<p>How to implement REST API using JAX-RS and the RESTEasy Reactive extensio</p>
</li>
<li>
<p>How to compose your application using beans</p>
</li>
<li>
<p>How to access your database using Hibernate ORM with Panache</p>
</li>
<li>
<p>How to use transactions</p>
</li>
<li>
<p>How to enable OpenAPI and Swagger-UI</p>
</li>
</ul>
<table><tbody><tr><td><i title="Important"></i></td><td>This service is exposed on the port 8084.</td></tr></tbody></table>

<p>But first, let’s describe our service. The Super-Villains microservice manages villains with their names, powers, and so on. The REST API allows adding, removing, listing, and picking a random villain from the stored set. Nothing outstanding but a good first step to discover Quarkus.</p>
<h3 id="villain-microservice">Villain Microservice</h3>
<p>First thing first, we need a project. That’s what you are going to see in this section.</p>
<h4 id="bootstrapping-the-villain-rest-endpoint">Bootstrapping the Villain REST Endpoint</h4>
<p>The easiest way to create a new Quarkus project is to use the Quarkus Maven plugin. Open a terminal and run the following command under the <code>quarkus-workshop-super-heroes/super-heroes</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>./mvnw<span class="w"> </span>io.quarkus:quarkus-maven-plugin:3.9.1:create<span class="w"> </span>-<span class="s2">&quot;DplatformVersion=3.9.1&quot;</span><span class="w"> </span>-<span class="s2">&quot;DprojectGroupId=io.quarkus.workshop.super-heroes&quot;</span><span class="w">   </span>-<span class="s2">&quot;DprojectArtifactId=rest-villains&quot;</span><span class="w"> </span>-DclassName<span class="o">=</span><span class="s2">&quot;io.quarkus.workshop.superheroes.villain.VillainResource&quot;</span><span class="w"> </span>-Dpath<span class="o">=</span><span class="s2">&quot;api/villains&quot;</span><span class="w">   </span>-Dextensions<span class="o">=</span><span class="s2">&quot;rest-jackson&quot;</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Notice that we scaffold the project with a reactive implementation of RestEasy (<code>rest-jackson</code>). This is the recommended way to develop REST applications with Quarkus even if we use the imperative programming model in the Villain microservice.</p></td></tr></tbody></table>

<p>Remember that <code>mvnw</code> is the maven wrapper. It behaves like <code>mvn</code>, but allows a project’s build dependencies to be encapsulated.</p>
<p>The last line selects the extension we want to use. As a start, we only select <code>rest-jackson</code>, which will also import <code>rest</code>.</p>
<p>If you want your IDE to manage this new Maven project, you can declare it in the parent POM (<code>quarkus-super-heroes/pom.xml</code>) by adding this new module in the <code>&lt;modules&gt;</code> section:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">&lt;module&gt;</span>super-heroes/rest-villains<span class="nt">&lt;/module&gt;</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Tip"></i></td><td><p>Prefer a Web UI?</p><p>Instead of the Maven command, you can use <a href="https://code.quarkus.io/">https://code.quarkus.io</a> and select the <code>rest-jackson</code> extension.</p></td></tr></tbody></table>

<h4 id="directory-structure">Directory Structure</h4>
<p>Once you bootstrap the project, you get the following directory structure with a few Java classes and other artifacts :</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-d35c181e82e42e8580f8c3e6dd1c2f98.png" /></p>
<p>The Maven archetype generates the following <code>rest-villains</code> sub-directory:</p>
<ul>
<li>
<p>The Maven structure with a <code>pom.xml</code></p>
</li>
<li>
<p>An <code>io.quarkus.workshop.superheroes.villain.VillainResource</code> resource exposed on <code>/api/villains</code></p>
</li>
<li>
<p>An associated unit test <code>VillainResourceTest</code></p>
</li>
<li>
<p>The landing page <code>index.html</code> that is accessible on <a href="http://localhost:8080/">http://localhost:8080</a> after starting the application</p>
</li>
<li>
<p>Example <code>Dockerfile</code> files for both native and JVM modes in <code>src/main/docker</code></p>
</li>
<li>
<p>The <code>application.properties</code> configuration file</p>
</li>
</ul>
<p>Once generated, look at the <code>pom.xml</code>. You will find the import of the Quarkus BOM, allowing you to omit the version on the different Quarkus dependencies. In addition, you can see the <code>quarkus-maven-plugin</code> responsible for the packaging of the application and providing the development mode.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">&lt;project&gt;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nt">&lt;properties&gt;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="nt">&lt;compiler-plugin.version&gt;</span>3.11.0<span class="nt">&lt;/compiler-plugin.version&gt;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="nt">&lt;maven.compiler.release&gt;</span>21<span class="nt">&lt;/maven.compiler.release&gt;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="nt">&lt;quarkus.platform.artifact-id&gt;</span>quarkus-bom<span class="nt">&lt;/quarkus.platform.artifact-id&gt;</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="nt">&lt;quarkus.platform.group-id&gt;</span>io.quarkus<span class="nt">&lt;/quarkus.platform.group-id&gt;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="nt">&lt;quarkus.platform.version&gt;</span>3.6.0<span class="nt">&lt;/quarkus.platform.version&gt;</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span><span class="nt">&lt;skipITs&gt;</span>true<span class="nt">&lt;/skipITs&gt;</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="nt">&lt;surefire-plugin.version&gt;</span>3.2.2<span class="nt">&lt;/surefire-plugin.version&gt;</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">  </span><span class="nt">&lt;/properties&gt;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">  </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">  </span><span class="nt">&lt;dependencyManagement&gt;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">      </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>${quarkus.platform.group-id}<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>${quarkus.platform.artifact-id}<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>${quarkus.platform.version}<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">        </span><span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">        </span><span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">      </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">  </span><span class="nt">&lt;/dependencyManagement&gt;</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">  </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">  </span><span class="nt">&lt;build&gt;</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">    </span><span class="nt">&lt;plugins&gt;</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">      </span><span class="nt">&lt;plugin&gt;</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>${quarkus.platform.group-id}<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>quarkus-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>${quarkus.platform.version}<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">        </span><span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">        </span><span class="nt">&lt;executions&gt;</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">          </span><span class="nt">&lt;execution&gt;</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">            </span><span class="nt">&lt;goals&gt;</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">              </span><span class="nt">&lt;goal&gt;</span>build<span class="nt">&lt;/goal&gt;</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">              </span><span class="nt">&lt;goal&gt;</span>generate-code<span class="nt">&lt;/goal&gt;</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">              </span><span class="nt">&lt;goal&gt;</span>generate-code-tests<span class="nt">&lt;/goal&gt;</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">            </span><span class="nt">&lt;/goals&gt;</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">          </span><span class="nt">&lt;/execution&gt;</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w">        </span><span class="nt">&lt;/executions&gt;</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">      </span><span class="nt">&lt;/plugin&gt;</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="w">     </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">    </span><span class="nt">&lt;/plugins&gt;</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="w">  </span><span class="nt">&lt;/build&gt;</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="nt">&lt;/project&gt;</span>
</span></code></pre></div>
<p>If we focus on the dependencies section, you can see the extensions allowing the development of REST applications (rest and rest-jackson)</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nt">&lt;dependencies&gt;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>quarkus-arc<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>quarkus-rest<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>quarkus-rest-jackson<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></div>
<ul>
<li>
<p><code>quarkus-arc</code> is the dependency injection framework integrated into Quarkus. It’s designed to perform build-time injections. We will see later why this is essential for Quarkus.</p>
</li>
<li>
<p><code>rest</code> is the framework we will use to implement our REST API. It uses JAX-RS annotations such as <code>@Path</code>, <code>@GET</code>…</p>
</li>
<li>
<p><code>rest-jackson</code> adds JSON object mapping capabilities to RESTEasy reactive.</p>
</li>
</ul>
<h4 id="the-villain-resource">The Villain Resource</h4>
<p>During the project creation, the <code>VillainResource.java</code> file has been created with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.GET</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Path</span><span class="p">;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Produces</span><span class="p">;</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainResource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello from RESTEasy Reactive&quot;</span><span class="p">;</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="p">}</span>
</span></code></pre></div>
<p>It’s a very simple REST endpoint returning a "Hello World" to requests on <code>/api/villains</code>. It uses JAX-RS annotations:</p>
<ul>
<li>
<p><code>@Path</code> indicates the HTTP path handled by the resource,</p>
</li>
<li>
<p><code>@GET</code> indicates that the method should be called when receiving a <code>GET</code> request on <code>/api/villains</code>.</p>
</li>
</ul>
<table><tbody><tr><td><i title="Note"></i></td><td>Methods can also have their own <code>@Path</code> annotation suffixed to the class one (if any).</td></tr></tbody></table>

<h4 id="running-the-application">Running the Application</h4>
<p>Now we are ready to run our application.</p>
<p>Use: <code>./mvnw quarkus:dev</code> in the <code>rest-villains</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>$<span class="w"> </span>./mvnw<span class="w"> </span>quarkus:dev
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Scanning<span class="w"> </span><span class="k">for</span><span class="w"> </span>projects...
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="o">[</span>INFO<span class="o">]</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>-----------&lt;<span class="w"> </span>io.quarkus.workshop.super-heroes:rest-villains<span class="w"> </span>&gt;-----------
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span>rest-villains<span class="w"> </span><span class="m">1</span>.0.0-SNAPSHOT
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>--------------------------------<span class="o">[</span><span class="w"> </span>jar<span class="w"> </span><span class="o">]</span>---------------------------------
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="o">[</span>INFO<span class="o">]</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>---<span class="w"> </span>quarkus-maven-plugin:3.9.1:dev<span class="w"> </span><span class="o">(</span>default-cli<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>rest-villains<span class="w"> </span>---
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Invoking<span class="w"> </span>resources:3.6.0:resources<span class="w"> </span><span class="o">(</span>default-resources<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>rest-villains
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Copying<span class="w"> </span><span class="m">2</span><span class="w"> </span>resources<span class="w"> </span>from<span class="w"> </span>src/main/resources<span class="w"> </span>to<span class="w"> </span>target/classes
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Invoking<span class="w"> </span>quarkus:3.6.0:generate-code<span class="w"> </span><span class="o">(</span>default<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>rest-villains
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Invoking<span class="w"> </span>compiler:3.11.0:compile<span class="w"> </span><span class="o">(</span>default-compile<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>rest-villains
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Nothing<span class="w"> </span>to<span class="w"> </span>compile<span class="w"> </span>-<span class="w"> </span>all<span class="w"> </span>classes<span class="w"> </span>are<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>date
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Invoking<span class="w"> </span>resources:3.6.0:testResources<span class="w"> </span><span class="o">(</span>default-testResources<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>rest-villains
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>skip<span class="w"> </span>non<span class="w"> </span>existing<span class="w"> </span>resourceDirectory<span class="w"> </span>/Users/agoncal/Documents/Code/Temp/quarkus-super-heroes/super-heroes/rest-villains/src/test/resources
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Invoking<span class="w"> </span>quarkus:3.6.0:generate-code-tests<span class="w"> </span><span class="o">(</span>default<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>rest-villains
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Invoking<span class="w"> </span>compiler:3.11.0:testCompile<span class="w"> </span><span class="o">(</span>default-testCompile<span class="o">)</span><span class="w"> </span>@<span class="w"> </span>rest-villains
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span>Nothing<span class="w"> </span>to<span class="w"> </span>compile<span class="w"> </span>-<span class="w"> </span>all<span class="w"> </span>classes<span class="w"> </span>are<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>date
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>Listening<span class="w"> </span><span class="k">for</span><span class="w"> </span>transport<span class="w"> </span>dt_socket<span class="w"> </span>at<span class="w"> </span>address:<span class="w"> </span><span class="m">5005</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>__<span class="w">  </span>____<span class="w">  </span>__<span class="w">  </span>_____<span class="w">   </span>___<span class="w">  </span>__<span class="w"> </span>____<span class="w">  </span>______
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w"> </span>--/<span class="w"> </span>__<span class="w"> </span><span class="se">\/</span><span class="w"> </span>/<span class="w"> </span>/<span class="w"> </span>/<span class="w"> </span>_<span class="w"> </span><span class="p">|</span><span class="w"> </span>/<span class="w"> </span>_<span class="w"> </span><span class="se">\/</span><span class="w"> </span>//_/<span class="w"> </span>/<span class="w"> </span>/<span class="w"> </span>/<span class="w"> </span>__/
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w"> </span>-/<span class="w"> </span>/_/<span class="w"> </span>/<span class="w"> </span>/_/<span class="w"> </span>/<span class="w"> </span>__<span class="w"> </span><span class="p">|</span>/<span class="w"> </span>,<span class="w"> </span>_/<span class="w"> </span>,&lt;<span class="w"> </span>/<span class="w"> </span>/_/<span class="w"> </span>/<span class="se">\ \</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>--<span class="se">\_</span>__<span class="se">\_\_</span>___/_/<span class="w"> </span><span class="p">|</span>_/_/<span class="p">|</span>_/_/<span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>___/___/
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="m">2022</span>-11-15<span class="w"> </span><span class="m">14</span>:05:29,414<span class="w"> </span>INFO<span class="w">  </span><span class="o">[</span>io.quarkus<span class="o">]</span><span class="w"> </span><span class="o">(</span>Quarkus<span class="w"> </span>Main<span class="w"> </span>Thread<span class="o">)</span><span class="w"> </span>rest-villains<span class="w"> </span><span class="m">1</span>.0.0-SNAPSHOT<span class="w"> </span>on<span class="w"> </span>JVM<span class="w"> </span><span class="o">(</span>powered<span class="w"> </span>by<span class="w"> </span>Quarkus<span class="w"> </span><span class="m">3</span>.9.1<span class="o">)</span><span class="w"> </span>started<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span>.093s.<span class="w"> </span>Listening<span class="w"> </span>on:<span class="w"> </span>http://localhost:8080
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="m">2022</span>-11-15<span class="w"> </span><span class="m">14</span>:05:29,423<span class="w"> </span>INFO<span class="w">  </span><span class="o">[</span>io.quarkus<span class="o">]</span><span class="w"> </span><span class="o">(</span>Quarkus<span class="w"> </span>Main<span class="w"> </span>Thread<span class="o">)</span><span class="w"> </span>Profile<span class="w"> </span>dev<span class="w"> </span>activated.<span class="w"> </span>Live<span class="w"> </span>Coding<span class="w"> </span>activated.
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="m">2022</span>-11-15<span class="w"> </span><span class="m">14</span>:05:29,423<span class="w"> </span>INFO<span class="w">  </span><span class="o">[</span>io.quarkus<span class="o">]</span><span class="w"> </span><span class="o">(</span>Quarkus<span class="w"> </span>Main<span class="w"> </span>Thread<span class="o">)</span><span class="w"> </span>Installed<span class="w"> </span>features:<span class="w"> </span><span class="o">[</span>cdi,<span class="w"> </span>rest,<span class="w"> </span>rest-jackson,<span class="w"> </span>smallrye-context-propagation,<span class="w"> </span>vertx<span class="o">]</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>Tests<span class="w"> </span>paused
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>Press<span class="w"> </span><span class="o">[</span>r<span class="o">]</span><span class="w"> </span>to<span class="w"> </span>resume<span class="w"> </span>testing,<span class="w"> </span><span class="o">[</span>o<span class="o">]</span><span class="w"> </span>Toggle<span class="w"> </span><span class="nb">test</span><span class="w"> </span>output,<span class="w"> </span><span class="o">[</span>:<span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>terminal,<span class="w"> </span><span class="o">[</span>h<span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>options&gt;
</span></code></pre></div>
<p>Then check that the endpoint returns <code>hello</code> as expected:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>curl<span class="w"> </span>http://localhost:8080/api/villains
</span></code></pre></div>
<p>You should see the following</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Hello from RESTEasy Reactive
</span></code></pre></div>
<h4 id="development-mode">Development Mode</h4>
<p><code>quarkus:dev</code> runs Quarkus in development mode. It enables hot deployment with background compilation, which means that when you modify your Java files or your resource files and invoke a REST endpoint (i.e., cURL command or refresh your browser), these changes will automatically take effect. It works too for resource files like the configuration property and HTML files. Refreshing the browser triggers a scan of the workspace, and if any changes are detected, the Java files are recompiled and the application is redeployed; your request is then serviced by the redeployed application. If there are any issues with compilation or deployment an error page will let you know.</p>
<p>The development mode also allows debugging and listens for a debugger on port 5005. If you want to wait for the debugger to attach before running, you can pass <code>-Dsuspend=true</code> on the command line. If you don’t want the debugger at all, you can use <code>-Ddebug=false</code>.</p>
<p>Alright, time to change some code. Open your favorite IDE and import the project. To check that the hot reload is working, update the <code>VillainResource.hello()</code> method by returning the String "<em>Hello Villain Resource</em>".</p>
<p>Now, execute the cURL command again:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>curl<span class="w"> </span>http://localhost:8080/api/villains
</span></code></pre></div>
<p>The output has changed ("<em>Hello Villain Resource</em>") without you having to stop and restart Quarkus!</p>
<h4 id="testing-the-application">Testing the Application</h4>
<p>All right, so far, so good, but wouldn’t it be better with a few tests, just in case.</p>
<p>In the generated <code>pom.xml</code> file, you can see two test dependencies:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">&lt;dependencies&gt;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>quarkus-junit5<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">        </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>io.rest-assured<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>rest-assured<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">        </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></div>
<p>So, we will use Junit 5 combined with RESTAssured, which eases the testing of REST applications.</p>
<p>If you look at the <code>maven-surefire-plugin</code> configuration in the <code>pom.xml</code>, you will see that we set the <code>java.util.logging</code> system property to ensure tests will use the correct method log manager.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nt">&lt;plugin&gt;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>${surefire-plugin.version}<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">      </span><span class="nt">&lt;systemPropertyVariables&gt;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">        </span><span class="nt">&lt;java.util.logging.manager&gt;</span>org.jboss.logmanager.LogManager<span class="nt">&lt;/java.util.logging.manager&gt;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">        </span><span class="nt">&lt;maven.home&gt;</span>${maven.home}<span class="nt">&lt;/maven.home&gt;</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">      </span><span class="nt">&lt;/systemPropertyVariables&gt;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="nt">&lt;/configuration&gt;</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></div>
<p>The generated project contains a simple test in <code>VillainResourceTest.java</code>.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.junit.QuarkusTest</span><span class="p">;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.given</span><span class="p">;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.hamcrest.CoreMatchers.is</span><span class="p">;</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainResourceTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testHelloEndpoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">          </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">          </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">             </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">             </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello from RESTEasy Reactive&quot;</span><span class="p">));</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>By using the <code>QuarkusTest</code> runner, the <code>VillainResourceTest</code> class instructs JUnit to start the application before the tests. Then, the <code>testHelloEndpoint</code> method checks the HTTP response status code and content. Notice that these tests use RestAssured, but feel free to use your favorite library</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Quarkus provides a RestAssured integration that updates the default port used by RestAssured before the tests are run. So in your RestAssured tests, you don’t have to specify the default test port 8081 used by Quarkus. You can also configure the ports used by tests by configuring the <code>quarkus.http.test-port</code> property in the application.properties.</p></td></tr></tbody></table>

<p>In the terminal running the application in <em>dev mode</em> (<code>./mvnw quarkus:dev</code>), you should see at the bottom:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Tests paused
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Press [r] to resume testing, [o] Toggle test output, [:] for the terminal, [h] for more options&gt;
</span></code></pre></div>
<p>Hit the <code>r</code> key, and watch Quarkus execute your tests automatically and even continuously. Unfortunately, this first run didn’t end well:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>2022-11-15 14:13:17,924 ERROR [io.qua.test] (Test runner thread) ==================== TEST REPORT #1 ====================
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>2022-11-15 14:13:17,925 ERROR [io.qua.test] (Test runner thread) Test VillainResourceTest#testHelloEndpoint() failed
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>: java.lang.AssertionError: 1 expectation failed.
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>Response body doesn&#39;t match expectation.
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>Expected: is &quot;Hello from RESTEasy Reactive&quot;
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>  Actual: Hello Villain Resource
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>        at io.restassured.internal.ValidatableResponseImpl.body(ValidatableResponseImpl.groovy)
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        at io.quarkus.workshop.superheroes.villain.VillainResourceTest.testHelloEndpoint(VillainResourceTest.java:18)
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>2022-11-15 14:13:17,927 ERROR [io.qua.test] (Test runner thread) &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Summary: &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>io.quarkus.workshop.superheroes.villain.VillainResourceTest#testHelloEndpoint(VillainResourceTest.java:18) VillainResourceTest#testHelloEndpoint() 1 expectation failed.
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>Response body doesn&#39;t match expectation.
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>Expected: is &quot;Hello from RESTEasy Reactive&quot;
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>  Actual: Hello Villain Resource
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>2022-11-15 14:13:17,929 ERROR [io.qua.test] (Test runner thread) &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1 TEST FAILED &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>2022-11-15 14:13:18,155 ERROR [io.qua.test] (Test runner thread) ==================== TEST REPORT #2 ====================
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>2022-11-15 14:13:18,155 ERROR [io.qua.test] (Test runner thread) Test VillainResourceTest#testHelloEndpoint() failed
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>: java.lang.AssertionError: 1 expectation failed.
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>Response body doesn&#39;t match expectation.
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>Expected: is &quot;Hello from RESTEasy Reactive&quot;
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>  Actual: Hello Villain Resource
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>        at io.restassured.internal.ValidatableResponseImpl.body(ValidatableResponseImpl.groovy)
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>        at io.quarkus.workshop.superheroes.villain.VillainResourceTest.testHelloEndpoint(VillainResourceTest.java:18)
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>2022-11-15 14:13:18,156 ERROR [io.qua.test] (Test runner thread) &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Summary: &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>io.quarkus.workshop.superheroes.villain.VillainResourceTest#testHelloEndpoint(VillainResourceTest.java:18) VillainResourceTest#testHelloEndpoint() 1 expectation failed.
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>Response body doesn&#39;t match expectation.
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>Expected: is &quot;Hello from RESTEasy Reactive&quot;
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>  Actual: Hello Villain Resource
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>2022-11-15 14:13:18,157 ERROR [io.qua.test] (Test runner thread) &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1 TEST FAILED &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</span></code></pre></div>
<p>It fails! It’s expected, you changed the output of <code>VillainResource.hello()</code> earlier. Adjust the test body condition accordingly:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.junit.QuarkusTest</span><span class="p">;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.given</span><span class="p">;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.hamcrest.CoreMatchers.is</span><span class="p">;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainResourceTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testHelloEndpoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">          </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">          </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">             </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">             </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello Villain Resource&quot;</span><span class="p">));</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>Save the file, and watch the dev mode automatically rerunning your test (and passing)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>--
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>2022-11-15 14:15:22,997 INFO  [io.qua.test] (Test runner thread) All tests are now passing
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>--
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>All 1 test is passing (0 skipped), 1 test was run in 186ms. Tests completed at 14:15:23.
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>Press [r] to re-run, [o] Toggle test output, [:] for the terminal, [h] for more options&gt;
</span></code></pre></div>
<p>Continuous testing is a big part of Quarkus development. Quarkus detects and runs the tests for you.</p>
<p>You can also run the tests from a terminal using:</p>
<h4 id="packaging-and-running-the-application">Packaging and Running the Application</h4>
<p>The application is packaged using the <code>./mvnw package</code> command (it also runs the tests). That command generates:</p>
<ul>
<li>
<p><code>target/rest-villains-1.0.0-SNAPSHOT.jar</code>: containing just the classes and resources of the projects, it’s the regular artifact produced by the Maven build (it is not an executable jar);</p>
</li>
<li>
<p><code>target/quarkus-app/</code> : this directory uses the <em>fast jar</em> packaging. It contains an executable jar (<code>quarkus-run.jar</code>), and all the dependencies (structured into <code>app</code>, <code>lib</code> and <code>quarkus</code>).</p>
</li>
</ul>
<p>This <em>fast jar</em> takes advantage of the build-time principle of Quarkus (we discuss it soon) to improve the application performances and which can be easily transposed to container layers.</p>
<p>Stop the application running in dev mode (by hitting <code>q</code> or <code>CTRL+C</code>), and run the application using: <code>java -jar target/quarkus-app/quarkus-run.jar</code>.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Before running the application, don’t forget to stop the hot reload mode (hit CTRL+C), or you will have a port conflict.</p></td></tr></tbody></table>

<table><tbody><tr><td><i title="Warning"></i></td><td><div><p>Troubleshooting</p><p>You might come across the following error while developing:</p></div><div><pre><code data-lang="shell">WARN  [io.qu.ne.ru.NettyRecorder] (Thread-48) Localhost lookup took more than one second; you need to add a /etc/hosts entry to improve Quarkus startup time. See https://thoeni.io/post/macos-sierra-java/ for details.</code></pre></div><p>If this is the case, it’s just a matter of adding the node name of your machine to the /etc/hosts. For that, first, get the name of your node with the following command:</p><p>Then <code>sudo vi /etc/hosts</code> so you have the right to edit the file and add the following entry:</p><div><pre><code data-lang="shell">127.0.0.1 localhost my-node.local</code></pre></div></td></tr></tbody></table>

<p>In another terminal, check that the application runs using:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>curl<span class="w"> </span>http://localhost:8080/api/villains
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>Hello<span class="w"> </span>Villain<span class="w"> </span>Resource
</span></code></pre></div>
<h3 id="transactions-and-orm">Transactions and ORM</h3>
<p>The Villain API’s role is to allow CRUD operations on Super Villains. In this module we will create a Villain entity and persist/update/delete/retrieve it from a PostgreSQL database in a transactional way.</p>
<p>This microservice uses an imperative/classic execution model. Interactions with the database will uses Hibernate ORM and will block until the responses from the database are retrieved.</p>
<h4 id="directory-structure_1">Directory Structure</h4>
<p>In this module we will add extra classes to the Villain API project. You will end-up with the following directory structure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-b3ee510d38dad3af75462173c8341109.png" /></p>
<h4 id="installing-the-postgresql-dependency-hibernate-with-panache-and-hibernate-validator">Installing the PostgreSQL Dependency, Hibernate with Panache and Hibernate Validator</h4>
<p>This microservice:</p>
<ul>
<li>
<p>Interacts with a PostgreSQL database - so it needs a driver</p>
</li>
<li>
<p>Uses Hibernate with Panache - needs the extension providing it</p>
</li>
<li>
<p>Validates payloads and entities - needs a validator</p>
</li>
<li>
<p>Consumes and produces JSON - needs a JSON mapper</p>
</li>
</ul>
<p>Hibernate ORM is the de-facto JPA implementation and offers you the full breadth of an Object Relational Mapper. It makes complex mappings possible, but it does not make simple and common mappings trivial. Hibernate ORM with Panache focuses on making your entities trivial and fun to write in Quarkus</p>
<p>Because JPA and Bean Validation work well together, we will use Bean Validation to constrain our business model.</p>
<p>To add the required dependencies, just run the following command under the <code>super-heroes/rest-villains</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>./mvnw<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jdbc-postgresql,hibernate-orm-panache,hibernate-validator&quot;</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Tip"></i></td><td>No need to add an extension for JSON, we already included <code>rest-jackson</code>.</td></tr></tbody></table>

<p>This will add the following dependencies in the <code>pom.xml</code> file:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nt">&lt;dependencies&gt;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>quarkus-hibernate-orm-panache<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>quarkus-hibernate-validator<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>quarkus-jdbc-postgresql<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></div>
<p>From now on, you can choose to either edit your pom directly or use the <code>quarkus:add-extension</code> command.</p>
<h4 id="villain-entity">Villain Entity</h4>
<p>To define a Panache entity, simply extend <code>PanacheEntity</code>, annotate it with <code>@Entity</code> and add your columns as public fields (no need to have getters and setters). The <code>Villain</code> entity should look like this:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.hibernate.orm.panache.PanacheEntity</span><span class="p">;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Column</span><span class="p">;</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Entity</span><span class="p">;</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Min</span><span class="p">;</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Size</span><span class="p">;</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="nd">@Entity</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Villain</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">PanacheEntity</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">otherName</span><span class="p">;</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">    </span><span class="nd">@Min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p">;</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">picture</span><span class="p">;</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">columnDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TEXT&quot;</span><span class="p">)</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">powers</span><span class="p">;</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Villain{&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">            </span><span class="s">&quot;id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">            </span><span class="s">&quot;, name=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="w">            </span><span class="s">&quot;, otherName=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">otherName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="w">            </span><span class="s">&quot;, level=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="w">            </span><span class="s">&quot;, picture=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">picture</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="w">            </span><span class="s">&quot;, powers=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">powers</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="w">            </span><span class="sc">&#39;}&#39;</span><span class="p">;</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="p">}</span>
</span></code></pre></div>
<p>Notice that you can put all your JPA column annotations and Bean Validation constraint annotations on the public fields.</p>
<h5 id="adding-operations">Adding Operations</h5>
<p>Thanks to Panache, once you have written the <code>Villain</code> entity, here are the most common operations you will be able to do:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">// creating a villain</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Villain</span><span class="p">();</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Lex Luthor&quot;</span><span class="p">;</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="c1">// persist it</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="n">villain</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="c1">// getting a list of all Villain entities</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">listAll</span><span class="p">();</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="c1">// finding a specific villain by ID</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="c1">// counting all villains</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="kt">long</span><span class="w"> </span><span class="n">countAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">count</span><span class="p">();</span>
</span></code></pre></div>
<p>But we are missing a business method: we need to return a random villain.</p>
<p>For that it’s just a matter to add the following method to our <code>Villain.java</code> entity:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">findRandom</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">countVillains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">();</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="n">Random</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">();</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">randomVillain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="na">nextInt</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">countVillains</span><span class="p">);</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">findAll</span><span class="p">().</span><span class="na">page</span><span class="p">(</span><span class="n">randomVillain</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="na">firstResult</span><span class="p">();</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="p">}</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>You would need to add the following import statement if not done automatically by your IDE <code>import java.util.Random;</code></p></td></tr></tbody></table>

<p>Picking a random villain is achieved as follows:</p>
<ol>
<li>
<p>Gets the number of villains stored in the database (<code>count()</code>)</p>
</li>
<li>
<p>Picks a random number between 0 and <code>count()</code></p>
</li>
<li>
<p>Asks Hibernate with Panache to find all villains in a paginated way and return the random page containing 1 villain.</p>
</li>
</ol>
<h4 id="configuring-hibernate">Configuring Hibernate</h4>
<p>Quarkus development mode is really useful for applications that mix front end or services and database access. We use <code>quarkus.hibernate-orm.database.generation=drop-and-create</code> in conjunction with <code>import.sql</code> so every change to your app and in particular to your entities, the database schema will be properly recreated and your data (stored in <code>import.sql</code>) will be used to repopulate it from scratch. This is best to perfectly control your environment and works magic with Quarkus live reload mode: your entity changes or any change to your <code>import.sql</code> is immediately picked up and the schema updated without restarting the application!</p>
<p>For that, make sure to have the following configuration in your <code>application.properties</code> (located in <code>src/main/resources</code>):</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># drop and create the database at startup (use `update` to only update the schema)</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="na">quarkus.hibernate-orm.database.generation</span><span class="o">=</span><span class="s">drop-and-create</span>
</span></code></pre></div>
<h4 id="villain-service">Villain Service</h4>
<p>To manipulate the <code>Villain</code> entity we will develop a transactional <code>VillainService</code> class. The idea is to wrap methods modifying the database (e.g. <code>entity.persist()</code>) within a transaction. Marking a CDI bean method <code>@Transactional</code> will do that for you and make that method a transaction boundary.</p>
<p><code>@Transactional</code> can be used to control transaction boundaries on any bean at the method level or at the class level to ensure every method is transactional. You can control whether and how the transaction is started with parameters on <code>@Transactional</code>:</p>
<ul>
<li>
<p><code>@Transactional(REQUIRED)</code> (default): starts a transaction if none was started, stays with the existing one otherwise.</p>
</li>
<li>
<p><code>@Transactional(REQUIRES_NEW)</code>: starts a transaction if none was started ; if an existing one was started, suspends it and starts a new one for the boundary of that method.</p>
</li>
<li>
<p><code>@Transactional(MANDATORY)</code>: fails if no transaction was started ; works within the existing transaction otherwise.</p>
</li>
<li>
<p><code>@Transactional(SUPPORTS)</code>: if a transaction was started, joins it ; otherwise works with no transaction.</p>
</li>
<li>
<p><code>@Transactional(NOT_SUPPORTED)</code>: if a transaction was started, suspends it and works with no transaction for the boundary of the method ; otherwise works with no transaction.</p>
</li>
<li>
<p><code>@Transactional(NEVER)</code>: if a transaction was started, raises an exception ; otherwise works with no transaction.</p>
</li>
</ul>
<p>Creates a new <code>VillainService.java</code> file in the same package with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional.TxType.REQUIRED</span><span class="p">;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional.TxType.SUPPORTS</span><span class="p">;</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional</span><span class="p">;</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.config.inject.ConfigProperty</span><span class="p">;</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="nd">@Transactional</span><span class="p">(</span><span class="n">REQUIRED</span><span class="p">)</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainService</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w">    </span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">SUPPORTS</span><span class="p">)</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAllVillains</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">listAll</span><span class="p">();</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w">    </span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">SUPPORTS</span><span class="p">)</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">findVillainById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="w">    </span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">SUPPORTS</span><span class="p">)</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">findRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">randomVillain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">randomVillain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="w">            </span><span class="n">randomVillain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">findRandom</span><span class="p">();</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">randomVillain</span><span class="p">;</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">persistVillain</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">villain</span><span class="p">;</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">updateVillain</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">id</span><span class="p">);</span>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a><span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="p">;</span>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a><span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villain</span><span class="p">.</span><span class="na">otherName</span><span class="p">;</span>
</span><span id="__span-30-46"><a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="p">;</span>
</span><span id="__span-30-47"><a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="p">;</span>
</span><span id="__span-30-48"><a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a><span class="w">        </span><span class="n">entity</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villain</span><span class="p">.</span><span class="na">powers</span><span class="p">;</span>
</span><span id="__span-30-49"><a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">entity</span><span class="p">;</span>
</span><span id="__span-30-50"><a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-51"><a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a>
</span><span id="__span-30-52"><a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteVillain</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-53"><a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-30-54"><a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">delete</span><span class="p">();</span>
</span><span id="__span-30-55"><a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-56"><a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>@ApplicationScoped</code> annotation declares a <em>bean</em>. The other component of the application can access this bean. Arc, the dependency injection framework integrated in Quarkus, handles the creation and the access to this class.</p>
<p>Notice that both methods that persist and update a villain, pass a <code>Villain</code> object as a parameter. Thanks to the Bean Validation’s <code>@Valid</code> annotation, the <code>Villain</code> object will be checked to see if it’s valid or not. If it’s not, the transaction will be rolled back.</p>
<h4 id="accessing-a-database-in-dev-mode">Accessing a database in dev mode</h4>
<p>Our project now requires a connection to a PostgreSQL database. In dev mode, no need to start a database or configure anything. Quarkus does that for us (just make sure you have Docker up and running).</p>
<p>Start the application in dev mode with <code>./mvnw quarkus:dev</code>. In the log, you will see the following:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>2021-09-21 15:58:44,640 INFO  [org.tes.doc.DockerClientProviderStrategy] (build-38) Loaded org.testcontainers.dockerclient.UnixSocketClientProviderStrategy from ~/.testcontainers.properties, will try it first
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>2021-09-21 15:58:45,068 INFO  [org.tes.doc.DockerClientProviderStrategy] (build-38) Found Docker environment with local Unix socket (unix:///var/run/docker.sock)
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>2021-09-21 15:58:45,070 INFO  [org.tes.DockerClientFactory] (build-38) Docker host IP address is localhost
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>2021-09-21 15:58:45,116 INFO  [org.tes.DockerClientFactory] (build-38) Connected to docker:
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>  Server Version: 20.10.8
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>  API Version: 1.41
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>  Operating System: Docker Desktop
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>  Total Memory: 5943 MB
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>2021-09-21 15:58:45,118 INFO  [org.tes.uti.ImageNameSubstitutor] (build-38) Image name substitution will be performed by: DefaultImageNameSubstitutor (composite of &#39;ConfigurationFileImageNameSubstitutor&#39; and &#39;PrefixingImageNameSubstitutor&#39;)
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>2021-09-21 15:58:45,453 INFO  [org.tes.uti.RegistryAuthLocator] (build-38) Credential helper/store (docker-credential-desktop) does not have credentials for index.docker.io
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>2021-09-21 15:58:45,957 INFO  [org.tes.DockerClientFactory] (build-38) Ryuk started - will monitor and terminate Testcontainers containers on JVM exit
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>2021-09-21 15:58:45,958 INFO  [org.tes.DockerClientFactory] (build-38) Checking the system...
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>2021-09-21 15:58:45,958 INFO  [org.tes.DockerClientFactory] (build-38) ✔︎ Docker server version should be at least 1.6.0
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>2021-09-21 15:58:46,083 INFO  [org.tes.DockerClientFactory] (build-38) ✔︎ Docker environment should have more than 2GB free disk space
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>2021-09-21 15:58:46,143 INFO  [🐳 .2]] (build-38) Creating container for image: postgres:13.2
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>2021-09-21 15:58:46,217 INFO  [🐳 .2]] (build-38) Starting container with ID: a7fd54795185ab17baf487388c1e3280fdfea3f6ef8670c0336d367dba3e1d9e
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>2021-09-21 15:58:46,545 INFO  [🐳 .2]] (build-38) Container postgres:13.2 is starting: a7fd54795185ab17baf487388c1e3280fdfea3f6ef8670c0336d367dba3e1d9e
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>2021-09-21 15:58:48,043 INFO  [🐳 .2]] (build-38) Container postgres:13.2 started in PT1.959377S
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>2021-09-21 15:58:48,044 INFO  [io.qua.dev.pos.dep.PostgresqlDevServicesProcessor] (build-38) Dev Services for the default datasource (postgresql) started
</span></code></pre></div>
<p>Quarkus detects the need for a database and starts one using a Docker container. It automatically configures the application, which means we are good to go and implement our REST API.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>If the application fails to start properly and the logs contain something like</p><div><pre><code data-lang="text">WARN  [or.te.ut.RyukResourceReaper] (testcontainers-ryuk) Can not connect to Ryuk at localhost:49153: java.net.ConnectException: Connection refused (Connection refused)</code></pre></div><p>try launching the application again after having the <code>TESTCONTAINERS_RYUK_DISABLED</code> environment variable to <code>true</code>. This setting will likely also be needed <strong>throughout</strong> the workshop.</p></td></tr></tbody></table>

<h4 id="villainresource-endpoint">VillainResource Endpoint</h4>
<p>The <code>VillainResource</code> was bootstrapped with only one method <code>hello()</code>. We need to add extra methods that will allow CRUD operations on villains.</p>
<p>Here are the new methods to add to the <code>VillainResource</code> class:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.resteasy.reactive.RestPath</span><span class="p">;</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.resteasy.reactive.RestResponse</span><span class="p">;</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.DELETE</span><span class="p">;</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.GET</span><span class="p">;</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.POST</span><span class="p">;</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.PUT</span><span class="p">;</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Path</span><span class="p">;</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Produces</span><span class="p">;</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Context</span><span class="p">;</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.UriBuilder</span><span class="p">;</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.UriInfo</span><span class="p">;</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.TEXT_PLAIN</span><span class="p">;</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainResource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="w">    </span><span class="n">VillainService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">VillainResource</span><span class="p">(</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">VillainService</span><span class="w"> </span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-32-33"><a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/random&quot;</span><span class="p">)</span>
</span><span id="__span-32-34"><a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-35"><a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findRandomVillain</span><span class="p">();</span>
</span><span id="__span-32-36"><a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Found random villain &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-37"><a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-38"><a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-39"><a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a>
</span><span id="__span-32-40"><a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-32-41"><a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getAllVillains</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-42"><a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findAllVillains</span><span class="p">();</span>
</span><span id="__span-32-43"><a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Total number of villains &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villains</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-32-44"><a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villains</span><span class="p">);</span>
</span><span id="__span-32-45"><a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-46"><a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a>
</span><span id="__span-32-47"><a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-32-48"><a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-32-49"><a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getVillain</span><span class="p">(</span><span class="nd">@RestPath</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-50"><a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findVillainById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-32-51"><a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">villain</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-52"><a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Found villain &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-53"><a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-54"><a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-55"><a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;No villain found with id &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-32-56"><a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">noContent</span><span class="p">();</span>
</span><span id="__span-32-57"><a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-32-58"><a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-59"><a id="__codelineno-32-59" name="__codelineno-32-59" href="#__codelineno-32-59"></a>
</span><span id="__span-32-60"><a id="__codelineno-32-60" name="__codelineno-32-60" href="#__codelineno-32-60"></a><span class="w">    </span><span class="nd">@POST</span>
</span><span id="__span-32-61"><a id="__codelineno-32-61" name="__codelineno-32-61" href="#__codelineno-32-61"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createVillain</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">,</span><span class="w"> </span><span class="nd">@Context</span><span class="w"> </span><span class="n">UriInfo</span><span class="w"> </span><span class="n">uriInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-62"><a id="__codelineno-32-62" name="__codelineno-32-62" href="#__codelineno-32-62"></a><span class="w">        </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">persistVillain</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-63"><a id="__codelineno-32-63" name="__codelineno-32-63" href="#__codelineno-32-63"></a><span class="w">        </span><span class="n">UriBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uriInfo</span><span class="p">.</span><span class="na">getAbsolutePathBuilder</span><span class="p">().</span><span class="na">path</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">id</span><span class="p">));</span>
</span><span id="__span-32-64"><a id="__codelineno-32-64" name="__codelineno-32-64" href="#__codelineno-32-64"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;New villain created with URI &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-32-65"><a id="__codelineno-32-65" name="__codelineno-32-65" href="#__codelineno-32-65"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">created</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
</span><span id="__span-32-66"><a id="__codelineno-32-66" name="__codelineno-32-66" href="#__codelineno-32-66"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-67"><a id="__codelineno-32-67" name="__codelineno-32-67" href="#__codelineno-32-67"></a>
</span><span id="__span-32-68"><a id="__codelineno-32-68" name="__codelineno-32-68" href="#__codelineno-32-68"></a><span class="w">    </span><span class="nd">@PUT</span>
</span><span id="__span-32-69"><a id="__codelineno-32-69" name="__codelineno-32-69" href="#__codelineno-32-69"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateVillain</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-70"><a id="__codelineno-32-70" name="__codelineno-32-70" href="#__codelineno-32-70"></a><span class="w">        </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">updateVillain</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-71"><a id="__codelineno-32-71" name="__codelineno-32-71" href="#__codelineno-32-71"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Villain updated with new valued &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-72"><a id="__codelineno-32-72" name="__codelineno-32-72" href="#__codelineno-32-72"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-32-73"><a id="__codelineno-32-73" name="__codelineno-32-73" href="#__codelineno-32-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-74"><a id="__codelineno-32-74" name="__codelineno-32-74" href="#__codelineno-32-74"></a>
</span><span id="__span-32-75"><a id="__codelineno-32-75" name="__codelineno-32-75" href="#__codelineno-32-75"></a><span class="w">    </span><span class="nd">@DELETE</span>
</span><span id="__span-32-76"><a id="__codelineno-32-76" name="__codelineno-32-76" href="#__codelineno-32-76"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-32-77"><a id="__codelineno-32-77" name="__codelineno-32-77" href="#__codelineno-32-77"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">deleteVillain</span><span class="p">(</span><span class="nd">@RestPath</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-78"><a id="__codelineno-32-78" name="__codelineno-32-78" href="#__codelineno-32-78"></a><span class="w">        </span><span class="n">service</span><span class="p">.</span><span class="na">deleteVillain</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-32-79"><a id="__codelineno-32-79" name="__codelineno-32-79" href="#__codelineno-32-79"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Villain deleted with &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-32-80"><a id="__codelineno-32-80" name="__codelineno-32-80" href="#__codelineno-32-80"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">noContent</span><span class="p">();</span>
</span><span id="__span-32-81"><a id="__codelineno-32-81" name="__codelineno-32-81" href="#__codelineno-32-81"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-82"><a id="__codelineno-32-82" name="__codelineno-32-82" href="#__codelineno-32-82"></a>
</span><span id="__span-32-83"><a id="__codelineno-32-83" name="__codelineno-32-83" href="#__codelineno-32-83"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-32-84"><a id="__codelineno-32-84" name="__codelineno-32-84" href="#__codelineno-32-84"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
</span><span id="__span-32-85"><a id="__codelineno-32-85" name="__codelineno-32-85" href="#__codelineno-32-85"></a><span class="w">    </span><span class="nd">@Produces</span><span class="p">(</span><span class="n">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-32-86"><a id="__codelineno-32-86" name="__codelineno-32-86" href="#__codelineno-32-86"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-87"><a id="__codelineno-32-87" name="__codelineno-32-87" href="#__codelineno-32-87"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello Villain Resource&quot;</span><span class="p">;</span>
</span><span id="__span-32-88"><a id="__codelineno-32-88" name="__codelineno-32-88" href="#__codelineno-32-88"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-89"><a id="__codelineno-32-89" name="__codelineno-32-89" href="#__codelineno-32-89"></a><span class="p">}</span>
</span></code></pre></div>
<p>Note that we added <code>@Path("/hello")</code> to the <code>hello</code> method to not conflict with the <code>getAllVillains()</code> method.</p>
<h4 id="dependency-injection">Dependency Injection</h4>
<p>Dependency injection in Quarkus is based on ArC which is a CDI-based dependency injection solution tailored for Quarkus' architecture You can learn more about it in the Contexts and Dependency Injection guide.</p>
<p>ArC handles injection at build time. You can use field injection and inject the <code>VillainService</code> and the logger using:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nd">@Inject</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nd">@Inject</span><span class="w"> </span><span class="n">VillainService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span></code></pre></div>
<p>But in your previous class, we used constructor injection. Both the <code>VillainService</code> and the <code>Logger</code> are injected as constructor parameter:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kd">public</span><span class="w"> </span><span class="nf">VillainResource</span><span class="p">(</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">VillainService</span><span class="w"> </span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="adding-data">Adding Data</h4>
<p>To load some SQL statements when Hibernate ORM starts, add the following <code>import.sql</code> in the root of the <code>resources</code> directory. It contains SQL statements terminated by a semicolon. This is useful to have a data set ready for the tests or demos.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">ALTER</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">villain_seq</span><span class="w"> </span><span class="k">RESTART</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">villain</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">otherName</span><span class="p">,</span><span class="w"> </span><span class="n">picture</span><span class="p">,</span><span class="w"> </span><span class="n">powers</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">)</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;villain_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Buuccolo&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Majin Buu&#39;</span><span class="p">,</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">        </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/15355.jpg&#39;</span><span class="p">,</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">        </span><span class="s1">&#39;Accelerated Healing, Adaptation, Agility, Flight, Immortality, Intelligence, Invulnerability, Reflexes, Self-Sustenance, Size Changing, Spatial Awareness, Stamina, Stealth, Super Breath, Super Speed, Super Strength, Teleportation&#39;</span><span class="p">,</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">        </span><span class="mi">22</span><span class="p">);</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">villain</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">otherName</span><span class="p">,</span><span class="w"> </span><span class="n">picture</span><span class="p">,</span><span class="w"> </span><span class="n">powers</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">)</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;villain_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Darth Vader&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Anakin Skywalker&#39;</span><span class="p">,</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">        </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/10444.jpg&#39;</span><span class="p">,</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">        </span><span class="s1">&#39;Accelerated Healing, Agility, Astral Projection, Cloaking, Danger Sense, Durability, Electrokinesis, Energy Blasts, Enhanced Hearing, Enhanced Senses, Force Fields, Hypnokinesis, Illusions, Intelligence, Jump, Light Control, Marksmanship, Precognition, Psionic Powers, Reflexes, Stealth, Super Speed, Telekinesis, Telepathy, The Force, Weapons Master&#39;</span><span class="p">,</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">        </span><span class="mi">13</span><span class="p">);</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">villain</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">otherName</span><span class="p">,</span><span class="w"> </span><span class="n">picture</span><span class="p">,</span><span class="w"> </span><span class="n">powers</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">)</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;villain_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;The Rival (CW)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Edward Clariss&#39;</span><span class="p">,</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">        </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/13846.jpg&#39;</span><span class="p">,</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">        </span><span class="s1">&#39;Accelerated Healing, Agility, Bullet Time, Durability, Electrokinesis, Endurance, Enhanced Senses, Intangibility, Marksmanship, Phasing, Reflexes, Speed Force, Stamina, Super Speed, Super Strength&#39;</span><span class="p">,</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">        </span><span class="mi">10</span><span class="p">);</span>
</span></code></pre></div>
<p>Ok, but that’s just a few entries. Download the SQL file <a href="https://raw.githubusercontent.com/johan-die/workshop-super-hero-data/main/import.sql">import.sql</a> and copy it under <code>src/main/resources</code>. Now, you have more than 500 villains that will be loaded in the database.</p>
<p>If you didn’t yet, start the application in dev mode by executing the following command under the <code>rest-villains</code> directory:</p>
<h4 id="crud-tests-in-villainresourcetest">CRUD Tests in VillainResourceTest</h4>
<p>To test the <code>VillainResource</code> endpoint, we just need to extend the <code>VillainResourceTest</code> we already have. No need to configure anything, Quarkus will start a test database for you.</p>
<p>In <code>io.quarkus.workshop.superheroes.villain.VillainResourceTest</code>, you will add the following test methods to the <code>VillainResourceTest</code> class:</p>
<ul>
<li>
<p><code>shouldNotGetUnknownVillain</code>: giving a random Villain identifier, the <code>VillainResource</code> endpoint should return a 204 (No content)</p>
</li>
<li>
<p><code>shouldGetRandomVillain</code>: checks that the <code>VillainResource</code> endpoint returns a random villain</p>
</li>
<li>
<p><code>shouldNotAddInvalidItem</code>: passing an invalid <code>Villain</code> should fail when creating it (thanks to the <code>@Valid</code> annotation)</p>
</li>
<li>
<p><code>shouldGetInitialItems</code>: checks that the <code>VillainResource</code> endpoint returns the list of heroes</p>
</li>
<li>
<p><code>shouldAddAnItem</code>: checks that the <code>VillainResource</code> endpoint creates a valid <code>Villain</code></p>
</li>
<li>
<p><code>shouldUpdateAnItem</code>: checks that the <code>VillainResource</code> endpoint updates a newly created <code>Villain</code></p>
</li>
<li>
<p><code>shouldRemoveAnItem</code>: checks that the <code>VillainResource</code> endpoint deletes a villain from the database</p>
</li>
</ul>
<p>The code is as follows:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.junit.QuarkusTest</span><span class="p">;</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.restassured.common.mapper.TypeRef</span><span class="p">;</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.hamcrest.core.Is</span><span class="p">;</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.MethodOrderer</span><span class="p">;</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Order</span><span class="p">;</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.TestMethodOrder</span><span class="p">;</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.get</span><span class="p">;</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.given</span><span class="p">;</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.ACCEPT</span><span class="p">;</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.CONTENT_TYPE</span><span class="p">;</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.TEXT_PLAIN</span><span class="p">;</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.BAD_REQUEST</span><span class="p">;</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.CREATED</span><span class="p">;</span>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.NO_CONTENT</span><span class="p">;</span>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.OK</span><span class="p">;</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.hamcrest.CoreMatchers.is</span><span class="p">;</span>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span><span class="p">;</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertNotNull</span><span class="p">;</span>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertTrue</span><span class="p">;</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a>
</span><span id="__span-36-29"><a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-36-30"><a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a><span class="nd">@TestMethodOrder</span><span class="p">(</span><span class="n">MethodOrderer</span><span class="p">.</span><span class="na">OrderAnnotation</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-36-31"><a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainResourceTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-32"><a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a>
</span><span id="__span-36-33"><a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;application/json;charset=UTF-8&quot;</span><span class="p">;</span>
</span><span id="__span-36-34"><a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a>
</span><span id="__span-36-35"><a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Chocolatine&quot;</span><span class="p">;</span>
</span><span id="__span-36-36"><a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Chocolatine (updated)&quot;</span><span class="p">;</span>
</span><span id="__span-36-37"><a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_OTHER_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Chocolatine chocolate in&quot;</span><span class="p">;</span>
</span><span id="__span-36-38"><a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_OTHER_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Chocolatine chocolate in (updated)&quot;</span><span class="p">;</span>
</span><span id="__span-36-39"><a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_chocolatine.png&quot;</span><span class="p">;</span>
</span><span id="__span-36-40"><a id="__codelineno-36-40" name="__codelineno-36-40" href="#__codelineno-36-40"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_chocolatine_updated.png&quot;</span><span class="p">;</span>
</span><span id="__span-36-41"><a id="__codelineno-36-41" name="__codelineno-36-41" href="#__codelineno-36-41"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;does not eat pain au chocolat&quot;</span><span class="p">;</span>
</span><span id="__span-36-42"><a id="__codelineno-36-42" name="__codelineno-36-42" href="#__codelineno-36-42"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;does not eat pain au chocolat (updated)&quot;</span><span class="p">;</span>
</span><span id="__span-36-43"><a id="__codelineno-36-43" name="__codelineno-36-43" href="#__codelineno-36-43"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-36-44"><a id="__codelineno-36-44" name="__codelineno-36-44" href="#__codelineno-36-44"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">UPDATED_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">43</span><span class="p">;</span>
</span><span id="__span-36-45"><a id="__codelineno-36-45" name="__codelineno-36-45" href="#__codelineno-36-45"></a>
</span><span id="__span-36-46"><a id="__codelineno-36-46" name="__codelineno-36-46" href="#__codelineno-36-46"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NB_VILLAINS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">570</span><span class="p">;</span>
</span><span id="__span-36-47"><a id="__codelineno-36-47" name="__codelineno-36-47" href="#__codelineno-36-47"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">villainId</span><span class="p">;</span>
</span><span id="__span-36-48"><a id="__codelineno-36-48" name="__codelineno-36-48" href="#__codelineno-36-48"></a>
</span><span id="__span-36-49"><a id="__codelineno-36-49" name="__codelineno-36-49" href="#__codelineno-36-49"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-50"><a id="__codelineno-36-50" name="__codelineno-36-50" href="#__codelineno-36-50"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testHelloEndpoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-51"><a id="__codelineno-36-51" name="__codelineno-36-51" href="#__codelineno-36-51"></a><span class="w">        </span><span class="n">given</span><span class="p">().</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT_PLAIN</span><span class="p">).</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/villains/hello&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">().</span><span class="na">statusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="na">body</span><span class="p">(</span><span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello Villain Resource&quot;</span><span class="p">));</span>
</span><span id="__span-36-52"><a id="__codelineno-36-52" name="__codelineno-36-52" href="#__codelineno-36-52"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-53"><a id="__codelineno-36-53" name="__codelineno-36-53" href="#__codelineno-36-53"></a>
</span><span id="__span-36-54"><a id="__codelineno-36-54" name="__codelineno-36-54" href="#__codelineno-36-54"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-55"><a id="__codelineno-36-55" name="__codelineno-36-55" href="#__codelineno-36-55"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotGetUnknownVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-56"><a id="__codelineno-36-56" name="__codelineno-36-56" href="#__codelineno-36-56"></a><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">randomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">().</span><span class="na">nextLong</span><span class="p">();</span>
</span><span id="__span-36-57"><a id="__codelineno-36-57" name="__codelineno-36-57" href="#__codelineno-36-57"></a><span class="w">        </span><span class="n">given</span><span class="p">().</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">randomId</span><span class="p">).</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/villains/{id}&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">().</span><span class="na">statusCode</span><span class="p">(</span><span class="n">NO_CONTENT</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-36-58"><a id="__codelineno-36-58" name="__codelineno-36-58" href="#__codelineno-36-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-59"><a id="__codelineno-36-59" name="__codelineno-36-59" href="#__codelineno-36-59"></a>
</span><span id="__span-36-60"><a id="__codelineno-36-60" name="__codelineno-36-60" href="#__codelineno-36-60"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-61"><a id="__codelineno-36-61" name="__codelineno-36-61" href="#__codelineno-36-61"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-62"><a id="__codelineno-36-62" name="__codelineno-36-62" href="#__codelineno-36-62"></a><span class="w">        </span><span class="n">given</span><span class="p">().</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/villains/random&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">().</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">()).</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">);</span>
</span><span id="__span-36-63"><a id="__codelineno-36-63" name="__codelineno-36-63" href="#__codelineno-36-63"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-64"><a id="__codelineno-36-64" name="__codelineno-36-64" href="#__codelineno-36-64"></a>
</span><span id="__span-36-65"><a id="__codelineno-36-65" name="__codelineno-36-65" href="#__codelineno-36-65"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-66"><a id="__codelineno-36-66" name="__codelineno-36-66" href="#__codelineno-36-66"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotAddInvalidItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-67"><a id="__codelineno-36-67" name="__codelineno-36-67" href="#__codelineno-36-67"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Villain</span><span class="p">();</span>
</span><span id="__span-36-68"><a id="__codelineno-36-68" name="__codelineno-36-68" href="#__codelineno-36-68"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-36-69"><a id="__codelineno-36-69" name="__codelineno-36-69" href="#__codelineno-36-69"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_OTHER_NAME</span><span class="p">;</span>
</span><span id="__span-36-70"><a id="__codelineno-36-70" name="__codelineno-36-70" href="#__codelineno-36-70"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_PICTURE</span><span class="p">;</span>
</span><span id="__span-36-71"><a id="__codelineno-36-71" name="__codelineno-36-71" href="#__codelineno-36-71"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_POWERS</span><span class="p">;</span>
</span><span id="__span-36-72"><a id="__codelineno-36-72" name="__codelineno-36-72" href="#__codelineno-36-72"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-36-73"><a id="__codelineno-36-73" name="__codelineno-36-73" href="#__codelineno-36-73"></a>
</span><span id="__span-36-74"><a id="__codelineno-36-74" name="__codelineno-36-74" href="#__codelineno-36-74"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-36-75"><a id="__codelineno-36-75" name="__codelineno-36-75" href="#__codelineno-36-75"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">villain</span><span class="p">)</span>
</span><span id="__span-36-76"><a id="__codelineno-36-76" name="__codelineno-36-76" href="#__codelineno-36-76"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">)</span>
</span><span id="__span-36-77"><a id="__codelineno-36-77" name="__codelineno-36-77" href="#__codelineno-36-77"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">)</span>
</span><span id="__span-36-78"><a id="__codelineno-36-78" name="__codelineno-36-78" href="#__codelineno-36-78"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-36-79"><a id="__codelineno-36-79" name="__codelineno-36-79" href="#__codelineno-36-79"></a><span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-36-80"><a id="__codelineno-36-80" name="__codelineno-36-80" href="#__codelineno-36-80"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-81"><a id="__codelineno-36-81" name="__codelineno-36-81" href="#__codelineno-36-81"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">BAD_REQUEST</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-36-82"><a id="__codelineno-36-82" name="__codelineno-36-82" href="#__codelineno-36-82"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-83"><a id="__codelineno-36-83" name="__codelineno-36-83" href="#__codelineno-36-83"></a>
</span><span id="__span-36-84"><a id="__codelineno-36-84" name="__codelineno-36-84" href="#__codelineno-36-84"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-85"><a id="__codelineno-36-85" name="__codelineno-36-85" href="#__codelineno-36-85"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-36-86"><a id="__codelineno-36-86" name="__codelineno-36-86" href="#__codelineno-36-86"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetInitialItems</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-87"><a id="__codelineno-36-87" name="__codelineno-36-87" href="#__codelineno-36-87"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-36-88"><a id="__codelineno-36-88" name="__codelineno-36-88" href="#__codelineno-36-88"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-89"><a id="__codelineno-36-89" name="__codelineno-36-89" href="#__codelineno-36-89"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-36-90"><a id="__codelineno-36-90" name="__codelineno-36-90" href="#__codelineno-36-90"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-36-91"><a id="__codelineno-36-91" name="__codelineno-36-91" href="#__codelineno-36-91"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-36-92"><a id="__codelineno-36-92" name="__codelineno-36-92" href="#__codelineno-36-92"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-36-93"><a id="__codelineno-36-93" name="__codelineno-36-93" href="#__codelineno-36-93"></a><span class="w">            </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getVillainTypeRef</span><span class="p">());</span>
</span><span id="__span-36-94"><a id="__codelineno-36-94" name="__codelineno-36-94" href="#__codelineno-36-94"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_VILLAINS</span><span class="p">,</span><span class="w"> </span><span class="n">villains</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-36-95"><a id="__codelineno-36-95" name="__codelineno-36-95" href="#__codelineno-36-95"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-96"><a id="__codelineno-36-96" name="__codelineno-36-96" href="#__codelineno-36-96"></a>
</span><span id="__span-36-97"><a id="__codelineno-36-97" name="__codelineno-36-97" href="#__codelineno-36-97"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-98"><a id="__codelineno-36-98" name="__codelineno-36-98" href="#__codelineno-36-98"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-99"><a id="__codelineno-36-99" name="__codelineno-36-99" href="#__codelineno-36-99"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldAddAnItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-100"><a id="__codelineno-36-100" name="__codelineno-36-100" href="#__codelineno-36-100"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Villain</span><span class="p">();</span>
</span><span id="__span-36-101"><a id="__codelineno-36-101" name="__codelineno-36-101" href="#__codelineno-36-101"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_NAME</span><span class="p">;</span>
</span><span id="__span-36-102"><a id="__codelineno-36-102" name="__codelineno-36-102" href="#__codelineno-36-102"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_OTHER_NAME</span><span class="p">;</span>
</span><span id="__span-36-103"><a id="__codelineno-36-103" name="__codelineno-36-103" href="#__codelineno-36-103"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_PICTURE</span><span class="p">;</span>
</span><span id="__span-36-104"><a id="__codelineno-36-104" name="__codelineno-36-104" href="#__codelineno-36-104"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_POWERS</span><span class="p">;</span>
</span><span id="__span-36-105"><a id="__codelineno-36-105" name="__codelineno-36-105" href="#__codelineno-36-105"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LEVEL</span><span class="p">;</span>
</span><span id="__span-36-106"><a id="__codelineno-36-106" name="__codelineno-36-106" href="#__codelineno-36-106"></a>
</span><span id="__span-36-107"><a id="__codelineno-36-107" name="__codelineno-36-107" href="#__codelineno-36-107"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-36-108"><a id="__codelineno-36-108" name="__codelineno-36-108" href="#__codelineno-36-108"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">villain</span><span class="p">)</span>
</span><span id="__span-36-109"><a id="__codelineno-36-109" name="__codelineno-36-109" href="#__codelineno-36-109"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">)</span>
</span><span id="__span-36-110"><a id="__codelineno-36-110" name="__codelineno-36-110" href="#__codelineno-36-110"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">)</span>
</span><span id="__span-36-111"><a id="__codelineno-36-111" name="__codelineno-36-111" href="#__codelineno-36-111"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-36-112"><a id="__codelineno-36-112" name="__codelineno-36-112" href="#__codelineno-36-112"></a><span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-36-113"><a id="__codelineno-36-113" name="__codelineno-36-113" href="#__codelineno-36-113"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-114"><a id="__codelineno-36-114" name="__codelineno-36-114" href="#__codelineno-36-114"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">CREATED</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-36-115"><a id="__codelineno-36-115" name="__codelineno-36-115" href="#__codelineno-36-115"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-36-116"><a id="__codelineno-36-116" name="__codelineno-36-116" href="#__codelineno-36-116"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">&quot;Location&quot;</span><span class="p">);</span>
</span><span id="__span-36-117"><a id="__codelineno-36-117" name="__codelineno-36-117" href="#__codelineno-36-117"></a><span class="w">        </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">location</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">));</span>
</span><span id="__span-36-118"><a id="__codelineno-36-118" name="__codelineno-36-118" href="#__codelineno-36-118"></a>
</span><span id="__span-36-119"><a id="__codelineno-36-119" name="__codelineno-36-119" href="#__codelineno-36-119"></a><span class="w">        </span><span class="c1">// Stores the id</span>
</span><span id="__span-36-120"><a id="__codelineno-36-120" name="__codelineno-36-120" href="#__codelineno-36-120"></a><span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
</span><span id="__span-36-121"><a id="__codelineno-36-121" name="__codelineno-36-121" href="#__codelineno-36-121"></a><span class="w">        </span><span class="n">villainId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="n">segments</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-36-122"><a id="__codelineno-36-122" name="__codelineno-36-122" href="#__codelineno-36-122"></a><span class="w">        </span><span class="n">assertNotNull</span><span class="p">(</span><span class="n">villainId</span><span class="p">);</span>
</span><span id="__span-36-123"><a id="__codelineno-36-123" name="__codelineno-36-123" href="#__codelineno-36-123"></a>
</span><span id="__span-36-124"><a id="__codelineno-36-124" name="__codelineno-36-124" href="#__codelineno-36-124"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-36-125"><a id="__codelineno-36-125" name="__codelineno-36-125" href="#__codelineno-36-125"></a><span class="w">            </span><span class="p">.</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">villainId</span><span class="p">)</span>
</span><span id="__span-36-126"><a id="__codelineno-36-126" name="__codelineno-36-126" href="#__codelineno-36-126"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-36-127"><a id="__codelineno-36-127" name="__codelineno-36-127" href="#__codelineno-36-127"></a><span class="w">            </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/villains/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-36-128"><a id="__codelineno-36-128" name="__codelineno-36-128" href="#__codelineno-36-128"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-129"><a id="__codelineno-36-129" name="__codelineno-36-129" href="#__codelineno-36-129"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-36-130"><a id="__codelineno-36-130" name="__codelineno-36-130" href="#__codelineno-36-130"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-36-131"><a id="__codelineno-36-131" name="__codelineno-36-131" href="#__codelineno-36-131"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_NAME</span><span class="p">))</span>
</span><span id="__span-36-132"><a id="__codelineno-36-132" name="__codelineno-36-132" href="#__codelineno-36-132"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;otherName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_OTHER_NAME</span><span class="p">))</span>
</span><span id="__span-36-133"><a id="__codelineno-36-133" name="__codelineno-36-133" href="#__codelineno-36-133"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_LEVEL</span><span class="p">))</span>
</span><span id="__span-36-134"><a id="__codelineno-36-134" name="__codelineno-36-134" href="#__codelineno-36-134"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;picture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_PICTURE</span><span class="p">))</span>
</span><span id="__span-36-135"><a id="__codelineno-36-135" name="__codelineno-36-135" href="#__codelineno-36-135"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;powers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_POWERS</span><span class="p">));</span>
</span><span id="__span-36-136"><a id="__codelineno-36-136" name="__codelineno-36-136" href="#__codelineno-36-136"></a>
</span><span id="__span-36-137"><a id="__codelineno-36-137" name="__codelineno-36-137" href="#__codelineno-36-137"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-36-138"><a id="__codelineno-36-138" name="__codelineno-36-138" href="#__codelineno-36-138"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-139"><a id="__codelineno-36-139" name="__codelineno-36-139" href="#__codelineno-36-139"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-36-140"><a id="__codelineno-36-140" name="__codelineno-36-140" href="#__codelineno-36-140"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-36-141"><a id="__codelineno-36-141" name="__codelineno-36-141" href="#__codelineno-36-141"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-36-142"><a id="__codelineno-36-142" name="__codelineno-36-142" href="#__codelineno-36-142"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-36-143"><a id="__codelineno-36-143" name="__codelineno-36-143" href="#__codelineno-36-143"></a><span class="w">            </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getVillainTypeRef</span><span class="p">());</span>
</span><span id="__span-36-144"><a id="__codelineno-36-144" name="__codelineno-36-144" href="#__codelineno-36-144"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_VILLAINS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">villains</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-36-145"><a id="__codelineno-36-145" name="__codelineno-36-145" href="#__codelineno-36-145"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-146"><a id="__codelineno-36-146" name="__codelineno-36-146" href="#__codelineno-36-146"></a>
</span><span id="__span-36-147"><a id="__codelineno-36-147" name="__codelineno-36-147" href="#__codelineno-36-147"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-148"><a id="__codelineno-36-148" name="__codelineno-36-148" href="#__codelineno-36-148"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-36-149"><a id="__codelineno-36-149" name="__codelineno-36-149" href="#__codelineno-36-149"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">testUpdatingAnItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-150"><a id="__codelineno-36-150" name="__codelineno-36-150" href="#__codelineno-36-150"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Villain</span><span class="p">();</span>
</span><span id="__span-36-151"><a id="__codelineno-36-151" name="__codelineno-36-151" href="#__codelineno-36-151"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Long</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">villainId</span><span class="p">);</span>
</span><span id="__span-36-152"><a id="__codelineno-36-152" name="__codelineno-36-152" href="#__codelineno-36-152"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_NAME</span><span class="p">;</span>
</span><span id="__span-36-153"><a id="__codelineno-36-153" name="__codelineno-36-153" href="#__codelineno-36-153"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_OTHER_NAME</span><span class="p">;</span>
</span><span id="__span-36-154"><a id="__codelineno-36-154" name="__codelineno-36-154" href="#__codelineno-36-154"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_PICTURE</span><span class="p">;</span>
</span><span id="__span-36-155"><a id="__codelineno-36-155" name="__codelineno-36-155" href="#__codelineno-36-155"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_POWERS</span><span class="p">;</span>
</span><span id="__span-36-156"><a id="__codelineno-36-156" name="__codelineno-36-156" href="#__codelineno-36-156"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_LEVEL</span><span class="p">;</span>
</span><span id="__span-36-157"><a id="__codelineno-36-157" name="__codelineno-36-157" href="#__codelineno-36-157"></a>
</span><span id="__span-36-158"><a id="__codelineno-36-158" name="__codelineno-36-158" href="#__codelineno-36-158"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-36-159"><a id="__codelineno-36-159" name="__codelineno-36-159" href="#__codelineno-36-159"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">villain</span><span class="p">)</span>
</span><span id="__span-36-160"><a id="__codelineno-36-160" name="__codelineno-36-160" href="#__codelineno-36-160"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">)</span>
</span><span id="__span-36-161"><a id="__codelineno-36-161" name="__codelineno-36-161" href="#__codelineno-36-161"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">)</span>
</span><span id="__span-36-162"><a id="__codelineno-36-162" name="__codelineno-36-162" href="#__codelineno-36-162"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-36-163"><a id="__codelineno-36-163" name="__codelineno-36-163" href="#__codelineno-36-163"></a><span class="w">            </span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-36-164"><a id="__codelineno-36-164" name="__codelineno-36-164" href="#__codelineno-36-164"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-165"><a id="__codelineno-36-165" name="__codelineno-36-165" href="#__codelineno-36-165"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-36-166"><a id="__codelineno-36-166" name="__codelineno-36-166" href="#__codelineno-36-166"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-36-167"><a id="__codelineno-36-167" name="__codelineno-36-167" href="#__codelineno-36-167"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_NAME</span><span class="p">))</span>
</span><span id="__span-36-168"><a id="__codelineno-36-168" name="__codelineno-36-168" href="#__codelineno-36-168"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;otherName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_OTHER_NAME</span><span class="p">))</span>
</span><span id="__span-36-169"><a id="__codelineno-36-169" name="__codelineno-36-169" href="#__codelineno-36-169"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_LEVEL</span><span class="p">))</span>
</span><span id="__span-36-170"><a id="__codelineno-36-170" name="__codelineno-36-170" href="#__codelineno-36-170"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;picture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_PICTURE</span><span class="p">))</span>
</span><span id="__span-36-171"><a id="__codelineno-36-171" name="__codelineno-36-171" href="#__codelineno-36-171"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;powers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_POWERS</span><span class="p">));</span>
</span><span id="__span-36-172"><a id="__codelineno-36-172" name="__codelineno-36-172" href="#__codelineno-36-172"></a>
</span><span id="__span-36-173"><a id="__codelineno-36-173" name="__codelineno-36-173" href="#__codelineno-36-173"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-36-174"><a id="__codelineno-36-174" name="__codelineno-36-174" href="#__codelineno-36-174"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-175"><a id="__codelineno-36-175" name="__codelineno-36-175" href="#__codelineno-36-175"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-36-176"><a id="__codelineno-36-176" name="__codelineno-36-176" href="#__codelineno-36-176"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-36-177"><a id="__codelineno-36-177" name="__codelineno-36-177" href="#__codelineno-36-177"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-36-178"><a id="__codelineno-36-178" name="__codelineno-36-178" href="#__codelineno-36-178"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-36-179"><a id="__codelineno-36-179" name="__codelineno-36-179" href="#__codelineno-36-179"></a><span class="w">            </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getVillainTypeRef</span><span class="p">());</span>
</span><span id="__span-36-180"><a id="__codelineno-36-180" name="__codelineno-36-180" href="#__codelineno-36-180"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_VILLAINS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">villains</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-36-181"><a id="__codelineno-36-181" name="__codelineno-36-181" href="#__codelineno-36-181"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-182"><a id="__codelineno-36-182" name="__codelineno-36-182" href="#__codelineno-36-182"></a>
</span><span id="__span-36-183"><a id="__codelineno-36-183" name="__codelineno-36-183" href="#__codelineno-36-183"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-36-184"><a id="__codelineno-36-184" name="__codelineno-36-184" href="#__codelineno-36-184"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-36-185"><a id="__codelineno-36-185" name="__codelineno-36-185" href="#__codelineno-36-185"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRemoveAnItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-186"><a id="__codelineno-36-186" name="__codelineno-36-186" href="#__codelineno-36-186"></a><span class="w">        </span><span class="n">given</span><span class="p">().</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">villainId</span><span class="p">).</span><span class="na">when</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="s">&quot;/api/villains/{id}&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">().</span><span class="na">statusCode</span><span class="p">(</span><span class="n">NO_CONTENT</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-36-187"><a id="__codelineno-36-187" name="__codelineno-36-187" href="#__codelineno-36-187"></a>
</span><span id="__span-36-188"><a id="__codelineno-36-188" name="__codelineno-36-188" href="#__codelineno-36-188"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-36-189"><a id="__codelineno-36-189" name="__codelineno-36-189" href="#__codelineno-36-189"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-36-190"><a id="__codelineno-36-190" name="__codelineno-36-190" href="#__codelineno-36-190"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-36-191"><a id="__codelineno-36-191" name="__codelineno-36-191" href="#__codelineno-36-191"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-36-192"><a id="__codelineno-36-192" name="__codelineno-36-192" href="#__codelineno-36-192"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-36-193"><a id="__codelineno-36-193" name="__codelineno-36-193" href="#__codelineno-36-193"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-36-194"><a id="__codelineno-36-194" name="__codelineno-36-194" href="#__codelineno-36-194"></a><span class="w">            </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getVillainTypeRef</span><span class="p">());</span>
</span><span id="__span-36-195"><a id="__codelineno-36-195" name="__codelineno-36-195" href="#__codelineno-36-195"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_VILLAINS</span><span class="p">,</span><span class="w"> </span><span class="n">villains</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-36-196"><a id="__codelineno-36-196" name="__codelineno-36-196" href="#__codelineno-36-196"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-197"><a id="__codelineno-36-197" name="__codelineno-36-197" href="#__codelineno-36-197"></a>
</span><span id="__span-36-198"><a id="__codelineno-36-198" name="__codelineno-36-198" href="#__codelineno-36-198"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TypeRef</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getVillainTypeRef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-199"><a id="__codelineno-36-199" name="__codelineno-36-199" href="#__codelineno-36-199"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TypeRef</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-200"><a id="__codelineno-36-200" name="__codelineno-36-200" href="#__codelineno-36-200"></a><span class="w">            </span><span class="c1">// Kept empty on purpose</span>
</span><span id="__span-36-201"><a id="__codelineno-36-201" name="__codelineno-36-201" href="#__codelineno-36-201"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-36-202"><a id="__codelineno-36-202" name="__codelineno-36-202" href="#__codelineno-36-202"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-203"><a id="__codelineno-36-203" name="__codelineno-36-203" href="#__codelineno-36-203"></a>
</span><span id="__span-36-204"><a id="__codelineno-36-204" name="__codelineno-36-204" href="#__codelineno-36-204"></a><span class="p">}</span>
</span></code></pre></div>
<p>The tests and the application runs in the same JVM, meaning that the test can be injected with application <em>beans</em>. This feature is very useful to test specific parts of the application. However, in our case, we just execute HTTP requests to check the result.</p>
<p>Run the test either in the dev mode or using <code>./mvnw test</code>. They should pass.</p>
<h4 id="building-production-package">Building production package</h4>
<p>Our service is not completely done yet, but let’s run it in <em>prod</em> mode.</p>
<h5 id="configuring-the-application">Configuring the application</h5>
<p>In <em>prod</em> mode, the dev services won’t be used. We need to configure the application to connect to a <em>real</em> database.</p>
<p>The main way of obtaining connections to a database is to use a datasource. In Quarkus, the out of the box datasource and connection pooling implementation is Agroal.</p>
<p>So, we need to configure the database access in the <code>src/main/resources/application.properties</code> file, but only when the application runs in <em>prod</em> mode.</p>
<p>Add the following datasource configuration:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="na">%prod.quarkus.datasource.username</span><span class="o">=</span><span class="s">superbad</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="na">%prod.quarkus.datasource.password</span><span class="o">=</span><span class="s">superbad</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="na">%prod.quarkus.datasource.jdbc.url</span><span class="o">=</span><span class="s">jdbc:postgresql://localhost:5432/villains_database</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="na">%prod.quarkus.hibernate-orm.sql-load-script</span><span class="o">=</span><span class="s">import.sql</span>
</span></code></pre></div>
<p><code>%prod</code> indicates that the property is only used when the application runs with the given profile. We configure the access to the database, and force the data initialization (which would have been disabled by default in <em>prod</em> mode).</p>
<h5 id="running-the-infrastructure">Running the Infrastructure</h5>
<p>Before going further, be sure to run the infrastructure. To execute this service, you need a database. Let’s use Docker and docker compose to ease the installation of such infrastructure.</p>
<p>You should already have installed the infrastructure into the <code>infrastructure</code> directory.</p>
<p>Now, just execute <code>docker compose -f docker-compose.yaml up -d</code> under the <code>infrastructure</code> directory. You should see a few logs going on and then all the containers get started.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>During the workshop, just leave all the containers up and running. Then, after the workshop, remember to shut them down using: <code>docker compose -f docker-compose.yaml down</code> .</p></td></tr></tbody></table>

<h5 id="packaging-and-running-the-application_1">Packaging and running the application</h5>
<p>Stop the dev mode, and run:</p>
<p>As previously, you will get your application in <code>target/quarkus-app</code>, run it using:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>java<span class="w"> </span>-jar<span class="w"> </span>target/quarkus-app/quarkus-run.jar
</span></code></pre></div>
<p>Open your browser to <a href="http://localhost:8080/api/villains">http://localhost:8080/api/villains</a>, and verify it displays the expected content. Once done, stop the application using <code>CTRL+C</code>.</p>
<h3 id="configuring-the-villain-microservice">Configuring the Villain Microservice</h3>
<p>Hardcoded values in our code are a no go (even if we all did it at some point). In this guide, we learn how to configure our Villain API as well as some parts of Quarkus.</p>
<h4 id="configuring-logging">Configuring Logging</h4>
<p>In the <code>VillainResource</code>, we injected a logger. That’s very useful to provide meaningful information about the execution. But you often need to adjust the configuration, such as the log level.</p>
<p>Runtime configuration of logging is done through the normal <code>application.properties</code> file:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="na">quarkus.log.console.enable</span><span class="o">=</span><span class="s">true</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="na">quarkus.log.console.format</span><span class="o">=</span><span class="s">%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="na">quarkus.log.console.level</span><span class="o">=</span><span class="s">INFO</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="na">quarkus.log.console.darken</span><span class="o">=</span><span class="s">1</span>
</span></code></pre></div>
<h4 id="configuring-quarkus-listening-port">Configuring Quarkus Listening Port</h4>
<p>Because we will end-up running several microservices, let’s configure Quarkus so it listens to a different port than 8080: This is quite easy as we just need to add one property in the <code>application.properties</code> file:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">## HTTP configuration</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="na">quarkus.http.port</span><span class="o">=</span><span class="s">8084</span>
</span></code></pre></div>
<p>Changing the port is one of the rare configuration that cannot be done while the application is running.</p>
<p>You would need to restart the application to change the port.</p>
<p>Hit <code>CTRL+C</code> to stop the application if it still running and restart it with: <code>./mvnw quarkus:dev</code>. Then run:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>curl<span class="w"> </span>http://localhost:8084/api/villains<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span></code></pre></div>
<h4 id="injecting-configuration-value">Injecting Configuration Value</h4>
<p>When we persist a new villain, we want to multiply the level by a value that can be configured (to reduce the level, so heroes will win the fights more easily). For this, Quarkus uses MicroProfile Config to inject the configuration in the application. The injection uses the <code>@ConfigProperty</code> annotation.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>When injecting a configured value, you can use <code>@Inject @ConfigProperty</code> or just <code>@ConfigProperty</code>. The <code>@Inject</code> annotation is not necessary for members annotated with <code>@ConfigProperty</code>, a behavior which differs from <a href="https://microprofile.io/project/eclipse/microprofile-config">MicroProfile Config</a>.</p></td></tr></tbody></table>

<p>Edit the <code>VillainService</code>, and introduce the following configuration properties:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nd">@ConfigProperty</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;level.multiplier&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="p">)</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">levelMultiplier</span><span class="p">;</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>You may need to add the following import statement if your IDE does not do it automatically: <code>import org.eclipse.microprofile.config.inject.ConfigProperty;</code></p></td></tr></tbody></table>

<p>If you do not provide a value for this property, the application startup fails with <code>jakarta.enterprise.inject.spi.DeploymentException: No config value of type [int] exists for: level.multiplier</code>. To avoid having to configure a value, we configure a default one (property <code>defaultValue</code>).</p>
<p>Now, modify the <code>VillainService.persistVillain()</code> method to use the injected properties:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">persistVillain</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">round</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">levelMultiplier</span><span class="p">);</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">villain</span><span class="p">;</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="create-the-configuration">Create the Configuration</h4>
<p>By default, Quarkus reads <code>application.properties</code>.</p>
<p>Edit the <code>src/main/resources/application.properties</code> with the following content:</p>
<h4 id="running-and-testing-the-application">Running and Testing the Application</h4>
<p>If you didn’t already, start the application with <code>./mvnw quarkus:dev</code>. Once started, create a new villain with the following cUrl command (notice the verbose option <code>-v</code> to see the HTTP response headers):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w">  </span><span class="s1">&#39;{&quot;level&quot;:5, &quot;name&quot;:&quot;Super Bad&quot;, &quot;powers&quot;:&quot;Agility, Longevity&quot;}&#39;</span><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>http://localhost:8084/api/villains<span class="w"> </span>-v
</span></code></pre></div>
<p>You should see something like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>&lt; HTTP/1.1 201 Created
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>&lt; Location: http://localhost:8084/api/villains/582
</span></code></pre></div>
<p>As you can see, we’ve passed a level of 5 to create this new villain. The cURL command returns the location of the newly created villain. Take this URL and do an HTTP GET on it. You will see that the level has been decreased.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>The example shows a newly created Villain with id <code>582</code>. But this id could be different on your machine. Just make sure to use the correct id in the next command.</p></td></tr></tbody></table>

<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>curl<span class="w"> </span>http://localhost:8084/api/villains/582<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="o">{</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">  </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">582</span>,
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">  </span><span class="s2">&quot;level&quot;</span>:<span class="w"> </span><span class="m">3</span>,
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">  </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;Super Bad&quot;</span>,
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">  </span><span class="s2">&quot;powers&quot;</span>:<span class="w"> </span><span class="s2">&quot;Agility, Longevity&quot;</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="o">}</span>
</span></code></pre></div>
<p>Hey! Wait a minute! It you enabled continuous testing, Quarkus should have warned you:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>--
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>Running 2/8. Running: io.quarkus.workshop.superheroes.villain.VillainResourceTest#shouldAddAnItem()
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>Press [o] Toggle test output, [h] for more options&gt;WARNING: An illegal reflective access operation has occurred
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>2021-09-21 21:02:16,067 ERROR [io.qua.test] (Test runner thread) ==================== TEST REPORT #1 ====================
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>2021-09-21 21:02:16,067 ERROR [io.qua.test] (Test runner thread) Test VillainResourceTest#shouldAddAnItem() failed
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>: java.lang.AssertionError: 1 expectation failed.
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>JSON path level doesn&#39;t match.
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>Expected: is &lt;42&gt;
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>  Actual: &lt;21&gt;
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>        at io.restassured.internal.ValidatableResponseImpl.body(ValidatableResponseImpl.groovy)
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>        at io.quarkus.workshop.superheroes.villain.VillainResourceTest.shouldAddAnItem(VillainResourceTest.java:133)
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>2021-09-21 21:02:16,070 ERROR [io.qua.test] (Test runner thread) &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1 TEST FAILED &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
</span></code></pre></div>
<p>Tests are failing now! Indeed, they don’t know the multiplier.</p>
<table><tbody><tr><td><i title="Tip"></i></td><td>Press <code>r</code> in the dev mode to run the tests.</td></tr></tbody></table>

<p>In the <code>application.properties</code> file, add: <code>%test.level.multiplier=1</code> which set the multiplier to 1 when running the tests:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>All 8 tests are passing (0 skipped), 8 tests were run in 1722ms. Tests completed at 21:03:25.
</span></code></pre></div>
<h3 id="open-api">Open API</h3>
<p>A Quarkus application can expose its API description through an OpenAPI specification. Quarkus also lets you test it via a user-friendly UI named Swagger UI.</p>
<p>In this section, we will see how to use OpenAPI with Quarkus and introduce the dev console.</p>
<h4 id="directory-structure_2">Directory Structure</h4>
<p>In this module we will add extra class (<code>VillainApplication</code>) to the Villain API project. You will end-up with the following directory structure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-41ee2d5b485f1d6914ec23c00a0ce414.png" /></p>
<h4 id="installing-the-openapi-extension">Installing the OpenAPI extension</h4>
<p>Quarkus proposes a <code>smallrye-openapi</code> extension compliant with the MicroProfile OpenAPI specification in order to generate your API OpenAPI v3 specification.</p>
<p>To install the OpenAPI dependency, just run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>./mvnw<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;smallrye-openapi&quot;</span>
</span></code></pre></div>
<p>This will add the following dependency in the <code>pom.xml</code> file:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>quarkus-smallrye-openapi<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<h4 id="open-api_1">Open API</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nt">openapi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0.3</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="nt">info</span><span class="p">:</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rest-villains API</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0-SNAPSHOT</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">  </span><span class="nt">/api/villains</span><span class="p">:</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain Resource</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">        </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">          </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">            </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">                </span><span class="nt">items</span><span class="p">:</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">                  </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">    </span><span class="nt">put</span><span class="p">:</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain Resource</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">      </span><span class="nt">requestBody</span><span class="p">:</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="w">        </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="w">          </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="w">            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="w">              </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="w">        </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="w">          </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a><span class="w">            </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-51-32"><a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a><span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-33"><a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="w">                </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-51-34"><a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="w">    </span><span class="nt">post</span><span class="p">:</span>
</span><span id="__span-51-35"><a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-51-36"><a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain Resource</span>
</span><span id="__span-51-37"><a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="w">      </span><span class="nt">requestBody</span><span class="p">:</span>
</span><span id="__span-51-38"><a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="w">        </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-51-39"><a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a><span class="w">          </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-51-40"><a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a><span class="w">            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-41"><a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a><span class="w">              </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-51-42"><a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-51-43"><a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a><span class="w">        </span><span class="s">&quot;201&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-44"><a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Created</span>
</span><span id="__span-51-45"><a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a><span class="w">  </span><span class="nt">/api/villains/hello</span><span class="p">:</span>
</span><span id="__span-51-46"><a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a><span class="w">    </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-51-47"><a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-51-48"><a id="__codelineno-51-48" name="__codelineno-51-48" href="#__codelineno-51-48"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain Resource</span>
</span><span id="__span-51-49"><a id="__codelineno-51-49" name="__codelineno-51-49" href="#__codelineno-51-49"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-51-50"><a id="__codelineno-51-50" name="__codelineno-51-50" href="#__codelineno-51-50"></a><span class="w">        </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-51"><a id="__codelineno-51-51" name="__codelineno-51-51" href="#__codelineno-51-51"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-51-52"><a id="__codelineno-51-52" name="__codelineno-51-52" href="#__codelineno-51-52"></a><span class="w">          </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-51-53"><a id="__codelineno-51-53" name="__codelineno-51-53" href="#__codelineno-51-53"></a><span class="w">            </span><span class="nt">text/plain</span><span class="p">:</span>
</span><span id="__span-51-54"><a id="__codelineno-51-54" name="__codelineno-51-54" href="#__codelineno-51-54"></a><span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-55"><a id="__codelineno-51-55" name="__codelineno-51-55" href="#__codelineno-51-55"></a><span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-51-56"><a id="__codelineno-51-56" name="__codelineno-51-56" href="#__codelineno-51-56"></a><span class="w">  </span><span class="nt">/api/villains/random</span><span class="p">:</span>
</span><span id="__span-51-57"><a id="__codelineno-51-57" name="__codelineno-51-57" href="#__codelineno-51-57"></a><span class="w">    </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-51-58"><a id="__codelineno-51-58" name="__codelineno-51-58" href="#__codelineno-51-58"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-51-59"><a id="__codelineno-51-59" name="__codelineno-51-59" href="#__codelineno-51-59"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain Resource</span>
</span><span id="__span-51-60"><a id="__codelineno-51-60" name="__codelineno-51-60" href="#__codelineno-51-60"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-51-61"><a id="__codelineno-51-61" name="__codelineno-51-61" href="#__codelineno-51-61"></a><span class="w">        </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-62"><a id="__codelineno-51-62" name="__codelineno-51-62" href="#__codelineno-51-62"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-51-63"><a id="__codelineno-51-63" name="__codelineno-51-63" href="#__codelineno-51-63"></a><span class="w">          </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-51-64"><a id="__codelineno-51-64" name="__codelineno-51-64" href="#__codelineno-51-64"></a><span class="w">            </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-51-65"><a id="__codelineno-51-65" name="__codelineno-51-65" href="#__codelineno-51-65"></a><span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-66"><a id="__codelineno-51-66" name="__codelineno-51-66" href="#__codelineno-51-66"></a><span class="w">                </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-51-67"><a id="__codelineno-51-67" name="__codelineno-51-67" href="#__codelineno-51-67"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">/api/villains/{id}</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-68"><a id="__codelineno-51-68" name="__codelineno-51-68" href="#__codelineno-51-68"></a><span class="w">    </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-51-69"><a id="__codelineno-51-69" name="__codelineno-51-69" href="#__codelineno-51-69"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-51-70"><a id="__codelineno-51-70" name="__codelineno-51-70" href="#__codelineno-51-70"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain Resource</span>
</span><span id="__span-51-71"><a id="__codelineno-51-71" name="__codelineno-51-71" href="#__codelineno-51-71"></a><span class="w">      </span><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-51-72"><a id="__codelineno-51-72" name="__codelineno-51-72" href="#__codelineno-51-72"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
</span><span id="__span-51-73"><a id="__codelineno-51-73" name="__codelineno-51-73" href="#__codelineno-51-73"></a><span class="w">        </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
</span><span id="__span-51-74"><a id="__codelineno-51-74" name="__codelineno-51-74" href="#__codelineno-51-74"></a><span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-51-75"><a id="__codelineno-51-75" name="__codelineno-51-75" href="#__codelineno-51-75"></a><span class="w">        </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-76"><a id="__codelineno-51-76" name="__codelineno-51-76" href="#__codelineno-51-76"></a><span class="w">          </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int64</span>
</span><span id="__span-51-77"><a id="__codelineno-51-77" name="__codelineno-51-77" href="#__codelineno-51-77"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-51-78"><a id="__codelineno-51-78" name="__codelineno-51-78" href="#__codelineno-51-78"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-51-79"><a id="__codelineno-51-79" name="__codelineno-51-79" href="#__codelineno-51-79"></a><span class="w">        </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-80"><a id="__codelineno-51-80" name="__codelineno-51-80" href="#__codelineno-51-80"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-51-81"><a id="__codelineno-51-81" name="__codelineno-51-81" href="#__codelineno-51-81"></a><span class="w">          </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-51-82"><a id="__codelineno-51-82" name="__codelineno-51-82" href="#__codelineno-51-82"></a><span class="w">            </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-51-83"><a id="__codelineno-51-83" name="__codelineno-51-83" href="#__codelineno-51-83"></a><span class="w">              </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-84"><a id="__codelineno-51-84" name="__codelineno-51-84" href="#__codelineno-51-84"></a><span class="w">                </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-51-85"><a id="__codelineno-51-85" name="__codelineno-51-85" href="#__codelineno-51-85"></a><span class="w">    </span><span class="nt">delete</span><span class="p">:</span>
</span><span id="__span-51-86"><a id="__codelineno-51-86" name="__codelineno-51-86" href="#__codelineno-51-86"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-51-87"><a id="__codelineno-51-87" name="__codelineno-51-87" href="#__codelineno-51-87"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain Resource</span>
</span><span id="__span-51-88"><a id="__codelineno-51-88" name="__codelineno-51-88" href="#__codelineno-51-88"></a><span class="w">      </span><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-51-89"><a id="__codelineno-51-89" name="__codelineno-51-89" href="#__codelineno-51-89"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
</span><span id="__span-51-90"><a id="__codelineno-51-90" name="__codelineno-51-90" href="#__codelineno-51-90"></a><span class="w">        </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
</span><span id="__span-51-91"><a id="__codelineno-51-91" name="__codelineno-51-91" href="#__codelineno-51-91"></a><span class="w">        </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-51-92"><a id="__codelineno-51-92" name="__codelineno-51-92" href="#__codelineno-51-92"></a><span class="w">        </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-51-93"><a id="__codelineno-51-93" name="__codelineno-51-93" href="#__codelineno-51-93"></a><span class="w">          </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int64</span>
</span><span id="__span-51-94"><a id="__codelineno-51-94" name="__codelineno-51-94" href="#__codelineno-51-94"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-51-95"><a id="__codelineno-51-95" name="__codelineno-51-95" href="#__codelineno-51-95"></a><span class="w">      </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-51-96"><a id="__codelineno-51-96" name="__codelineno-51-96" href="#__codelineno-51-96"></a><span class="w">        </span><span class="s">&quot;204&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-51-97"><a id="__codelineno-51-97" name="__codelineno-51-97" href="#__codelineno-51-97"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">No Content</span>
</span><span id="__span-51-98"><a id="__codelineno-51-98" name="__codelineno-51-98" href="#__codelineno-51-98"></a><span class="nt">components</span><span class="p">:</span>
</span><span id="__span-51-99"><a id="__codelineno-51-99" name="__codelineno-51-99" href="#__codelineno-51-99"></a><span class="w">  </span><span class="nt">schemas</span><span class="p">:</span>
</span><span id="__span-51-100"><a id="__codelineno-51-100" name="__codelineno-51-100" href="#__codelineno-51-100"></a><span class="w">    </span><span class="nt">Villain</span><span class="p">:</span>
</span><span id="__span-51-101"><a id="__codelineno-51-101" name="__codelineno-51-101" href="#__codelineno-51-101"></a><span class="w">      </span><span class="nt">required</span><span class="p">:</span>
</span><span id="__span-51-102"><a id="__codelineno-51-102" name="__codelineno-51-102" href="#__codelineno-51-102"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
</span><span id="__span-51-103"><a id="__codelineno-51-103" name="__codelineno-51-103" href="#__codelineno-51-103"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">level</span>
</span><span id="__span-51-104"><a id="__codelineno-51-104" name="__codelineno-51-104" href="#__codelineno-51-104"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
</span><span id="__span-51-105"><a id="__codelineno-51-105" name="__codelineno-51-105" href="#__codelineno-51-105"></a><span class="w">      </span><span class="nt">properties</span><span class="p">:</span>
</span><span id="__span-51-106"><a id="__codelineno-51-106" name="__codelineno-51-106" href="#__codelineno-51-106"></a><span class="w">        </span><span class="nt">id</span><span class="p">:</span>
</span><span id="__span-51-107"><a id="__codelineno-51-107" name="__codelineno-51-107" href="#__codelineno-51-107"></a><span class="w">          </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int64</span>
</span><span id="__span-51-108"><a id="__codelineno-51-108" name="__codelineno-51-108" href="#__codelineno-51-108"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-51-109"><a id="__codelineno-51-109" name="__codelineno-51-109" href="#__codelineno-51-109"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span>
</span><span id="__span-51-110"><a id="__codelineno-51-110" name="__codelineno-51-110" href="#__codelineno-51-110"></a><span class="w">          </span><span class="nt">maxLength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
</span><span id="__span-51-111"><a id="__codelineno-51-111" name="__codelineno-51-111" href="#__codelineno-51-111"></a><span class="w">          </span><span class="nt">minLength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-51-112"><a id="__codelineno-51-112" name="__codelineno-51-112" href="#__codelineno-51-112"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-51-113"><a id="__codelineno-51-113" name="__codelineno-51-113" href="#__codelineno-51-113"></a><span class="w">        </span><span class="nt">otherName</span><span class="p">:</span>
</span><span id="__span-51-114"><a id="__codelineno-51-114" name="__codelineno-51-114" href="#__codelineno-51-114"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-51-115"><a id="__codelineno-51-115" name="__codelineno-51-115" href="#__codelineno-51-115"></a><span class="w">        </span><span class="nt">level</span><span class="p">:</span>
</span><span id="__span-51-116"><a id="__codelineno-51-116" name="__codelineno-51-116" href="#__codelineno-51-116"></a><span class="w">          </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int32</span>
</span><span id="__span-51-117"><a id="__codelineno-51-117" name="__codelineno-51-117" href="#__codelineno-51-117"></a><span class="w">          </span><span class="nt">minimum</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-51-118"><a id="__codelineno-51-118" name="__codelineno-51-118" href="#__codelineno-51-118"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-51-119"><a id="__codelineno-51-119" name="__codelineno-51-119" href="#__codelineno-51-119"></a><span class="w">        </span><span class="nt">picture</span><span class="p">:</span>
</span><span id="__span-51-120"><a id="__codelineno-51-120" name="__codelineno-51-120" href="#__codelineno-51-120"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-51-121"><a id="__codelineno-51-121" name="__codelineno-51-121" href="#__codelineno-51-121"></a><span class="w">        </span><span class="nt">powers</span><span class="p">:</span>
</span><span id="__span-51-122"><a id="__codelineno-51-122" name="__codelineno-51-122" href="#__codelineno-51-122"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-51-123"><a id="__codelineno-51-123" name="__codelineno-51-123" href="#__codelineno-51-123"></a><span class="w">  </span><span class="nt">securitySchemes</span><span class="p">:</span>
</span><span id="__span-51-124"><a id="__codelineno-51-124" name="__codelineno-51-124" href="#__codelineno-51-124"></a><span class="w">    </span><span class="nt">SecurityScheme</span><span class="p">:</span>
</span><span id="__span-51-125"><a id="__codelineno-51-125" name="__codelineno-51-125" href="#__codelineno-51-125"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id="__span-51-126"><a id="__codelineno-51-126" name="__codelineno-51-126" href="#__codelineno-51-126"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Authentication</span>
</span><span id="__span-51-127"><a id="__codelineno-51-127" name="__codelineno-51-127" href="#__codelineno-51-127"></a><span class="w">      </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">basic</span>
</span></code></pre></div>
<p>This contract lacks documentation. The Eclipse MicroProfile OpenAPI allows you to customize the methods of your REST endpoint as well as the application.</p>
<p>While having the OpenAPI specification is great, it can’t be consumed easily by humans. In your browser, go to <a href="http://localhost:8084/q/dev">http://localhost:8084/q/dev</a>. This is the dev console. It provides all the tools you need to develop your Quarkus application. We will use it several times in this workshop. Note that the dev console is only available in dev mode.</p>
<p>The Dev Console integrates Swagger, a UI to invoke your endpoints from the comfort of your browser. Click on the "<em>Swagger UI</em>" button located in the "SmallRye OpenAPI" widget (<a href="http://localhost:8084/q/swagger-ui">http://localhost:8084/q/swagger-ui</a>).</p>
<p>You will see all your endpoints listed. Click on the "<em>GET</em>" button for the "/api/villains" path, then click on "<em>Try it out</em>" and finally on "Execute". You can see the result immediately.</p>
<p>When developing REST APIs, this UI is very convenient. You can test your endpoint and immediately see the outcome. If something does not please you, edit the code, go back to the browser, re-execute, and voilà!</p>
<h5 id="customizing-methods">Customizing Methods</h5>
<p>The MicroProfile OpenAPI has a set of annotations to customize each REST endpoint method so the OpenAPI contract is richer and clearer for consumers:</p>
<ul>
<li>
<p><code>@Operation</code>: Describes a single API operation on a path.</p>
</li>
<li>
<p><code>@APIResponse</code>: Corresponds to the OpenAPI Response model object which describes a single response from an API Operation</p>
</li>
<li>
<p><code>@Parameter</code>: The name of the parameter.</p>
</li>
<li>
<p><code>@RequestBody</code>: A brief description of the request body.</p>
</li>
</ul>
<p>This is what the <code>VillainResource</code> endpoint should look like once you have annotated it:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URI</span><span class="p">;</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.DELETE</span><span class="p">;</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.GET</span><span class="p">;</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.POST</span><span class="p">;</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.PUT</span><span class="p">;</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Path</span><span class="p">;</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Produces</span><span class="p">;</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Context</span><span class="p">;</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response</span><span class="p">;</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.UriBuilder</span><span class="p">;</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.UriInfo</span><span class="p">;</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.Operation</span><span class="p">;</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span><span class="p">;</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Content</span><span class="p">;</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</span><span class="p">;</span>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span><span class="p">;</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.tags.Tag</span><span class="p">;</span>
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.resteasy.reactive.RestPath</span><span class="p">;</span>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.resteasy.reactive.RestResponse</span><span class="p">;</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a>
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a><span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;villains&quot;</span><span class="p">)</span>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainResource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a><span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="w">    </span><span class="n">VillainService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">VillainResource</span><span class="p">(</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">VillainService</span><span class="w"> </span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-37"><a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span><span id="__span-52-38"><a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-52-39"><a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-40"><a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a>
</span><span id="__span-52-41"><a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Returns a random villain&quot;</span><span class="p">)</span>
</span><span id="__span-52-42"><a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-52-43"><a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/random&quot;</span><span class="p">)</span>
</span><span id="__span-52-44"><a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span>
</span><span id="__span-52-45"><a id="__codelineno-52-45" name="__codelineno-52-45" href="#__codelineno-52-45"></a><span class="w">        </span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span>
</span><span id="__span-52-46"><a id="__codelineno-52-46" name="__codelineno-52-46" href="#__codelineno-52-46"></a><span class="w">        </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">))</span>
</span><span id="__span-52-47"><a id="__codelineno-52-47" name="__codelineno-52-47" href="#__codelineno-52-47"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-52-48"><a id="__codelineno-52-48" name="__codelineno-52-48" href="#__codelineno-52-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-49"><a id="__codelineno-52-49" name="__codelineno-52-49" href="#__codelineno-52-49"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findRandomVillain</span><span class="p">();</span>
</span><span id="__span-52-50"><a id="__codelineno-52-50" name="__codelineno-52-50" href="#__codelineno-52-50"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Found random villain &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-51"><a id="__codelineno-52-51" name="__codelineno-52-51" href="#__codelineno-52-51"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-52"><a id="__codelineno-52-52" name="__codelineno-52-52" href="#__codelineno-52-52"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-53"><a id="__codelineno-52-53" name="__codelineno-52-53" href="#__codelineno-52-53"></a>
</span><span id="__span-52-54"><a id="__codelineno-52-54" name="__codelineno-52-54" href="#__codelineno-52-54"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Returns all the villains from the database&quot;</span><span class="p">)</span>
</span><span id="__span-52-55"><a id="__codelineno-52-55" name="__codelineno-52-55" href="#__codelineno-52-55"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-52-56"><a id="__codelineno-52-56" name="__codelineno-52-56" href="#__codelineno-52-56"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span>
</span><span id="__span-52-57"><a id="__codelineno-52-57" name="__codelineno-52-57" href="#__codelineno-52-57"></a><span class="w">        </span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span>
</span><span id="__span-52-58"><a id="__codelineno-52-58" name="__codelineno-52-58" href="#__codelineno-52-58"></a><span class="w">        </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SchemaType</span><span class="p">.</span><span class="na">ARRAY</span><span class="p">))</span>
</span><span id="__span-52-59"><a id="__codelineno-52-59" name="__codelineno-52-59" href="#__codelineno-52-59"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-52-60"><a id="__codelineno-52-60" name="__codelineno-52-60" href="#__codelineno-52-60"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getAllVillains</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-61"><a id="__codelineno-52-61" name="__codelineno-52-61" href="#__codelineno-52-61"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findAllVillains</span><span class="p">();</span>
</span><span id="__span-52-62"><a id="__codelineno-52-62" name="__codelineno-52-62" href="#__codelineno-52-62"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Total number of villains &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villains</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-52-63"><a id="__codelineno-52-63" name="__codelineno-52-63" href="#__codelineno-52-63"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villains</span><span class="p">);</span>
</span><span id="__span-52-64"><a id="__codelineno-52-64" name="__codelineno-52-64" href="#__codelineno-52-64"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-65"><a id="__codelineno-52-65" name="__codelineno-52-65" href="#__codelineno-52-65"></a>
</span><span id="__span-52-66"><a id="__codelineno-52-66" name="__codelineno-52-66" href="#__codelineno-52-66"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Returns a villain for a given identifier&quot;</span><span class="p">)</span>
</span><span id="__span-52-67"><a id="__codelineno-52-67" name="__codelineno-52-67" href="#__codelineno-52-67"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-52-68"><a id="__codelineno-52-68" name="__codelineno-52-68" href="#__codelineno-52-68"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-52-69"><a id="__codelineno-52-69" name="__codelineno-52-69" href="#__codelineno-52-69"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">class</span><span class="p">)))</span>
</span><span id="__span-52-70"><a id="__codelineno-52-70" name="__codelineno-52-70" href="#__codelineno-52-70"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;204&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The villain is not found for a given identifier&quot;</span><span class="p">)</span>
</span><span id="__span-52-71"><a id="__codelineno-52-71" name="__codelineno-52-71" href="#__codelineno-52-71"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getVillain</span><span class="p">(</span><span class="nd">@RestPath</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-72"><a id="__codelineno-52-72" name="__codelineno-52-72" href="#__codelineno-52-72"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findVillainById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-52-73"><a id="__codelineno-52-73" name="__codelineno-52-73" href="#__codelineno-52-73"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">villain</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-74"><a id="__codelineno-52-74" name="__codelineno-52-74" href="#__codelineno-52-74"></a><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Found villain &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-75"><a id="__codelineno-52-75" name="__codelineno-52-75" href="#__codelineno-52-75"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-76"><a id="__codelineno-52-76" name="__codelineno-52-76" href="#__codelineno-52-76"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-77"><a id="__codelineno-52-77" name="__codelineno-52-77" href="#__codelineno-52-77"></a><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;No villain found with id &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-52-78"><a id="__codelineno-52-78" name="__codelineno-52-78" href="#__codelineno-52-78"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">noContent</span><span class="p">();</span>
</span><span id="__span-52-79"><a id="__codelineno-52-79" name="__codelineno-52-79" href="#__codelineno-52-79"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-52-80"><a id="__codelineno-52-80" name="__codelineno-52-80" href="#__codelineno-52-80"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-81"><a id="__codelineno-52-81" name="__codelineno-52-81" href="#__codelineno-52-81"></a>
</span><span id="__span-52-82"><a id="__codelineno-52-82" name="__codelineno-52-82" href="#__codelineno-52-82"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Creates a valid villain&quot;</span><span class="p">)</span>
</span><span id="__span-52-83"><a id="__codelineno-52-83" name="__codelineno-52-83" href="#__codelineno-52-83"></a><span class="w">    </span><span class="nd">@POST</span>
</span><span id="__span-52-84"><a id="__codelineno-52-84" name="__codelineno-52-84" href="#__codelineno-52-84"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span>
</span><span id="__span-52-85"><a id="__codelineno-52-85" name="__codelineno-52-85" href="#__codelineno-52-85"></a><span class="w">        </span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;201&quot;</span><span class="p">,</span>
</span><span id="__span-52-86"><a id="__codelineno-52-86" name="__codelineno-52-86" href="#__codelineno-52-86"></a><span class="w">        </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The URI of the created villain&quot;</span><span class="p">,</span>
</span><span id="__span-52-87"><a id="__codelineno-52-87" name="__codelineno-52-87" href="#__codelineno-52-87"></a><span class="w">        </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URI</span><span class="p">.</span><span class="na">class</span><span class="p">))</span>
</span><span id="__span-52-88"><a id="__codelineno-52-88" name="__codelineno-52-88" href="#__codelineno-52-88"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-52-89"><a id="__codelineno-52-89" name="__codelineno-52-89" href="#__codelineno-52-89"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createVillain</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">,</span><span class="w"> </span><span class="nd">@Context</span><span class="w"> </span><span class="n">UriInfo</span><span class="w"> </span><span class="n">uriInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-90"><a id="__codelineno-52-90" name="__codelineno-52-90" href="#__codelineno-52-90"></a><span class="w">        </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">persistVillain</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-91"><a id="__codelineno-52-91" name="__codelineno-52-91" href="#__codelineno-52-91"></a><span class="w">        </span><span class="n">UriBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uriInfo</span><span class="p">.</span><span class="na">getAbsolutePathBuilder</span><span class="p">().</span><span class="na">path</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">id</span><span class="p">));</span>
</span><span id="__span-52-92"><a id="__codelineno-52-92" name="__codelineno-52-92" href="#__codelineno-52-92"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;New villain created with URI &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-52-93"><a id="__codelineno-52-93" name="__codelineno-52-93" href="#__codelineno-52-93"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">created</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
</span><span id="__span-52-94"><a id="__codelineno-52-94" name="__codelineno-52-94" href="#__codelineno-52-94"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-95"><a id="__codelineno-52-95" name="__codelineno-52-95" href="#__codelineno-52-95"></a>
</span><span id="__span-52-96"><a id="__codelineno-52-96" name="__codelineno-52-96" href="#__codelineno-52-96"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Updates an exiting  villain&quot;</span><span class="p">)</span>
</span><span id="__span-52-97"><a id="__codelineno-52-97" name="__codelineno-52-97" href="#__codelineno-52-97"></a><span class="w">    </span><span class="nd">@PUT</span>
</span><span id="__span-52-98"><a id="__codelineno-52-98" name="__codelineno-52-98" href="#__codelineno-52-98"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span>
</span><span id="__span-52-99"><a id="__codelineno-52-99" name="__codelineno-52-99" href="#__codelineno-52-99"></a><span class="w">        </span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span>
</span><span id="__span-52-100"><a id="__codelineno-52-100" name="__codelineno-52-100" href="#__codelineno-52-100"></a><span class="w">        </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The updated villain&quot;</span><span class="p">,</span>
</span><span id="__span-52-101"><a id="__codelineno-52-101" name="__codelineno-52-101" href="#__codelineno-52-101"></a><span class="w">        </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Villain</span><span class="p">.</span><span class="na">class</span><span class="p">))</span>
</span><span id="__span-52-102"><a id="__codelineno-52-102" name="__codelineno-52-102" href="#__codelineno-52-102"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-52-103"><a id="__codelineno-52-103" name="__codelineno-52-103" href="#__codelineno-52-103"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Villain</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateVillain</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-104"><a id="__codelineno-52-104" name="__codelineno-52-104" href="#__codelineno-52-104"></a><span class="w">        </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">updateVillain</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-105"><a id="__codelineno-52-105" name="__codelineno-52-105" href="#__codelineno-52-105"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Villain updated with new valued &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-106"><a id="__codelineno-52-106" name="__codelineno-52-106" href="#__codelineno-52-106"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">villain</span><span class="p">);</span>
</span><span id="__span-52-107"><a id="__codelineno-52-107" name="__codelineno-52-107" href="#__codelineno-52-107"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-108"><a id="__codelineno-52-108" name="__codelineno-52-108" href="#__codelineno-52-108"></a>
</span><span id="__span-52-109"><a id="__codelineno-52-109" name="__codelineno-52-109" href="#__codelineno-52-109"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Deletes an exiting villain&quot;</span><span class="p">)</span>
</span><span id="__span-52-110"><a id="__codelineno-52-110" name="__codelineno-52-110" href="#__codelineno-52-110"></a><span class="w">    </span><span class="nd">@DELETE</span>
</span><span id="__span-52-111"><a id="__codelineno-52-111" name="__codelineno-52-111" href="#__codelineno-52-111"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-52-112"><a id="__codelineno-52-112" name="__codelineno-52-112" href="#__codelineno-52-112"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;204&quot;</span><span class="p">)</span>
</span><span id="__span-52-113"><a id="__codelineno-52-113" name="__codelineno-52-113" href="#__codelineno-52-113"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">deleteVillain</span><span class="p">(</span><span class="nd">@RestPath</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-114"><a id="__codelineno-52-114" name="__codelineno-52-114" href="#__codelineno-52-114"></a><span class="w">        </span><span class="n">service</span><span class="p">.</span><span class="na">deleteVillain</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-52-115"><a id="__codelineno-52-115" name="__codelineno-52-115" href="#__codelineno-52-115"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Villain deleted with &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-52-116"><a id="__codelineno-52-116" name="__codelineno-52-116" href="#__codelineno-52-116"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">noContent</span><span class="p">();</span>
</span><span id="__span-52-117"><a id="__codelineno-52-117" name="__codelineno-52-117" href="#__codelineno-52-117"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-118"><a id="__codelineno-52-118" name="__codelineno-52-118" href="#__codelineno-52-118"></a>
</span><span id="__span-52-119"><a id="__codelineno-52-119" name="__codelineno-52-119" href="#__codelineno-52-119"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-52-120"><a id="__codelineno-52-120" name="__codelineno-52-120" href="#__codelineno-52-120"></a><span class="w">    </span><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-52-121"><a id="__codelineno-52-121" name="__codelineno-52-121" href="#__codelineno-52-121"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
</span><span id="__span-52-122"><a id="__codelineno-52-122" name="__codelineno-52-122" href="#__codelineno-52-122"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-123"><a id="__codelineno-52-123" name="__codelineno-52-123" href="#__codelineno-52-123"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello Villain Resource&quot;</span><span class="p">;</span>
</span><span id="__span-52-124"><a id="__codelineno-52-124" name="__codelineno-52-124" href="#__codelineno-52-124"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-52-125"><a id="__codelineno-52-125" name="__codelineno-52-125" href="#__codelineno-52-125"></a><span class="p">}</span>
</span></code></pre></div>
<p>With this new code, go back to the Swagger UI at <a href="http://localhost:8084/q/swagger-ui">http://localhost:8084/q/swagger-ui</a> and refresh. Your endpoints are organized by tags, and each annotated endpoint is documented.</p>
<p>Documenting REST API is essential when working with different teams. You can see OpenAPI as the JavaDoc for REST.</p>
<h5 id="customizing-the-application">Customizing the Application</h5>
<p>The previous annotations allow you to customize the contract for a given REST Endpoint. But it’s also important to document the entire application.</p>
<p>The Microprofile OpenAPI also has a set of annotation to do so. The difference is that these annotations cannot be used on the endpoint methods, but instead on another Java class configuring the entire application.</p>
<p>For this, you need to create the <code>src/main/java/io/quarkus/workshop/superheroes/villain/VillainApplication</code> class with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.ApplicationPath</span><span class="p">;</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Application</span><span class="p">;</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.ExternalDocumentation</span><span class="p">;</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.OpenAPIDefinition</span><span class="p">;</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.info.Contact</span><span class="p">;</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.info.Info</span><span class="p">;</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.servers.Server</span><span class="p">;</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="nd">@ApplicationPath</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="nd">@OpenAPIDefinition</span><span class="p">(</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">    </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Info</span><span class="p">(</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Villain API&quot;</span><span class="p">,</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="w">        </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;This API allows CRUD operations on a villain&quot;</span><span class="p">,</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="w">        </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span><span class="p">,</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">        </span><span class="n">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Contact</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Quarkus&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://github.com/quarkusio&quot;</span><span class="p">)</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="w">    </span><span class="n">servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nd">@Server</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8084&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="w">    </span><span class="n">externalDocs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@ExternalDocumentation</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://github.com/quarkusio/quarkus-workshops&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;All the Quarkus workshops&quot;</span><span class="p">)</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="p">)</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainApplication</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="w">    </span><span class="c1">// Empty body</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a><span class="p">}</span>
</span></code></pre></div>
<p>Go back to the Swagger UI and refresh again. At the top of the document, you can see the version and the global API documentation.</p>
<h5 id="customized-contract">Customized Contract</h5>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nt">openapi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0.3</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="nt">info</span><span class="p">:</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Villain API</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This API allows CRUD operations on a villain</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">    </span><span class="nt">contact</span><span class="p">:</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Quarkus</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/quarkusio</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="nt">externalDocs</span><span class="p">:</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">All the Quarkus workshops</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/quarkusio/quarkus-workshops</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="nt">servers</span><span class="p">:</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8084</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="w">    </span><span class="nt">/api/villains</span><span class="p">:</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="w">        </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="w">            </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Returns all the villains from the database</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="w">            </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="w">                </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a><span class="w">                    </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a><span class="w">                        </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a><span class="w">                            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a><span class="w">                                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
</span><span id="__span-54-29"><a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a><span class="w">                                </span><span class="nt">items</span><span class="p">:</span>
</span><span id="__span-54-30"><a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a><span class="w">                                    </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-54-31"><a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a><span class="w">        </span><span class="nt">put</span><span class="p">:</span>
</span><span id="__span-54-32"><a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a><span class="w">            </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-33"><a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-34"><a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a><span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Updates an exiting  villain</span>
</span><span id="__span-54-35"><a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a><span class="w">            </span><span class="nt">requestBody</span><span class="p">:</span>
</span><span id="__span-54-36"><a id="__codelineno-54-36" name="__codelineno-54-36" href="#__codelineno-54-36"></a><span class="w">                </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-37"><a id="__codelineno-54-37" name="__codelineno-54-37" href="#__codelineno-54-37"></a><span class="w">                    </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-54-38"><a id="__codelineno-54-38" name="__codelineno-54-38" href="#__codelineno-54-38"></a><span class="w">                        </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-39"><a id="__codelineno-54-39" name="__codelineno-54-39" href="#__codelineno-54-39"></a><span class="w">                            </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-54-40"><a id="__codelineno-54-40" name="__codelineno-54-40" href="#__codelineno-54-40"></a><span class="w">            </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-54-41"><a id="__codelineno-54-41" name="__codelineno-54-41" href="#__codelineno-54-41"></a><span class="w">                </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-42"><a id="__codelineno-54-42" name="__codelineno-54-42" href="#__codelineno-54-42"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The updated villain</span>
</span><span id="__span-54-43"><a id="__codelineno-54-43" name="__codelineno-54-43" href="#__codelineno-54-43"></a><span class="w">                    </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-44"><a id="__codelineno-54-44" name="__codelineno-54-44" href="#__codelineno-54-44"></a><span class="w">                        </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-54-45"><a id="__codelineno-54-45" name="__codelineno-54-45" href="#__codelineno-54-45"></a><span class="w">                            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-46"><a id="__codelineno-54-46" name="__codelineno-54-46" href="#__codelineno-54-46"></a><span class="w">                                </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-54-47"><a id="__codelineno-54-47" name="__codelineno-54-47" href="#__codelineno-54-47"></a><span class="w">        </span><span class="nt">post</span><span class="p">:</span>
</span><span id="__span-54-48"><a id="__codelineno-54-48" name="__codelineno-54-48" href="#__codelineno-54-48"></a><span class="w">            </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-49"><a id="__codelineno-54-49" name="__codelineno-54-49" href="#__codelineno-54-49"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-50"><a id="__codelineno-54-50" name="__codelineno-54-50" href="#__codelineno-54-50"></a><span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Creates a valid villain</span>
</span><span id="__span-54-51"><a id="__codelineno-54-51" name="__codelineno-54-51" href="#__codelineno-54-51"></a><span class="w">            </span><span class="nt">requestBody</span><span class="p">:</span>
</span><span id="__span-54-52"><a id="__codelineno-54-52" name="__codelineno-54-52" href="#__codelineno-54-52"></a><span class="w">                </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-53"><a id="__codelineno-54-53" name="__codelineno-54-53" href="#__codelineno-54-53"></a><span class="w">                    </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-54-54"><a id="__codelineno-54-54" name="__codelineno-54-54" href="#__codelineno-54-54"></a><span class="w">                        </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-55"><a id="__codelineno-54-55" name="__codelineno-54-55" href="#__codelineno-54-55"></a><span class="w">                            </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-54-56"><a id="__codelineno-54-56" name="__codelineno-54-56" href="#__codelineno-54-56"></a><span class="w">            </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-54-57"><a id="__codelineno-54-57" name="__codelineno-54-57" href="#__codelineno-54-57"></a><span class="w">                </span><span class="s">&quot;201&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-58"><a id="__codelineno-54-58" name="__codelineno-54-58" href="#__codelineno-54-58"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The URI of the created villain</span>
</span><span id="__span-54-59"><a id="__codelineno-54-59" name="__codelineno-54-59" href="#__codelineno-54-59"></a><span class="w">                    </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-60"><a id="__codelineno-54-60" name="__codelineno-54-60" href="#__codelineno-54-60"></a><span class="w">                        </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-54-61"><a id="__codelineno-54-61" name="__codelineno-54-61" href="#__codelineno-54-61"></a><span class="w">                            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-62"><a id="__codelineno-54-62" name="__codelineno-54-62" href="#__codelineno-54-62"></a><span class="w">                                </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">uri</span>
</span><span id="__span-54-63"><a id="__codelineno-54-63" name="__codelineno-54-63" href="#__codelineno-54-63"></a><span class="w">                                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-54-64"><a id="__codelineno-54-64" name="__codelineno-54-64" href="#__codelineno-54-64"></a><span class="w">    </span><span class="nt">/api/villains/hello</span><span class="p">:</span>
</span><span id="__span-54-65"><a id="__codelineno-54-65" name="__codelineno-54-65" href="#__codelineno-54-65"></a><span class="w">        </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-54-66"><a id="__codelineno-54-66" name="__codelineno-54-66" href="#__codelineno-54-66"></a><span class="w">            </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-67"><a id="__codelineno-54-67" name="__codelineno-54-67" href="#__codelineno-54-67"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-68"><a id="__codelineno-54-68" name="__codelineno-54-68" href="#__codelineno-54-68"></a><span class="w">            </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-54-69"><a id="__codelineno-54-69" name="__codelineno-54-69" href="#__codelineno-54-69"></a><span class="w">                </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-70"><a id="__codelineno-54-70" name="__codelineno-54-70" href="#__codelineno-54-70"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-54-71"><a id="__codelineno-54-71" name="__codelineno-54-71" href="#__codelineno-54-71"></a><span class="w">                    </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-72"><a id="__codelineno-54-72" name="__codelineno-54-72" href="#__codelineno-54-72"></a><span class="w">                        </span><span class="nt">text/plain</span><span class="p">:</span>
</span><span id="__span-54-73"><a id="__codelineno-54-73" name="__codelineno-54-73" href="#__codelineno-54-73"></a><span class="w">                            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-74"><a id="__codelineno-54-74" name="__codelineno-54-74" href="#__codelineno-54-74"></a><span class="w">                                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-54-75"><a id="__codelineno-54-75" name="__codelineno-54-75" href="#__codelineno-54-75"></a><span class="w">    </span><span class="nt">/api/villains/random</span><span class="p">:</span>
</span><span id="__span-54-76"><a id="__codelineno-54-76" name="__codelineno-54-76" href="#__codelineno-54-76"></a><span class="w">        </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-54-77"><a id="__codelineno-54-77" name="__codelineno-54-77" href="#__codelineno-54-77"></a><span class="w">            </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-78"><a id="__codelineno-54-78" name="__codelineno-54-78" href="#__codelineno-54-78"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-79"><a id="__codelineno-54-79" name="__codelineno-54-79" href="#__codelineno-54-79"></a><span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Returns a random villain</span>
</span><span id="__span-54-80"><a id="__codelineno-54-80" name="__codelineno-54-80" href="#__codelineno-54-80"></a><span class="w">            </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-54-81"><a id="__codelineno-54-81" name="__codelineno-54-81" href="#__codelineno-54-81"></a><span class="w">                </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-82"><a id="__codelineno-54-82" name="__codelineno-54-82" href="#__codelineno-54-82"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-54-83"><a id="__codelineno-54-83" name="__codelineno-54-83" href="#__codelineno-54-83"></a><span class="w">                    </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-84"><a id="__codelineno-54-84" name="__codelineno-54-84" href="#__codelineno-54-84"></a><span class="w">                        </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-54-85"><a id="__codelineno-54-85" name="__codelineno-54-85" href="#__codelineno-54-85"></a><span class="w">                            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-86"><a id="__codelineno-54-86" name="__codelineno-54-86" href="#__codelineno-54-86"></a><span class="w">                                </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-54-87"><a id="__codelineno-54-87" name="__codelineno-54-87" href="#__codelineno-54-87"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">/api/villains/{id}</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-88"><a id="__codelineno-54-88" name="__codelineno-54-88" href="#__codelineno-54-88"></a><span class="w">        </span><span class="nt">get</span><span class="p">:</span>
</span><span id="__span-54-89"><a id="__codelineno-54-89" name="__codelineno-54-89" href="#__codelineno-54-89"></a><span class="w">            </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-90"><a id="__codelineno-54-90" name="__codelineno-54-90" href="#__codelineno-54-90"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-91"><a id="__codelineno-54-91" name="__codelineno-54-91" href="#__codelineno-54-91"></a><span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Returns a villain for a given identifier</span>
</span><span id="__span-54-92"><a id="__codelineno-54-92" name="__codelineno-54-92" href="#__codelineno-54-92"></a><span class="w">            </span><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-54-93"><a id="__codelineno-54-93" name="__codelineno-54-93" href="#__codelineno-54-93"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
</span><span id="__span-54-94"><a id="__codelineno-54-94" name="__codelineno-54-94" href="#__codelineno-54-94"></a><span class="w">                    </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
</span><span id="__span-54-95"><a id="__codelineno-54-95" name="__codelineno-54-95" href="#__codelineno-54-95"></a><span class="w">                    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-54-96"><a id="__codelineno-54-96" name="__codelineno-54-96" href="#__codelineno-54-96"></a><span class="w">                    </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-97"><a id="__codelineno-54-97" name="__codelineno-54-97" href="#__codelineno-54-97"></a><span class="w">                        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int64</span>
</span><span id="__span-54-98"><a id="__codelineno-54-98" name="__codelineno-54-98" href="#__codelineno-54-98"></a><span class="w">                        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-54-99"><a id="__codelineno-54-99" name="__codelineno-54-99" href="#__codelineno-54-99"></a><span class="w">            </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-54-100"><a id="__codelineno-54-100" name="__codelineno-54-100" href="#__codelineno-54-100"></a><span class="w">                </span><span class="s">&quot;200&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-101"><a id="__codelineno-54-101" name="__codelineno-54-101" href="#__codelineno-54-101"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OK</span>
</span><span id="__span-54-102"><a id="__codelineno-54-102" name="__codelineno-54-102" href="#__codelineno-54-102"></a><span class="w">                    </span><span class="nt">content</span><span class="p">:</span>
</span><span id="__span-54-103"><a id="__codelineno-54-103" name="__codelineno-54-103" href="#__codelineno-54-103"></a><span class="w">                        </span><span class="nt">application/json</span><span class="p">:</span>
</span><span id="__span-54-104"><a id="__codelineno-54-104" name="__codelineno-54-104" href="#__codelineno-54-104"></a><span class="w">                            </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-105"><a id="__codelineno-54-105" name="__codelineno-54-105" href="#__codelineno-54-105"></a><span class="w">                                </span><span class="nt">$ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#/components/schemas/Villain&#39;</span>
</span><span id="__span-54-106"><a id="__codelineno-54-106" name="__codelineno-54-106" href="#__codelineno-54-106"></a><span class="w">                </span><span class="s">&quot;204&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-107"><a id="__codelineno-54-107" name="__codelineno-54-107" href="#__codelineno-54-107"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The villain is not found for a given identifier</span>
</span><span id="__span-54-108"><a id="__codelineno-54-108" name="__codelineno-54-108" href="#__codelineno-54-108"></a><span class="w">        </span><span class="nt">delete</span><span class="p">:</span>
</span><span id="__span-54-109"><a id="__codelineno-54-109" name="__codelineno-54-109" href="#__codelineno-54-109"></a><span class="w">            </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-54-110"><a id="__codelineno-54-110" name="__codelineno-54-110" href="#__codelineno-54-110"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">villains</span>
</span><span id="__span-54-111"><a id="__codelineno-54-111" name="__codelineno-54-111" href="#__codelineno-54-111"></a><span class="w">            </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deletes an exiting villain</span>
</span><span id="__span-54-112"><a id="__codelineno-54-112" name="__codelineno-54-112" href="#__codelineno-54-112"></a><span class="w">            </span><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-54-113"><a id="__codelineno-54-113" name="__codelineno-54-113" href="#__codelineno-54-113"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id</span>
</span><span id="__span-54-114"><a id="__codelineno-54-114" name="__codelineno-54-114" href="#__codelineno-54-114"></a><span class="w">                    </span><span class="nt">in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
</span><span id="__span-54-115"><a id="__codelineno-54-115" name="__codelineno-54-115" href="#__codelineno-54-115"></a><span class="w">                    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-54-116"><a id="__codelineno-54-116" name="__codelineno-54-116" href="#__codelineno-54-116"></a><span class="w">                    </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-54-117"><a id="__codelineno-54-117" name="__codelineno-54-117" href="#__codelineno-54-117"></a><span class="w">                        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int64</span>
</span><span id="__span-54-118"><a id="__codelineno-54-118" name="__codelineno-54-118" href="#__codelineno-54-118"></a><span class="w">                        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-54-119"><a id="__codelineno-54-119" name="__codelineno-54-119" href="#__codelineno-54-119"></a><span class="w">            </span><span class="nt">responses</span><span class="p">:</span>
</span><span id="__span-54-120"><a id="__codelineno-54-120" name="__codelineno-54-120" href="#__codelineno-54-120"></a><span class="w">                </span><span class="s">&quot;204&quot;</span><span class="p p-Indicator">:</span>
</span><span id="__span-54-121"><a id="__codelineno-54-121" name="__codelineno-54-121" href="#__codelineno-54-121"></a><span class="w">                    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">No Content</span>
</span><span id="__span-54-122"><a id="__codelineno-54-122" name="__codelineno-54-122" href="#__codelineno-54-122"></a><span class="nt">components</span><span class="p">:</span>
</span><span id="__span-54-123"><a id="__codelineno-54-123" name="__codelineno-54-123" href="#__codelineno-54-123"></a><span class="w">    </span><span class="nt">schemas</span><span class="p">:</span>
</span><span id="__span-54-124"><a id="__codelineno-54-124" name="__codelineno-54-124" href="#__codelineno-54-124"></a><span class="w">        </span><span class="nt">Villain</span><span class="p">:</span>
</span><span id="__span-54-125"><a id="__codelineno-54-125" name="__codelineno-54-125" href="#__codelineno-54-125"></a><span class="w">            </span><span class="nt">required</span><span class="p">:</span>
</span><span id="__span-54-126"><a id="__codelineno-54-126" name="__codelineno-54-126" href="#__codelineno-54-126"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
</span><span id="__span-54-127"><a id="__codelineno-54-127" name="__codelineno-54-127" href="#__codelineno-54-127"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">level</span>
</span><span id="__span-54-128"><a id="__codelineno-54-128" name="__codelineno-54-128" href="#__codelineno-54-128"></a><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
</span><span id="__span-54-129"><a id="__codelineno-54-129" name="__codelineno-54-129" href="#__codelineno-54-129"></a><span class="w">            </span><span class="nt">properties</span><span class="p">:</span>
</span><span id="__span-54-130"><a id="__codelineno-54-130" name="__codelineno-54-130" href="#__codelineno-54-130"></a><span class="w">                </span><span class="nt">id</span><span class="p">:</span>
</span><span id="__span-54-131"><a id="__codelineno-54-131" name="__codelineno-54-131" href="#__codelineno-54-131"></a><span class="w">                    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int64</span>
</span><span id="__span-54-132"><a id="__codelineno-54-132" name="__codelineno-54-132" href="#__codelineno-54-132"></a><span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-54-133"><a id="__codelineno-54-133" name="__codelineno-54-133" href="#__codelineno-54-133"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span>
</span><span id="__span-54-134"><a id="__codelineno-54-134" name="__codelineno-54-134" href="#__codelineno-54-134"></a><span class="w">                    </span><span class="nt">maxLength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
</span><span id="__span-54-135"><a id="__codelineno-54-135" name="__codelineno-54-135" href="#__codelineno-54-135"></a><span class="w">                    </span><span class="nt">minLength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-54-136"><a id="__codelineno-54-136" name="__codelineno-54-136" href="#__codelineno-54-136"></a><span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-54-137"><a id="__codelineno-54-137" name="__codelineno-54-137" href="#__codelineno-54-137"></a><span class="w">                </span><span class="nt">otherName</span><span class="p">:</span>
</span><span id="__span-54-138"><a id="__codelineno-54-138" name="__codelineno-54-138" href="#__codelineno-54-138"></a><span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-54-139"><a id="__codelineno-54-139" name="__codelineno-54-139" href="#__codelineno-54-139"></a><span class="w">                </span><span class="nt">level</span><span class="p">:</span>
</span><span id="__span-54-140"><a id="__codelineno-54-140" name="__codelineno-54-140" href="#__codelineno-54-140"></a><span class="w">                    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int32</span>
</span><span id="__span-54-141"><a id="__codelineno-54-141" name="__codelineno-54-141" href="#__codelineno-54-141"></a><span class="w">                    </span><span class="nt">minimum</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-54-142"><a id="__codelineno-54-142" name="__codelineno-54-142" href="#__codelineno-54-142"></a><span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integer</span>
</span><span id="__span-54-143"><a id="__codelineno-54-143" name="__codelineno-54-143" href="#__codelineno-54-143"></a><span class="w">                </span><span class="nt">picture</span><span class="p">:</span>
</span><span id="__span-54-144"><a id="__codelineno-54-144" name="__codelineno-54-144" href="#__codelineno-54-144"></a><span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-54-145"><a id="__codelineno-54-145" name="__codelineno-54-145" href="#__codelineno-54-145"></a><span class="w">                </span><span class="nt">powers</span><span class="p">:</span>
</span><span id="__span-54-146"><a id="__codelineno-54-146" name="__codelineno-54-146" href="#__codelineno-54-146"></a><span class="w">                    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-54-147"><a id="__codelineno-54-147" name="__codelineno-54-147" href="#__codelineno-54-147"></a><span class="w">    </span><span class="nt">securitySchemes</span><span class="p">:</span>
</span><span id="__span-54-148"><a id="__codelineno-54-148" name="__codelineno-54-148" href="#__codelineno-54-148"></a><span class="w">        </span><span class="nt">SecurityScheme</span><span class="p">:</span>
</span><span id="__span-54-149"><a id="__codelineno-54-149" name="__codelineno-54-149" href="#__codelineno-54-149"></a><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id="__span-54-150"><a id="__codelineno-54-150" name="__codelineno-54-150" href="#__codelineno-54-150"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Authentication</span>
</span><span id="__span-54-151"><a id="__codelineno-54-151" name="__codelineno-54-151" href="#__codelineno-54-151"></a><span class="w">            </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">basic</span>
</span></code></pre></div>
<p>You can expose or exchange this contract to the API consumers, so they now what to expect when using your API.</p>
<h4 id="openapi-tests-in-villainresourcetest">OpenAPI Tests in VillainResourceTest</h4>
<p>Let’s add an extra test method in <code>VillainResourceTest</code> ensuring that the OpenAPI specification is packaged with the application:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nd">@Test</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">shouldPingOpenAPI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="n">given</span><span class="p">().</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">).</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/q/openapi&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">().</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>Run the test:</p>
<ul>
<li>
<p>From the dev mode, or</p>
</li>
<li>
<p>By executing the test using <code>./mvnw test</code>.</p>
</li>
</ul>
<hr />
<p>In the previous chapter, you had a quick peek at Quarkus and how you can build HTTP / REST-based applications with it. But that was just the beginning; Quarkus can do a lot more, which is the purpose of this chapter. In this chapter, you are going to see:</p>
<ul>
<li>
<p>What’s Quarkus? and how does it change the Java landscape</p>
</li>
<li>
<p>What are the main Quarkus idea, and how it helps in the <em>cloud native world</em></p>
</li>
<li>
<p>The Quarkus build process, in other words, the <em>secret sauce number 1</em></p>
</li>
<li>
<p>The Quarkus reactive nature, in other words, the <em>secret sauce number 2</em></p>
</li>
<li>
<p>Some Quarkus features such as the application lifecycle support</p>
</li>
<li>
<p>How you can use Quarkus to generate native executable</p>
</li>
</ul>
<h3 id="whats-quarkus">What’s Quarkus?</h3>
<p>Java was born more than 25 years ago. The world 25 years ago was quite different. The software industry has gone through several revolutions over these two decades. Java has always been able to reinvent itself to stay relevant.</p>
<p>But a new revolution is happening. While for years, most applications were running on huge machines, with lots of CPU and memory, they are now running on the Cloud, in constrained environments, in containers, where the resources are shared. Density is the new optimization: crank as many mini-apps (or microservices) as possible per node. And scale by adding more instances of an app instead of a more powerful single instance.</p>
<p>The Java ergonomics, designed 20 years ago, do not fit well in this new environment. Java applications were designed to run 24/7 for months, even years. The JIT is optimizing the execution over time; the GC manages the memory efficiently… But all these features have a cost, and the memory required to run Java applications and startup times are showstoppers when you deploy 20 or 50 microservices instead of one application. The issue is not the JVM itself; it’s also the Java ecosystem that needs to be reinvented.</p>
<p>That’s where Quarkus, and other projects, enter the game. Quarkus uses a build time principle. During the build of the application, tasks that usually happen at runtime are executed at build time.</p>
<p><img alt="quarkus build time principle" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/quarkus-build-time-principle.png" /></p>
<p>Thus, when the application runs, everything has been pre-computed, and all the annotation scanning, XML parsing, and so on won’t be executed anymore. It has two direct benefits: startup time (a lot faster) and memory consumption (a lot lower).</p>
<p><img alt="quarkus augmentation" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/quarkus-augmentation.png" /></p>
<p>So, as depicted in the figure above, Quarkus does bring an infrastructure for frameworks to embrace build time metadata discovery (like annotations), replace proxies with generated classes, pre-configure most frameworks, and handle dependency injection at build time.</p>
<p>Also, during the build, Quarkus detects which class needs to be accessed by reflection at runtime, boots framework at build time to record the result, and generally offers a lot of GraalVM optimization for free (or cheap at least). Indeed, thanks to all this metadata, Quarkus can configure native compilers such as the GraalVM compiler to generate a native executable for your Java application. Thanks to an aggressive dead-code elimination, the final executable is smaller, faster to start, and uses a ridiculously small amount of memory.</p>
<p><img alt="quarkus native compilation" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/quarkus-native-compilation.png" /></p>
<p>Quarkus does not stop there. As you have seen in the previous chapter, it proposes a stellar developer experience. It also unifies reactive and imperative to let you decide how you want to handle I/O. It allows implementing both REST and event-driven applications using a consistent model. To do this, Quarkus is based on a reactive core allowing high concurrency and reducing memory consumption.</p>
<p>Quarkus detects if your method can be called on the I/O thread and follows the reactive execution model; or if your method must be called on a worker thread and follows the imperative execution model.</p>
<p>Ok, but enough talking, time to see this in action.</p>
<h3 id="quarkus-augmentation">Quarkus Augmentation</h3>
<p>Let’s demystify all this.</p>
<p>So far, you have developed the super-villains microservice. This microservice is relatively simple. It still has database access, ORM support, transaction, JSON serialization, and deserialization.</p>
<p>Let’s now package this application using: <code>mvnw package</code></p>
<p>In the log, you can see actions happening during what Quarkus calls the <em>augmentation</em> phase.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>[INFO] --- quarkus-maven-plugin:3.9.1:build (default) @ rest-villains ---
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>[INFO] [org.jboss.threads] JBoss Threads version 3.4.2.Final
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>[INFO] [org.hibernate.Version] HHH000412: Hibernate ORM core version 5.5.7.Final
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>[INFO] [io.quarkus.deployment.QuarkusAugmentor] Quarkus augmentation completed in 1932ms
</span></code></pre></div>
<p>In this log, you can observe the <em>build</em> principle. Typically, about Hibernate, it saves from having to:</p>
<ol>
<li>
<p>embed an XML parser at runtime,</p>
</li>
<li>
<p>Do the actual parsing,</p>
</li>
<li>
<p>Configure Hibernate based on the content of the file.</p>
</li>
</ol>
<p>With Quarkus, at runtime, almost everything is already configured. Only runtime configuration properties are applied at startup (such as database URLs).</p>
<p>Also, during this augmentation, Java classes are generated or extended. Remember the <code>Villain</code> Panache entity. The class is extended during the <em>augmentation</em>. If you run <code>javap --class-path target/quarkus-app/quarkus/transformed-bytecode.jar io.quarkus.workshop.superheroes.villain.Villain</code>, you can see methods prefixed with <code>$$</code> added to the class.</p>
<p>Each <em>extension</em> can combine build time and run time. The following figure presents some of the extensions you already used, but there are a lot more. We are going to learn more about extensions later in this workshop and even build one. What’s important to understand for now is that the magic is packaged into extension, and every time you add a <code>quarkus-</code> dependency to your <code>pom.xml</code> file, you enable an extension.</p>
<p><img alt="quarkus extensions" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/quarkus-extensions.png" /></p>
<h3 id="application-lifecycle">Application Lifecycle</h3>
<p>Now that you know how Quarkus is structured let’s continue using various extensions. You often need to execute custom actions when the application starts and clean up everything when the application stops. In this module, we will display a banner in the logs once the Villain microservice has started.</p>
<h4 id="directory-structure_3">Directory Structure</h4>
<p>In this section, we will add an extra class (<code>VillainApplicationLifeCycle</code>) to handle the Villain API lifecycle. You will end up with the following directory structure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-c0e71dfef9a8c6bfc3196247f13073cf.png" /></p>
<p>When our application starts, the logs are dull and lack a banner (any decent application <strong>must</strong> have a banner nowadays).</p>
<p>So the first thing that you need to do is to go to the <a href="http://patorjk.com/software/taag">following website</a> and pick up your favorite "Villain API" text banner.</p>
<p>Create a new class named <code>VillainApplicationLifeCycle</code> (or pick another name, the name does not matter) in the <code>io.quarkus.workshop.superheroes.villain</code> package, and copy your banner, so you end up with something like the following:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.villain</span><span class="p">;</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.runtime.ShutdownEvent</span><span class="p">;</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.runtime.StartupEvent</span><span class="p">;</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.runtime.configuration.ConfigUtils</span><span class="p">;</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.event.Observes</span><span class="p">;</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VillainApplicationLifeCycle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">VillainApplicationLifeCycle</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">onStart</span><span class="p">(</span><span class="nd">@Observes</span><span class="w"> </span><span class="n">StartupEvent</span><span class="w"> </span><span class="n">ev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot; __     ___ _ _       _             _    ____ ___ &quot;</span><span class="p">);</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot; \\ \\   / (_) | | __ _(_)_ __       / \\  |  _ \\_ _|&quot;</span><span class="p">);</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;  \\ \\ / /| | | |/ _` | | &#39;_ \\     / _ \\ | |_) | | &quot;</span><span class="p">);</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;   \\ V / | | | | (_| | | | | |   / ___ \\|  __/| | &quot;</span><span class="p">);</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;    \\_/  |_|_|_|\\__,_|_|_| |_|  /_/   \\_\\_|  |___|&quot;</span><span class="p">);</span>
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-57-22"><a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a>
</span><span id="__span-57-23"><a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">onStop</span><span class="p">(</span><span class="nd">@Observes</span><span class="w"> </span><span class="n">ShutdownEvent</span><span class="w"> </span><span class="n">ev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-24"><a id="__codelineno-57-24" name="__codelineno-57-24" href="#__codelineno-57-24"></a><span class="w">        </span><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;The application VILLAIN is stopping...&quot;</span><span class="p">);</span>
</span><span id="__span-57-25"><a id="__codelineno-57-25" name="__codelineno-57-25" href="#__codelineno-57-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-57-26"><a id="__codelineno-57-26" name="__codelineno-57-26" href="#__codelineno-57-26"></a><span class="p">}</span>
</span></code></pre></div>
<p>Thanks to the CDI <code>@Observes</code>, the <code>VillainApplicationLifeCycle</code> is invoked. On startup with the <code>StartupEvent</code> so it can execute code (here, displaying the banner) when the application is starting</p>
<p>Run the application with: <code>./mvnw quarkus:dev</code>, the banner is printed to the console. When the application is stopped, the second log message is printed.</p>
<p>The method is called by ArC, the dependency injection framework used by Quarkus. Arc embraces the build-time principle, meaning that injection happens at build time. In addition, Arc can detect and remove unused beans at runtime, saving memory.</p>
<p>With the application running in dev mode, open your browser to <a href="http://localhost:8084/q/dev/">http://localhost:8084/q/dev/</a>. In the ArC widget, you can see the number of beans that have been removed ("Removed Beans"), and if you click on the link, see the list. If you click on the "Observers" link, you will see the two methods we added. In the "Fired Events" view, you can see which event has been fired and when.</p>
<h3 id="configuration-profiles">Configuration Profiles</h3>
<p>Quarkus supports the notion of configuration profiles. These allow you to have multiple configurations in the same file and select between them via a profile name.</p>
<p>Quarkus has three profiles by default, although it is possible to use as many as you like. The default profiles are:</p>
<ul>
<li>
<p><code>dev</code> - Activated when in development mode (i.e. <code>quarkus:dev</code>)</p>
</li>
<li>
<p><code>test</code> - Activated when running tests</p>
</li>
<li>
<p><code>prod</code> - The default profile when not running in development or test mode</p>
</li>
</ul>
<p>Let’s change the <code>VillainApplicationLifeCycle</code> so it displays the current profile.</p>
<p>For that, just add a log invoking <code>ConfigUtils.getProfiles()</code> in the <code>onStart()</code> method:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;The application VILLAIN is starting with profile &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ConfigUtils</span><span class="p">.</span><span class="na">getProfiles</span><span class="p">());</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>If not already done, you need to add the following import statement: <code>import io.quarkus.runtime.configuration.ConfigUtils;</code></p></td></tr></tbody></table>

<p>In the <code>application.properties</code> file, you can prefix a property with the profile. For example, we did add the <code>%test.level.multiplier=1</code> property in the previous chapter. It indicates that the property <code>level.multiplier</code> is set to 1 in the <code>test</code> profile.</p>
<p>Now, you will get the <code>dev</code> profile enabled if you start your application in dev mode with <code>./mvnw compile quarkus:dev</code>. If you start the tests, the <code>test</code> profile is enabled (the <code>multiplier</code> is set to 1).</p>
<p>You can also create your own profiles, and activate them with the <code>quarkus.profile</code> property. For example, to use a profile called <code>foo</code>, package your application with <code>./mvnw package</code>, and start it with <code>java -Dquarkus.profile=foo -jar target/quarkus-app/quarkus-run.jar</code>. You will see that the <code>foo</code> profile is enabled. As not overridden, the <code>level.multiplier</code> property has the value 0.5.</p>
<p>Profiles are handy to customize the configuration per environment. We are going to see an example of such customization in the next section.</p>
<h2 id="reactive">Reactive</h2>
<hr />
<p>Quarkus combines the build time principle with a reactive core. The combination of these two characteristics improves the application concurrency and makes use of resources more efficiently. In this chapter, we will see the counterpart of the Villain microservice: the Hero microservice! Instead of the imperative approach used for the villains, we will use reactive programming and Hibernate Reactive. The logic of the microservice is the same.</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-c5821fb9501d70d4e2c01bbd1c31fce8.png" /></p>
<p>In the following sections, you will learn:</p>
<ul>
<li>
<p>How to create a new reactive Quarkus application</p>
</li>
<li>
<p>How to implement REST API using JAX-RS and the RESTEasy Reactive extension using a reactive development model</p>
</li>
<li>
<p>How to access your database using Hibernate Reactive with Panache</p>
</li>
<li>
<p>How to use transactions the reactive way</p>
</li>
</ul>
<table><tbody><tr><td><i title="Important"></i></td><td>This service is exposed on the port 8083.</td></tr></tbody></table>

<h3 id="why-reactive">Why reactive?</h3>
<p>"Reactive" is a set of principles to build <em>better</em> distributed systems. By following these principles, you create more elastic and resilient systems.</p>
<p>One of the central aspects of being reactive is about using non-blocking I/O to handle remote interactions efficiently. With a few threads, your application can handle many concurrent I/Os. A consequence of such usage is the need to implement applications that do not block these threads. There are multiple approaches to do so, such as callbacks, co-routines, and reactive programming.</p>
<p>Quarkus encourages users to use Mutiny, an intuitive and event-driven reactive programming library. In this section, we will cover the basics of Mutiny and implement an entirely reactive microservice.</p>
<h3 id="hero-microservice">Hero Microservice</h3>
<p>New microservice, new project!</p>
<p>The easiest way to create this new Quarkus project is to use the Quarkus Maven plugin. Open a terminal and run the following command under the <code>quarkus-workshop-super-heroes/super-heroes</code> directory</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>./mvnw<span class="w"> </span>io.quarkus:quarkus-maven-plugin:3.9.1:create<span class="w">   </span>-<span class="s2">&quot;DplatformVersion=3.9.1&quot;</span><span class="w"> </span>-<span class="s2">&quot;DprojectGroupId=io.quarkus.workshop.super-heroes&quot;</span><span class="w">  </span>-<span class="s2">&quot;DprojectArtifactId=rest-heroes&quot;</span><span class="w"> </span>-DclassName<span class="o">=</span><span class="s2">&quot;io.quarkus.workshop.superheroes.hero.HeroResource&quot;</span><span class="w"> </span>-Dpath<span class="o">=</span><span class="s2">&quot;api/heroes&quot;</span><span class="w">   </span>-Dextensions<span class="o">=</span><span class="s2">&quot;rest-jackson,quarkus-hibernate-validator,quarkus-smallrye-openapi,quarkus-hibernate-reactive-panache,quarkus-reactive-pg-client&quot;</span>
</span></code></pre></div>
<p>As you can see, we can select multiple extensions during the project creation:</p>
<ul>
<li>
<p><code>rest-jackson</code> provides RESTEasy Reactive and the ability to map JSON objects,</p>
</li>
<li>
<p><code>quarkus-hibernate-validator</code> provides the Hibernate Validator support,</p>
</li>
<li>
<p><code>quarkus-smallrye-openapi</code> provides the OpenAPI descriptor support and the Swagger UI in the dev console,</p>
</li>
<li>
<p><code>quarkus-hibernate-reactive-panache</code> provides Panache entity supports using Hibernate Reactive, an ORM using reactive database drivers,</p>
</li>
<li>
<p><code>quarkus-reactive-pg-client</code> provides the reactive database driver used by Hibernate Reactive to interact with PostGreSQL databases.</p>
</li>
</ul>
<p>If you want your IDE to manage this new Maven project, you can declare it in the parent POM by adding this new module in the <code>&lt;modules&gt;</code> section:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="nt">&lt;module&gt;</span>super-heroes/rest-heroes<span class="nt">&lt;/module&gt;</span>
</span></code></pre></div>
<h4 id="directory-structure_4">Directory Structure</h4>
<p>At the end of this chapter, you will end up with the following directory structure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-4cd74d521582cd753cc00b2256e446f3.png" /></p>
<h4 id="the-hero-entity">The Hero entity</h4>
<p>Let’s start with the <code>Hero</code> entity class.</p>
<p>Create the <code>io.quarkus.workshop.superheroes.hero.Hero</code> class in the created project with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.hero</span><span class="p">;</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.hibernate.reactive.panache.PanacheEntity</span><span class="p">;</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Uni</span><span class="p">;</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Column</span><span class="p">;</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Entity</span><span class="p">;</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Min</span><span class="p">;</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.Size</span><span class="p">;</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="nd">@Entity</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Hero</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">PanacheEntity</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="w">    </span><span class="nd">@Size</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a>
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">otherName</span><span class="p">;</span>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-61-24"><a id="__codelineno-61-24" name="__codelineno-61-24" href="#__codelineno-61-24"></a><span class="w">    </span><span class="nd">@Min</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-61-25"><a id="__codelineno-61-25" name="__codelineno-61-25" href="#__codelineno-61-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p">;</span>
</span><span id="__span-61-26"><a id="__codelineno-61-26" name="__codelineno-61-26" href="#__codelineno-61-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">picture</span><span class="p">;</span>
</span><span id="__span-61-27"><a id="__codelineno-61-27" name="__codelineno-61-27" href="#__codelineno-61-27"></a>
</span><span id="__span-61-28"><a id="__codelineno-61-28" name="__codelineno-61-28" href="#__codelineno-61-28"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">columnDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TEXT&quot;</span><span class="p">)</span>
</span><span id="__span-61-29"><a id="__codelineno-61-29" name="__codelineno-61-29" href="#__codelineno-61-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">powers</span><span class="p">;</span>
</span><span id="__span-61-30"><a id="__codelineno-61-30" name="__codelineno-61-30" href="#__codelineno-61-30"></a>
</span><span id="__span-61-31"><a id="__codelineno-61-31" name="__codelineno-61-31" href="#__codelineno-61-31"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findRandom</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-32"><a id="__codelineno-61-32" name="__codelineno-61-32" href="#__codelineno-61-32"></a><span class="w">        </span><span class="n">Random</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">();</span>
</span><span id="__span-61-33"><a id="__codelineno-61-33" name="__codelineno-61-33" href="#__codelineno-61-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">()</span>
</span><span id="__span-61-34"><a id="__codelineno-61-34" name="__codelineno-61-34" href="#__codelineno-61-34"></a><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="n">count</span><span class="p">.</span><span class="na">intValue</span><span class="p">()))</span>
</span><span id="__span-61-35"><a id="__codelineno-61-35" name="__codelineno-61-35" href="#__codelineno-61-35"></a><span class="w">            </span><span class="p">.</span><span class="na">chain</span><span class="p">(</span><span class="n">randomHero</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">findAll</span><span class="p">().</span><span class="na">page</span><span class="p">(</span><span class="n">randomHero</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-61-36"><a id="__codelineno-61-36" name="__codelineno-61-36" href="#__codelineno-61-36"></a><span class="w">                </span><span class="p">.</span><span class="na">firstResult</span><span class="p">());</span>
</span><span id="__span-61-37"><a id="__codelineno-61-37" name="__codelineno-61-37" href="#__codelineno-61-37"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-61-38"><a id="__codelineno-61-38" name="__codelineno-61-38" href="#__codelineno-61-38"></a>
</span><span id="__span-61-39"><a id="__codelineno-61-39" name="__codelineno-61-39" href="#__codelineno-61-39"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-61-40"><a id="__codelineno-61-40" name="__codelineno-61-40" href="#__codelineno-61-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-41"><a id="__codelineno-61-41" name="__codelineno-61-41" href="#__codelineno-61-41"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hero{&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-61-42"><a id="__codelineno-61-42" name="__codelineno-61-42" href="#__codelineno-61-42"></a><span class="w">            </span><span class="s">&quot;id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-61-43"><a id="__codelineno-61-43" name="__codelineno-61-43" href="#__codelineno-61-43"></a><span class="w">            </span><span class="s">&quot;, name=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-61-44"><a id="__codelineno-61-44" name="__codelineno-61-44" href="#__codelineno-61-44"></a><span class="w">            </span><span class="s">&quot;, otherName=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">otherName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-61-45"><a id="__codelineno-61-45" name="__codelineno-61-45" href="#__codelineno-61-45"></a><span class="w">            </span><span class="s">&quot;, level=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-61-46"><a id="__codelineno-61-46" name="__codelineno-61-46" href="#__codelineno-61-46"></a><span class="w">            </span><span class="s">&quot;, picture=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">picture</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-61-47"><a id="__codelineno-61-47" name="__codelineno-61-47" href="#__codelineno-61-47"></a><span class="w">            </span><span class="s">&quot;, powers=&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">powers</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-61-48"><a id="__codelineno-61-48" name="__codelineno-61-48" href="#__codelineno-61-48"></a><span class="w">            </span><span class="sc">&#39;}&#39;</span><span class="p">;</span>
</span><span id="__span-61-49"><a id="__codelineno-61-49" name="__codelineno-61-49" href="#__codelineno-61-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-61-50"><a id="__codelineno-61-50" name="__codelineno-61-50" href="#__codelineno-61-50"></a><span class="p">}</span>
</span></code></pre></div>
<p>First, note that we are extending <code>io.quarkus.hibernate.reactive.panache.PanacheEntity</code>. It’s the reactive variant of <code>import io.quarkus.hibernate.orm.panache.PanacheEntity</code>. As a consequence, methods are asynchronous, and instead of returning an object, they return asynchronous structure that will let you know when the object is ready to be consumed.</p>
<p>The field part is the same as for the Villain. The <code>toString</code> method is also equivalent.</p>
<p>The major difference is the <code>findRandom</code> method. Instead of returning a <code>Hero</code>, it returns a <code>Uni&lt;Hero</code>. A <code>Uni</code> represents an asynchronous action. Unlike with the imperative development model, we cannot block the thread waiting for the result. Here, we need to register a <em>continuation</em> invoked when the result is available. During that time, the thread is released and can be used to handle another request.</p>
<p>Let’s split the <code>findRandom</code> method to better understand what’s going on:</p>
<ol>
<li>
<p><code>count()</code> returns a <code>Uni&lt;Long&gt;</code> with the number of heroes stored in the database,</p>
</li>
<li>
<p>when this count is retrieved from the database, it transforms the result into a random number,</p>
</li>
<li>
<p>when this is computed, it chains the processing with another asynchronous action which retrieve the hero located at the random index.</p>
</li>
</ol>
<p>As a consequence this method returns a <code>Uni&lt;Hero&gt;</code>. The consumer will need to register a continuation to receive the <code>Hero</code>.</p>
<h4 id="uni-api-in-2-minutes">Uni API in 2 minutes</h4>
<p>Uni comes from <a href="https://smallrye.io/smallrye-mutiny">Mutiny</a>, an intuitive, event-driven reactive programming library.</p>
<p>There are a few method to understand to use <code>Uni</code>:</p>
<ul>
<li>
<p><code>map</code> : transforms (synchronously) an item when this item becomes available.</p>
</li>
<li>
<p><code>chain</code>: transforms an item, when it become available, into another <code>Uni</code>. The outcome will be the outcome of the produced <code>Uni</code>.</p>
</li>
<li>
<p><code>replaceWith</code>: replaces an item with something else.</p>
</li>
<li>
<p><code>invoke</code>: invokes the method when the item becomes available. It does not modify the item.</p>
</li>
</ul>
<table><tbody><tr><td><i title="Note"></i></td><td><code>Uni</code> is lazy. To trigger the computation you need to subscribe to it. However, most of the time, Quarkus handles the subscription for us.</td></tr></tbody></table>

<h4 id="the-hero-resource">The Hero Resource</h4>
<p>Unlike the <code>VillainResource</code>, the <code>HeroResource</code> uses the reactive development model. It returns asynchronous structures (<code>Uni</code>).</p>
<p>Open the <code>HeroResource</code> and update the content to be:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.hero</span><span class="p">;</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.hibernate.reactive.panache.common.WithTransaction</span><span class="p">;</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Uni</span><span class="p">;</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.Operation</span><span class="p">;</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</span><span class="p">;</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Content</span><span class="p">;</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</span><span class="p">;</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.responses.APIResponse</span><span class="p">;</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.tags.Tag</span><span class="p">;</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.resteasy.reactive.RestPath</span><span class="p">;</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.resteasy.reactive.RestResponse</span><span class="p">;</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.DELETE</span><span class="p">;</span>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.GET</span><span class="p">;</span>
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.POST</span><span class="p">;</span>
</span><span id="__span-62-20"><a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.PUT</span><span class="p">;</span>
</span><span id="__span-62-21"><a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Path</span><span class="p">;</span>
</span><span id="__span-62-22"><a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Produces</span><span class="p">;</span>
</span><span id="__span-62-23"><a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Context</span><span class="p">;</span>
</span><span id="__span-62-24"><a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-62-25"><a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response</span><span class="p">;</span>
</span><span id="__span-62-26"><a id="__codelineno-62-26" name="__codelineno-62-26" href="#__codelineno-62-26"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.UriBuilder</span><span class="p">;</span>
</span><span id="__span-62-27"><a id="__codelineno-62-27" name="__codelineno-62-27" href="#__codelineno-62-27"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.UriInfo</span><span class="p">;</span>
</span><span id="__span-62-28"><a id="__codelineno-62-28" name="__codelineno-62-28" href="#__codelineno-62-28"></a>
</span><span id="__span-62-29"><a id="__codelineno-62-29" name="__codelineno-62-29" href="#__codelineno-62-29"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URI</span><span class="p">;</span>
</span><span id="__span-62-30"><a id="__codelineno-62-30" name="__codelineno-62-30" href="#__codelineno-62-30"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-62-31"><a id="__codelineno-62-31" name="__codelineno-62-31" href="#__codelineno-62-31"></a>
</span><span id="__span-62-32"><a id="__codelineno-62-32" name="__codelineno-62-32" href="#__codelineno-62-32"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-62-33"><a id="__codelineno-62-33" name="__codelineno-62-33" href="#__codelineno-62-33"></a>
</span><span id="__span-62-34"><a id="__codelineno-62-34" name="__codelineno-62-34" href="#__codelineno-62-34"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">)</span>
</span><span id="__span-62-35"><a id="__codelineno-62-35" name="__codelineno-62-35" href="#__codelineno-62-35"></a><span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;heroes&quot;</span><span class="p">)</span>
</span><span id="__span-62-36"><a id="__codelineno-62-36" name="__codelineno-62-36" href="#__codelineno-62-36"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HeroResource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-37"><a id="__codelineno-62-37" name="__codelineno-62-37" href="#__codelineno-62-37"></a>
</span><span id="__span-62-38"><a id="__codelineno-62-38" name="__codelineno-62-38" href="#__codelineno-62-38"></a><span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-62-39"><a id="__codelineno-62-39" name="__codelineno-62-39" href="#__codelineno-62-39"></a>
</span><span id="__span-62-40"><a id="__codelineno-62-40" name="__codelineno-62-40" href="#__codelineno-62-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">HeroResource</span><span class="p">(</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-41"><a id="__codelineno-62-41" name="__codelineno-62-41" href="#__codelineno-62-41"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-62-42"><a id="__codelineno-62-42" name="__codelineno-62-42" href="#__codelineno-62-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-43"><a id="__codelineno-62-43" name="__codelineno-62-43" href="#__codelineno-62-43"></a>
</span><span id="__span-62-44"><a id="__codelineno-62-44" name="__codelineno-62-44" href="#__codelineno-62-44"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Returns a random hero&quot;</span><span class="p">)</span>
</span><span id="__span-62-45"><a id="__codelineno-62-45" name="__codelineno-62-45" href="#__codelineno-62-45"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-62-46"><a id="__codelineno-62-46" name="__codelineno-62-46" href="#__codelineno-62-46"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/random&quot;</span><span class="p">)</span>
</span><span id="__span-62-47"><a id="__codelineno-62-47" name="__codelineno-62-47" href="#__codelineno-62-47"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)))</span>
</span><span id="__span-62-48"><a id="__codelineno-62-48" name="__codelineno-62-48" href="#__codelineno-62-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getRandomHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-49"><a id="__codelineno-62-49" name="__codelineno-62-49" href="#__codelineno-62-49"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">findRandom</span><span class="p">()</span>
</span><span id="__span-62-50"><a id="__codelineno-62-50" name="__codelineno-62-50" href="#__codelineno-62-50"></a><span class="w">            </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">ifNotNull</span><span class="p">().</span><span class="na">transform</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-51"><a id="__codelineno-62-51" name="__codelineno-62-51" href="#__codelineno-62-51"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="p">.</span><span class="na">debugf</span><span class="p">(</span><span class="s">&quot;Found random hero: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">);</span>
</span><span id="__span-62-52"><a id="__codelineno-62-52" name="__codelineno-62-52" href="#__codelineno-62-52"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span id="__span-62-53"><a id="__codelineno-62-53" name="__codelineno-62-53" href="#__codelineno-62-53"></a><span class="w">            </span><span class="p">})</span>
</span><span id="__span-62-54"><a id="__codelineno-62-54" name="__codelineno-62-54" href="#__codelineno-62-54"></a><span class="w">            </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">ifNull</span><span class="p">().</span><span class="na">continueWith</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-55"><a id="__codelineno-62-55" name="__codelineno-62-55" href="#__codelineno-62-55"></a><span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;No random villain found&quot;</span><span class="p">);</span>
</span><span id="__span-62-56"><a id="__codelineno-62-56" name="__codelineno-62-56" href="#__codelineno-62-56"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">notFound</span><span class="p">();</span>
</span><span id="__span-62-57"><a id="__codelineno-62-57" name="__codelineno-62-57" href="#__codelineno-62-57"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-62-58"><a id="__codelineno-62-58" name="__codelineno-62-58" href="#__codelineno-62-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-59"><a id="__codelineno-62-59" name="__codelineno-62-59" href="#__codelineno-62-59"></a>
</span><span id="__span-62-60"><a id="__codelineno-62-60" name="__codelineno-62-60" href="#__codelineno-62-60"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Returns all the heroes from the database&quot;</span><span class="p">)</span>
</span><span id="__span-62-61"><a id="__codelineno-62-61" name="__codelineno-62-61" href="#__codelineno-62-61"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-62-62"><a id="__codelineno-62-62" name="__codelineno-62-62" href="#__codelineno-62-62"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SchemaType</span><span class="p">.</span><span class="na">ARRAY</span><span class="p">)))</span>
</span><span id="__span-62-63"><a id="__codelineno-62-63" name="__codelineno-62-63" href="#__codelineno-62-63"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getAllHeroes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-64"><a id="__codelineno-62-64" name="__codelineno-62-64" href="#__codelineno-62-64"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">listAll</span><span class="p">();</span>
</span><span id="__span-62-65"><a id="__codelineno-62-65" name="__codelineno-62-65" href="#__codelineno-62-65"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-66"><a id="__codelineno-62-66" name="__codelineno-62-66" href="#__codelineno-62-66"></a>
</span><span id="__span-62-67"><a id="__codelineno-62-67" name="__codelineno-62-67" href="#__codelineno-62-67"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Returns a hero for a given identifier&quot;</span><span class="p">)</span>
</span><span id="__span-62-68"><a id="__codelineno-62-68" name="__codelineno-62-68" href="#__codelineno-62-68"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-62-69"><a id="__codelineno-62-69" name="__codelineno-62-69" href="#__codelineno-62-69"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-62-70"><a id="__codelineno-62-70" name="__codelineno-62-70" href="#__codelineno-62-70"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">class</span><span class="p">)))</span>
</span><span id="__span-62-71"><a id="__codelineno-62-71" name="__codelineno-62-71" href="#__codelineno-62-71"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;204&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The hero is not found for a given identifier&quot;</span><span class="p">)</span>
</span><span id="__span-62-72"><a id="__codelineno-62-72" name="__codelineno-62-72" href="#__codelineno-62-72"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getHero</span><span class="p">(</span><span class="nd">@RestPath</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-73"><a id="__codelineno-62-73" name="__codelineno-62-73" href="#__codelineno-62-73"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="n">findById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-62-74"><a id="__codelineno-62-74" name="__codelineno-62-74" href="#__codelineno-62-74"></a><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">hero</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-75"><a id="__codelineno-62-75" name="__codelineno-62-75" href="#__codelineno-62-75"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hero</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-76"><a id="__codelineno-62-76" name="__codelineno-62-76" href="#__codelineno-62-76"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">hero</span><span class="p">);</span>
</span><span id="__span-62-77"><a id="__codelineno-62-77" name="__codelineno-62-77" href="#__codelineno-62-77"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-62-78"><a id="__codelineno-62-78" name="__codelineno-62-78" href="#__codelineno-62-78"></a><span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">debugf</span><span class="p">(</span><span class="s">&quot;No Hero found with id %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-62-79"><a id="__codelineno-62-79" name="__codelineno-62-79" href="#__codelineno-62-79"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">noContent</span><span class="p">();</span>
</span><span id="__span-62-80"><a id="__codelineno-62-80" name="__codelineno-62-80" href="#__codelineno-62-80"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-62-81"><a id="__codelineno-62-81" name="__codelineno-62-81" href="#__codelineno-62-81"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-82"><a id="__codelineno-62-82" name="__codelineno-62-82" href="#__codelineno-62-82"></a>
</span><span id="__span-62-83"><a id="__codelineno-62-83" name="__codelineno-62-83" href="#__codelineno-62-83"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Creates a valid hero&quot;</span><span class="p">)</span>
</span><span id="__span-62-84"><a id="__codelineno-62-84" name="__codelineno-62-84" href="#__codelineno-62-84"></a><span class="w">    </span><span class="nd">@POST</span>
</span><span id="__span-62-85"><a id="__codelineno-62-85" name="__codelineno-62-85" href="#__codelineno-62-85"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;201&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The URI of the created hero&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URI</span><span class="p">.</span><span class="na">class</span><span class="p">)))</span>
</span><span id="__span-62-86"><a id="__codelineno-62-86" name="__codelineno-62-86" href="#__codelineno-62-86"></a><span class="w">    </span><span class="nd">@WithTransaction</span>
</span><span id="__span-62-87"><a id="__codelineno-62-87" name="__codelineno-62-87" href="#__codelineno-62-87"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">URI</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">createHero</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="p">,</span><span class="w"> </span><span class="nd">@Context</span><span class="w"> </span><span class="n">UriInfo</span><span class="w"> </span><span class="n">uriInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-88"><a id="__codelineno-62-88" name="__codelineno-62-88" href="#__codelineno-62-88"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">hero</span><span class="p">.</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="n">persist</span><span class="p">()</span>
</span><span id="__span-62-89"><a id="__codelineno-62-89" name="__codelineno-62-89" href="#__codelineno-62-89"></a><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-90"><a id="__codelineno-62-90" name="__codelineno-62-90" href="#__codelineno-62-90"></a><span class="w">                </span><span class="n">UriBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uriInfo</span><span class="p">.</span><span class="na">getAbsolutePathBuilder</span><span class="p">().</span><span class="na">path</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="na">id</span><span class="p">));</span>
</span><span id="__span-62-91"><a id="__codelineno-62-91" name="__codelineno-62-91" href="#__codelineno-62-91"></a><span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;New Hero created with URI &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span>
</span><span id="__span-62-92"><a id="__codelineno-62-92" name="__codelineno-62-92" href="#__codelineno-62-92"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">created</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
</span><span id="__span-62-93"><a id="__codelineno-62-93" name="__codelineno-62-93" href="#__codelineno-62-93"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-62-94"><a id="__codelineno-62-94" name="__codelineno-62-94" href="#__codelineno-62-94"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-95"><a id="__codelineno-62-95" name="__codelineno-62-95" href="#__codelineno-62-95"></a>
</span><span id="__span-62-96"><a id="__codelineno-62-96" name="__codelineno-62-96" href="#__codelineno-62-96"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Updates an exiting hero&quot;</span><span class="p">)</span>
</span><span id="__span-62-97"><a id="__codelineno-62-97" name="__codelineno-62-97" href="#__codelineno-62-97"></a><span class="w">    </span><span class="nd">@PUT</span>
</span><span id="__span-62-98"><a id="__codelineno-62-98" name="__codelineno-62-98" href="#__codelineno-62-98"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The updated hero&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">class</span><span class="p">)))</span>
</span><span id="__span-62-99"><a id="__codelineno-62-99" name="__codelineno-62-99" href="#__codelineno-62-99"></a><span class="w">    </span><span class="nd">@WithTransaction</span>
</span><span id="__span-62-100"><a id="__codelineno-62-100" name="__codelineno-62-100" href="#__codelineno-62-100"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateHero</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-101"><a id="__codelineno-62-101" name="__codelineno-62-101" href="#__codelineno-62-101"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="n">findById</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">id</span><span class="p">)</span>
</span><span id="__span-62-102"><a id="__codelineno-62-102" name="__codelineno-62-102" href="#__codelineno-62-102"></a><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">retrieved</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-103"><a id="__codelineno-62-103" name="__codelineno-62-103" href="#__codelineno-62-103"></a><span class="w">                </span><span class="n">retrieved</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="p">;</span>
</span><span id="__span-62-104"><a id="__codelineno-62-104" name="__codelineno-62-104" href="#__codelineno-62-104"></a><span class="w">                </span><span class="n">retrieved</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hero</span><span class="p">.</span><span class="na">otherName</span><span class="p">;</span>
</span><span id="__span-62-105"><a id="__codelineno-62-105" name="__codelineno-62-105" href="#__codelineno-62-105"></a><span class="w">                </span><span class="n">retrieved</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="p">;</span>
</span><span id="__span-62-106"><a id="__codelineno-62-106" name="__codelineno-62-106" href="#__codelineno-62-106"></a><span class="w">                </span><span class="n">retrieved</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="p">;</span>
</span><span id="__span-62-107"><a id="__codelineno-62-107" name="__codelineno-62-107" href="#__codelineno-62-107"></a><span class="w">                </span><span class="n">retrieved</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hero</span><span class="p">.</span><span class="na">powers</span><span class="p">;</span>
</span><span id="__span-62-108"><a id="__codelineno-62-108" name="__codelineno-62-108" href="#__codelineno-62-108"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">retrieved</span><span class="p">;</span>
</span><span id="__span-62-109"><a id="__codelineno-62-109" name="__codelineno-62-109" href="#__codelineno-62-109"></a><span class="w">            </span><span class="p">})</span>
</span><span id="__span-62-110"><a id="__codelineno-62-110" name="__codelineno-62-110" href="#__codelineno-62-110"></a><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-111"><a id="__codelineno-62-111" name="__codelineno-62-111" href="#__codelineno-62-111"></a><span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">debugf</span><span class="p">(</span><span class="s">&quot;Hero updated with new valued %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">);</span>
</span><span id="__span-62-112"><a id="__codelineno-62-112" name="__codelineno-62-112" href="#__codelineno-62-112"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">h</span><span class="p">;</span>
</span><span id="__span-62-113"><a id="__codelineno-62-113" name="__codelineno-62-113" href="#__codelineno-62-113"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-62-114"><a id="__codelineno-62-114" name="__codelineno-62-114" href="#__codelineno-62-114"></a>
</span><span id="__span-62-115"><a id="__codelineno-62-115" name="__codelineno-62-115" href="#__codelineno-62-115"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-116"><a id="__codelineno-62-116" name="__codelineno-62-116" href="#__codelineno-62-116"></a>
</span><span id="__span-62-117"><a id="__codelineno-62-117" name="__codelineno-62-117" href="#__codelineno-62-117"></a><span class="w">    </span><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Deletes an exiting hero&quot;</span><span class="p">)</span>
</span><span id="__span-62-118"><a id="__codelineno-62-118" name="__codelineno-62-118" href="#__codelineno-62-118"></a><span class="w">    </span><span class="nd">@DELETE</span>
</span><span id="__span-62-119"><a id="__codelineno-62-119" name="__codelineno-62-119" href="#__codelineno-62-119"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-62-120"><a id="__codelineno-62-120" name="__codelineno-62-120" href="#__codelineno-62-120"></a><span class="w">    </span><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;204&quot;</span><span class="p">)</span>
</span><span id="__span-62-121"><a id="__codelineno-62-121" name="__codelineno-62-121" href="#__codelineno-62-121"></a><span class="w">    </span><span class="nd">@WithTransaction</span>
</span><span id="__span-62-122"><a id="__codelineno-62-122" name="__codelineno-62-122" href="#__codelineno-62-122"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">deleteHero</span><span class="p">(</span><span class="nd">@RestPath</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-123"><a id="__codelineno-62-123" name="__codelineno-62-123" href="#__codelineno-62-123"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-62-124"><a id="__codelineno-62-124" name="__codelineno-62-124" href="#__codelineno-62-124"></a><span class="w">            </span><span class="p">.</span><span class="na">invoke</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">debugf</span><span class="p">(</span><span class="s">&quot;Hero deleted with %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">))</span>
</span><span id="__span-62-125"><a id="__codelineno-62-125" name="__codelineno-62-125" href="#__codelineno-62-125"></a><span class="w">            </span><span class="p">.</span><span class="na">replaceWith</span><span class="p">(</span><span class="n">RestResponse</span><span class="p">.</span><span class="na">noContent</span><span class="p">());</span>
</span><span id="__span-62-126"><a id="__codelineno-62-126" name="__codelineno-62-126" href="#__codelineno-62-126"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-127"><a id="__codelineno-62-127" name="__codelineno-62-127" href="#__codelineno-62-127"></a>
</span><span id="__span-62-128"><a id="__codelineno-62-128" name="__codelineno-62-128" href="#__codelineno-62-128"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-62-129"><a id="__codelineno-62-129" name="__codelineno-62-129" href="#__codelineno-62-129"></a><span class="w">    </span><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-62-130"><a id="__codelineno-62-130" name="__codelineno-62-130" href="#__codelineno-62-130"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
</span><span id="__span-62-131"><a id="__codelineno-62-131" name="__codelineno-62-131" href="#__codelineno-62-131"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-132"><a id="__codelineno-62-132" name="__codelineno-62-132" href="#__codelineno-62-132"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello Hero Resource&quot;</span><span class="p">;</span>
</span><span id="__span-62-133"><a id="__codelineno-62-133" name="__codelineno-62-133" href="#__codelineno-62-133"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-62-134"><a id="__codelineno-62-134" name="__codelineno-62-134" href="#__codelineno-62-134"></a><span class="p">}</span>
</span></code></pre></div>
<p>The resource implements the same HTTP API as the villain counterpart. It does not use a transactional service, but uses Panache method directly.</p>
<p>As you can see, instead of returning the result directly, it returns <code>Uni&lt;T&gt;</code>. Quarkus retrieves the <code>Uni</code> and <em>waits</em> for the outcome to be available before writing the response. During that time, it can handle other requests.</p>
<p>Notice also the <code>@WithTransaction</code>, which is the reactive variant of <code>@Transactional</code>.</p>
<h4 id="configuring-the-reactive-access-to-the-database">Configuring the reactive access to the database</h4>
<p>Configuring the reactive access to the database is relatively similar to configuring the JDBC url.</p>
<p>Open the <code>application.properties</code> file and add:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1">## HTTP configuration</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="na">quarkus.http.port</span><span class="o">=</span><span class="s">8083</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="c1">## Custom banner file path</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="na">quarkus.banner.path</span><span class="o">=</span><span class="s">banner.txt</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="c1"># drop and create the database at startup (use `update` to only update the schema)</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="na">quarkus.hibernate-orm.database.generation</span><span class="o">=</span><span class="s">drop-and-create</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="na">%prod.quarkus.datasource.username</span><span class="o">=</span><span class="s">superman</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="na">%prod.quarkus.datasource.password</span><span class="o">=</span><span class="s">superman</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="na">%prod.quarkus.datasource.reactive.url</span><span class="o">=</span><span class="s">postgresql://localhost:5432/heroes_database</span>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="na">%prod.quarkus.hibernate-orm.sql-load-script</span><span class="o">=</span><span class="s">import.sql</span>
</span></code></pre></div>
<p>The <em>prod</em> profile contains the <code>%prod.quarkus.datasource.reactive.url</code> which configure the access to the database.</p>
<p>We also set the port to be 8083.</p>
<h4 id="importing-heroes">Importing heroes</h4>
<p>Create the <code>src/main/resources/import.sql</code> and copy the content from <a href="https://raw.githubusercontent.com/johan-die/workshop-super-hero-data/main/super/import.sql">import.sql</a>.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">ALTER</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">hero_seq</span><span class="w"> </span><span class="k">RESTART</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">hero</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">otherName</span><span class="p">,</span><span class="w"> </span><span class="n">picture</span><span class="p">,</span><span class="w"> </span><span class="n">powers</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">)</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;hero_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Chewbacca&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/10466.jpg&#39;</span><span class="p">,</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">        </span><span class="s1">&#39;Agility, Longevity, Marksmanship, Natural Weapons, Stealth, Super Strength, Weapons Master&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">hero</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">otherName</span><span class="p">,</span><span class="w"> </span><span class="n">picture</span><span class="p">,</span><span class="w"> </span><span class="n">powers</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">)</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;hero_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Angel Salvadore&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Angel Salvadore Bohusk&#39;</span><span class="p">,</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">        </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/1406.jpg&#39;</span><span class="p">,</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">        </span><span class="s1">&#39;Animal Attributes, Animal Oriented Powers, Flight, Regeneration, Toxin and Disease Control&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">hero</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">otherName</span><span class="p">,</span><span class="w"> </span><span class="n">picture</span><span class="p">,</span><span class="w"> </span><span class="n">powers</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">)</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;hero_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Bill Harken&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/1527.jpg&#39;</span><span class="p">,</span>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w">        </span><span class="s1">&#39;Super Speed, Super Strength, Toxin and Disease Resistance&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="p">...</span>
</span></code></pre></div>
<h4 id="testing-the-heroes">Testing the heroes</h4>
<p>Time for some tests! Open the <code>io.quarkus.workshop.superheroes.hero.HeroResourceTest</code> class and copy the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.hero</span><span class="p">;</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.junit.QuarkusTest</span><span class="p">;</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.restassured.common.mapper.TypeRef</span><span class="p">;</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.hamcrest.core.Is</span><span class="p">;</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.MethodOrderer</span><span class="p">;</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Order</span><span class="p">;</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.TestMethodOrder</span><span class="p">;</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.get</span><span class="p">;</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.given</span><span class="p">;</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.ACCEPT</span><span class="p">;</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.CONTENT_TYPE</span><span class="p">;</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.TEXT_PLAIN</span><span class="p">;</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.BAD_REQUEST</span><span class="p">;</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.CREATED</span><span class="p">;</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.NO_CONTENT</span><span class="p">;</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.OK</span><span class="p">;</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.hamcrest.CoreMatchers.is</span><span class="p">;</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span><span class="p">;</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertNotNull</span><span class="p">;</span>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertTrue</span><span class="p">;</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a><span class="nd">@TestMethodOrder</span><span class="p">(</span><span class="n">MethodOrderer</span><span class="p">.</span><span class="na">OrderAnnotation</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HeroResourceTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a>
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;application/json;charset=UTF-8&quot;</span><span class="p">;</span>
</span><span id="__span-65-34"><a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a>
</span><span id="__span-65-35"><a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Baguette&quot;</span><span class="p">;</span>
</span><span id="__span-65-36"><a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Baguette (updated)&quot;</span><span class="p">;</span>
</span><span id="__span-65-37"><a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_OTHER_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Baguette Tradition&quot;</span><span class="p">;</span>
</span><span id="__span-65-38"><a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_OTHER_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Baguette Tradition (updated)&quot;</span><span class="p">;</span>
</span><span id="__span-65-39"><a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_baguette.png&quot;</span><span class="p">;</span>
</span><span id="__span-65-40"><a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_baguette_updated.png&quot;</span><span class="p">;</span>
</span><span id="__span-65-41"><a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;eats baguette really quickly&quot;</span><span class="p">;</span>
</span><span id="__span-65-42"><a id="__codelineno-65-42" name="__codelineno-65-42" href="#__codelineno-65-42"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATED_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;eats baguette really quickly (updated)&quot;</span><span class="p">;</span>
</span><span id="__span-65-43"><a id="__codelineno-65-43" name="__codelineno-65-43" href="#__codelineno-65-43"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-65-44"><a id="__codelineno-65-44" name="__codelineno-65-44" href="#__codelineno-65-44"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">UPDATED_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">43</span><span class="p">;</span>
</span><span id="__span-65-45"><a id="__codelineno-65-45" name="__codelineno-65-45" href="#__codelineno-65-45"></a>
</span><span id="__span-65-46"><a id="__codelineno-65-46" name="__codelineno-65-46" href="#__codelineno-65-46"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NB_HEROES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">941</span><span class="p">;</span>
</span><span id="__span-65-47"><a id="__codelineno-65-47" name="__codelineno-65-47" href="#__codelineno-65-47"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">heroId</span><span class="p">;</span>
</span><span id="__span-65-48"><a id="__codelineno-65-48" name="__codelineno-65-48" href="#__codelineno-65-48"></a>
</span><span id="__span-65-49"><a id="__codelineno-65-49" name="__codelineno-65-49" href="#__codelineno-65-49"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-50"><a id="__codelineno-65-50" name="__codelineno-65-50" href="#__codelineno-65-50"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldPingOpenAPI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-51"><a id="__codelineno-65-51" name="__codelineno-65-51" href="#__codelineno-65-51"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-52"><a id="__codelineno-65-52" name="__codelineno-65-52" href="#__codelineno-65-52"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-53"><a id="__codelineno-65-53" name="__codelineno-65-53" href="#__codelineno-65-53"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-54"><a id="__codelineno-65-54" name="__codelineno-65-54" href="#__codelineno-65-54"></a><span class="w">            </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/q/openapi&quot;</span><span class="p">)</span>
</span><span id="__span-65-55"><a id="__codelineno-65-55" name="__codelineno-65-55" href="#__codelineno-65-55"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-56"><a id="__codelineno-65-56" name="__codelineno-65-56" href="#__codelineno-65-56"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-65-57"><a id="__codelineno-65-57" name="__codelineno-65-57" href="#__codelineno-65-57"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-58"><a id="__codelineno-65-58" name="__codelineno-65-58" href="#__codelineno-65-58"></a>
</span><span id="__span-65-59"><a id="__codelineno-65-59" name="__codelineno-65-59" href="#__codelineno-65-59"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-60"><a id="__codelineno-65-60" name="__codelineno-65-60" href="#__codelineno-65-60"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testHelloEndpoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-61"><a id="__codelineno-65-61" name="__codelineno-65-61" href="#__codelineno-65-61"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-62"><a id="__codelineno-65-62" name="__codelineno-65-62" href="#__codelineno-65-62"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-65-63"><a id="__codelineno-65-63" name="__codelineno-65-63" href="#__codelineno-65-63"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-64"><a id="__codelineno-65-64" name="__codelineno-65-64" href="#__codelineno-65-64"></a><span class="w">            </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/heroes/hello&quot;</span><span class="p">)</span>
</span><span id="__span-65-65"><a id="__codelineno-65-65" name="__codelineno-65-65" href="#__codelineno-65-65"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-66"><a id="__codelineno-65-66" name="__codelineno-65-66" href="#__codelineno-65-66"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-65-67"><a id="__codelineno-65-67" name="__codelineno-65-67" href="#__codelineno-65-67"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello Hero Resource&quot;</span><span class="p">));</span>
</span><span id="__span-65-68"><a id="__codelineno-65-68" name="__codelineno-65-68" href="#__codelineno-65-68"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-69"><a id="__codelineno-65-69" name="__codelineno-65-69" href="#__codelineno-65-69"></a>
</span><span id="__span-65-70"><a id="__codelineno-65-70" name="__codelineno-65-70" href="#__codelineno-65-70"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-71"><a id="__codelineno-65-71" name="__codelineno-65-71" href="#__codelineno-65-71"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotGetUnknownHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-72"><a id="__codelineno-65-72" name="__codelineno-65-72" href="#__codelineno-65-72"></a><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">randomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">().</span><span class="na">nextLong</span><span class="p">();</span>
</span><span id="__span-65-73"><a id="__codelineno-65-73" name="__codelineno-65-73" href="#__codelineno-65-73"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-74"><a id="__codelineno-65-74" name="__codelineno-65-74" href="#__codelineno-65-74"></a><span class="w">            </span><span class="p">.</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">randomId</span><span class="p">)</span>
</span><span id="__span-65-75"><a id="__codelineno-65-75" name="__codelineno-65-75" href="#__codelineno-65-75"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-76"><a id="__codelineno-65-76" name="__codelineno-65-76" href="#__codelineno-65-76"></a><span class="w">            </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/heroes/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-65-77"><a id="__codelineno-65-77" name="__codelineno-65-77" href="#__codelineno-65-77"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-78"><a id="__codelineno-65-78" name="__codelineno-65-78" href="#__codelineno-65-78"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">NO_CONTENT</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-65-79"><a id="__codelineno-65-79" name="__codelineno-65-79" href="#__codelineno-65-79"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-80"><a id="__codelineno-65-80" name="__codelineno-65-80" href="#__codelineno-65-80"></a>
</span><span id="__span-65-81"><a id="__codelineno-65-81" name="__codelineno-65-81" href="#__codelineno-65-81"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-82"><a id="__codelineno-65-82" name="__codelineno-65-82" href="#__codelineno-65-82"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetRandomHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-83"><a id="__codelineno-65-83" name="__codelineno-65-83" href="#__codelineno-65-83"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-84"><a id="__codelineno-65-84" name="__codelineno-65-84" href="#__codelineno-65-84"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-85"><a id="__codelineno-65-85" name="__codelineno-65-85" href="#__codelineno-65-85"></a><span class="w">            </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/heroes/random&quot;</span><span class="p">)</span>
</span><span id="__span-65-86"><a id="__codelineno-65-86" name="__codelineno-65-86" href="#__codelineno-65-86"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-87"><a id="__codelineno-65-87" name="__codelineno-65-87" href="#__codelineno-65-87"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-88"><a id="__codelineno-65-88" name="__codelineno-65-88" href="#__codelineno-65-88"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">);</span>
</span><span id="__span-65-89"><a id="__codelineno-65-89" name="__codelineno-65-89" href="#__codelineno-65-89"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-90"><a id="__codelineno-65-90" name="__codelineno-65-90" href="#__codelineno-65-90"></a>
</span><span id="__span-65-91"><a id="__codelineno-65-91" name="__codelineno-65-91" href="#__codelineno-65-91"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-92"><a id="__codelineno-65-92" name="__codelineno-65-92" href="#__codelineno-65-92"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotAddInvalidItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-93"><a id="__codelineno-65-93" name="__codelineno-65-93" href="#__codelineno-65-93"></a><span class="w">        </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hero</span><span class="p">();</span>
</span><span id="__span-65-94"><a id="__codelineno-65-94" name="__codelineno-65-94" href="#__codelineno-65-94"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-65-95"><a id="__codelineno-65-95" name="__codelineno-65-95" href="#__codelineno-65-95"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_OTHER_NAME</span><span class="p">;</span>
</span><span id="__span-65-96"><a id="__codelineno-65-96" name="__codelineno-65-96" href="#__codelineno-65-96"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_PICTURE</span><span class="p">;</span>
</span><span id="__span-65-97"><a id="__codelineno-65-97" name="__codelineno-65-97" href="#__codelineno-65-97"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_POWERS</span><span class="p">;</span>
</span><span id="__span-65-98"><a id="__codelineno-65-98" name="__codelineno-65-98" href="#__codelineno-65-98"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-65-99"><a id="__codelineno-65-99" name="__codelineno-65-99" href="#__codelineno-65-99"></a>
</span><span id="__span-65-100"><a id="__codelineno-65-100" name="__codelineno-65-100" href="#__codelineno-65-100"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-101"><a id="__codelineno-65-101" name="__codelineno-65-101" href="#__codelineno-65-101"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">hero</span><span class="p">)</span>
</span><span id="__span-65-102"><a id="__codelineno-65-102" name="__codelineno-65-102" href="#__codelineno-65-102"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-103"><a id="__codelineno-65-103" name="__codelineno-65-103" href="#__codelineno-65-103"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-104"><a id="__codelineno-65-104" name="__codelineno-65-104" href="#__codelineno-65-104"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-105"><a id="__codelineno-65-105" name="__codelineno-65-105" href="#__codelineno-65-105"></a><span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">)</span>
</span><span id="__span-65-106"><a id="__codelineno-65-106" name="__codelineno-65-106" href="#__codelineno-65-106"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-107"><a id="__codelineno-65-107" name="__codelineno-65-107" href="#__codelineno-65-107"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">BAD_REQUEST</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-65-108"><a id="__codelineno-65-108" name="__codelineno-65-108" href="#__codelineno-65-108"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-109"><a id="__codelineno-65-109" name="__codelineno-65-109" href="#__codelineno-65-109"></a>
</span><span id="__span-65-110"><a id="__codelineno-65-110" name="__codelineno-65-110" href="#__codelineno-65-110"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-111"><a id="__codelineno-65-111" name="__codelineno-65-111" href="#__codelineno-65-111"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-65-112"><a id="__codelineno-65-112" name="__codelineno-65-112" href="#__codelineno-65-112"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetInitialItems</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-113"><a id="__codelineno-65-113" name="__codelineno-65-113" href="#__codelineno-65-113"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="w"> </span><span class="n">heroes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-114"><a id="__codelineno-65-114" name="__codelineno-65-114" href="#__codelineno-65-114"></a><span class="w">                                              </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-115"><a id="__codelineno-65-115" name="__codelineno-65-115" href="#__codelineno-65-115"></a><span class="w">                                              </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-116"><a id="__codelineno-65-116" name="__codelineno-65-116" href="#__codelineno-65-116"></a><span class="w">                                              </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-65-117"><a id="__codelineno-65-117" name="__codelineno-65-117" href="#__codelineno-65-117"></a><span class="w">                                              </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-65-118"><a id="__codelineno-65-118" name="__codelineno-65-118" href="#__codelineno-65-118"></a><span class="w">                                              </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getHeroTypeRef</span><span class="p">());</span>
</span><span id="__span-65-119"><a id="__codelineno-65-119" name="__codelineno-65-119" href="#__codelineno-65-119"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_HEROES</span><span class="p">,</span><span class="w"> </span><span class="n">heroes</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-65-120"><a id="__codelineno-65-120" name="__codelineno-65-120" href="#__codelineno-65-120"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-121"><a id="__codelineno-65-121" name="__codelineno-65-121" href="#__codelineno-65-121"></a>
</span><span id="__span-65-122"><a id="__codelineno-65-122" name="__codelineno-65-122" href="#__codelineno-65-122"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-123"><a id="__codelineno-65-123" name="__codelineno-65-123" href="#__codelineno-65-123"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-65-124"><a id="__codelineno-65-124" name="__codelineno-65-124" href="#__codelineno-65-124"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldAddAnItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-125"><a id="__codelineno-65-125" name="__codelineno-65-125" href="#__codelineno-65-125"></a><span class="w">        </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hero</span><span class="p">();</span>
</span><span id="__span-65-126"><a id="__codelineno-65-126" name="__codelineno-65-126" href="#__codelineno-65-126"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_NAME</span><span class="p">;</span>
</span><span id="__span-65-127"><a id="__codelineno-65-127" name="__codelineno-65-127" href="#__codelineno-65-127"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_OTHER_NAME</span><span class="p">;</span>
</span><span id="__span-65-128"><a id="__codelineno-65-128" name="__codelineno-65-128" href="#__codelineno-65-128"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_PICTURE</span><span class="p">;</span>
</span><span id="__span-65-129"><a id="__codelineno-65-129" name="__codelineno-65-129" href="#__codelineno-65-129"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_POWERS</span><span class="p">;</span>
</span><span id="__span-65-130"><a id="__codelineno-65-130" name="__codelineno-65-130" href="#__codelineno-65-130"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LEVEL</span><span class="p">;</span>
</span><span id="__span-65-131"><a id="__codelineno-65-131" name="__codelineno-65-131" href="#__codelineno-65-131"></a>
</span><span id="__span-65-132"><a id="__codelineno-65-132" name="__codelineno-65-132" href="#__codelineno-65-132"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-133"><a id="__codelineno-65-133" name="__codelineno-65-133" href="#__codelineno-65-133"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">hero</span><span class="p">)</span>
</span><span id="__span-65-134"><a id="__codelineno-65-134" name="__codelineno-65-134" href="#__codelineno-65-134"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-135"><a id="__codelineno-65-135" name="__codelineno-65-135" href="#__codelineno-65-135"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-136"><a id="__codelineno-65-136" name="__codelineno-65-136" href="#__codelineno-65-136"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-137"><a id="__codelineno-65-137" name="__codelineno-65-137" href="#__codelineno-65-137"></a><span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">)</span>
</span><span id="__span-65-138"><a id="__codelineno-65-138" name="__codelineno-65-138" href="#__codelineno-65-138"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-139"><a id="__codelineno-65-139" name="__codelineno-65-139" href="#__codelineno-65-139"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">CREATED</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-140"><a id="__codelineno-65-140" name="__codelineno-65-140" href="#__codelineno-65-140"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-65-141"><a id="__codelineno-65-141" name="__codelineno-65-141" href="#__codelineno-65-141"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">&quot;Location&quot;</span><span class="p">);</span>
</span><span id="__span-65-142"><a id="__codelineno-65-142" name="__codelineno-65-142" href="#__codelineno-65-142"></a><span class="w">        </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">location</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">));</span>
</span><span id="__span-65-143"><a id="__codelineno-65-143" name="__codelineno-65-143" href="#__codelineno-65-143"></a>
</span><span id="__span-65-144"><a id="__codelineno-65-144" name="__codelineno-65-144" href="#__codelineno-65-144"></a><span class="w">        </span><span class="c1">// Stores the id</span>
</span><span id="__span-65-145"><a id="__codelineno-65-145" name="__codelineno-65-145" href="#__codelineno-65-145"></a><span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">location</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
</span><span id="__span-65-146"><a id="__codelineno-65-146" name="__codelineno-65-146" href="#__codelineno-65-146"></a><span class="w">        </span><span class="n">heroId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="n">segments</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-65-147"><a id="__codelineno-65-147" name="__codelineno-65-147" href="#__codelineno-65-147"></a><span class="w">        </span><span class="n">assertNotNull</span><span class="p">(</span><span class="n">heroId</span><span class="p">);</span>
</span><span id="__span-65-148"><a id="__codelineno-65-148" name="__codelineno-65-148" href="#__codelineno-65-148"></a>
</span><span id="__span-65-149"><a id="__codelineno-65-149" name="__codelineno-65-149" href="#__codelineno-65-149"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-150"><a id="__codelineno-65-150" name="__codelineno-65-150" href="#__codelineno-65-150"></a><span class="w">            </span><span class="p">.</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">heroId</span><span class="p">)</span>
</span><span id="__span-65-151"><a id="__codelineno-65-151" name="__codelineno-65-151" href="#__codelineno-65-151"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-152"><a id="__codelineno-65-152" name="__codelineno-65-152" href="#__codelineno-65-152"></a><span class="w">            </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/heroes/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-65-153"><a id="__codelineno-65-153" name="__codelineno-65-153" href="#__codelineno-65-153"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-154"><a id="__codelineno-65-154" name="__codelineno-65-154" href="#__codelineno-65-154"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-155"><a id="__codelineno-65-155" name="__codelineno-65-155" href="#__codelineno-65-155"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_NAME</span><span class="p">))</span>
</span><span id="__span-65-156"><a id="__codelineno-65-156" name="__codelineno-65-156" href="#__codelineno-65-156"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;otherName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_OTHER_NAME</span><span class="p">))</span>
</span><span id="__span-65-157"><a id="__codelineno-65-157" name="__codelineno-65-157" href="#__codelineno-65-157"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_LEVEL</span><span class="p">))</span>
</span><span id="__span-65-158"><a id="__codelineno-65-158" name="__codelineno-65-158" href="#__codelineno-65-158"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;picture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_PICTURE</span><span class="p">))</span>
</span><span id="__span-65-159"><a id="__codelineno-65-159" name="__codelineno-65-159" href="#__codelineno-65-159"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;powers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_POWERS</span><span class="p">));</span>
</span><span id="__span-65-160"><a id="__codelineno-65-160" name="__codelineno-65-160" href="#__codelineno-65-160"></a>
</span><span id="__span-65-161"><a id="__codelineno-65-161" name="__codelineno-65-161" href="#__codelineno-65-161"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="w"> </span><span class="n">heroes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-162"><a id="__codelineno-65-162" name="__codelineno-65-162" href="#__codelineno-65-162"></a><span class="w">                                              </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-163"><a id="__codelineno-65-163" name="__codelineno-65-163" href="#__codelineno-65-163"></a><span class="w">                                              </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-65-164"><a id="__codelineno-65-164" name="__codelineno-65-164" href="#__codelineno-65-164"></a><span class="w">                                              </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-65-165"><a id="__codelineno-65-165" name="__codelineno-65-165" href="#__codelineno-65-165"></a><span class="w">                                              </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getHeroTypeRef</span><span class="p">());</span>
</span><span id="__span-65-166"><a id="__codelineno-65-166" name="__codelineno-65-166" href="#__codelineno-65-166"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_HEROES</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">heroes</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-65-167"><a id="__codelineno-65-167" name="__codelineno-65-167" href="#__codelineno-65-167"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-168"><a id="__codelineno-65-168" name="__codelineno-65-168" href="#__codelineno-65-168"></a>
</span><span id="__span-65-169"><a id="__codelineno-65-169" name="__codelineno-65-169" href="#__codelineno-65-169"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-170"><a id="__codelineno-65-170" name="__codelineno-65-170" href="#__codelineno-65-170"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-65-171"><a id="__codelineno-65-171" name="__codelineno-65-171" href="#__codelineno-65-171"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldUpdateAnItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-172"><a id="__codelineno-65-172" name="__codelineno-65-172" href="#__codelineno-65-172"></a><span class="w">        </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hero</span><span class="p">();</span>
</span><span id="__span-65-173"><a id="__codelineno-65-173" name="__codelineno-65-173" href="#__codelineno-65-173"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Long</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">heroId</span><span class="p">);</span>
</span><span id="__span-65-174"><a id="__codelineno-65-174" name="__codelineno-65-174" href="#__codelineno-65-174"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_NAME</span><span class="p">;</span>
</span><span id="__span-65-175"><a id="__codelineno-65-175" name="__codelineno-65-175" href="#__codelineno-65-175"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">otherName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_OTHER_NAME</span><span class="p">;</span>
</span><span id="__span-65-176"><a id="__codelineno-65-176" name="__codelineno-65-176" href="#__codelineno-65-176"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_PICTURE</span><span class="p">;</span>
</span><span id="__span-65-177"><a id="__codelineno-65-177" name="__codelineno-65-177" href="#__codelineno-65-177"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_POWERS</span><span class="p">;</span>
</span><span id="__span-65-178"><a id="__codelineno-65-178" name="__codelineno-65-178" href="#__codelineno-65-178"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UPDATED_LEVEL</span><span class="p">;</span>
</span><span id="__span-65-179"><a id="__codelineno-65-179" name="__codelineno-65-179" href="#__codelineno-65-179"></a>
</span><span id="__span-65-180"><a id="__codelineno-65-180" name="__codelineno-65-180" href="#__codelineno-65-180"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-181"><a id="__codelineno-65-181" name="__codelineno-65-181" href="#__codelineno-65-181"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">hero</span><span class="p">)</span>
</span><span id="__span-65-182"><a id="__codelineno-65-182" name="__codelineno-65-182" href="#__codelineno-65-182"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-183"><a id="__codelineno-65-183" name="__codelineno-65-183" href="#__codelineno-65-183"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-184"><a id="__codelineno-65-184" name="__codelineno-65-184" href="#__codelineno-65-184"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-185"><a id="__codelineno-65-185" name="__codelineno-65-185" href="#__codelineno-65-185"></a><span class="w">            </span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">)</span>
</span><span id="__span-65-186"><a id="__codelineno-65-186" name="__codelineno-65-186" href="#__codelineno-65-186"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-187"><a id="__codelineno-65-187" name="__codelineno-65-187" href="#__codelineno-65-187"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-188"><a id="__codelineno-65-188" name="__codelineno-65-188" href="#__codelineno-65-188"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-189"><a id="__codelineno-65-189" name="__codelineno-65-189" href="#__codelineno-65-189"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_NAME</span><span class="p">))</span>
</span><span id="__span-65-190"><a id="__codelineno-65-190" name="__codelineno-65-190" href="#__codelineno-65-190"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;otherName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_OTHER_NAME</span><span class="p">))</span>
</span><span id="__span-65-191"><a id="__codelineno-65-191" name="__codelineno-65-191" href="#__codelineno-65-191"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_LEVEL</span><span class="p">))</span>
</span><span id="__span-65-192"><a id="__codelineno-65-192" name="__codelineno-65-192" href="#__codelineno-65-192"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;picture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_PICTURE</span><span class="p">))</span>
</span><span id="__span-65-193"><a id="__codelineno-65-193" name="__codelineno-65-193" href="#__codelineno-65-193"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;powers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">UPDATED_POWERS</span><span class="p">));</span>
</span><span id="__span-65-194"><a id="__codelineno-65-194" name="__codelineno-65-194" href="#__codelineno-65-194"></a>
</span><span id="__span-65-195"><a id="__codelineno-65-195" name="__codelineno-65-195" href="#__codelineno-65-195"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="w"> </span><span class="n">heroes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-196"><a id="__codelineno-65-196" name="__codelineno-65-196" href="#__codelineno-65-196"></a><span class="w">                                              </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-197"><a id="__codelineno-65-197" name="__codelineno-65-197" href="#__codelineno-65-197"></a><span class="w">                                              </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-198"><a id="__codelineno-65-198" name="__codelineno-65-198" href="#__codelineno-65-198"></a><span class="w">                                              </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-65-199"><a id="__codelineno-65-199" name="__codelineno-65-199" href="#__codelineno-65-199"></a><span class="w">                                              </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-65-200"><a id="__codelineno-65-200" name="__codelineno-65-200" href="#__codelineno-65-200"></a><span class="w">                                              </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getHeroTypeRef</span><span class="p">());</span>
</span><span id="__span-65-201"><a id="__codelineno-65-201" name="__codelineno-65-201" href="#__codelineno-65-201"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_HEROES</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">heroes</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-65-202"><a id="__codelineno-65-202" name="__codelineno-65-202" href="#__codelineno-65-202"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-203"><a id="__codelineno-65-203" name="__codelineno-65-203" href="#__codelineno-65-203"></a>
</span><span id="__span-65-204"><a id="__codelineno-65-204" name="__codelineno-65-204" href="#__codelineno-65-204"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-65-205"><a id="__codelineno-65-205" name="__codelineno-65-205" href="#__codelineno-65-205"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-65-206"><a id="__codelineno-65-206" name="__codelineno-65-206" href="#__codelineno-65-206"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldRemoveAnItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-207"><a id="__codelineno-65-207" name="__codelineno-65-207" href="#__codelineno-65-207"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-65-208"><a id="__codelineno-65-208" name="__codelineno-65-208" href="#__codelineno-65-208"></a><span class="w">            </span><span class="p">.</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">heroId</span><span class="p">)</span>
</span><span id="__span-65-209"><a id="__codelineno-65-209" name="__codelineno-65-209" href="#__codelineno-65-209"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-65-210"><a id="__codelineno-65-210" name="__codelineno-65-210" href="#__codelineno-65-210"></a><span class="w">            </span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="s">&quot;/api/heroes/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-65-211"><a id="__codelineno-65-211" name="__codelineno-65-211" href="#__codelineno-65-211"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-212"><a id="__codelineno-65-212" name="__codelineno-65-212" href="#__codelineno-65-212"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">NO_CONTENT</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-65-213"><a id="__codelineno-65-213" name="__codelineno-65-213" href="#__codelineno-65-213"></a>
</span><span id="__span-65-214"><a id="__codelineno-65-214" name="__codelineno-65-214" href="#__codelineno-65-214"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;</span><span class="w"> </span><span class="n">heroes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-65-215"><a id="__codelineno-65-215" name="__codelineno-65-215" href="#__codelineno-65-215"></a><span class="w">                                              </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-65-216"><a id="__codelineno-65-216" name="__codelineno-65-216" href="#__codelineno-65-216"></a><span class="w">                                              </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-65-217"><a id="__codelineno-65-217" name="__codelineno-65-217" href="#__codelineno-65-217"></a><span class="w">                                              </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-65-218"><a id="__codelineno-65-218" name="__codelineno-65-218" href="#__codelineno-65-218"></a><span class="w">                                              </span><span class="p">.</span><span class="na">body</span><span class="p">()</span>
</span><span id="__span-65-219"><a id="__codelineno-65-219" name="__codelineno-65-219" href="#__codelineno-65-219"></a><span class="w">                                              </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">getHeroTypeRef</span><span class="p">());</span>
</span><span id="__span-65-220"><a id="__codelineno-65-220" name="__codelineno-65-220" href="#__codelineno-65-220"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_HEROES</span><span class="p">,</span><span class="w"> </span><span class="n">heroes</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-65-221"><a id="__codelineno-65-221" name="__codelineno-65-221" href="#__codelineno-65-221"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-222"><a id="__codelineno-65-222" name="__codelineno-65-222" href="#__codelineno-65-222"></a>
</span><span id="__span-65-223"><a id="__codelineno-65-223" name="__codelineno-65-223" href="#__codelineno-65-223"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TypeRef</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getHeroTypeRef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-224"><a id="__codelineno-65-224" name="__codelineno-65-224" href="#__codelineno-65-224"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TypeRef</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-225"><a id="__codelineno-65-225" name="__codelineno-65-225" href="#__codelineno-65-225"></a><span class="w">            </span><span class="c1">// Kept empty on purpose</span>
</span><span id="__span-65-226"><a id="__codelineno-65-226" name="__codelineno-65-226" href="#__codelineno-65-226"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-65-227"><a id="__codelineno-65-227" name="__codelineno-65-227" href="#__codelineno-65-227"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-65-228"><a id="__codelineno-65-228" name="__codelineno-65-228" href="#__codelineno-65-228"></a><span class="p">}</span>
</span></code></pre></div>
<p>The tests are very similar to the ones from the villain service.</p>
<h3 id="running-testing-and-packaging-the-application">Running, Testing and Packaging the Application</h3>
<p>First, make sure the tests pass by executing the command <code>./mvnw test</code> (or from your IDE).</p>
<p>Now that the tests are green, we are ready to run our application.</p>
<p>Use <code>./mvnw quarkus:dev</code> to start it. Once the application is started, create a new hero with the following cUrl command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w">  </span><span class="s1">&#39;{&quot;level&quot;:2, &quot;name&quot;:&quot;Super level&quot;, &quot;powers&quot;:&quot;leaping&quot;}&#39;</span><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>http://localhost:8083/api/heroes<span class="w"> </span>-v
</span></code></pre></div>
<p>Thanks to the verbose mode (<code>-v</code>) you should see a similar output:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>&lt; HTTP/1.1 201 Created
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>&lt; Location: http://localhost:8083/api/heroes/952
</span></code></pre></div>
<p>The cUrl command returns the location of the newly created hero. Take this URL and do an HTTP GET on it.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>The example shows a newly created Hero with id <code>952</code>. But this id could be different on your machine. Just make sure to use the correct id in the next command.</p></td></tr></tbody></table>

<div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>curl<span class="w"> </span>http://localhost:8083/api/heroes/952<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span></code></pre></div>
<div class="language-json highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="p">{</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">952</span><span class="p">,</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Super level&quot;</span><span class="p">,</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">  </span><span class="nt">&quot;otherName&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">  </span><span class="nt">&quot;picture&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">  </span><span class="nt">&quot;powers&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;leaping&quot;</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, build the application using: <code>./mvnw package</code>, and run the application using <code>java -jar target/quarkus-app/quarkus-run.jar</code>. Open your browser and go to <a href="http://localhost:8083/api/heroes">http://localhost:8083/api/heroes</a>.</p>
<h2 id="from-microservice-to-microservices">From Microservice to Microservices</h2>
<hr />
<p>So far we’ve built two microservices: the villains and heroes microservices. In the following sections you will develop an extra microservice: a <em>fight</em> microservice where heroes and villains fight. We will also add a React front-end, so we can fight graphically. But as you can notice in the diagram below, these microservices still not communicate with each other. You will have to wait the next chapter for that ;o)</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-ba4cce28188efc82438e95c34a129907.png" /></p>
<p>Each microservice is developed in its own directory.</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-a4d8621e9b70a4542b084242842a5e14.png" /></p>
<p>In the following sections, you will:</p>
<ul>
<li>
<p>Create a new Quarkus application</p>
</li>
<li>
<p>Implement REST API using JAX-RS</p>
</li>
<li>
<p>Access your database using Hibernate ORM with Panache</p>
</li>
<li>
<p>Use transactions</p>
</li>
</ul>
<table><tbody><tr><td><i title="Important"></i></td><td>This service is exposed on the port 8082.</td></tr></tbody></table>

<h3 id="fight-microservice">Fight Microservice</h3>
<p>Ok, let’s develop another microservice. We have a REST API that returns a random Hero. Another REST API that returns a random Villain… we need a new REST API that invokes those two, gets one random hero and one random villain and makes them fight. Let’s call it the Fight API.</p>
<table><tbody><tr><td><i title="Important"></i></td><td>This microservice uses the imperative development model but use reactive extensions.</td></tr></tbody></table>

<h4 id="bootstrapping-the-fight-rest-endpoint">Bootstrapping the Fight REST Endpoint</h4>
<p>Like for the Hero and Villain API, the easiest way to create this new Quarkus project is to use a Maven archetype. Under the <code>quarkus-workshop-super-heroes/super-heroes</code> root directory where you have all your code.</p>
<p>Open a terminal and run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>./mvnw<span class="w"> </span>io.quarkus:quarkus-maven-plugin:3.9.1:create<span class="w"> </span>-<span class="s2">&quot;DplatformVersion=3.9.1&quot;</span><span class="w"> </span>-<span class="s2">&quot;DprojectGroupId=io.quarkus.workshop.super-heroes&quot;</span><span class="w"> </span>-<span class="s2">&quot;DprojectArtifactId=rest-fights&quot;</span><span class="w"> </span>-DclassName<span class="o">=</span><span class="s2">&quot;io.quarkus.workshop.superheroes.fight.FightResource&quot;</span><span class="w"> </span>-Dpath<span class="o">=</span><span class="s2">&quot;api/fights&quot;</span><span class="w">  </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jdbc-postgresql,hibernate-orm-panache,hibernate-validator,quarkus-rest-jackson,smallrye-openapi,kafka&quot;</span>
</span></code></pre></div>
<p>If you open the <code>pom.xml</code> file, you will see that the following extensions have been imported:</p>
<ul>
<li>
<p><code>io.quarkus:quarkus-hibernate-orm-panache</code></p>
</li>
<li>
<p><code>io.quarkus:quarkus-hibernate-validator</code></p>
</li>
<li>
<p><code>io.quarkus:quarkus-smallrye-openapi</code></p>
</li>
<li>
<p><code>io.quarkus:quarkus-messaging-kafka</code></p>
</li>
<li>
<p><code>io.quarkus:quarkus-rest-jackson</code></p>
</li>
<li>
<p><code>io.quarkus:quarkus-jdbc-postgresql</code></p>
</li>
</ul>
<p>You can see that beyond the extensions we have used so far, we added the Kafka support which uses Eclipse MicroProfile Reactive Messaging. Stay tuned.</p>
<p>The Quarkus Maven plugin has generated some code that we won’t be using. You can delete the Java classes <code>MyReactiveMessagingApplication</code> and <code>MyReactiveMessagingApplicationTest</code>.</p>
<p>If you want your IDE to manage this new Maven project, you can declare it in the parent POM by adding this new module in the <code>&lt;modules&gt;</code> section:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="nt">&lt;module&gt;</span>super-heroes/rest-fights<span class="nt">&lt;/module&gt;</span>
</span></code></pre></div>
<h4 id="directory-structure_5">Directory Structure</h4>
<p>At the end you should have the following directory structure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-d24aa1313b8c9a01356a21fa17a4a21c.png" /></p>
<h4 id="fight-entity">Fight Entity</h4>
<p>A fight is between a hero and a villain. Each time there is a fight, there is a winner and a loser. So the <code>Fight</code> entity is there to store all these fights.</p>
<p>Create the <code>io.quarkus.workshop.superheroes.fight.Fight</code> class with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight</span><span class="p">;</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.hibernate.orm.panache.PanacheEntity</span><span class="p">;</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</span><span class="p">;</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Column</span><span class="p">;</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.persistence.Entity</span><span class="p">;</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Instant</span><span class="p">;</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="nd">@Entity</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Each fight has a winner and a loser&quot;</span><span class="p">)</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Fight</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">PanacheEntity</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">fightDate</span><span class="p">;</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerName</span><span class="p">;</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">winnerLevel</span><span class="p">;</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">columnDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TEXT&quot;</span><span class="p">)</span>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerPowers</span><span class="p">;</span>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerPicture</span><span class="p">;</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserName</span><span class="p">;</span>
</span><span id="__span-72-29"><a id="__codelineno-72-29" name="__codelineno-72-29" href="#__codelineno-72-29"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-30"><a id="__codelineno-72-30" name="__codelineno-72-30" href="#__codelineno-72-30"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">loserLevel</span><span class="p">;</span>
</span><span id="__span-72-31"><a id="__codelineno-72-31" name="__codelineno-72-31" href="#__codelineno-72-31"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-32"><a id="__codelineno-72-32" name="__codelineno-72-32" href="#__codelineno-72-32"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">columnDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TEXT&quot;</span><span class="p">)</span>
</span><span id="__span-72-33"><a id="__codelineno-72-33" name="__codelineno-72-33" href="#__codelineno-72-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserPowers</span><span class="p">;</span>
</span><span id="__span-72-34"><a id="__codelineno-72-34" name="__codelineno-72-34" href="#__codelineno-72-34"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-35"><a id="__codelineno-72-35" name="__codelineno-72-35" href="#__codelineno-72-35"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserPicture</span><span class="p">;</span>
</span><span id="__span-72-36"><a id="__codelineno-72-36" name="__codelineno-72-36" href="#__codelineno-72-36"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-37"><a id="__codelineno-72-37" name="__codelineno-72-37" href="#__codelineno-72-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerTeam</span><span class="p">;</span>
</span><span id="__span-72-38"><a id="__codelineno-72-38" name="__codelineno-72-38" href="#__codelineno-72-38"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-72-39"><a id="__codelineno-72-39" name="__codelineno-72-39" href="#__codelineno-72-39"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserTeam</span><span class="p">;</span>
</span><span id="__span-72-40"><a id="__codelineno-72-40" name="__codelineno-72-40" href="#__codelineno-72-40"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="fighters-bean">Fighters Bean</h4>
<p>Now comes a trick. The Fight REST API will ultimately invoke the Hero and Villain APIs (next sections) to get two random fighters. The <code>Fighters</code> class has one <code>Hero</code> and one <code>Villain</code>. Notice that <code>Fighters</code> is not an entity, it is not persisted in the database, just marshalled and unmarshalled to JSon.</p>
<p>Create the <code>io.quarkus.workshop.superheroes.fight.Fighters</code> class, with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight</span><span class="p">;</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.Hero</span><span class="p">;</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.Villain</span><span class="p">;</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</span><span class="p">;</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;A fight between one hero and one villain&quot;</span><span class="p">)</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Fighters</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="p">;</span>
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="p">;</span>
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a>
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>It does not compile because it needs a <code>Hero</code> class and a <code>Villain</code> class. The Fight REST API is just interested in the hero’s name, level, picture and powers (not the other name as described in the Hero API).</p>
<p>So create the <code>Hero</code> bean looks like this (notice the <code>client</code> subpackage):</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</span><span class="p">;</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The hero fighting against the villain&quot;</span><span class="p">)</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Hero</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p">;</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">picture</span><span class="p">;</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">powers</span><span class="p">;</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>Also create the <code>Villain</code> counterpart (also in the <code>client</code> subpackage):</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</span><span class="p">;</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.constraints.NotNull</span><span class="p">;</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The villain fighting against the hero&quot;</span><span class="p">)</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Villain</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">level</span><span class="p">;</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="w">    </span><span class="nd">@NotNull</span>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">picture</span><span class="p">;</span>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">powers</span><span class="p">;</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a>
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>So, these classes are just used to map the results from the <code>Hero</code> and <code>Villain</code> microservices.</p>
<h4 id="fightservice-transactional-service">FightService Transactional Service</h4>
<p>Now, let’s create a <code>FightService</code> class that orchestrate the fights.</p>
<p>Create the <code>io.quarkus.workshop.superheroes.fight.FightService</code> class with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight</span><span class="p">;</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional</span><span class="p">;</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Instant</span><span class="p">;</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span>
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional.TxType.REQUIRED</span><span class="p">;</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.transaction.Transactional.TxType.SUPPORTS</span><span class="p">;</span>
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a><span class="nd">@Transactional</span><span class="p">(</span><span class="n">SUPPORTS</span><span class="p">)</span>
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FightService</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-19"><a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a>
</span><span id="__span-76-20"><a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a><span class="w">    </span><span class="nd">@Inject</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-76-21"><a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a>
</span><span id="__span-76-22"><a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Random</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">();</span>
</span><span id="__span-76-23"><a id="__codelineno-76-23" name="__codelineno-76-23" href="#__codelineno-76-23"></a>
</span><span id="__span-76-24"><a id="__codelineno-76-24" name="__codelineno-76-24" href="#__codelineno-76-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAllFights</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-25"><a id="__codelineno-76-25" name="__codelineno-76-25" href="#__codelineno-76-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Fight</span><span class="p">.</span><span class="na">listAll</span><span class="p">();</span>
</span><span id="__span-76-26"><a id="__codelineno-76-26" name="__codelineno-76-26" href="#__codelineno-76-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-76-27"><a id="__codelineno-76-27" name="__codelineno-76-27" href="#__codelineno-76-27"></a>
</span><span id="__span-76-28"><a id="__codelineno-76-28" name="__codelineno-76-28" href="#__codelineno-76-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="nf">findFightById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-29"><a id="__codelineno-76-29" name="__codelineno-76-29" href="#__codelineno-76-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Fight</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-76-30"><a id="__codelineno-76-30" name="__codelineno-76-30" href="#__codelineno-76-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-76-31"><a id="__codelineno-76-31" name="__codelineno-76-31" href="#__codelineno-76-31"></a>
</span><span id="__span-76-32"><a id="__codelineno-76-32" name="__codelineno-76-32" href="#__codelineno-76-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Fighters</span><span class="w"> </span><span class="nf">findRandomFighters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-33"><a id="__codelineno-76-33" name="__codelineno-76-33" href="#__codelineno-76-33"></a><span class="w">        </span><span class="c1">// Will be implemented later</span>
</span><span id="__span-76-34"><a id="__codelineno-76-34" name="__codelineno-76-34" href="#__codelineno-76-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-76-35"><a id="__codelineno-76-35" name="__codelineno-76-35" href="#__codelineno-76-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-76-36"><a id="__codelineno-76-36" name="__codelineno-76-36" href="#__codelineno-76-36"></a>
</span><span id="__span-76-37"><a id="__codelineno-76-37" name="__codelineno-76-37" href="#__codelineno-76-37"></a><span class="w">    </span><span class="nd">@Transactional</span><span class="p">(</span><span class="n">REQUIRED</span><span class="p">)</span>
</span><span id="__span-76-38"><a id="__codelineno-76-38" name="__codelineno-76-38" href="#__codelineno-76-38"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="nf">persistFight</span><span class="p">(</span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-39"><a id="__codelineno-76-39" name="__codelineno-76-39" href="#__codelineno-76-39"></a><span class="w">        </span><span class="c1">// Amazingly fancy logic to determine the winner...</span>
</span><span id="__span-76-40"><a id="__codelineno-76-40" name="__codelineno-76-40" href="#__codelineno-76-40"></a><span class="w">        </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">;</span>
</span><span id="__span-76-41"><a id="__codelineno-76-41" name="__codelineno-76-41" href="#__codelineno-76-41"></a>
</span><span id="__span-76-42"><a id="__codelineno-76-42" name="__codelineno-76-42" href="#__codelineno-76-42"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">heroAdjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span id="__span-76-43"><a id="__codelineno-76-43" name="__codelineno-76-43" href="#__codelineno-76-43"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">villainAdjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span id="__span-76-44"><a id="__codelineno-76-44" name="__codelineno-76-44" href="#__codelineno-76-44"></a>
</span><span id="__span-76-45"><a id="__codelineno-76-45" name="__codelineno-76-45" href="#__codelineno-76-45"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">heroAdjust</span><span class="p">)</span>
</span><span id="__span-76-46"><a id="__codelineno-76-46" name="__codelineno-76-46" href="#__codelineno-76-46"></a><span class="w">            </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villainAdjust</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-47"><a id="__codelineno-76-47" name="__codelineno-76-47" href="#__codelineno-76-47"></a><span class="w">            </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heroWon</span><span class="p">(</span><span class="n">fighters</span><span class="p">);</span>
</span><span id="__span-76-48"><a id="__codelineno-76-48" name="__codelineno-76-48" href="#__codelineno-76-48"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">level</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-49"><a id="__codelineno-76-49" name="__codelineno-76-49" href="#__codelineno-76-49"></a><span class="w">            </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villainWon</span><span class="p">(</span><span class="n">fighters</span><span class="p">);</span>
</span><span id="__span-76-50"><a id="__codelineno-76-50" name="__codelineno-76-50" href="#__codelineno-76-50"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-51"><a id="__codelineno-76-51" name="__codelineno-76-51" href="#__codelineno-76-51"></a><span class="w">            </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="na">nextBoolean</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">heroWon</span><span class="p">(</span><span class="n">fighters</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">villainWon</span><span class="p">(</span><span class="n">fighters</span><span class="p">);</span>
</span><span id="__span-76-52"><a id="__codelineno-76-52" name="__codelineno-76-52" href="#__codelineno-76-52"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-76-53"><a id="__codelineno-76-53" name="__codelineno-76-53" href="#__codelineno-76-53"></a>
</span><span id="__span-76-54"><a id="__codelineno-76-54" name="__codelineno-76-54" href="#__codelineno-76-54"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">fightDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
</span><span id="__span-76-55"><a id="__codelineno-76-55" name="__codelineno-76-55" href="#__codelineno-76-55"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">persist</span><span class="p">();</span>
</span><span id="__span-76-56"><a id="__codelineno-76-56" name="__codelineno-76-56" href="#__codelineno-76-56"></a>
</span><span id="__span-76-57"><a id="__codelineno-76-57" name="__codelineno-76-57" href="#__codelineno-76-57"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fight</span><span class="p">;</span>
</span><span id="__span-76-58"><a id="__codelineno-76-58" name="__codelineno-76-58" href="#__codelineno-76-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-76-59"><a id="__codelineno-76-59" name="__codelineno-76-59" href="#__codelineno-76-59"></a>
</span><span id="__span-76-60"><a id="__codelineno-76-60" name="__codelineno-76-60" href="#__codelineno-76-60"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="nf">heroWon</span><span class="p">(</span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-61"><a id="__codelineno-76-61" name="__codelineno-76-61" href="#__codelineno-76-61"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Yes, Hero won :o)&quot;</span><span class="p">);</span>
</span><span id="__span-76-62"><a id="__codelineno-76-62" name="__codelineno-76-62" href="#__codelineno-76-62"></a><span class="w">        </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Fight</span><span class="p">();</span>
</span><span id="__span-76-63"><a id="__codelineno-76-63" name="__codelineno-76-63" href="#__codelineno-76-63"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">name</span><span class="p">;</span>
</span><span id="__span-76-64"><a id="__codelineno-76-64" name="__codelineno-76-64" href="#__codelineno-76-64"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPicture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">picture</span><span class="p">;</span>
</span><span id="__span-76-65"><a id="__codelineno-76-65" name="__codelineno-76-65" href="#__codelineno-76-65"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">level</span><span class="p">;</span>
</span><span id="__span-76-66"><a id="__codelineno-76-66" name="__codelineno-76-66" href="#__codelineno-76-66"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">powers</span><span class="p">;</span>
</span><span id="__span-76-67"><a id="__codelineno-76-67" name="__codelineno-76-67" href="#__codelineno-76-67"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">name</span><span class="p">;</span>
</span><span id="__span-76-68"><a id="__codelineno-76-68" name="__codelineno-76-68" href="#__codelineno-76-68"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPicture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">picture</span><span class="p">;</span>
</span><span id="__span-76-69"><a id="__codelineno-76-69" name="__codelineno-76-69" href="#__codelineno-76-69"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">level</span><span class="p">;</span>
</span><span id="__span-76-70"><a id="__codelineno-76-70" name="__codelineno-76-70" href="#__codelineno-76-70"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">powers</span><span class="p">;</span>
</span><span id="__span-76-71"><a id="__codelineno-76-71" name="__codelineno-76-71" href="#__codelineno-76-71"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;heroes&quot;</span><span class="p">;</span>
</span><span id="__span-76-72"><a id="__codelineno-76-72" name="__codelineno-76-72" href="#__codelineno-76-72"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;villains&quot;</span><span class="p">;</span>
</span><span id="__span-76-73"><a id="__codelineno-76-73" name="__codelineno-76-73" href="#__codelineno-76-73"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fight</span><span class="p">;</span>
</span><span id="__span-76-74"><a id="__codelineno-76-74" name="__codelineno-76-74" href="#__codelineno-76-74"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-76-75"><a id="__codelineno-76-75" name="__codelineno-76-75" href="#__codelineno-76-75"></a>
</span><span id="__span-76-76"><a id="__codelineno-76-76" name="__codelineno-76-76" href="#__codelineno-76-76"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="nf">villainWon</span><span class="p">(</span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-77"><a id="__codelineno-76-77" name="__codelineno-76-77" href="#__codelineno-76-77"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Gee, Villain won :o(&quot;</span><span class="p">);</span>
</span><span id="__span-76-78"><a id="__codelineno-76-78" name="__codelineno-76-78" href="#__codelineno-76-78"></a><span class="w">        </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Fight</span><span class="p">();</span>
</span><span id="__span-76-79"><a id="__codelineno-76-79" name="__codelineno-76-79" href="#__codelineno-76-79"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">name</span><span class="p">;</span>
</span><span id="__span-76-80"><a id="__codelineno-76-80" name="__codelineno-76-80" href="#__codelineno-76-80"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPicture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">picture</span><span class="p">;</span>
</span><span id="__span-76-81"><a id="__codelineno-76-81" name="__codelineno-76-81" href="#__codelineno-76-81"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">level</span><span class="p">;</span>
</span><span id="__span-76-82"><a id="__codelineno-76-82" name="__codelineno-76-82" href="#__codelineno-76-82"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">.</span><span class="na">powers</span><span class="p">;</span>
</span><span id="__span-76-83"><a id="__codelineno-76-83" name="__codelineno-76-83" href="#__codelineno-76-83"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">name</span><span class="p">;</span>
</span><span id="__span-76-84"><a id="__codelineno-76-84" name="__codelineno-76-84" href="#__codelineno-76-84"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPicture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">picture</span><span class="p">;</span>
</span><span id="__span-76-85"><a id="__codelineno-76-85" name="__codelineno-76-85" href="#__codelineno-76-85"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">level</span><span class="p">;</span>
</span><span id="__span-76-86"><a id="__codelineno-76-86" name="__codelineno-76-86" href="#__codelineno-76-86"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">.</span><span class="na">powers</span><span class="p">;</span>
</span><span id="__span-76-87"><a id="__codelineno-76-87" name="__codelineno-76-87" href="#__codelineno-76-87"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;villains&quot;</span><span class="p">;</span>
</span><span id="__span-76-88"><a id="__codelineno-76-88" name="__codelineno-76-88" href="#__codelineno-76-88"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;heroes&quot;</span><span class="p">;</span>
</span><span id="__span-76-89"><a id="__codelineno-76-89" name="__codelineno-76-89" href="#__codelineno-76-89"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fight</span><span class="p">;</span>
</span><span id="__span-76-90"><a id="__codelineno-76-90" name="__codelineno-76-90" href="#__codelineno-76-90"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-76-91"><a id="__codelineno-76-91" name="__codelineno-76-91" href="#__codelineno-76-91"></a>
</span><span id="__span-76-92"><a id="__codelineno-76-92" name="__codelineno-76-92" href="#__codelineno-76-92"></a><span class="p">}</span>
</span></code></pre></div>
<p>Notice the <code>persistFight</code> method. This method is the one creating a fight between a hero and a villain. As you can see the algorithm to determine the winner is a bit random (even though it uses the levels). If you are not happy about the way the fight operates, choose your own winning algorithm ;o)</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>For now, the <code>Fighters findRandomFighters()</code> method returns null. Later, this method will invoke the Hello and Villain API to get a random Hero and random Villain.</p></td></tr></tbody></table>

<h4 id="fightresource-endpoint">FightResource Endpoint</h4>
<p>To expose a REST API we also need a <code>FightResource</code> (with OpenAPI annotations of course).</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight</span><span class="p">;</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.*</span><span class="p">;</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.config.inject.ConfigProperty</span><span class="p">;</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.validation.Valid</span><span class="p">;</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response</span><span class="p">;</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.UriInfo</span><span class="p">;</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.TEXT_PLAIN</span><span class="p">;</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/fights&quot;</span><span class="p">)</span>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a><span class="nd">@Produces</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FightResource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-23"><a id="__codelineno-77-23" name="__codelineno-77-23" href="#__codelineno-77-23"></a>
</span><span id="__span-77-24"><a id="__codelineno-77-24" name="__codelineno-77-24" href="#__codelineno-77-24"></a><span class="w">    </span><span class="nd">@Inject</span>
</span><span id="__span-77-25"><a id="__codelineno-77-25" name="__codelineno-77-25" href="#__codelineno-77-25"></a><span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-77-26"><a id="__codelineno-77-26" name="__codelineno-77-26" href="#__codelineno-77-26"></a>
</span><span id="__span-77-27"><a id="__codelineno-77-27" name="__codelineno-77-27" href="#__codelineno-77-27"></a><span class="w">    </span><span class="nd">@Inject</span>
</span><span id="__span-77-28"><a id="__codelineno-77-28" name="__codelineno-77-28" href="#__codelineno-77-28"></a><span class="w">    </span><span class="n">FightService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span><span id="__span-77-29"><a id="__codelineno-77-29" name="__codelineno-77-29" href="#__codelineno-77-29"></a>
</span><span id="__span-77-30"><a id="__codelineno-77-30" name="__codelineno-77-30" href="#__codelineno-77-30"></a>
</span><span id="__span-77-31"><a id="__codelineno-77-31" name="__codelineno-77-31" href="#__codelineno-77-31"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-77-32"><a id="__codelineno-77-32" name="__codelineno-77-32" href="#__codelineno-77-32"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/randomfighters&quot;</span><span class="p">)</span>
</span><span id="__span-77-33"><a id="__codelineno-77-33" name="__codelineno-77-33" href="#__codelineno-77-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nf">getRandomFighters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-34"><a id="__codelineno-77-34" name="__codelineno-77-34" href="#__codelineno-77-34"></a><span class="w">        </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findRandomFighters</span><span class="p">();</span>
</span><span id="__span-77-35"><a id="__codelineno-77-35" name="__codelineno-77-35" href="#__codelineno-77-35"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Get random fighters &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fighters</span><span class="p">);</span>
</span><span id="__span-77-36"><a id="__codelineno-77-36" name="__codelineno-77-36" href="#__codelineno-77-36"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">fighters</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-77-37"><a id="__codelineno-77-37" name="__codelineno-77-37" href="#__codelineno-77-37"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-77-38"><a id="__codelineno-77-38" name="__codelineno-77-38" href="#__codelineno-77-38"></a>
</span><span id="__span-77-39"><a id="__codelineno-77-39" name="__codelineno-77-39" href="#__codelineno-77-39"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-77-40"><a id="__codelineno-77-40" name="__codelineno-77-40" href="#__codelineno-77-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nf">getAllFights</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-41"><a id="__codelineno-77-41" name="__codelineno-77-41" href="#__codelineno-77-41"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findAllFights</span><span class="p">();</span>
</span><span id="__span-77-42"><a id="__codelineno-77-42" name="__codelineno-77-42" href="#__codelineno-77-42"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Total number of fights &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fights</span><span class="p">);</span>
</span><span id="__span-77-43"><a id="__codelineno-77-43" name="__codelineno-77-43" href="#__codelineno-77-43"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">fights</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-77-44"><a id="__codelineno-77-44" name="__codelineno-77-44" href="#__codelineno-77-44"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-77-45"><a id="__codelineno-77-45" name="__codelineno-77-45" href="#__codelineno-77-45"></a>
</span><span id="__span-77-46"><a id="__codelineno-77-46" name="__codelineno-77-46" href="#__codelineno-77-46"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-77-47"><a id="__codelineno-77-47" name="__codelineno-77-47" href="#__codelineno-77-47"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-77-48"><a id="__codelineno-77-48" name="__codelineno-77-48" href="#__codelineno-77-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nf">getFight</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-49"><a id="__codelineno-77-49" name="__codelineno-77-49" href="#__codelineno-77-49"></a><span class="w">        </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findFightById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-77-50"><a id="__codelineno-77-50" name="__codelineno-77-50" href="#__codelineno-77-50"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fight</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-51"><a id="__codelineno-77-51" name="__codelineno-77-51" href="#__codelineno-77-51"></a><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Found fight &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fight</span><span class="p">);</span>
</span><span id="__span-77-52"><a id="__codelineno-77-52" name="__codelineno-77-52" href="#__codelineno-77-52"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">fight</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-77-53"><a id="__codelineno-77-53" name="__codelineno-77-53" href="#__codelineno-77-53"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-54"><a id="__codelineno-77-54" name="__codelineno-77-54" href="#__codelineno-77-54"></a><span class="w">            </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;No fight found with id &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
</span><span id="__span-77-55"><a id="__codelineno-77-55" name="__codelineno-77-55" href="#__codelineno-77-55"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">noContent</span><span class="p">().</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-77-56"><a id="__codelineno-77-56" name="__codelineno-77-56" href="#__codelineno-77-56"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-77-57"><a id="__codelineno-77-57" name="__codelineno-77-57" href="#__codelineno-77-57"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-77-58"><a id="__codelineno-77-58" name="__codelineno-77-58" href="#__codelineno-77-58"></a>
</span><span id="__span-77-59"><a id="__codelineno-77-59" name="__codelineno-77-59" href="#__codelineno-77-59"></a><span class="w">    </span><span class="nd">@POST</span>
</span><span id="__span-77-60"><a id="__codelineno-77-60" name="__codelineno-77-60" href="#__codelineno-77-60"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="nf">fight</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="p">,</span><span class="w"> </span><span class="n">UriInfo</span><span class="w"> </span><span class="n">uriInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-61"><a id="__codelineno-77-61" name="__codelineno-77-61" href="#__codelineno-77-61"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">persistFight</span><span class="p">(</span><span class="n">fighters</span><span class="p">);</span>
</span><span id="__span-77-62"><a id="__codelineno-77-62" name="__codelineno-77-62" href="#__codelineno-77-62"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-77-63"><a id="__codelineno-77-63" name="__codelineno-77-63" href="#__codelineno-77-63"></a>
</span><span id="__span-77-64"><a id="__codelineno-77-64" name="__codelineno-77-64" href="#__codelineno-77-64"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-77-65"><a id="__codelineno-77-65" name="__codelineno-77-65" href="#__codelineno-77-65"></a><span class="w">    </span><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-77-66"><a id="__codelineno-77-66" name="__codelineno-77-66" href="#__codelineno-77-66"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
</span><span id="__span-77-67"><a id="__codelineno-77-67" name="__codelineno-77-67" href="#__codelineno-77-67"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-68"><a id="__codelineno-77-68" name="__codelineno-77-68" href="#__codelineno-77-68"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello Fight Resource&quot;</span><span class="p">;</span>
</span><span id="__span-77-69"><a id="__codelineno-77-69" name="__codelineno-77-69" href="#__codelineno-77-69"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-77-70"><a id="__codelineno-77-70" name="__codelineno-77-70" href="#__codelineno-77-70"></a>
</span><span id="__span-77-71"><a id="__codelineno-77-71" name="__codelineno-77-71" href="#__codelineno-77-71"></a><span class="p">}</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>The OpenAPI annotations have been omitted to keep the service focused on the task. Feel free to add them if you want complete OpenAPI descriptors.</p><p>Notice that most of the REST endpoints that you’ve seen so far produce or consume JSON. JSON being the default media type in Quarkus, we could have omitted the <code>@Produces</code> or <code>@Consume</code> annotation.</p></td></tr></tbody></table>

<h4 id="adding-data_1">Adding Data</h4>
<p>To load some SQL statements when Hibernate ORM starts, create the <code>src/main/resources/import.sql</code> file with the following content:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="k">ALTER</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">fight_seq</span><span class="w"> </span><span class="k">RESTART</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">fight</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">fightDate</span><span class="p">,</span><span class="w"> </span><span class="n">winnerName</span><span class="p">,</span><span class="w"> </span><span class="n">winnerLevel</span><span class="p">,</span><span class="w"> </span><span class="n">winnerPicture</span><span class="p">,</span><span class="w"> </span><span class="n">winnerPowers</span><span class="p">,</span><span class="w"> </span><span class="n">loserName</span><span class="p">,</span><span class="w"> </span><span class="n">loserLevel</span><span class="p">,</span><span class="w"> </span><span class="n">loserPicture</span><span class="p">,</span><span class="w"> </span><span class="n">loserPowers</span><span class="p">,</span><span class="w"> </span><span class="n">winnerTeam</span><span class="p">,</span><span class="w"> </span><span class="n">loserTeam</span><span class="p">)</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;fight_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="k">current_timestamp</span><span class="p">,</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">        </span><span class="s1">&#39;Chewbacca&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/10466.jpg&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Agility, Longevity, Marksmanship, Natural Weapons, Stealth, Super Strength, Weapons Master&#39;</span><span class="p">,</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">        </span><span class="s1">&#39;Buuccolo&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/15355.jpg&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Accelerated Healing, Adaptation, Agility, Flight, Immortality, Intelligence, Invulnerability, Reflexes, Self-Sustenance, Size Changing, Spatial Awareness, Stamina, Stealth, Super Breath, Super Speed, Super Strength, Teleportation&#39;</span><span class="p">,</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">        </span><span class="s1">&#39;heroes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;villains&#39;</span><span class="p">);</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">fight</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">fightDate</span><span class="p">,</span><span class="w"> </span><span class="n">winnerName</span><span class="p">,</span><span class="w"> </span><span class="n">winnerLevel</span><span class="p">,</span><span class="w"> </span><span class="n">winnerPicture</span><span class="p">,</span><span class="w"> </span><span class="n">winnerPowers</span><span class="p">,</span><span class="w"> </span><span class="n">loserName</span><span class="p">,</span><span class="w"> </span><span class="n">loserLevel</span><span class="p">,</span><span class="w"> </span><span class="n">loserPicture</span><span class="p">,</span><span class="w"> </span><span class="n">loserPowers</span><span class="p">,</span><span class="w"> </span><span class="n">winnerTeam</span><span class="p">,</span><span class="w"> </span><span class="n">loserTeam</span><span class="p">)</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;fight_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="k">current_timestamp</span><span class="p">,</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">        </span><span class="s1">&#39;Galadriel&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/11796.jpg&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Danger Sense, Immortality, Intelligence, Invisibility, Magic, Precognition, Telekinesis, Telepathy&#39;</span><span class="p">,</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">        </span><span class="s1">&#39;Darth Vader&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/10444.jpg&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Accelerated Healing, Agility, Astral Projection, Cloaking, Danger Sense, Durability, Electrokinesis, Energy Blasts, Enhanced Hearing, Enhanced Senses, Force Fields, Hypnokinesis, Illusions, Intelligence, Jump, Light Control, Marksmanship, Precognition, Psionic Powers, Reflexes, Stealth, Super Speed, Telekinesis, Telepathy, The Force, Weapons Master&#39;</span><span class="p">,</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w">        </span><span class="s1">&#39;heroes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;villains&#39;</span><span class="p">);</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">fight</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">fightDate</span><span class="p">,</span><span class="w"> </span><span class="n">winnerName</span><span class="p">,</span><span class="w"> </span><span class="n">winnerLevel</span><span class="p">,</span><span class="w"> </span><span class="n">winnerPicture</span><span class="p">,</span><span class="w"> </span><span class="n">winnerPowers</span><span class="p">,</span><span class="w"> </span><span class="n">loserName</span><span class="p">,</span><span class="w"> </span><span class="n">loserLevel</span><span class="p">,</span><span class="w"> </span><span class="n">loserPicture</span><span class="p">,</span><span class="w"> </span><span class="n">loserPowers</span><span class="p">,</span><span class="w"> </span><span class="n">winnerTeam</span><span class="p">,</span><span class="w"> </span><span class="n">loserTeam</span><span class="p">)</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;fight_seq&#39;</span><span class="p">),</span><span class="w"> </span><span class="k">current_timestamp</span><span class="p">,</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="w">        </span><span class="s1">&#39;Annihilus&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/1307.jpg&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Agility, Durability, Flight, Reflexes, Stamina, Super Speed, Super Strength&#39;</span><span class="p">,</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="w">        </span><span class="s1">&#39;Shikamaru&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;https://www.superherodb.com/pictures2/portraits/10/050/11742.jpg&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Adaptation, Agility, Element Control, Fire Control, Intelligence, Jump, Marksmanship, Possession, Reflexes, Shapeshifting, Stamina, Stealth, Telekinesis, Wallcrawling, Weapon-based Powers, Weapons Master&#39;</span><span class="p">,</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a><span class="w">        </span><span class="s1">&#39;villains&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;heroes&#39;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="configuration">Configuration</h4>
<p>As usual, we need to configure the application.</p>
<p>In the <code>application.properties</code> file add:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1">## HTTP configuration</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="na">quarkus.http.port</span><span class="o">=</span><span class="s">8082</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="c1">## Custom banner file path</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="na">quarkus.banner.path</span><span class="o">=</span><span class="s">banner.txt</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="c1">## drop and create the database at startup (use `update` to only update the schema)</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="na">quarkus.hibernate-orm.database.generation</span><span class="o">=</span><span class="s">drop-and-create</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="c1">## Logging configuration</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="na">quarkus.log.console.enable</span><span class="o">=</span><span class="s">true</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="na">quarkus.log.console.format</span><span class="o">=</span><span class="s">%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="na">quarkus.log.console.level</span><span class="o">=</span><span class="s">DEBUG</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="c1">## Production configuration</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="na">%prod.quarkus.datasource.jdbc.url</span><span class="o">=</span><span class="s">jdbc:postgresql://localhost:5432/fights_database</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="na">%prod.quarkus.datasource.db-kind</span><span class="o">=</span><span class="s">postgresql</span>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="na">%prod.quarkus.datasource.username</span><span class="o">=</span><span class="s">superfight</span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="na">%prod.quarkus.datasource.password</span><span class="o">=</span><span class="s">superfight</span>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="na">%prod.quarkus.hibernate-orm.sql-load-script</span><span class="o">=</span><span class="s">import.sql</span>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="na">%prod.quarkus.log.console.level</span><span class="o">=</span><span class="s">INFO</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a><span class="na">%prod.quarkus.hibernate-orm.database.generation</span><span class="o">=</span><span class="s">update</span>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a>
</span><span id="__span-79-26"><a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a><span class="c1">## Kafka configuration</span>
</span></code></pre></div>
<p>Note that the fight service uses the port <code>8082</code>.</p>
<h4 id="fightresourcetest-test-class">FightResourceTest Test Class</h4>
<p>We need to test our REST API.</p>
<p>For that, copy the following <code>FightResourceTest</code> class under the <code>src/test/java/io/quarkus/workshop/superheroes/fight</code> directory.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight</span><span class="p">;</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.junit.QuarkusTest</span><span class="p">;</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.Hero</span><span class="p">;</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.Villain</span><span class="p">;</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.restassured.common.mapper.TypeRef</span><span class="p">;</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.hamcrest.core.Is</span><span class="p">;</span>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.MethodOrderer</span><span class="p">;</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Order</span><span class="p">;</span>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.TestMethodOrder</span><span class="p">;</span>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Random</span><span class="p">;</span>
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.get</span><span class="p">;</span>
</span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.given</span><span class="p">;</span>
</span><span id="__span-80-18"><a id="__codelineno-80-18" name="__codelineno-80-18" href="#__codelineno-80-18"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.ACCEPT</span><span class="p">;</span>
</span><span id="__span-80-19"><a id="__codelineno-80-19" name="__codelineno-80-19" href="#__codelineno-80-19"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.CONTENT_TYPE</span><span class="p">;</span>
</span><span id="__span-80-20"><a id="__codelineno-80-20" name="__codelineno-80-20" href="#__codelineno-80-20"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-80-21"><a id="__codelineno-80-21" name="__codelineno-80-21" href="#__codelineno-80-21"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.*</span><span class="p">;</span>
</span><span id="__span-80-22"><a id="__codelineno-80-22" name="__codelineno-80-22" href="#__codelineno-80-22"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.hamcrest.CoreMatchers.*</span><span class="p">;</span>
</span><span id="__span-80-23"><a id="__codelineno-80-23" name="__codelineno-80-23" href="#__codelineno-80-23"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span><span class="p">;</span>
</span><span id="__span-80-24"><a id="__codelineno-80-24" name="__codelineno-80-24" href="#__codelineno-80-24"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertNotNull</span><span class="p">;</span>
</span><span id="__span-80-25"><a id="__codelineno-80-25" name="__codelineno-80-25" href="#__codelineno-80-25"></a>
</span><span id="__span-80-26"><a id="__codelineno-80-26" name="__codelineno-80-26" href="#__codelineno-80-26"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-80-27"><a id="__codelineno-80-27" name="__codelineno-80-27" href="#__codelineno-80-27"></a><span class="nd">@TestMethodOrder</span><span class="p">(</span><span class="n">MethodOrderer</span><span class="p">.</span><span class="na">OrderAnnotation</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-80-28"><a id="__codelineno-80-28" name="__codelineno-80-28" href="#__codelineno-80-28"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FightResourceTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-29"><a id="__codelineno-80-29" name="__codelineno-80-29" href="#__codelineno-80-29"></a>
</span><span id="__span-80-30"><a id="__codelineno-80-30" name="__codelineno-80-30" href="#__codelineno-80-30"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_WINNER_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Baguette&quot;</span><span class="p">;</span>
</span><span id="__span-80-31"><a id="__codelineno-80-31" name="__codelineno-80-31" href="#__codelineno-80-31"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_WINNER_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_baguette.png&quot;</span><span class="p">;</span>
</span><span id="__span-80-32"><a id="__codelineno-80-32" name="__codelineno-80-32" href="#__codelineno-80-32"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_WINNER_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-80-33"><a id="__codelineno-80-33" name="__codelineno-80-33" href="#__codelineno-80-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_WINNER_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Eats baguette in less than a second&quot;</span><span class="p">;</span>
</span><span id="__span-80-34"><a id="__codelineno-80-34" name="__codelineno-80-34" href="#__codelineno-80-34"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_LOSER_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Chocolatine&quot;</span><span class="p">;</span>
</span><span id="__span-80-35"><a id="__codelineno-80-35" name="__codelineno-80-35" href="#__codelineno-80-35"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_LOSER_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_chocolatine.png&quot;</span><span class="p">;</span>
</span><span id="__span-80-36"><a id="__codelineno-80-36" name="__codelineno-80-36" href="#__codelineno-80-36"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_LOSER_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
</span><span id="__span-80-37"><a id="__codelineno-80-37" name="__codelineno-80-37" href="#__codelineno-80-37"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_LOSER_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Transforms chocolatine into pain au chocolat&quot;</span><span class="p">;</span>
</span><span id="__span-80-38"><a id="__codelineno-80-38" name="__codelineno-80-38" href="#__codelineno-80-38"></a>
</span><span id="__span-80-39"><a id="__codelineno-80-39" name="__codelineno-80-39" href="#__codelineno-80-39"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NB_FIGHTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</span><span id="__span-80-40"><a id="__codelineno-80-40" name="__codelineno-80-40" href="#__codelineno-80-40"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fightId</span><span class="p">;</span>
</span><span id="__span-80-41"><a id="__codelineno-80-41" name="__codelineno-80-41" href="#__codelineno-80-41"></a>
</span><span id="__span-80-42"><a id="__codelineno-80-42" name="__codelineno-80-42" href="#__codelineno-80-42"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-80-43"><a id="__codelineno-80-43" name="__codelineno-80-43" href="#__codelineno-80-43"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldPingOpenAPI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-44"><a id="__codelineno-80-44" name="__codelineno-80-44" href="#__codelineno-80-44"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-80-45"><a id="__codelineno-80-45" name="__codelineno-80-45" href="#__codelineno-80-45"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-80-46"><a id="__codelineno-80-46" name="__codelineno-80-46" href="#__codelineno-80-46"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/q/openapi&quot;</span><span class="p">)</span>
</span><span id="__span-80-47"><a id="__codelineno-80-47" name="__codelineno-80-47" href="#__codelineno-80-47"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-48"><a id="__codelineno-80-48" name="__codelineno-80-48" href="#__codelineno-80-48"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-80-49"><a id="__codelineno-80-49" name="__codelineno-80-49" href="#__codelineno-80-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-80-50"><a id="__codelineno-80-50" name="__codelineno-80-50" href="#__codelineno-80-50"></a>
</span><span id="__span-80-51"><a id="__codelineno-80-51" name="__codelineno-80-51" href="#__codelineno-80-51"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-80-52"><a id="__codelineno-80-52" name="__codelineno-80-52" href="#__codelineno-80-52"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testHelloEndpoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-53"><a id="__codelineno-80-53" name="__codelineno-80-53" href="#__codelineno-80-53"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-80-54"><a id="__codelineno-80-54" name="__codelineno-80-54" href="#__codelineno-80-54"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/fights/hello&quot;</span><span class="p">)</span>
</span><span id="__span-80-55"><a id="__codelineno-80-55" name="__codelineno-80-55" href="#__codelineno-80-55"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-56"><a id="__codelineno-80-56" name="__codelineno-80-56" href="#__codelineno-80-56"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-80-57"><a id="__codelineno-80-57" name="__codelineno-80-57" href="#__codelineno-80-57"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello Fight Resource&quot;</span><span class="p">));</span>
</span><span id="__span-80-58"><a id="__codelineno-80-58" name="__codelineno-80-58" href="#__codelineno-80-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-80-59"><a id="__codelineno-80-59" name="__codelineno-80-59" href="#__codelineno-80-59"></a>
</span><span id="__span-80-60"><a id="__codelineno-80-60" name="__codelineno-80-60" href="#__codelineno-80-60"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-80-61"><a id="__codelineno-80-61" name="__codelineno-80-61" href="#__codelineno-80-61"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotGetUnknownFight</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-62"><a id="__codelineno-80-62" name="__codelineno-80-62" href="#__codelineno-80-62"></a><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">randomId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Random</span><span class="p">().</span><span class="na">nextLong</span><span class="p">();</span>
</span><span id="__span-80-63"><a id="__codelineno-80-63" name="__codelineno-80-63" href="#__codelineno-80-63"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-80-64"><a id="__codelineno-80-64" name="__codelineno-80-64" href="#__codelineno-80-64"></a><span class="w">            </span><span class="p">.</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">randomId</span><span class="p">)</span>
</span><span id="__span-80-65"><a id="__codelineno-80-65" name="__codelineno-80-65" href="#__codelineno-80-65"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/fights/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-80-66"><a id="__codelineno-80-66" name="__codelineno-80-66" href="#__codelineno-80-66"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-67"><a id="__codelineno-80-67" name="__codelineno-80-67" href="#__codelineno-80-67"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">NO_CONTENT</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-80-68"><a id="__codelineno-80-68" name="__codelineno-80-68" href="#__codelineno-80-68"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-80-69"><a id="__codelineno-80-69" name="__codelineno-80-69" href="#__codelineno-80-69"></a>
</span><span id="__span-80-70"><a id="__codelineno-80-70" name="__codelineno-80-70" href="#__codelineno-80-70"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-80-71"><a id="__codelineno-80-71" name="__codelineno-80-71" href="#__codelineno-80-71"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNotAddInvalidItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-72"><a id="__codelineno-80-72" name="__codelineno-80-72" href="#__codelineno-80-72"></a><span class="w">        </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Fighters</span><span class="p">();</span>
</span><span id="__span-80-73"><a id="__codelineno-80-73" name="__codelineno-80-73" href="#__codelineno-80-73"></a><span class="w">        </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-80-74"><a id="__codelineno-80-74" name="__codelineno-80-74" href="#__codelineno-80-74"></a><span class="w">        </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-80-75"><a id="__codelineno-80-75" name="__codelineno-80-75" href="#__codelineno-80-75"></a>
</span><span id="__span-80-76"><a id="__codelineno-80-76" name="__codelineno-80-76" href="#__codelineno-80-76"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-80-77"><a id="__codelineno-80-77" name="__codelineno-80-77" href="#__codelineno-80-77"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">fighters</span><span class="p">)</span>
</span><span id="__span-80-78"><a id="__codelineno-80-78" name="__codelineno-80-78" href="#__codelineno-80-78"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-80-79"><a id="__codelineno-80-79" name="__codelineno-80-79" href="#__codelineno-80-79"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-80-80"><a id="__codelineno-80-80" name="__codelineno-80-80" href="#__codelineno-80-80"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-80-81"><a id="__codelineno-80-81" name="__codelineno-80-81" href="#__codelineno-80-81"></a><span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/fights&quot;</span><span class="p">)</span>
</span><span id="__span-80-82"><a id="__codelineno-80-82" name="__codelineno-80-82" href="#__codelineno-80-82"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-83"><a id="__codelineno-80-83" name="__codelineno-80-83" href="#__codelineno-80-83"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">BAD_REQUEST</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-80-84"><a id="__codelineno-80-84" name="__codelineno-80-84" href="#__codelineno-80-84"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-80-85"><a id="__codelineno-80-85" name="__codelineno-80-85" href="#__codelineno-80-85"></a>
</span><span id="__span-80-86"><a id="__codelineno-80-86" name="__codelineno-80-86" href="#__codelineno-80-86"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-80-87"><a id="__codelineno-80-87" name="__codelineno-80-87" href="#__codelineno-80-87"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-80-88"><a id="__codelineno-80-88" name="__codelineno-80-88" href="#__codelineno-80-88"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetInitialItems</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-89"><a id="__codelineno-80-89" name="__codelineno-80-89" href="#__codelineno-80-89"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/fights&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-90"><a id="__codelineno-80-90" name="__codelineno-80-90" href="#__codelineno-80-90"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-80-91"><a id="__codelineno-80-91" name="__codelineno-80-91" href="#__codelineno-80-91"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">().</span><span class="na">body</span><span class="p">().</span><span class="na">as</span><span class="p">(</span><span class="n">getFightTypeRef</span><span class="p">());</span>
</span><span id="__span-80-92"><a id="__codelineno-80-92" name="__codelineno-80-92" href="#__codelineno-80-92"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_FIGHTS</span><span class="p">,</span><span class="w"> </span><span class="n">fights</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-80-93"><a id="__codelineno-80-93" name="__codelineno-80-93" href="#__codelineno-80-93"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-80-94"><a id="__codelineno-80-94" name="__codelineno-80-94" href="#__codelineno-80-94"></a>
</span><span id="__span-80-95"><a id="__codelineno-80-95" name="__codelineno-80-95" href="#__codelineno-80-95"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-80-96"><a id="__codelineno-80-96" name="__codelineno-80-96" href="#__codelineno-80-96"></a><span class="w">    </span><span class="nd">@Order</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-80-97"><a id="__codelineno-80-97" name="__codelineno-80-97" href="#__codelineno-80-97"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldAddAnItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-98"><a id="__codelineno-80-98" name="__codelineno-80-98" href="#__codelineno-80-98"></a><span class="w">        </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hero</span><span class="p">();</span>
</span><span id="__span-80-99"><a id="__codelineno-80-99" name="__codelineno-80-99" href="#__codelineno-80-99"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_NAME</span><span class="p">;</span>
</span><span id="__span-80-100"><a id="__codelineno-80-100" name="__codelineno-80-100" href="#__codelineno-80-100"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_PICTURE</span><span class="p">;</span>
</span><span id="__span-80-101"><a id="__codelineno-80-101" name="__codelineno-80-101" href="#__codelineno-80-101"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_LEVEL</span><span class="p">;</span>
</span><span id="__span-80-102"><a id="__codelineno-80-102" name="__codelineno-80-102" href="#__codelineno-80-102"></a><span class="w">        </span><span class="n">hero</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_POWERS</span><span class="p">;</span>
</span><span id="__span-80-103"><a id="__codelineno-80-103" name="__codelineno-80-103" href="#__codelineno-80-103"></a><span class="w">        </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Villain</span><span class="p">();</span>
</span><span id="__span-80-104"><a id="__codelineno-80-104" name="__codelineno-80-104" href="#__codelineno-80-104"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_NAME</span><span class="p">;</span>
</span><span id="__span-80-105"><a id="__codelineno-80-105" name="__codelineno-80-105" href="#__codelineno-80-105"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_PICTURE</span><span class="p">;</span>
</span><span id="__span-80-106"><a id="__codelineno-80-106" name="__codelineno-80-106" href="#__codelineno-80-106"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_LEVEL</span><span class="p">;</span>
</span><span id="__span-80-107"><a id="__codelineno-80-107" name="__codelineno-80-107" href="#__codelineno-80-107"></a><span class="w">        </span><span class="n">villain</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_POWERS</span><span class="p">;</span>
</span><span id="__span-80-108"><a id="__codelineno-80-108" name="__codelineno-80-108" href="#__codelineno-80-108"></a><span class="w">        </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Fighters</span><span class="p">();</span>
</span><span id="__span-80-109"><a id="__codelineno-80-109" name="__codelineno-80-109" href="#__codelineno-80-109"></a><span class="w">        </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hero</span><span class="p">;</span>
</span><span id="__span-80-110"><a id="__codelineno-80-110" name="__codelineno-80-110" href="#__codelineno-80-110"></a><span class="w">        </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villain</span><span class="p">;</span>
</span><span id="__span-80-111"><a id="__codelineno-80-111" name="__codelineno-80-111" href="#__codelineno-80-111"></a>
</span><span id="__span-80-112"><a id="__codelineno-80-112" name="__codelineno-80-112" href="#__codelineno-80-112"></a><span class="w">        </span><span class="n">fightId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-80-113"><a id="__codelineno-80-113" name="__codelineno-80-113" href="#__codelineno-80-113"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">fighters</span><span class="p">)</span>
</span><span id="__span-80-114"><a id="__codelineno-80-114" name="__codelineno-80-114" href="#__codelineno-80-114"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-80-115"><a id="__codelineno-80-115" name="__codelineno-80-115" href="#__codelineno-80-115"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-80-116"><a id="__codelineno-80-116" name="__codelineno-80-116" href="#__codelineno-80-116"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-80-117"><a id="__codelineno-80-117" name="__codelineno-80-117" href="#__codelineno-80-117"></a><span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/fights&quot;</span><span class="p">)</span>
</span><span id="__span-80-118"><a id="__codelineno-80-118" name="__codelineno-80-118" href="#__codelineno-80-118"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-119"><a id="__codelineno-80-119" name="__codelineno-80-119" href="#__codelineno-80-119"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-80-120"><a id="__codelineno-80-120" name="__codelineno-80-120" href="#__codelineno-80-120"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">containsString</span><span class="p">(</span><span class="s">&quot;winner&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">containsString</span><span class="p">(</span><span class="s">&quot;loser&quot;</span><span class="p">))</span>
</span><span id="__span-80-121"><a id="__codelineno-80-121" name="__codelineno-80-121" href="#__codelineno-80-121"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">().</span><span class="na">body</span><span class="p">().</span><span class="na">jsonPath</span><span class="p">().</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
</span><span id="__span-80-122"><a id="__codelineno-80-122" name="__codelineno-80-122" href="#__codelineno-80-122"></a>
</span><span id="__span-80-123"><a id="__codelineno-80-123" name="__codelineno-80-123" href="#__codelineno-80-123"></a><span class="w">        </span><span class="n">assertNotNull</span><span class="p">(</span><span class="n">fightId</span><span class="p">);</span>
</span><span id="__span-80-124"><a id="__codelineno-80-124" name="__codelineno-80-124" href="#__codelineno-80-124"></a>
</span><span id="__span-80-125"><a id="__codelineno-80-125" name="__codelineno-80-125" href="#__codelineno-80-125"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-80-126"><a id="__codelineno-80-126" name="__codelineno-80-126" href="#__codelineno-80-126"></a><span class="w">            </span><span class="p">.</span><span class="na">pathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fightId</span><span class="p">)</span>
</span><span id="__span-80-127"><a id="__codelineno-80-127" name="__codelineno-80-127" href="#__codelineno-80-127"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/fights/{id}&quot;</span><span class="p">)</span>
</span><span id="__span-80-128"><a id="__codelineno-80-128" name="__codelineno-80-128" href="#__codelineno-80-128"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-129"><a id="__codelineno-80-129" name="__codelineno-80-129" href="#__codelineno-80-129"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-80-130"><a id="__codelineno-80-130" name="__codelineno-80-130" href="#__codelineno-80-130"></a><span class="w">            </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-80-131"><a id="__codelineno-80-131" name="__codelineno-80-131" href="#__codelineno-80-131"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;winnerName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_WINNER_NAME</span><span class="p">))</span>
</span><span id="__span-80-132"><a id="__codelineno-80-132" name="__codelineno-80-132" href="#__codelineno-80-132"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;winnerPicture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_WINNER_PICTURE</span><span class="p">))</span>
</span><span id="__span-80-133"><a id="__codelineno-80-133" name="__codelineno-80-133" href="#__codelineno-80-133"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;winnerLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_WINNER_LEVEL</span><span class="p">))</span>
</span><span id="__span-80-134"><a id="__codelineno-80-134" name="__codelineno-80-134" href="#__codelineno-80-134"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;winnerPowers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_WINNER_POWERS</span><span class="p">))</span>
</span><span id="__span-80-135"><a id="__codelineno-80-135" name="__codelineno-80-135" href="#__codelineno-80-135"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;loserName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_LOSER_NAME</span><span class="p">))</span>
</span><span id="__span-80-136"><a id="__codelineno-80-136" name="__codelineno-80-136" href="#__codelineno-80-136"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;loserPicture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_LOSER_PICTURE</span><span class="p">))</span>
</span><span id="__span-80-137"><a id="__codelineno-80-137" name="__codelineno-80-137" href="#__codelineno-80-137"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;loserLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_LOSER_LEVEL</span><span class="p">))</span>
</span><span id="__span-80-138"><a id="__codelineno-80-138" name="__codelineno-80-138" href="#__codelineno-80-138"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;loserPowers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">DEFAULT_LOSER_POWERS</span><span class="p">))</span>
</span><span id="__span-80-139"><a id="__codelineno-80-139" name="__codelineno-80-139" href="#__codelineno-80-139"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="s">&quot;fightDate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Is</span><span class="p">.</span><span class="na">is</span><span class="p">(</span><span class="n">notNullValue</span><span class="p">()));</span>
</span><span id="__span-80-140"><a id="__codelineno-80-140" name="__codelineno-80-140" href="#__codelineno-80-140"></a>
</span><span id="__span-80-141"><a id="__codelineno-80-141" name="__codelineno-80-141" href="#__codelineno-80-141"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/api/fights&quot;</span><span class="p">).</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-80-142"><a id="__codelineno-80-142" name="__codelineno-80-142" href="#__codelineno-80-142"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-80-143"><a id="__codelineno-80-143" name="__codelineno-80-143" href="#__codelineno-80-143"></a><span class="w">            </span><span class="p">.</span><span class="na">extract</span><span class="p">().</span><span class="na">body</span><span class="p">().</span><span class="na">as</span><span class="p">(</span><span class="n">getFightTypeRef</span><span class="p">());</span>
</span><span id="__span-80-144"><a id="__codelineno-80-144" name="__codelineno-80-144" href="#__codelineno-80-144"></a><span class="w">        </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">NB_FIGHTS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">fights</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
</span><span id="__span-80-145"><a id="__codelineno-80-145" name="__codelineno-80-145" href="#__codelineno-80-145"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-80-146"><a id="__codelineno-80-146" name="__codelineno-80-146" href="#__codelineno-80-146"></a>
</span><span id="__span-80-147"><a id="__codelineno-80-147" name="__codelineno-80-147" href="#__codelineno-80-147"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">TypeRef</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getFightTypeRef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-148"><a id="__codelineno-80-148" name="__codelineno-80-148" href="#__codelineno-80-148"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TypeRef</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-80-149"><a id="__codelineno-80-149" name="__codelineno-80-149" href="#__codelineno-80-149"></a><span class="w">            </span><span class="c1">// Kept empty on purpose</span>
</span><span id="__span-80-150"><a id="__codelineno-80-150" name="__codelineno-80-150" href="#__codelineno-80-150"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-80-151"><a id="__codelineno-80-151" name="__codelineno-80-151" href="#__codelineno-80-151"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-80-152"><a id="__codelineno-80-152" name="__codelineno-80-152" href="#__codelineno-80-152"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="running-testing-and-packaging-the-application_1">Running, Testing and Packaging the Application</h4>
<p>First, delete the generated <code>FightResourceIT</code> native test class, as we won’t run native tests. Then, make sure the tests pass by executing the command <code>./mvnw test</code> (or from your IDE). Quarkus automatically starts the PostGreSQL database.</p>
<p>Now that the tests are green, we are ready to run our application. Use <code>./mvnw quarkus:dev</code> to start it (notice that there is no banner yet, it will come later). Once the application is started, just check that it returns the fights from the database with the following cURL command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>curl<span class="w"> </span>http://localhost:8082/api/fights
</span></code></pre></div>
<h2 id="user-interface">User Interface</h2>
<p>Now that we have the three main microservices, time to have a decent user interface to start fighting. The purpose of this workshop is not to develop a web interface and learn <em>yet another web framework</em>. This time you will just execute another Quarkus instance with an already React application. We will be using <a href="https://quarkiverse.github.io/quarkiverse-docs/quarkus-quinoa/dev/">Quinoa</a> to handle building and serving the React application.</p>
<h3 id="quinoa">Quinoa?</h3>
<p><a href="https://quarkus.io/extensions/io.quarkiverse.quinoa/quarkus-quinoa">Quinoa</a> is a Quarkus extension which eases the development of single page apps or web components. It lets you live code the backend and frontend together with close to no configuration. It also helps with both packaging and serving, and if you want it to, abstracts away <code>npm</code>.</p>
<p>When enabled in development mode, Quinoa will start the UI live coding server provided by the target framework and forward relevant requests to it. In production mode, Quinoa will run the build and process the generated files to serve them at runtime.</p>
<p>Quinoa is framework-agnostic, and works with React, Angular, Vue, Lit, and others, alongside other Quarkus services (REST, GraphQL, Security, Events, etc).</p>
<h3 id="the-web-application">The Web Application</h3>
<p>Navigate to the <code>super-heroes/ui-super-heroes</code> directory. It contains the code of the application.</p>
<p>The React application is in <code>src/main/webui</code>. Being a React application, you will find a <code>package.json</code> file which defines all the needed dependencies. All the React code (graphical components, model, services) is located under <code>src/main/webui/src/app</code>.</p>
<h4 id="running-the-web-application">Running the Web Application</h4>
<p>We don’t need to worry too much about the React code.</p>
<p>From the <code>ui-super-heroes</code> directory, use <code>./mvnw quarkus:dev</code> to start the web application.</p>
<p>Be sure you have the hero, villain and fights microservices running (dev mode is enough).</p>
<p>If you don’t have Node installed, Quinoa will install it during the start process (under the <code>.quinoa</code> directory).</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>INFO  [com.git.eir.mav.plu.fro.lib.NodeInstaller] (build-40) Installing node version v16.16.0
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>INFO  [com.git.eir.mav.plu.fro.lib.NodeInstaller] (build-40) Extracting NPM
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>INFO  [com.git.eir.mav.plu.fro.lib.NodeInstaller] (build-40) Installed node locally.
</span></code></pre></div>
<p>You should see console output like the following</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>2023-05-18 14:22:02,745 INFO  [io.qua.qui.dep.ForwardedDevProcessor] (build-5) Quinoa package manager live coding is up and running on port: 3000 (in 18118ms)
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>2023-05-18 14:22:02,749 INFO  [io.qua.qui.dep.ForwardedDevProcessor] (build-40) Quinoa is forwarding unhandled requests to port: 3000
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>__  ____  __  _____   ___  __ ____  ______
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a> --/ __ \/ / / / _ | / _ \/ //_/ / / / __/
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a> -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a>--\___\_\____/_/ |_/_/|_/_/|_|\____/___/
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a>2023-05-18 14:22:03,237 INFO  [io.quarkus] (Quarkus Main Thread) ui-super-heroes 1.0.0-SNAPSHOT on JVM (powered by Quarkus 3.9.1) started in 24.765s. Listening on: http://localhost:8080
</span></code></pre></div>
<p>Once the application is started, go to <a href="http://localhost:8080/">http://localhost:8080</a> (8080 is the default Quarkus port as we didn’t change it in the <code>application.properties</code> this time). It should display a main web page. There won’t be much content yet, because we need to fix a few things and add some more implementation.</p>
<p><img alt="blank ui" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/blank-ui.png" /></p>
<p>If you want, you can visit <a href="http://localhost:3000/">http://localhost:3000</a> (the usual React port) to confirm that Quinoa is forwarding what’s on port 3000 to port 8080. The version of the application on <a href="http://localhost:3000/">http://localhost:3000</a> will always stay disappointingly blank, because it’s looking for its config on the wrong port. So don’t use that one!</p>
<p>You might want to create a fuller Quarkus BFF for the UI, and use something like <a href="https://quarkus.io/guides/stork">Stork</a> for service discovery. However, that’s beyond the scope of this workshop!</p>
<h4 id="live-coding-the-ui">Live coding the UI</h4>
<p>Live coding works for the javascript parts of the application, just as it does for the Java ones.</p>
<p>Open <code>src/main/webui/src/app/app.component.html</code> and edit the text, perhaps by adding 'Hello there' into the welcome message. Check localhost:8080, and your new content should appear. (It may take a moment or two for the refresh to trigger.)</p>
<p>You can also change the javascript code. For example, try updating the text in <code>src/main/webui/src/app/app.component.ts</code>.</p>
<h3 id="cors">CORS</h3>
<p>Cross-origin resource sharing (CORS) is a mechanism that allows restricted resources on a web page to be requested from another domain outside the domain from which the first resource was served. So when we want our heroes and villains to fight, we actually cross several origins: we go from localhost:8080 (the UI) to localhost:8082 (Fight API) which invokes localhost:8083 (Hero) and localhost:8084 (Villain). If you look at the console of your Browser you should see something similar to this:</p>
<p><img alt="cors" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/cors.png" /></p>
<p>Quarkus comes with a CORS filter which intercepts all incoming HTTP requests. It can be enabled in the Quarkus configuration file:</p>
<p>If the filter is enabled and an HTTP request is identified as cross-origin, the CORS policy and headers defined using the following properties will be applied before passing the request on to its actual target (servlet, JAX-RS resource, etc.):</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>quarkus.http.cors.origins</code></td>
<td>The comma-separated list of origins allowed for CORS. The filter allows any origin if this is not set.</td>
</tr>
<tr>
<td><code>quarkus.http.cors.methods</code></td>
<td>The comma-separated list of HTTP methods allowed for CORS. The filter allows any method if this is not set.</td>
</tr>
<tr>
<td><code>quarkus.http.cors.headers</code></td>
<td>The comma-separated list of HTTP headers allowed for CORS. The filter allows any header if this is not set.</td>
</tr>
<tr>
<td><code>quarkus.http.cors.exposed-headers</code></td>
<td>The comma-separated list of HTTP headers exposed in CORS.</td>
</tr>
<tr>
<td><code>quarkus.http.cors.access-control-max-age</code></td>
<td>The duration indicating how long the results of a pre-flight request can be cached. This value will be returned in a Access-Control-Max-Age response header.</td>
</tr>
</tbody>
</table>
<p>So make sure you set the following properties on the:</p>
<ul>
<li>
<p>Fight microservice,</p>
</li>
<li>
<p>Hero microservice,</p>
</li>
<li>
<p>Villain microservice</p>
</li>
</ul>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="na">quarkus.http.cors</span><span class="o">=</span><span class="s">true</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="na">quarkus.http.cors.origins</span><span class="o">=</span><span class="s">/.*/</span>
</span></code></pre></div>
<p>But, even with this, the UI is still not working. The CORS errors are gone, so that’s a good step, but we forgot something else:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-f44d76d59eea57d7c7c2debf5e432cb3.png" /></p>
<p>Remember the function to retrieve random fighters. We are currently returning <code>null</code>. Let’s move to the next session to see how we can implement this method.</p>
<h2 id="http-communication-fault-tolerance">HTTP communication &amp; Fault Tolerance</h2>
<hr />
<p>So far we’ve built one Fight microservice which need to invoke the Hero and Villain microservices. In the following sections you will develop this invocation thanks to the MicroProfile REST Client. We will also deal with fault tolerance thanks to timeouts and circuit breaker.</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-f383c38e127f13fbdd6cc3ba98a08354.png" /></p>
<h3 id="rest-client">REST Client</h3>
<p>This chapter explains how to use the MicroProfile REST Client in order to interact with REST APIs with very little effort.</p>
<h4 id="directory-structure_6">Directory Structure</h4>
<p>Remember the structure of the Fight microservice:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-2cac30cbb3df97fa722b8e506f58d4ed.png" /></p>
<p>We are going to rework the:</p>
<ul>
<li>
<p><code>FightService</code> class</p>
</li>
<li>
<p><code>FightResourceTest</code> class</p>
</li>
<li>
<p><code>application.properties</code></p>
</li>
</ul>
<h4 id="installing-the-reactive-rest-client-dependency">Installing the Reactive REST Client Dependency</h4>
<p>To install the Reactive REST Client dependency, just run the following command in the Fight microservice:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="p">.</span><span class="o">/</span><span class="n">mvnw</span><span class="w"> </span><span class="n">quarkus</span><span class="p">:</span><span class="n">add</span><span class="o">-</span><span class="n">extension</span><span class="w"> </span><span class="o">-</span><span class="n">Dextensions</span><span class="o">=</span><span class="s">&quot;io.quarkus:quarkus-rest-client-jackson&quot;</span>
</span></code></pre></div>
<p>This will add the following dependency in the <code>pom.xml</code> file:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>quarkus-rest-client-jackson<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>This dependency imports both the reactive rest client implementation and the JSON mapping support (which uses Jackson).</p>
<h4 id="fightservice-invoking-external-microservices">FightService Invoking External Microservices</h4>
<p>Remember that in the previous sections we left the <code>FightService.findRandomFighters()</code> method returns <code>null</code>. We have to fix this. What we actually want is to invoke both the Hero and Villain APIs, asking for a random hero and a random villain.</p>
<p>For that, replace the <code>findRandomFighters</code> method with the following code to the <code>FightService</code> class:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="nd">@RestClient</span><span class="w"> </span><span class="n">HeroProxy</span><span class="w"> </span><span class="n">heroProxy</span><span class="p">;</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="nd">@RestClient</span><span class="w"> </span><span class="n">VillainProxy</span><span class="w"> </span><span class="n">villainProxy</span><span class="p">;</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="c1">// ...</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="n">Fighters</span><span class="w"> </span><span class="nf">findRandomFighters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">    </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findRandomHero</span><span class="p">();</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">    </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findRandomVillain</span><span class="p">();</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">    </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Fighters</span><span class="p">();</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">    </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hero</span><span class="p">;</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">    </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villain</span><span class="p">;</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fighters</span><span class="p">;</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="p">}</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="n">Villain</span><span class="w"> </span><span class="nf">findRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">villainProxy</span><span class="p">.</span><span class="na">findRandomVillain</span><span class="p">();</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="p">}</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="n">Hero</span><span class="w"> </span><span class="nf">findRandomHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">heroProxy</span><span class="p">.</span><span class="na">findRandomHero</span><span class="p">();</span>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>Note the Rest client injection. They use the <code>@RestClient</code> qualifier, i.e. a bean selector. With Quarkus, when you use a qualifier, you can omit <code>@Inject</code>.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>If not done automatically by your IDE, add the following import statement: <code>import org.eclipse.microprofile.rest.client.inject.RestClient;</code></p></td></tr></tbody></table>

<h4 id="creating-the-interfaces">Creating the Interfaces</h4>
<p>Using the MicroProfile REST Client is as simple as creating an interface using the proper JAX-RS and MicroProfile annotations.</p>
<p>In our case both interfaces should be created under the <code>client</code> subpackage and have the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.rest.client.inject.RegisterRestClient</span><span class="p">;</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.GET</span><span class="p">;</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Path</span><span class="p">;</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Produces</span><span class="p">;</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/heroes&quot;</span><span class="p">)</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="nd">@RegisterRestClient</span><span class="p">(</span><span class="n">configKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hero&quot;</span><span class="p">)</span>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">HeroProxy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/random&quot;</span><span class="p">)</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">    </span><span class="n">Hero</span><span class="w"> </span><span class="nf">findRandomHero</span><span class="p">();</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>findRandomHero</code> method gives our code the ability to query a random hero from the Hero REST API. The client will handle all the networking and marshalling leaving our code clean of such technical details.</p>
<p>The purpose of the annotations in the code above is the following:</p>
<ul>
<li>
<p><code>@RegisterRestClient</code> allows Quarkus to know that this interface is meant to be available for CDI injection as a REST Client</p>
</li>
<li>
<p><code>@Path</code> and <code>@GET</code> are the standard JAX-RS annotations used to define how to access the service</p>
</li>
<li>
<p><code>@Produces</code> defines the expected content-type</p>
</li>
</ul>
<p>The <code>VillainProxy</code> is very similar and looks like this:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.rest.client.inject.RegisterRestClient</span><span class="p">;</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.GET</span><span class="p">;</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Path</span><span class="p">;</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Produces</span><span class="p">;</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/villains&quot;</span><span class="p">)</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="nd">@RegisterRestClient</span><span class="p">(</span><span class="n">configKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;villain&quot;</span><span class="p">)</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">VillainProxy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/random&quot;</span><span class="p">)</span>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a><span class="w">    </span><span class="n">Villain</span><span class="w"> </span><span class="nf">findRandomVillain</span><span class="p">();</span>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>Once created, go back to the <code>FightService</code> class and add the following import statements:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.HeroProxy</span><span class="p">;</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.VillainProxy</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="configuring-rest-client-invocation">Configuring REST Client Invocation</h4>
<p>In order to determine the base URL to which REST calls will be made, the REST Client uses configuration from <code>application.properties</code>. The name of the property needs to follow a certain convention which is best displayed in the following code:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="na">quarkus.rest-client.hero.url</span><span class="o">=</span><span class="s">http://localhost:8083</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="na">quarkus.rest-client.villain.url</span><span class="o">=</span><span class="s">http://localhost:8084</span>
</span></code></pre></div>
<p>Having this configuration means that all requests performed using <code>HeroProxy</code> will use <a href="http://localhost:8083/">http://localhost:8083</a> as the base URL. Using this configuration, calling the <code>findRandomHero</code> method of <code>HeroProxy</code> would result in an HTTP GET request being made to <a href="http://localhost:8083/api/heroes/random">http://localhost:8083/api/heroes/random</a>.</p>
<p>Now, go back in the UI and refresh, you should see some pictures!</p>
<h4 id="updating-the-test-with-mock-support">Updating the Test with Mock Support</h4>
<p>But, now we have another problem. To run the tests of the Fight API we need the Hero and Villain REST APIs to be up and running. To avoid this, we need to Mock the <code>HeroProxy</code> and <code>VillainProxy</code> interfaces.</p>
<p>Quarkus supports the use of mock objects using the CDI <code>@Alternative</code> mechanism</p>
<p>To use this simply override the bean you wish to mock with a class in the <code>src/test/java</code> directory, and put the <code>@Alternative</code> and <code>@Priority(1)</code> annotations on the bean. Alternatively, a convenient <code>io.quarkus.test.Mock</code> stereotype annotation could be used. This built-in stereotype declares <code>@Alternative</code>, <code>@Priority(1)</code> and <code>@Dependent</code>.</p>
<h5 id="mocking-a-villain-service">Mocking a Villain service</h5>
<p>So, to mock the <code>VillainProxy</code> interface we just need to implement the following <code>MockVillainProxy</code> class (under the <code>client</code> subpackage under <code>src/test/java/io/quarkus/workshop/superheroes/fight</code>):</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.Mock</span><span class="p">;</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.rest.client.inject.RestClient</span><span class="p">;</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="nd">@Mock</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="nd">@RestClient</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MockVillainProxy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">VillainProxy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">findRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">INSTANCE</span><span class="p">;</span>
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>We are using some common classes for the test data. They don’t exist yet, so the IDE will complain! Let your IDE’s quick fix create the classes for you, or create them manually (under the <code>client</code> subpackage under <code>src/test/java/io/quarkus/workshop/superheroes/fight</code>), and then fill in the following contents:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DefaultTestVillain</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Chocolatine&quot;</span><span class="p">;</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_chocolatine.png&quot;</span><span class="p">;</span>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;does not eat pain au chocolat&quot;</span><span class="p">;</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">();</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">DefaultTestVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_NAME</span><span class="p">;</span>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_PICTURE</span><span class="p">;</span>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_POWERS</span><span class="p">;</span>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_VILLAIN_LEVEL</span><span class="p">;</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="p">}</span>
</span></code></pre></div>
<h5 id="mocking-a-hero-service">Mocking a Hero service</h5>
<p>We could create a <code>@Mock</code> for the <code>HeroProxy</code>, as we did for the Villain, but there are some drawbacks to using <code>@Mock</code>:</p>
<ul>
<li>
<p>Any class defined by <code>@Mock</code> is global in scope, and can’t be isolated to individual tests. That can result in unwanted cross-talk between tests.</p>
</li>
<li>
<p>Because of how the mock is defined, it’s also harder to use <a href="https://site.mockito.org/">Mockito</a> to generate the mock instance.</p>
</li>
</ul>
<p>Let’s try a different approach.</p>
<p>We’ll still want a class which holds test data for the hero. Create the following under the <code>client</code> subpackage:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DefaultTestHero</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Hero</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_HERO_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Baguette&quot;</span><span class="p">;</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_HERO_PICTURE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;super_baguette.png&quot;</span><span class="p">;</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_HERO_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;eats baguette really quickly&quot;</span><span class="p">;</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_HERO_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">();</span>
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">DefaultTestHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_HERO_NAME</span><span class="p">;</span>
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_HERO_PICTURE</span><span class="p">;</span>
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_HERO_POWERS</span><span class="p">;</span>
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_HERO_LEVEL</span><span class="p">;</span>
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>Add the extended Quarkus Mockito support to the <code>fight</code> service’s <code>pom.xml</code>:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>quarkus-junit5-mockito<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">    </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>Now we can add the following to the top of the <code>FightResourceTest</code>:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="nd">@InjectMock</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="nd">@RestClient</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="n">HeroProxy</span><span class="w"> </span><span class="n">heroProxy</span><span class="p">;</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="nd">@BeforeEach</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w">    </span><span class="n">when</span><span class="p">(</span><span class="n">heroProxy</span><span class="p">.</span><span class="na">findRandomHero</span><span class="p">()).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">INSTANCE</span><span class="p">);</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>when</code> call is a static import of <code>Mockito.when</code>. The <a href="https://quarkus.io/guides/getting-started-testing#further-simplification-with-injectmock"><code>@InjectMock</code></a> annotation results in a mock being created and made available in test methods of the test class. Importantly, other test classes are not affected by this.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.InjectMock</span><span class="p">;</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.mockito.Mockito.when</span><span class="p">;</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.rest.client.inject.RestClient</span><span class="p">;</span>
</span></code></pre></div>
<p>Finally, edit the <code>FightResourceTest</code> and add the following method:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="nd">@Test</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetRandomFighters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">    </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="w">        </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="w">        </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/fights/randomfighters&quot;</span><span class="p">)</span>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="w">        </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="w">        </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w">        </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="w">        </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="w">        </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">Fighters</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a>
</span><span id="__span-98-12"><a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a><span class="w">    </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">;</span>
</span><span id="__span-98-13"><a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_NAME</span><span class="p">);</span>
</span><span id="__span-98-14"><a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_PICTURE</span><span class="p">);</span>
</span><span id="__span-98-15"><a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_LEVEL</span><span class="p">);</span>
</span><span id="__span-98-16"><a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">powers</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_POWERS</span><span class="p">);</span>
</span><span id="__span-98-17"><a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a>
</span><span id="__span-98-18"><a id="__codelineno-98-18" name="__codelineno-98-18" href="#__codelineno-98-18"></a><span class="w">    </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">;</span>
</span><span id="__span-98-19"><a id="__codelineno-98-19" name="__codelineno-98-19" href="#__codelineno-98-19"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">DEFAULT_VILLAIN_NAME</span><span class="p">);</span>
</span><span id="__span-98-20"><a id="__codelineno-98-20" name="__codelineno-98-20" href="#__codelineno-98-20"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">DEFAULT_VILLAIN_PICTURE</span><span class="p">);</span>
</span><span id="__span-98-21"><a id="__codelineno-98-21" name="__codelineno-98-21" href="#__codelineno-98-21"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">DEFAULT_VILLAIN_LEVEL</span><span class="p">);</span>
</span><span id="__span-98-22"><a id="__codelineno-98-22" name="__codelineno-98-22" href="#__codelineno-98-22"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">powers</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">DEFAULT_VILLAIN_POWERS</span><span class="p">);</span>
</span><span id="__span-98-23"><a id="__codelineno-98-23" name="__codelineno-98-23" href="#__codelineno-98-23"></a><span class="p">}</span>
</span></code></pre></div>
<p>Now, run the test from the dev mode, or from your IDE. You can shutdown the hero and villain services to verify that the tests still pass.</p>
<p>Time to play. Start the Hero, Villain and Fight microservices as well as the user interface (using <code>./mvnw quarkus:dev</code> on each project) and select random fighters.</p>
<p><img alt="react ui" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/react-ui.png" /></p>
<h3 id="fallbacks">Fallbacks</h3>
<p>So now you’ve been playing this great Super Heroes Fight for a few hours… and you kill the Hero REST API. What happens? Well, the Fight REST API cannot invoke the Hero API anymore and breaks with the following exception:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>Caused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:8083
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>Caused by: java.net.ConnectException: Connection refused
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a>        at java.base/sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>        at java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:777)
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>        at io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:330)
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>        at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:334)
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:707)
</span><span id="__span-99-8"><a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a>        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
</span><span id="__span-99-9"><a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a>        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
</span><span id="__span-99-10"><a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a>        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
</span><span id="__span-99-11"><a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a>        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986)
</span><span id="__span-99-12"><a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a>        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
</span><span id="__span-99-13"><a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a>        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
</span><span id="__span-99-14"><a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a>        at java.base/java.lang.Thread.run(Thread.java:829)
</span></code></pre></div>
<p>One of the challenges brought by the distributed nature of microservices is that communication with external systems is inherently unreliable. This increases demand on resiliency of applications. To simplify making more resilient applications, Quarkus contains an implementation of the MicroProfile Fault Tolerance specification</p>
<h4 id="installing-the-fault-tolerance-dependency">Installing the Fault Tolerance Dependency</h4>
<p>To install the MicroProfile Fault Tolerance dependency, just run the following command in the Fight microservice:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>./mvnw<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;smallrye-fault-tolerance&quot;</span>
</span></code></pre></div>
<p>This will add the following dependency in the <code>pom.xml</code> file:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>quarkus-smallrye-fault-tolerance<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<h4 id="adding-fallbacks">Adding Fallbacks</h4>
<p>Let’s make our find random fighters feature better by providing a fallback way of getting a dummy hero or villain in case of failure.</p>
<p>For that, add two fallback methods to the <code>FightService</code> and a <code>@Fallback</code> annotation to both <code>findRandomHero</code> and <code>findRandomVillain</code> methods as follows:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="nd">@Fallback</span><span class="p">(</span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fallbackRandomHero&quot;</span><span class="p">)</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="n">Hero</span><span class="w"> </span><span class="nf">findRandomHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">heroProxy</span><span class="p">.</span><span class="na">findRandomHero</span><span class="p">();</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="p">}</span>
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a>
</span><span id="__span-102-6"><a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="nd">@Fallback</span><span class="p">(</span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fallbackRandomVillain&quot;</span><span class="p">)</span>
</span><span id="__span-102-7"><a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="n">Villain</span><span class="w"> </span><span class="nf">findRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-8"><a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">villainProxy</span><span class="p">.</span><span class="na">findRandomVillain</span><span class="p">();</span>
</span><span id="__span-102-9"><a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a><span class="p">}</span>
</span><span id="__span-102-10"><a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a>
</span><span id="__span-102-11"><a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a><span class="kd">public</span><span class="w"> </span><span class="n">Hero</span><span class="w"> </span><span class="nf">fallbackRandomHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-12"><a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Falling back on Hero&quot;</span><span class="p">);</span>
</span><span id="__span-102-13"><a id="__codelineno-102-13" name="__codelineno-102-13" href="#__codelineno-102-13"></a><span class="w">    </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hero</span><span class="p">();</span>
</span><span id="__span-102-14"><a id="__codelineno-102-14" name="__codelineno-102-14" href="#__codelineno-102-14"></a><span class="w">    </span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Fallback hero&quot;</span><span class="p">;</span>
</span><span id="__span-102-15"><a id="__codelineno-102-15" name="__codelineno-102-15" href="#__codelineno-102-15"></a><span class="w">    </span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://dummyimage.com/240x320/1e8fff/ffffff&amp;amp;text=Fallback+Hero&quot;</span><span class="p">;</span>
</span><span id="__span-102-16"><a id="__codelineno-102-16" name="__codelineno-102-16" href="#__codelineno-102-16"></a><span class="w">    </span><span class="n">hero</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Fallback hero powers&quot;</span><span class="p">;</span>
</span><span id="__span-102-17"><a id="__codelineno-102-17" name="__codelineno-102-17" href="#__codelineno-102-17"></a><span class="w">    </span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-102-18"><a id="__codelineno-102-18" name="__codelineno-102-18" href="#__codelineno-102-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">hero</span><span class="p">;</span>
</span><span id="__span-102-19"><a id="__codelineno-102-19" name="__codelineno-102-19" href="#__codelineno-102-19"></a><span class="p">}</span>
</span><span id="__span-102-20"><a id="__codelineno-102-20" name="__codelineno-102-20" href="#__codelineno-102-20"></a>
</span><span id="__span-102-21"><a id="__codelineno-102-21" name="__codelineno-102-21" href="#__codelineno-102-21"></a><span class="kd">public</span><span class="w"> </span><span class="n">Villain</span><span class="w"> </span><span class="nf">fallbackRandomVillain</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-102-22"><a id="__codelineno-102-22" name="__codelineno-102-22" href="#__codelineno-102-22"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Falling back on Villain&quot;</span><span class="p">);</span>
</span><span id="__span-102-23"><a id="__codelineno-102-23" name="__codelineno-102-23" href="#__codelineno-102-23"></a><span class="w">    </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Villain</span><span class="p">();</span>
</span><span id="__span-102-24"><a id="__codelineno-102-24" name="__codelineno-102-24" href="#__codelineno-102-24"></a><span class="w">    </span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Fallback villain&quot;</span><span class="p">;</span>
</span><span id="__span-102-25"><a id="__codelineno-102-25" name="__codelineno-102-25" href="#__codelineno-102-25"></a><span class="w">    </span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://dummyimage.com/240x320/b22222/ffffff&amp;amp;text=Fallback+Villain&quot;</span><span class="p">;</span>
</span><span id="__span-102-26"><a id="__codelineno-102-26" name="__codelineno-102-26" href="#__codelineno-102-26"></a><span class="w">    </span><span class="n">villain</span><span class="p">.</span><span class="na">powers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Fallback villain powers&quot;</span><span class="p">;</span>
</span><span id="__span-102-27"><a id="__codelineno-102-27" name="__codelineno-102-27" href="#__codelineno-102-27"></a><span class="w">    </span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-102-28"><a id="__codelineno-102-28" name="__codelineno-102-28" href="#__codelineno-102-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">villain</span><span class="p">;</span>
</span><span id="__span-102-29"><a id="__codelineno-102-29" name="__codelineno-102-29" href="#__codelineno-102-29"></a><span class="p">}</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Also add the <code>import org.eclipse.microprofile.faulttolerance.Fallback;</code> statement.</p></td></tr></tbody></table>

<h4 id="running-the-application_1">Running the Application</h4>
<p>Now we are ready to run our application and test the fallbacks.</p>
<p>For that, kill the Hero (and/or the Villain API) and start playing again. You should see the following:</p>
<p><img alt="fault tolerance fallback" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/fault-tolerance-fallback.png" /></p>
<p>Restart the Hero REST API… and keep on playing. Super-heroes are back to the fight!</p>
<h3 id="timeout">Timeout</h3>
<p>Sometimes invoking a REST API can take a long time. In fact, the more microservices invoke other microservices, the more network latency you can have. And what happens when a HTTP request takes long? Well, it hangs. On your browser you can see the request pending if you turn on the dev tools and look at what’s the network is doing.</p>
<p><img alt="fault tolerance pending" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/fault-tolerance-pending.png" /></p>
<h4 id="adding-timeouts">Adding Timeouts</h4>
<p>Getting random fighters can take longer than expected.</p>
<p>To simulate a long-running process, add the following code to the <code>FightResource</code>:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="nd">@ConfigProperty</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;process.milliseconds&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">)</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="kt">long</span><span class="w"> </span><span class="n">tooManyMilliseconds</span><span class="p">;</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">veryLongProcess</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">tooManyMilliseconds</span><span class="p">);</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">interrupt</span><span class="p">();</span>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-103-10"><a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="p">}</span>
</span><span id="__span-103-11"><a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a>
</span><span id="__span-103-12"><a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="nd">@GET</span>
</span><span id="__span-103-13"><a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/randomfighters&quot;</span><span class="p">)</span>
</span><span id="__span-103-14"><a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a><span class="nd">@Timeout</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="w"> </span><span class="c1">// &lt;-- Added</span>
</span><span id="__span-103-15"><a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a><span class="kd">public</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nf">getRandomFighters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-16"><a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a><span class="w">    </span><span class="n">veryLongProcess</span><span class="p">();</span><span class="w"> </span><span class="c1">// &lt;-- Added</span>
</span><span id="__span-103-17"><a id="__codelineno-103-17" name="__codelineno-103-17" href="#__codelineno-103-17"></a><span class="w">    </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">findRandomFighters</span><span class="p">();</span>
</span><span id="__span-103-18"><a id="__codelineno-103-18" name="__codelineno-103-18" href="#__codelineno-103-18"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Get random fighters &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fighters</span><span class="p">);</span>
</span><span id="__span-103-19"><a id="__codelineno-103-19" name="__codelineno-103-19" href="#__codelineno-103-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">fighters</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-103-20"><a id="__codelineno-103-20" name="__codelineno-103-20" href="#__codelineno-103-20"></a><span class="p">}</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Don’t forget to add the following import:</p><div><pre><code data-lang="java">import org.eclipse.microprofile.config.inject.ConfigProperty;
import org.eclipse.microprofile.faulttolerance.Timeout;</code></pre></div></td></tr></tbody></table>

<p>Let’s say we’ve added some new functionality in the <code>veryLongProcess</code> method. When the process is really too long and the system is overloaded, we would rather time out.</p>
<p>Note that the timeout was configured to 500 ms, and a <code>Thread.sleep</code> was introduced and can be configured in the <code>application.properties</code>. If we set the property to a higher value than the timeout, let’s say 10.000, then the request should be interrupted.</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="na">process.milliseconds</span><span class="o">=</span><span class="s">10000</span>
</span></code></pre></div>
<h4 id="running-the-application_2">Running the Application</h4>
<p>Now that you have set the number of waiting milliseconds to 10.000, run the application and start fighting again. You should see the following:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>18:40:48 ERROR [or.jb.re.re.co.co.AbstractResteasyReactiveContext] (executor-thread-0) Request failed: org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException: Timeout[io.quarkus.workshop.superheroes.fight.FightResource#getRandomFighters] timed out
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>        at io.smallrye.faulttolerance.core.timeout.Timeout.timeoutException(Timeout.java:91)
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a>        at io.smallrye.faulttolerance.core.timeout.Timeout.doApply(Timeout.java:78)
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>        at io.smallrye.faulttolerance.core.timeout.Timeout.apply(Timeout.java:30)
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a>...
</span></code></pre></div>
<p>Before going further, set the <code>process.milliseconds</code> to 0.</p>
<h2 id="contract-testing">Contract testing</h2>
<hr />
<p>Let’s look at what we’ve done so far. We have been doing some (some) test-driven development, we have several microservices, and they’re even talking to each other. We have fault tolerance for when services go down.</p>
<p>Clearly, we have an invincible application. Right? Right?</p>
<p>In your IDE, have a look to see how many instances of a class called <code>Hero</code> you have. There should be two. This is by design; one for the consumer of the service, and one for the provider.</p>
<p>The two classes are different, with the provider class having a lot more code in it. However, the fields in the two classes should be roughly the same.</p>
<p>What happens if we do some refactoring?</p>
<p>In the <code>rest-heroes</code> project, let’s do some searching and replacing. (We do search and replace so we catch both Java and SQL in our refactoring.) Change "level" to "maturity". Make sure to only do search within the rest-heroes directory. (Normally this project would be in its own repository, but we’ve grouped everything together into one repository for convenience.)</p>
<p>Check all of your tests. The heroes, villains, and fights tests should all be running clean. A successful refactoring!</p>
<p>Now visit the UI at <a href="http://localhost:8080/">http://localhost:8080/</a>. What’s going on? The hero’s level is always 0. Why didn’t the tests catch this?</p>
<p>Although we changed the provider of an API, no one told the consumer that the API had changed. The unit tests were (correctly) isolated in scope, so they didn’t catch the cross-service misunderstanding.</p>
<p>Feel free to reverse the change now, rather than patching up the service consumer.</p>
<p>This was a slightly contrived example, but uncaught API changes are a common cause of breaks, especially early in project development, before APIs have been locked down. Tools like OpenAPI validation can catch syntax changes, but they will not catch semantic changes. (What if we’d changed the level to be normalised against the best fighter, or count down from 100?)</p>
<p>This is where contract testing comes in. Contract testing is a lightweight way of validating that a service’s consumer and provider have the same understanding about what the service does.</p>
<p>There are several contract testing tools available. The Red Hat App Development Consulting team have an <a href="https://appdev.consulting.redhat.com/tracks/contract-first/">excellent tutorial</a> describing contract first development and a polyglot OpenAPI-based stack for contract testing.</p>
<p>We will be using an all-in-one tool called <a href="https://docs.pact.io/">Pact</a>, which is also polyglot, and enables consumer-driven contract testing. The Pact team have <a href="https://pactflow.io/blog/contract-testing-using-json-schemas-and-open-api-part-1/">a good overview</a> of the advantages and disadvantages of schema-based testing (such as validation based on an OpenAPI spec) and consumer-driven contract testing.</p>
<h3 id="consumer-tests">Consumer tests</h3>
<p>Pact is a consumer-driven contract testing framework, which means that we begin by writing tests for the API consumer.</p>
<h4 id="writing-the-first-contract-test">Writing the first contract test</h4>
<p>Add the Pact Quarkus extension to the <code>pom.xml</code> of the Fights service:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>io.quarkiverse.pact<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>quarkus-pact-consumer<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>1.3.0<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="w">    </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>The Pact framework will stand up a server which listens on a port. To avoid port conflicts between the real services and the Pact stubs, let’s use a different port for the contract instances. Open the fight service’s <code>application.properties</code> and add the following</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="na">%test.quarkus.rest-client.hero.url</span><span class="o">=</span><span class="s">http://localhost:8093</span>
</span></code></pre></div>
<p>The <code>%test</code> scopes the updated property to only apply in the test mode.</p>
<p>Create a class called <code>FightResourceConsumerTest.java</code>.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight</span><span class="p">;</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">au.com.dius.pact.consumer.dsl.PactDslWithProvider</span><span class="p">;</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">au.com.dius.pact.consumer.junit5.PactConsumerTestExt</span><span class="p">;</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">au.com.dius.pact.consumer.junit5.PactTestFor</span><span class="p">;</span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">au.com.dius.pact.core.model.PactSpecVersion</span><span class="p">;</span>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">au.com.dius.pact.core.model.V4Pact</span><span class="p">;</span>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">au.com.dius.pact.core.model.annotations.Pact</span><span class="p">;</span>
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.junit.QuarkusTest</span><span class="p">;</span>
</span><span id="__span-108-10"><a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.DefaultTestHero</span><span class="p">;</span>
</span><span id="__span-108-11"><a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.DefaultTestVillain</span><span class="p">;</span>
</span><span id="__span-108-12"><a id="__codelineno-108-12" name="__codelineno-108-12" href="#__codelineno-108-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.Hero</span><span class="p">;</span>
</span><span id="__span-108-13"><a id="__codelineno-108-13" name="__codelineno-108-13" href="#__codelineno-108-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client.Villain</span><span class="p">;</span>
</span><span id="__span-108-14"><a id="__codelineno-108-14" name="__codelineno-108-14" href="#__codelineno-108-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
</span><span id="__span-108-15"><a id="__codelineno-108-15" name="__codelineno-108-15" href="#__codelineno-108-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.extension.ExtendWith</span><span class="p">;</span>
</span><span id="__span-108-16"><a id="__codelineno-108-16" name="__codelineno-108-16" href="#__codelineno-108-16"></a>
</span><span id="__span-108-17"><a id="__codelineno-108-17" name="__codelineno-108-17" href="#__codelineno-108-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.HttpMethod</span><span class="p">;</span>
</span><span id="__span-108-18"><a id="__codelineno-108-18" name="__codelineno-108-18" href="#__codelineno-108-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders</span><span class="p">;</span>
</span><span id="__span-108-19"><a id="__codelineno-108-19" name="__codelineno-108-19" href="#__codelineno-108-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-108-20"><a id="__codelineno-108-20" name="__codelineno-108-20" href="#__codelineno-108-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response</span><span class="p">;</span>
</span><span id="__span-108-21"><a id="__codelineno-108-21" name="__codelineno-108-21" href="#__codelineno-108-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status</span><span class="p">;</span>
</span><span id="__span-108-22"><a id="__codelineno-108-22" name="__codelineno-108-22" href="#__codelineno-108-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
</span><span id="__span-108-23"><a id="__codelineno-108-23" name="__codelineno-108-23" href="#__codelineno-108-23"></a>
</span><span id="__span-108-24"><a id="__codelineno-108-24" name="__codelineno-108-24" href="#__codelineno-108-24"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">au.com.dius.pact.consumer.dsl.LambdaDsl.newJsonBody</span><span class="p">;</span>
</span><span id="__span-108-25"><a id="__codelineno-108-25" name="__codelineno-108-25" href="#__codelineno-108-25"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.given</span><span class="p">;</span>
</span><span id="__span-108-26"><a id="__codelineno-108-26" name="__codelineno-108-26" href="#__codelineno-108-26"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-108-27"><a id="__codelineno-108-27" name="__codelineno-108-27" href="#__codelineno-108-27"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.OK</span><span class="p">;</span>
</span><span id="__span-108-28"><a id="__codelineno-108-28" name="__codelineno-108-28" href="#__codelineno-108-28"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span><span class="p">;</span>
</span><span id="__span-108-29"><a id="__codelineno-108-29" name="__codelineno-108-29" href="#__codelineno-108-29"></a>
</span><span id="__span-108-30"><a id="__codelineno-108-30" name="__codelineno-108-30" href="#__codelineno-108-30"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-108-31"><a id="__codelineno-108-31" name="__codelineno-108-31" href="#__codelineno-108-31"></a><span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">PactConsumerTestExt</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-108-32"><a id="__codelineno-108-32" name="__codelineno-108-32" href="#__codelineno-108-32"></a><span class="nd">@PactTestFor</span><span class="p">(</span>
</span><span id="__span-108-33"><a id="__codelineno-108-33" name="__codelineno-108-33" href="#__codelineno-108-33"></a><span class="w">    </span><span class="n">providerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rest-heroes&quot;</span><span class="p">,</span>
</span><span id="__span-108-34"><a id="__codelineno-108-34" name="__codelineno-108-34" href="#__codelineno-108-34"></a><span class="w">    </span><span class="n">pactVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PactSpecVersion</span><span class="p">.</span><span class="na">V4</span><span class="p">,</span>
</span><span id="__span-108-35"><a id="__codelineno-108-35" name="__codelineno-108-35" href="#__codelineno-108-35"></a><span class="w">    </span><span class="n">hostInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">,</span>
</span><span id="__span-108-36"><a id="__codelineno-108-36" name="__codelineno-108-36" href="#__codelineno-108-36"></a><span class="w">    </span><span class="c1">// Hard-code the Pact MockServer to what we defined in application.properties</span>
</span><span id="__span-108-37"><a id="__codelineno-108-37" name="__codelineno-108-37" href="#__codelineno-108-37"></a><span class="w">    </span><span class="c1">// I don&#39;t like it but couldn&#39;t figure out any other way without using dynamic config</span>
</span><span id="__span-108-38"><a id="__codelineno-108-38" name="__codelineno-108-38" href="#__codelineno-108-38"></a><span class="w">    </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;8093&quot;</span>
</span><span id="__span-108-39"><a id="__codelineno-108-39" name="__codelineno-108-39" href="#__codelineno-108-39"></a><span class="p">)</span>
</span><span id="__span-108-40"><a id="__codelineno-108-40" name="__codelineno-108-40" href="#__codelineno-108-40"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FightResourceConsumerTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-41"><a id="__codelineno-108-41" name="__codelineno-108-41" href="#__codelineno-108-41"></a>
</span><span id="__span-108-42"><a id="__codelineno-108-42" name="__codelineno-108-42" href="#__codelineno-108-42"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">HERO_API_BASE_URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/api/heroes&quot;</span><span class="p">;</span>
</span><span id="__span-108-43"><a id="__codelineno-108-43" name="__codelineno-108-43" href="#__codelineno-108-43"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">HERO_RANDOM_URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HERO_API_BASE_URI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/random&quot;</span><span class="p">;</span>
</span><span id="__span-108-44"><a id="__codelineno-108-44" name="__codelineno-108-44" href="#__codelineno-108-44"></a>
</span><span id="__span-108-45"><a id="__codelineno-108-45" name="__codelineno-108-45" href="#__codelineno-108-45"></a><span class="w">    </span><span class="nd">@Pact</span><span class="p">(</span><span class="n">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rest-fights&quot;</span><span class="p">)</span>
</span><span id="__span-108-46"><a id="__codelineno-108-46" name="__codelineno-108-46" href="#__codelineno-108-46"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">V4Pact</span><span class="w"> </span><span class="nf">randomHeroFoundPact</span><span class="p">(</span><span class="n">PactDslWithProvider</span><span class="w"> </span><span class="n">builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-47"><a id="__codelineno-108-47" name="__codelineno-108-47" href="#__codelineno-108-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span>
</span><span id="__span-108-48"><a id="__codelineno-108-48" name="__codelineno-108-48" href="#__codelineno-108-48"></a><span class="w">            </span><span class="p">.</span><span class="na">uponReceiving</span><span class="p">(</span><span class="s">&quot;A request for a random hero&quot;</span><span class="p">)</span>
</span><span id="__span-108-49"><a id="__codelineno-108-49" name="__codelineno-108-49" href="#__codelineno-108-49"></a><span class="w">            </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="n">HERO_RANDOM_URI</span><span class="p">)</span>
</span><span id="__span-108-50"><a id="__codelineno-108-50" name="__codelineno-108-50" href="#__codelineno-108-50"></a><span class="w">            </span><span class="p">.</span><span class="na">method</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
</span><span id="__span-108-51"><a id="__codelineno-108-51" name="__codelineno-108-51" href="#__codelineno-108-51"></a><span class="w">            </span><span class="p">.</span><span class="na">headers</span><span class="p">(</span><span class="n">HttpHeaders</span><span class="p">.</span><span class="na">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-108-52"><a id="__codelineno-108-52" name="__codelineno-108-52" href="#__codelineno-108-52"></a><span class="w">            </span><span class="p">.</span><span class="na">willRespondWith</span><span class="p">()</span>
</span><span id="__span-108-53"><a id="__codelineno-108-53" name="__codelineno-108-53" href="#__codelineno-108-53"></a><span class="w">            </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="na">Status</span><span class="p">.</span><span class="na">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-108-54"><a id="__codelineno-108-54" name="__codelineno-108-54" href="#__codelineno-108-54"></a><span class="w">            </span><span class="p">.</span><span class="na">headers</span><span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">HttpHeaders</span><span class="p">.</span><span class="na">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">))</span>
</span><span id="__span-108-55"><a id="__codelineno-108-55" name="__codelineno-108-55" href="#__codelineno-108-55"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">newJsonBody</span><span class="p">(</span><span class="n">body</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-108-56"><a id="__codelineno-108-56" name="__codelineno-108-56" href="#__codelineno-108-56"></a><span class="w">                    </span><span class="n">body</span>
</span><span id="__span-108-57"><a id="__codelineno-108-57" name="__codelineno-108-57" href="#__codelineno-108-57"></a><span class="w">                        </span><span class="p">.</span><span class="na">stringType</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_NAME</span><span class="p">)</span>
</span><span id="__span-108-58"><a id="__codelineno-108-58" name="__codelineno-108-58" href="#__codelineno-108-58"></a><span class="w">                        </span><span class="p">.</span><span class="na">integerType</span><span class="p">(</span><span class="s">&quot;level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_LEVEL</span><span class="p">)</span>
</span><span id="__span-108-59"><a id="__codelineno-108-59" name="__codelineno-108-59" href="#__codelineno-108-59"></a><span class="w">                        </span><span class="p">.</span><span class="na">stringType</span><span class="p">(</span><span class="s">&quot;picture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_PICTURE</span><span class="p">)</span>
</span><span id="__span-108-60"><a id="__codelineno-108-60" name="__codelineno-108-60" href="#__codelineno-108-60"></a><span class="w">                </span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
</span><span id="__span-108-61"><a id="__codelineno-108-61" name="__codelineno-108-61" href="#__codelineno-108-61"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-108-62"><a id="__codelineno-108-62" name="__codelineno-108-62" href="#__codelineno-108-62"></a><span class="w">            </span><span class="p">.</span><span class="na">toPact</span><span class="p">(</span><span class="n">V4Pact</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-108-63"><a id="__codelineno-108-63" name="__codelineno-108-63" href="#__codelineno-108-63"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-64"><a id="__codelineno-108-64" name="__codelineno-108-64" href="#__codelineno-108-64"></a>
</span><span id="__span-108-65"><a id="__codelineno-108-65" name="__codelineno-108-65" href="#__codelineno-108-65"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-108-66"><a id="__codelineno-108-66" name="__codelineno-108-66" href="#__codelineno-108-66"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">randomHeroFound</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-67"><a id="__codelineno-108-67" name="__codelineno-108-67" href="#__codelineno-108-67"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-108-68"><a id="__codelineno-108-68" name="__codelineno-108-68" href="#__codelineno-108-68"></a><span class="p">}</span>
</span></code></pre></div>
<p>Here we are setting up a test to run with Pact and telling Pact what ports it should stand up the mock server on. We also define how the mock should behave.</p>
<p>Run the build, using <code>./mvnw verify</code> or <code>./mvnw quarkus:dev</code>. You should see a failure. What’s happened? The <code>randomHeroFound</code> test didn’t have any assertions, so how could there be a failure? Pact is doing some validation for us. We have defined a mock, but nothing is exercising it. That might mean our code doesn’t do what we think it does, so Pact flags it as an error.</p>
<p>Let’s fill in the dummy test method with something more substantial. Replace the <code>randomHeroFound</code> test with the following. You’ll notice this is very similar to the one in <code>FightResourceTest</code>; you could even copy and paste from that class.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="nd">@Test</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="nd">@PactTestFor</span><span class="p">(</span><span class="n">pactMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;randomHeroFoundPact&quot;</span><span class="p">)</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">randomHeroFound</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="w">    </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w">        </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w">        </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/fights/randomfighters&quot;</span><span class="p">)</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w">        </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w">        </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-109-9"><a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="w">        </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-109-10"><a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a><span class="w">        </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-109-11"><a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="w">        </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">Fighters</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-109-12"><a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a>
</span><span id="__span-109-13"><a id="__codelineno-109-13" name="__codelineno-109-13" href="#__codelineno-109-13"></a><span class="w">    </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">;</span>
</span><span id="__span-109-14"><a id="__codelineno-109-14" name="__codelineno-109-14" href="#__codelineno-109-14"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_NAME</span><span class="p">);</span>
</span><span id="__span-109-15"><a id="__codelineno-109-15" name="__codelineno-109-15" href="#__codelineno-109-15"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_PICTURE</span><span class="p">);</span>
</span><span id="__span-109-16"><a id="__codelineno-109-16" name="__codelineno-109-16" href="#__codelineno-109-16"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestHero</span><span class="p">.</span><span class="na">DEFAULT_HERO_LEVEL</span><span class="p">);</span>
</span><span id="__span-109-17"><a id="__codelineno-109-17" name="__codelineno-109-17" href="#__codelineno-109-17"></a>
</span><span id="__span-109-18"><a id="__codelineno-109-18" name="__codelineno-109-18" href="#__codelineno-109-18"></a><span class="w">    </span><span class="c1">// We&#39;re really trying to test the fighter, so we want to make sure it still passes back</span>
</span><span id="__span-109-19"><a id="__codelineno-109-19" name="__codelineno-109-19" href="#__codelineno-109-19"></a><span class="w">    </span><span class="c1">// a villain</span>
</span><span id="__span-109-20"><a id="__codelineno-109-20" name="__codelineno-109-20" href="#__codelineno-109-20"></a><span class="w">    </span><span class="n">Villain</span><span class="w"> </span><span class="n">villain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">villain</span><span class="p">;</span>
</span><span id="__span-109-21"><a id="__codelineno-109-21" name="__codelineno-109-21" href="#__codelineno-109-21"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">DEFAULT_VILLAIN_NAME</span><span class="p">);</span>
</span><span id="__span-109-22"><a id="__codelineno-109-22" name="__codelineno-109-22" href="#__codelineno-109-22"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">picture</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">DEFAULT_VILLAIN_PICTURE</span><span class="p">);</span>
</span><span id="__span-109-23"><a id="__codelineno-109-23" name="__codelineno-109-23" href="#__codelineno-109-23"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">villain</span><span class="p">.</span><span class="na">level</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultTestVillain</span><span class="p">.</span><span class="na">DEFAULT_VILLAIN_LEVEL</span><span class="p">);</span>
</span><span id="__span-109-24"><a id="__codelineno-109-24" name="__codelineno-109-24" href="#__codelineno-109-24"></a><span class="p">}</span>
</span></code></pre></div>
<p>Run the tests. They should all pass.</p>
<p>Note that we’re only setting up contracts for heroes here. If we were to make contracts for getting villains, the test would fail. Can you think why that might be?</p>
<table><tbody><tr><td><i title="Tip"></i></td><td><p>When we use Pact, the Pact framework stands up a server which acts as a mock. Remember that we defined a global <code>@Mock</code> for the <code>VillainProxy</code>. Because <code>@Mocks</code> are global, that mock would be used instead of the Pact mock service we want the class under test to be talking to. This is an example of why a local <code>@InjectMock</code> is often preferable to a global <code>@Mock</code>.</p></td></tr></tbody></table>

<h4 id="the-contract">The contract</h4>
<p>Look in <code>target/pacts</code>. You should find a json contract, <code>rest-fights-rest-heroes.json</code>. Inspect it to see how the contents of the <code>@Pact</code> method have been turned into json.</p>
<p>What we want to be testing when we use Pact in our tests is the behaviour of our own code. Here, although we check the value of the hero fields, we’re trying to make sure that the <strong>fights service</strong> is doing the right thing. Our expectation for the fights service is pretty low: it just has to pass through what it gets from the heroes service.</p>
<table><tbody><tr><td><i title="Warning"></i></td><td><p>This test is just on the edge of falling into a common Pact anti-pattern, testing the mock. We do <strong>not</strong> need to do detailed validation of what comes back from the pact server, because it’s a mock that we define.</p></td></tr></tbody></table>

<p>A more interesting contract test would exercise some of the more complex fights functionality, while using the mock we’ve defined. Can you write one? (You might also need to define a villain pact.)</p>
<p>If you get stuck, you can look at the consumer contract tests in the <a href="https://raw.githubusercontent.com/quarkusio/quarkus-workshops/refs/heads/main/quarkus-workshop-super-heroes/super-heroes/rest-fights/src/test/java/io/quarkus/workshop/superheroes/fight/FightResourceConsumerTest.java">source repo</a> for inspiration.</p>
<h3 id="provider-tests">Provider tests</h3>
<p>So far, we’ve done good work and set up tests for the fight service, to extend our testing of the fight service, and also encode its expectations for the hero service into a json contract.</p>
<p>The next step is to make sure the Hero service actually produces what the contract says it should!</p>
<h4 id="sharing-the-contract">Sharing the contract</h4>
<p>There are a few possibilities for sharing the contract. A self-hosted or <a href="https://pactflow.io/">managed</a> <a href="https://docs.pact.io/getting_started/sharing_pacts">pact broker</a> can host all of the contracts, as well as providing extra services such as metrics about when tests were run and compatibility dashboards.</p>
<p>Alternatively, some teams check the json contract into the provider’s source control after a successful run. Note that Pact is consumer-driven contract system; the consumer has responsibility for defining the contract, and therefore also has responsibility for sharing it.</p>
<p>The simplest sharing mechanism is copying on a filesystem, so that’s what we’ll do. From the fights service, copy the contract to the heroes service.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>mkdir -p ../rest-heroes/src/test/resources
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>cp -r target/pacts ../rest-heroes/src/test/resources
</span></code></pre></div>
<h4 id="writing-the-test">Writing the test</h4>
<p>The great thing about the provider Pact tests is that the provider doesn’t have to do much. The Pact framework will generate a test for each expectation in the contract and run them, based on just a small amount of boilerplate code:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="nd">@TestTemplate</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">PactVerificationInvocationContextProvider</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">pactVerificationTestTemplate</span><span class="p">(</span><span class="n">PactVerificationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="w">    </span><span class="n">context</span><span class="p">.</span><span class="na">verifyInteraction</span><span class="p">();</span>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>(No need to put that snippet anywhere yet, we will see how it fits into a test class in a moment.)</p>
<p>Add the Pact dependency to the heroes service <code>pom.xml</code>:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>io.quarkiverse.pact<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>quarkus-pact-provider<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>1.3.0<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">    </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>quarkus-panache-mock<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="w">    </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>We also add the <a href="https://quarkus.io/guides/hibernate-orm-panache#mocking">Panache Mock dependency</a>, which allows us to which allows use Mockito to mock all provided static methods. That will come in handy at various points in the provider testing.</p>
<p>Create a <code>io/quarkus/workshop/superheroes/hero/HeroContractVerificationTest.java</code> class in the <code>rest-heroes</code> project. It doesn’t need to do much except tell Pact what port the Hero provider is listening on, and create a JUnit test template, which will be expanded into the full set of tests needed to verify the contract.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="nd">@Provider</span><span class="p">(</span><span class="s">&quot;rest-heroes&quot;</span><span class="p">)</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="nd">@PactFolder</span><span class="p">(</span><span class="s">&quot;pacts&quot;</span><span class="p">)</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HeroContractVerificationTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">    </span><span class="nd">@ConfigProperty</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;quarkus.http.test-port&quot;</span><span class="p">)</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">quarkusPort</span><span class="p">;</span>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="w">    </span><span class="nd">@BeforeEach</span>
</span><span id="__span-113-10"><a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">beforeEach</span><span class="p">(</span><span class="n">PactVerificationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-11"><a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">setTarget</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HttpTestTarget</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">quarkusPort</span><span class="p">));</span>
</span><span id="__span-113-12"><a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-113-13"><a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a>
</span><span id="__span-113-14"><a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a><span class="w">    </span><span class="nd">@TestTemplate</span>
</span><span id="__span-113-15"><a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">    </span><span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">PactVerificationInvocationContextProvider</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</span><span id="__span-113-16"><a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">pactVerificationTestTemplate</span><span class="p">(</span><span class="n">PactVerificationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-17"><a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">verifyInteraction</span><span class="p">();</span>
</span><span id="__span-113-18"><a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-113-19"><a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="p">}</span>
</span></code></pre></div>
<p>When you run the tests they should pass.</p>
<h3 id="states">States</h3>
<p>One of the advantages of Pact over simpler contract verification methods, such as OpenAPI syntax-checking, is that a pact can include a range of expected responses, depending on what was passed in, and external state.</p>
<p>This allows for a richer set of checks. For example, it can exercise more interesting logic on the consumer side, and it can act as a proper functional test for the provider.</p>
<p>Let’s exercise some error-handling. What happens if no heroes can be found? In that case, we expect that the heroes server will return a 404. Let’s get that into the contract, and exercise the fight service’s error handling.</p>
<p>Add a new pact. We use the <code>given()</code> to identify the state.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="nd">@Pact</span><span class="p">(</span><span class="n">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rest-fights&quot;</span><span class="p">)</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">V4Pact</span><span class="w"> </span><span class="nf">randomHeroNotFoundPact</span><span class="p">(</span><span class="n">PactDslWithProvider</span><span class="w"> </span><span class="n">builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">builder</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="w">        </span><span class="p">.</span><span class="na">given</span><span class="p">(</span><span class="s">&quot;No random hero found&quot;</span><span class="p">)</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="w">        </span><span class="p">.</span><span class="na">uponReceiving</span><span class="p">(</span><span class="s">&quot;A request for a random hero&quot;</span><span class="p">)</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="w">        </span><span class="p">.</span><span class="na">path</span><span class="p">(</span><span class="n">HERO_RANDOM_URI</span><span class="p">)</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="w">        </span><span class="p">.</span><span class="na">method</span><span class="p">(</span><span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="w">        </span><span class="p">.</span><span class="na">headers</span><span class="p">(</span><span class="n">HttpHeaders</span><span class="p">.</span><span class="na">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">        </span><span class="p">.</span><span class="na">willRespondWith</span><span class="p">()</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="w">        </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">Status</span><span class="p">.</span><span class="na">NOT_FOUND</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">        </span><span class="p">.</span><span class="na">toPact</span><span class="p">(</span><span class="n">V4Pact</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, we can define another test method, which exercises our service, given this unhappy state. If the hero service returns 404, we want to check that the fallback instances we defined earlier are used. We also want to check that things work as normal for the villain part of the response.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="nd">@Test</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="nd">@PactTestFor</span><span class="p">(</span><span class="n">pactMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;randomHeroNotFoundPact&quot;</span><span class="p">)</span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">shouldGetRandomFighters</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="w">    </span><span class="n">Fighters</span><span class="w"> </span><span class="n">fighters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">        </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="w">        </span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/fights/randomfighters&quot;</span><span class="p">)</span>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="w">        </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a><span class="w">        </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">        </span><span class="p">.</span><span class="na">contentType</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="w">        </span><span class="p">.</span><span class="na">extract</span><span class="p">()</span>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="w">        </span><span class="p">.</span><span class="na">as</span><span class="p">(</span><span class="n">Fighters</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a>
</span><span id="__span-115-13"><a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="w">    </span><span class="n">Hero</span><span class="w"> </span><span class="n">hero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fighters</span><span class="p">.</span><span class="na">hero</span><span class="p">;</span>
</span><span id="__span-115-14"><a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a>
</span><span id="__span-115-15"><a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fallback hero&quot;</span><span class="p">);</span>
</span><span id="__span-115-16"><a id="__codelineno-115-16" name="__codelineno-115-16" href="#__codelineno-115-16"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">picture</span><span class="p">,</span>
</span><span id="__span-115-17"><a id="__codelineno-115-17" name="__codelineno-115-17" href="#__codelineno-115-17"></a><span class="w">        </span><span class="s">&quot;https://dummyimage.com/240x320/1e8fff/ffffff&amp;amp;text=Fallback+Hero&quot;</span><span class="p">);</span>
</span><span id="__span-115-18"><a id="__codelineno-115-18" name="__codelineno-115-18" href="#__codelineno-115-18"></a><span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="na">level</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-115-19"><a id="__codelineno-115-19" name="__codelineno-115-19" href="#__codelineno-115-19"></a><span class="p">}</span>
</span></code></pre></div>
<p>Run the tests. They should pass. Then copy them to the hero service, using <code>cp -r target/pacts ../rest-heroes/src/test/resources</code>. In the hero service, the tests will fail, because we haven’t told Pact how to handle the new state.</p>
<p>We would normally do that with a <code>@State</code> annotation. However, for boring JUnit classloading reasons, we don’t have access to the CDI context in the <code>@State</code> method, so we’ll work around it by handling the state in the <code>@BeforeEach</code>.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">NO_HERO_FOUND_STATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;No random hero found&quot;</span><span class="p">;</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="nd">@BeforeEach</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">beforeEach</span><span class="p">(</span><span class="n">PactVerificationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="w">    </span><span class="n">context</span><span class="p">.</span><span class="na">setTarget</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HttpTestTarget</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">quarkusPort</span><span class="p">));</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="w">    </span><span class="c1">// We have to do this here because the CDI context isn&#39;t available</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="w">    </span><span class="c1">// in the @State method below</span>
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">noHeroState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getInteraction</span><span class="p">()</span>
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="w">                                                 </span><span class="p">.</span><span class="na">getProviderStates</span><span class="p">())</span>
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a><span class="w">                              </span><span class="p">.</span><span class="na">orElseGet</span><span class="p">(</span><span class="n">List</span><span class="p">::</span><span class="n">of</span><span class="p">)</span>
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a><span class="w">                              </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
</span><span id="__span-116-13"><a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a><span class="w">                              </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span>
</span><span id="__span-116-14"><a id="__codelineno-116-14" name="__codelineno-116-14" href="#__codelineno-116-14"></a><span class="w">                                  </span><span class="n">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">NO_HERO_FOUND_STATE</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">getName</span><span class="p">()))</span>
</span><span id="__span-116-15"><a id="__codelineno-116-15" name="__codelineno-116-15" href="#__codelineno-116-15"></a><span class="w">                              </span><span class="p">.</span><span class="na">count</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-116-16"><a id="__codelineno-116-16" name="__codelineno-116-16" href="#__codelineno-116-16"></a>
</span><span id="__span-116-17"><a id="__codelineno-116-17" name="__codelineno-116-17" href="#__codelineno-116-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">noHeroState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-18"><a id="__codelineno-116-18" name="__codelineno-116-18" href="#__codelineno-116-18"></a><span class="w">        </span><span class="n">PanacheMock</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">Hero</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-116-19"><a id="__codelineno-116-19" name="__codelineno-116-19" href="#__codelineno-116-19"></a><span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">Hero</span><span class="p">.</span><span class="na">findRandom</span><span class="p">()).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Uni</span><span class="p">.</span><span class="na">createFrom</span><span class="p">()</span>
</span><span id="__span-116-20"><a id="__codelineno-116-20" name="__codelineno-116-20" href="#__codelineno-116-20"></a><span class="w">                                              </span><span class="p">.</span><span class="na">nullItem</span><span class="p">());</span>
</span><span id="__span-116-21"><a id="__codelineno-116-21" name="__codelineno-116-21" href="#__codelineno-116-21"></a>
</span><span id="__span-116-22"><a id="__codelineno-116-22" name="__codelineno-116-22" href="#__codelineno-116-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-116-23"><a id="__codelineno-116-23" name="__codelineno-116-23" href="#__codelineno-116-23"></a><span class="p">}</span>
</span><span id="__span-116-24"><a id="__codelineno-116-24" name="__codelineno-116-24" href="#__codelineno-116-24"></a>
</span><span id="__span-116-25"><a id="__codelineno-116-25" name="__codelineno-116-25" href="#__codelineno-116-25"></a>
</span><span id="__span-116-26"><a id="__codelineno-116-26" name="__codelineno-116-26" href="#__codelineno-116-26"></a><span class="nd">@State</span><span class="p">(</span><span class="n">NO_HERO_FOUND_STATE</span><span class="p">)</span>
</span><span id="__span-116-27"><a id="__codelineno-116-27" name="__codelineno-116-27" href="#__codelineno-116-27"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">clearData</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">NoSuchMethodException</span><span class="p">,</span><span class="w"> </span><span class="n">InvocationTargetException</span><span class="p">,</span>
</span><span id="__span-116-28"><a id="__codelineno-116-28" name="__codelineno-116-28" href="#__codelineno-116-28"></a><span class="w">    </span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-29"><a id="__codelineno-116-29" name="__codelineno-116-29" href="#__codelineno-116-29"></a><span class="w">    </span><span class="c1">// Already handled in beforeEach</span>
</span><span id="__span-116-30"><a id="__codelineno-116-30" name="__codelineno-116-30" href="#__codelineno-116-30"></a><span class="w">    </span><span class="c1">// See https://github.com/quarkusio/quarkus/issues/22611</span>
</span><span id="__span-116-31"><a id="__codelineno-116-31" name="__codelineno-116-31" href="#__codelineno-116-31"></a><span class="p">}</span>
</span></code></pre></div>
<p>What’s going on? The consumer expects a 404 if there are no heroes, but the provider is returning a 204. The reasoning from the consumer is that if a caller asks for a resource the server doesn’t have, it should be a 404, the same way if a user types in an invalid URL into the browser. This is a more pure interpretation of REST than what was inplemented by the <code>HeroResource</code>.</p>
<p>There are arguments for both 404 (not found) and 204 (no content). Feel free to debate with your neighbour about which you prefer – but it doesn’t really matter which is correct. What matters is that the provider and consumer had different preferences. If the provider returns 204 rather than 404, the fallback logic on the provider (as implemented) is not triggered. (You can try this out for yourself by changing the contract in the <code>FightResourceConsumerTest</code>.)</p>
<p>At this point, the consumer and provider need to have a conversation to decide whether the expectations or implementation should be updated. To make the fallback logic simplest, we will update the provider. Edit the <code>HeroResource</code> and update the <code>getRandomHero</code> method to explicitly handle the null case.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Returns a random hero&quot;</span><span class="p">)</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="nd">@GET</span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/random&quot;</span><span class="p">)</span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="nd">@APIResponse</span><span class="p">(</span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;200&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Content</span><span class="p">(</span><span class="n">mediaType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Schema</span><span class="p">(</span><span class="n">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)))</span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="kd">public</span><span class="w"> </span><span class="n">Uni</span><span class="o">&lt;</span><span class="n">RestResponse</span><span class="o">&lt;</span><span class="n">Hero</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">getRandomHero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Hero</span><span class="p">.</span><span class="na">findRandom</span><span class="p">()</span>
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="w">        </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">ifNotNull</span><span class="p">().</span><span class="na">transform</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-8"><a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="p">.</span><span class="na">debugf</span><span class="p">(</span><span class="s">&quot;Found random hero: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">);</span>
</span><span id="__span-117-9"><a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span id="__span-117-10"><a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-117-11"><a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a><span class="w">        </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">ifNull</span><span class="p">().</span><span class="na">continueWith</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-12"><a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;No random villain found&quot;</span><span class="p">);</span>
</span><span id="__span-117-13"><a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">RestResponse</span><span class="p">.</span><span class="na">notFound</span><span class="p">();</span>
</span><span id="__span-117-14"><a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-117-15"><a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a><span class="p">}</span>
</span></code></pre></div>
<p>The tests should now pass.</p>
<h2 id="artificial-intelligence">Artificial Intelligence</h2>
<hr />
<p>On one side we have superheroes, and on the other side we have super villains. What happens when they fight? Let’s ask an AI to narrate the fight!</p>
<p>In this section we will introduce a new microservice that will use AI to narrate the fight between a superhero and a super villain. It will use the Semantic Kernel API to generate the text invoking OpenAI or Azure OpenAI (you choose).</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-fb020717f07781a3b0d3c7233671acc6.png" /></p>
<p>In the following sections, you will learn:</p>
<ul>
<li>
<p>What is Semantic Kernel?</p>
</li>
<li>
<p>How to invoke OpenAI or Azure OpenAI GPT model using Semantic Kernel</p>
</li>
<li>
<p>How to create an OpenAI Plugin (a.k.a Skill) to narrate a fight</p>
</li>
</ul>
<table><tbody><tr><td><i title="Important"></i></td><td>This service is exposed on the port 8086.</td></tr></tbody></table>

<h3 id="whats-semantic-kernel">What’s Semantic Kernel?</h3>
<p><a href="https://learn.microsoft.com/semantic-kernel/overview">Semantic Kernel</a> is an open-source SDK that lets you easily combine AI services like OpenAI, Azure OpenAI, and Hugging Face with conventional programming languages like C#, Python or Java. By doing so, you can create AI apps that combine the best of both worlds: the deterministic nature of conventional programming and the semantic aspect of AI.</p>
<p><img alt="semantic kernel" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/semantic-kernel.png" /></p>
<p>Semantic Kernel has been engineered to allow developers to flexibly integrate AI services into their existing apps. To do so, Semantic Kernel provides a set of connectors that make it easy to add memories and models. In this way, Semantic Kernel is able to add a simulated "brain" to your app.</p>
<p>Additionally, Semantic Kernel makes it easy to add skills to your applications with AI plugins that allow you to interact with the real world. These plugins are composed of prompts and native functions that can respond to triggers and perform actions. In this way, plugins are like the "body" of your AI app.</p>
<h3 id="narration-microservice">Narration Microservice</h3>
<p>Let’s create a new microservice that will use Semantic Kernel to narrate the fight between a superhero and a super villain. New microservice, new project!</p>
<p>As before, the easiest way to create this new Quarkus project is to use the Quarkus Maven plugin (you can also go to <a href="https://code.quarkus.io/">https://code.quarkus.io</a> if you prefer). Open a terminal and run the following command under the <code>quarkus-workshop-super-heroes/super-heroes</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>./mvnw<span class="w"> </span>io.quarkus:quarkus-maven-plugin:3.9.1:create<span class="w">    </span>-<span class="s2">&quot;DplatformVersion=3.9.1&quot;</span><span class="w"> </span>-<span class="s2">&quot;DprojectGroupId=io.quarkus.workshop.super-heroes&quot;</span><span class="w">   </span>-<span class="s2">&quot;DprojectArtifactId=rest-narration&quot;</span><span class="w">    </span>-DclassName<span class="o">=</span><span class="s2">&quot;io.quarkus.workshop.superheroes.narration.NarrationResource&quot;</span><span class="w">    </span>-Dpath<span class="o">=</span><span class="s2">&quot;api/narration&quot;</span><span class="w">   </span>-Dextensions<span class="o">=</span><span class="s2">&quot;resteasy-jackson,quarkus-smallrye-openapi,quarkus-smallrye-fault-tolerance&quot;</span>
</span></code></pre></div>
<p>This microservice needs less dependencies than the previous ones:</p>
<ul>
<li>
<p><code>resteasy-jackson</code> provides RESTEasy Reactive and the ability to map JSON objects,</p>
</li>
<li>
<p><code>quarkus-smallrye-openapi</code> provides the OpenAPI descriptor support and the Swagger UI in the dev console,</p>
</li>
<li>
<p><code>quarkus-smallrye-fault-tolerance</code> provides the MicroProfile Fault Tolerance dependency so we can fallback in case OpenAI/Azure OpenAI does not respond.</p>
</li>
</ul>
<p>If you want your IDE to manage this new Maven project, you can declare it in the parent POM by adding this new module in the <code>&lt;modules&gt;</code> section:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="nt">&lt;module&gt;</span>super-heroes/rest-narration<span class="nt">&lt;/module&gt;</span>
</span></code></pre></div>
<h4 id="directory-structure_7">Directory Structure</h4>
<p>At the end of this chapter, you will end up with the following directory structure (notice the <code>NarrationSkill</code> directory under <code>src/main/resources</code>):</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-8d5a4934150957500484b7319611febe.png" /></p>
<h4 id="add-the-semantic-kernel-dependencies">Add the Semantic Kernel dependencies</h4>
<p>Once the project is created, you need to add the Semantic Kernel dependencies. Semantic Kernel is available on <a href="https://central.sonatype.com/artifact/com.microsoft.semantic-kernel/semantickernel-bom">Maven Central</a>. It has a BOM (Bill of Materials) that you can import in your project and then add the dependencies you need. Add the following XML in the <code>rest-narration/pom.xml</code> file:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="w">  </span><span class="nt">&lt;properties&gt;</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="w">    </span><span class="nt">&lt;semantic-kernel.version&gt;</span>0.2.11-alpha<span class="nt">&lt;/semantic-kernel.version&gt;</span>
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="w">  </span><span class="nt">&lt;/properties&gt;</span>
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="w">  </span><span class="nt">&lt;dependencyManagement&gt;</span>
</span><span id="__span-120-6"><a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
</span><span id="__span-120-7"><a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a><span class="w">      </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-120-8"><a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a><span class="w">      </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-120-9"><a id="__codelineno-120-9" name="__codelineno-120-9" href="#__codelineno-120-9"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.microsoft.semantic-kernel<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-120-10"><a id="__codelineno-120-10" name="__codelineno-120-10" href="#__codelineno-120-10"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>semantickernel-bom<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-120-11"><a id="__codelineno-120-11" name="__codelineno-120-11" href="#__codelineno-120-11"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>${semantic-kernel.version}<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-120-12"><a id="__codelineno-120-12" name="__codelineno-120-12" href="#__codelineno-120-12"></a><span class="w">        </span><span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span><span id="__span-120-13"><a id="__codelineno-120-13" name="__codelineno-120-13" href="#__codelineno-120-13"></a><span class="w">        </span><span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-120-14"><a id="__codelineno-120-14" name="__codelineno-120-14" href="#__codelineno-120-14"></a><span class="w">      </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-120-15"><a id="__codelineno-120-15" name="__codelineno-120-15" href="#__codelineno-120-15"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
</span><span id="__span-120-16"><a id="__codelineno-120-16" name="__codelineno-120-16" href="#__codelineno-120-16"></a><span class="w">  </span><span class="nt">&lt;/dependencyManagement&gt;</span>
</span><span id="__span-120-17"><a id="__codelineno-120-17" name="__codelineno-120-17" href="#__codelineno-120-17"></a><span class="w">  </span><span class="nt">&lt;dependencies&gt;</span>
</span><span id="__span-120-18"><a id="__codelineno-120-18" name="__codelineno-120-18" href="#__codelineno-120-18"></a><span class="w">    </span><span class="cm">&lt;!-- ... --&gt;</span>
</span><span id="__span-120-19"><a id="__codelineno-120-19" name="__codelineno-120-19" href="#__codelineno-120-19"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-120-20"><a id="__codelineno-120-20" name="__codelineno-120-20" href="#__codelineno-120-20"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>com.microsoft.semantic-kernel<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-120-21"><a id="__codelineno-120-21" name="__codelineno-120-21" href="#__codelineno-120-21"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>semantickernel-core<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-120-22"><a id="__codelineno-120-22" name="__codelineno-120-22" href="#__codelineno-120-22"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-120-23"><a id="__codelineno-120-23" name="__codelineno-120-23" href="#__codelineno-120-23"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-120-24"><a id="__codelineno-120-24" name="__codelineno-120-24" href="#__codelineno-120-24"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>com.microsoft.semantic-kernel<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-120-25"><a id="__codelineno-120-25" name="__codelineno-120-25" href="#__codelineno-120-25"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>semantickernel-settings-loader<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-120-26"><a id="__codelineno-120-26" name="__codelineno-120-26" href="#__codelineno-120-26"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-120-27"><a id="__codelineno-120-27" name="__codelineno-120-27" href="#__codelineno-120-27"></a><span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-120-28"><a id="__codelineno-120-28" name="__codelineno-120-28" href="#__codelineno-120-28"></a><span class="w">      </span><span class="nt">&lt;groupId&gt;</span>com.microsoft.semantic-kernel<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-120-29"><a id="__codelineno-120-29" name="__codelineno-120-29" href="#__codelineno-120-29"></a><span class="w">      </span><span class="nt">&lt;artifactId&gt;</span>semantickernel-connectors-ai-openai<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-120-30"><a id="__codelineno-120-30" name="__codelineno-120-30" href="#__codelineno-120-30"></a><span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
</span><span id="__span-120-31"><a id="__codelineno-120-31" name="__codelineno-120-31" href="#__codelineno-120-31"></a><span class="w">  </span><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></div>
<h4 id="the-fight-bean">The Fight bean</h4>
<p>Let’s start with the <code>Fight</code> class. The fight is what is going to be narrated by the microservice and ultimately sent by the Fight microservice.</p>
<p>Create the <code>io.quarkus.workshop.superheroes.narration.Fight</code> class in the created project with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.narration</span><span class="p">;</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</span><span class="p">;</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="nd">@Schema</span><span class="p">(</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The fight that is narrated&quot;</span><span class="p">)</span>
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Fight</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a>
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerName</span><span class="p">;</span>
</span><span id="__span-121-9"><a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">winnerLevel</span><span class="p">;</span>
</span><span id="__span-121-10"><a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerPowers</span><span class="p">;</span>
</span><span id="__span-121-11"><a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserName</span><span class="p">;</span>
</span><span id="__span-121-12"><a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">loserLevel</span><span class="p">;</span>
</span><span id="__span-121-13"><a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserPowers</span><span class="p">;</span>
</span><span id="__span-121-14"><a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerTeam</span><span class="p">;</span>
</span><span id="__span-121-15"><a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserTeam</span><span class="p">;</span>
</span><span id="__span-121-16"><a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="the-narration-rest-resource">The Narration REST Resource</h4>
<p>The <code>NarrationResource</code> only has one HTTP POST method to create a new narration. Given a fight, it will invoke the <code>NarrationService</code> to return a fight narration.</p>
<p>Open the generated <code>io.quarkus.workshop.superheroes.narration.NarrationResource</code> and update the content to be:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.narration</span><span class="p">;</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.*</span><span class="p">;</span>
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response</span><span class="p">;</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.openapi.annotations.tags.Tag</span><span class="p">;</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="cm">/**</span>
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="cm"> * JAX-RS API endpoints with &lt;code&gt;/api/narration&lt;/code&gt; as the base URI for all endpoints</span>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="cm"> */</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a>
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/narration&quot;</span><span class="p">)</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="nd">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-122-16"><a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="nd">@Tag</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;narration&quot;</span><span class="p">)</span>
</span><span id="__span-122-17"><a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NarrationResource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-122-18"><a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a>
</span><span id="__span-122-19"><a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="w">    </span><span class="nd">@Inject</span>
</span><span id="__span-122-20"><a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="w">    </span><span class="n">NarrationService</span><span class="w"> </span><span class="n">service</span><span class="p">;</span>
</span><span id="__span-122-21"><a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a>
</span><span id="__span-122-22"><a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="w">    </span><span class="nd">@POST</span>
</span><span id="__span-122-23"><a id="__codelineno-122-23" name="__codelineno-122-23" href="#__codelineno-122-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nf">narrate</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-122-24"><a id="__codelineno-122-24" name="__codelineno-122-24" href="#__codelineno-122-24"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">narration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">narrate</span><span class="p">(</span><span class="n">fight</span><span class="p">);</span>
</span><span id="__span-122-25"><a id="__codelineno-122-25" name="__codelineno-122-25" href="#__codelineno-122-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="na">Status</span><span class="p">.</span><span class="na">CREATED</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">narration</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-122-26"><a id="__codelineno-122-26" name="__codelineno-122-26" href="#__codelineno-122-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-122-27"><a id="__codelineno-122-27" name="__codelineno-122-27" href="#__codelineno-122-27"></a>
</span><span id="__span-122-28"><a id="__codelineno-122-28" name="__codelineno-122-28" href="#__codelineno-122-28"></a><span class="w">    </span><span class="nd">@GET</span>
</span><span id="__span-122-29"><a id="__codelineno-122-29" name="__codelineno-122-29" href="#__codelineno-122-29"></a><span class="w">    </span><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
</span><span id="__span-122-30"><a id="__codelineno-122-30" name="__codelineno-122-30" href="#__codelineno-122-30"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-122-31"><a id="__codelineno-122-31" name="__codelineno-122-31" href="#__codelineno-122-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello Narration Resource&quot;</span><span class="p">;</span>
</span><span id="__span-122-32"><a id="__codelineno-122-32" name="__codelineno-122-32" href="#__codelineno-122-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-122-33"><a id="__codelineno-122-33" name="__codelineno-122-33" href="#__codelineno-122-33"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="the-semantic-kernel-narration-service">The Semantic Kernel Narration service</h4>
<p>Now it’s time to implement the <code>NarrationService</code> that will use the Semantic Kernel to generate the narration. First of all, let’s create an interface that will be implemented by the <code>SemanticKernelNarrationService</code> but could also be implemented by other AI frameworks: Create the <code>io.quarkus.workshop.superheroes.narration.NarrationService</code> interface in the created project with the following content:</p>
<p>Open the <code>NarrationResource</code> and update the content to be:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.narration</span><span class="p">;</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">NarrationService</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">narrate</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, create the <code>io.quarkus.workshop.superheroes.narration.SemanticKernelNarrationService</code> that implements the <code>NarrationService</code> interface. This class has the following methods:</p>
<ul>
<li>
<p><code>narrate</code>: the main method that will use the Semantic Kernel to generate the narration</p>
</li>
<li>
<p><code>fallbackNarrate</code>: the fallback method that will be invoked if the <code>narrate</code> method fails (due to a timeout for example)</p>
</li>
<li>
<p><code>getClient</code>: a method that returns the Semantic Kernel client configured by the <code>conf.properties</code> file</p>
</li>
</ul>
<div class="language-java highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.narration</span><span class="p">;</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.azure.ai.openai.OpenAIAsyncClient</span><span class="p">;</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.Kernel</span><span class="p">;</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.SKBuilders</span><span class="p">;</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.connectors.ai.openai.util.OpenAIClientProvider</span><span class="p">;</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.exceptions.ConfigurationException</span><span class="p">;</span>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.orchestration.SKContext</span><span class="p">;</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.skilldefinition.ReadOnlyFunctionCollection</span><span class="p">;</span>
</span><span id="__span-124-10"><a id="__codelineno-124-10" name="__codelineno-124-10" href="#__codelineno-124-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.textcompletion.CompletionSKFunction</span><span class="p">;</span>
</span><span id="__span-124-11"><a id="__codelineno-124-11" name="__codelineno-124-11" href="#__codelineno-124-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.microsoft.semantickernel.textcompletion.TextCompletion</span><span class="p">;</span>
</span><span id="__span-124-12"><a id="__codelineno-124-12" name="__codelineno-124-12" href="#__codelineno-124-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-124-13"><a id="__codelineno-124-13" name="__codelineno-124-13" href="#__codelineno-124-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
</span><span id="__span-124-14"><a id="__codelineno-124-14" name="__codelineno-124-14" href="#__codelineno-124-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.faulttolerance.Fallback</span><span class="p">;</span>
</span><span id="__span-124-15"><a id="__codelineno-124-15" name="__codelineno-124-15" href="#__codelineno-124-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.faulttolerance.Timeout</span><span class="p">;</span>
</span><span id="__span-124-16"><a id="__codelineno-124-16" name="__codelineno-124-16" href="#__codelineno-124-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-124-17"><a id="__codelineno-124-17" name="__codelineno-124-17" href="#__codelineno-124-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">reactor.core.publisher.Mono</span><span class="p">;</span>
</span><span id="__span-124-18"><a id="__codelineno-124-18" name="__codelineno-124-18" href="#__codelineno-124-18"></a>
</span><span id="__span-124-19"><a id="__codelineno-124-19" name="__codelineno-124-19" href="#__codelineno-124-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
</span><span id="__span-124-20"><a id="__codelineno-124-20" name="__codelineno-124-20" href="#__codelineno-124-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span>
</span><span id="__span-124-21"><a id="__codelineno-124-21" name="__codelineno-124-21" href="#__codelineno-124-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
</span><span id="__span-124-22"><a id="__codelineno-124-22" name="__codelineno-124-22" href="#__codelineno-124-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Properties</span><span class="p">;</span>
</span><span id="__span-124-23"><a id="__codelineno-124-23" name="__codelineno-124-23" href="#__codelineno-124-23"></a>
</span><span id="__span-124-24"><a id="__codelineno-124-24" name="__codelineno-124-24" href="#__codelineno-124-24"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-124-25"><a id="__codelineno-124-25" name="__codelineno-124-25" href="#__codelineno-124-25"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SemanticKernelNarrationService</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">NarrationService</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-26"><a id="__codelineno-124-26" name="__codelineno-124-26" href="#__codelineno-124-26"></a>
</span><span id="__span-124-27"><a id="__codelineno-124-27" name="__codelineno-124-27" href="#__codelineno-124-27"></a><span class="w">    </span><span class="nd">@Inject</span>
</span><span id="__span-124-28"><a id="__codelineno-124-28" name="__codelineno-124-28" href="#__codelineno-124-28"></a><span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-124-29"><a id="__codelineno-124-29" name="__codelineno-124-29" href="#__codelineno-124-29"></a>
</span><span id="__span-124-30"><a id="__codelineno-124-30" name="__codelineno-124-30" href="#__codelineno-124-30"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-124-31"><a id="__codelineno-124-31" name="__codelineno-124-31" href="#__codelineno-124-31"></a><span class="w">    </span><span class="nd">@Fallback</span><span class="p">(</span><span class="n">fallbackMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fallbackNarrate&quot;</span><span class="p">)</span>
</span><span id="__span-124-32"><a id="__codelineno-124-32" name="__codelineno-124-32" href="#__codelineno-124-32"></a><span class="w">    </span><span class="nd">@Timeout</span><span class="p">(</span><span class="mi">30_000</span><span class="p">)</span>
</span><span id="__span-124-33"><a id="__codelineno-124-33" name="__codelineno-124-33" href="#__codelineno-124-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">narrate</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-34"><a id="__codelineno-124-34" name="__codelineno-124-34" href="#__codelineno-124-34"></a>
</span><span id="__span-124-35"><a id="__codelineno-124-35" name="__codelineno-124-35" href="#__codelineno-124-35"></a><span class="w">        </span><span class="c1">// Creates an Azure OpenAI client</span>
</span><span id="__span-124-36"><a id="__codelineno-124-36" name="__codelineno-124-36" href="#__codelineno-124-36"></a><span class="w">        </span><span class="n">OpenAIAsyncClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getClient</span><span class="p">();</span>
</span><span id="__span-124-37"><a id="__codelineno-124-37" name="__codelineno-124-37" href="#__codelineno-124-37"></a>
</span><span id="__span-124-38"><a id="__codelineno-124-38" name="__codelineno-124-38" href="#__codelineno-124-38"></a><span class="w">        </span><span class="c1">// Creates an instance of the TextCompletion service</span>
</span><span id="__span-124-39"><a id="__codelineno-124-39" name="__codelineno-124-39" href="#__codelineno-124-39"></a><span class="w">        </span><span class="n">TextCompletion</span><span class="w"> </span><span class="n">textCompletion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SKBuilders</span><span class="p">.</span><span class="na">chatCompletion</span><span class="p">().</span><span class="na">withOpenAIClient</span><span class="p">(</span><span class="n">client</span><span class="p">).</span><span class="na">withModelId</span><span class="p">(</span><span class="s">&quot;gpt35turbo&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-124-40"><a id="__codelineno-124-40" name="__codelineno-124-40" href="#__codelineno-124-40"></a>
</span><span id="__span-124-41"><a id="__codelineno-124-41" name="__codelineno-124-41" href="#__codelineno-124-41"></a><span class="w">        </span><span class="c1">// Instantiates the Kernel</span>
</span><span id="__span-124-42"><a id="__codelineno-124-42" name="__codelineno-124-42" href="#__codelineno-124-42"></a><span class="w">        </span><span class="n">Kernel</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SKBuilders</span><span class="p">.</span><span class="na">kernel</span><span class="p">().</span><span class="na">withDefaultAIService</span><span class="p">(</span><span class="n">textCompletion</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-124-43"><a id="__codelineno-124-43" name="__codelineno-124-43" href="#__codelineno-124-43"></a>
</span><span id="__span-124-44"><a id="__codelineno-124-44" name="__codelineno-124-44" href="#__codelineno-124-44"></a><span class="w">        </span><span class="c1">// Registers skills</span>
</span><span id="__span-124-45"><a id="__codelineno-124-45" name="__codelineno-124-45" href="#__codelineno-124-45"></a><span class="w">        </span><span class="n">ReadOnlyFunctionCollection</span><span class="w"> </span><span class="n">skill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kernel</span><span class="p">.</span><span class="na">importSkillFromResources</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NarrationSkill&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NarrateFight&quot;</span><span class="p">);</span>
</span><span id="__span-124-46"><a id="__codelineno-124-46" name="__codelineno-124-46" href="#__codelineno-124-46"></a><span class="w">        </span><span class="n">CompletionSKFunction</span><span class="w"> </span><span class="n">fightFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">skill</span><span class="p">.</span><span class="na">getFunction</span><span class="p">(</span><span class="s">&quot;NarrateFight&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CompletionSKFunction</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-124-47"><a id="__codelineno-124-47" name="__codelineno-124-47" href="#__codelineno-124-47"></a>
</span><span id="__span-124-48"><a id="__codelineno-124-48" name="__codelineno-124-48" href="#__codelineno-124-48"></a><span class="w">        </span><span class="c1">// Ask to narrate a fight</span>
</span><span id="__span-124-49"><a id="__codelineno-124-49" name="__codelineno-124-49" href="#__codelineno-124-49"></a><span class="w">        </span><span class="n">SKContext</span><span class="w"> </span><span class="n">fightContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SKBuilders</span><span class="p">.</span><span class="na">context</span><span class="p">().</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-124-50"><a id="__codelineno-124-50" name="__codelineno-124-50" href="#__codelineno-124-50"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;winner_team&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerTeam</span><span class="p">);</span>
</span><span id="__span-124-51"><a id="__codelineno-124-51" name="__codelineno-124-51" href="#__codelineno-124-51"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;winner_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerName</span><span class="p">);</span>
</span><span id="__span-124-52"><a id="__codelineno-124-52" name="__codelineno-124-52" href="#__codelineno-124-52"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;winner_powers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPowers</span><span class="p">);</span>
</span><span id="__span-124-53"><a id="__codelineno-124-53" name="__codelineno-124-53" href="#__codelineno-124-53"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;winner_level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">fight</span><span class="p">.</span><span class="na">winnerLevel</span><span class="p">));</span>
</span><span id="__span-124-54"><a id="__codelineno-124-54" name="__codelineno-124-54" href="#__codelineno-124-54"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;loser_team&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">loserTeam</span><span class="p">);</span>
</span><span id="__span-124-55"><a id="__codelineno-124-55" name="__codelineno-124-55" href="#__codelineno-124-55"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;loser_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">loserName</span><span class="p">);</span>
</span><span id="__span-124-56"><a id="__codelineno-124-56" name="__codelineno-124-56" href="#__codelineno-124-56"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;loser_powers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPowers</span><span class="p">);</span>
</span><span id="__span-124-57"><a id="__codelineno-124-57" name="__codelineno-124-57" href="#__codelineno-124-57"></a><span class="w">        </span><span class="n">fightContext</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;loser_level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">fight</span><span class="p">.</span><span class="na">loserLevel</span><span class="p">));</span>
</span><span id="__span-124-58"><a id="__codelineno-124-58" name="__codelineno-124-58" href="#__codelineno-124-58"></a><span class="w">        </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">SKContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fightFunction</span><span class="p">.</span><span class="na">invokeAsync</span><span class="p">(</span><span class="n">fightContext</span><span class="p">);</span>
</span><span id="__span-124-59"><a id="__codelineno-124-59" name="__codelineno-124-59" href="#__codelineno-124-59"></a>
</span><span id="__span-124-60"><a id="__codelineno-124-60" name="__codelineno-124-60" href="#__codelineno-124-60"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">narration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">block</span><span class="p">().</span><span class="na">getResult</span><span class="p">();</span>
</span><span id="__span-124-61"><a id="__codelineno-124-61" name="__codelineno-124-61" href="#__codelineno-124-61"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;The narration for the fight is: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">narration</span><span class="p">);</span>
</span><span id="__span-124-62"><a id="__codelineno-124-62" name="__codelineno-124-62" href="#__codelineno-124-62"></a>
</span><span id="__span-124-63"><a id="__codelineno-124-63" name="__codelineno-124-63" href="#__codelineno-124-63"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">narration</span><span class="p">;</span>
</span><span id="__span-124-64"><a id="__codelineno-124-64" name="__codelineno-124-64" href="#__codelineno-124-64"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-124-65"><a id="__codelineno-124-65" name="__codelineno-124-65" href="#__codelineno-124-65"></a>
</span><span id="__span-124-66"><a id="__codelineno-124-66" name="__codelineno-124-66" href="#__codelineno-124-66"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">fallbackNarrate</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-67"><a id="__codelineno-124-67" name="__codelineno-124-67" href="#__codelineno-124-67"></a><span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Falling back on Narration&quot;</span><span class="p">);</span>
</span><span id="__span-124-68"><a id="__codelineno-124-68" name="__codelineno-124-68" href="#__codelineno-124-68"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
</span><span id="__span-124-69"><a id="__codelineno-124-69" name="__codelineno-124-69" href="#__codelineno-124-69"></a><span class="s">            High above a bustling city, a symbol of hope and justice soared through the sky, while chaos reigned below, with malevolent laughter echoing through the streets.</span>
</span><span id="__span-124-70"><a id="__codelineno-124-70" name="__codelineno-124-70" href="#__codelineno-124-70"></a><span class="s">            With unwavering determination, the figure swiftly descended, effortlessly evading explosive attacks, closing the gap, and delivering a decisive blow that silenced the wicked laughter.</span>
</span><span id="__span-124-71"><a id="__codelineno-124-71" name="__codelineno-124-71" href="#__codelineno-124-71"></a>
</span><span id="__span-124-72"><a id="__codelineno-124-72" name="__codelineno-124-72" href="#__codelineno-124-72"></a><span class="s">            In the end, the battle concluded with a clear victory for the forces of good, as their commitment to peace triumphed over the chaos and villainy that had threatened the city.</span>
</span><span id="__span-124-73"><a id="__codelineno-124-73" name="__codelineno-124-73" href="#__codelineno-124-73"></a><span class="s">            The people knew that their protector had once again ensured their safety.</span>
</span><span id="__span-124-74"><a id="__codelineno-124-74" name="__codelineno-124-74" href="#__codelineno-124-74"></a><span class="s">            &quot;&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-124-75"><a id="__codelineno-124-75" name="__codelineno-124-75" href="#__codelineno-124-75"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-124-76"><a id="__codelineno-124-76" name="__codelineno-124-76" href="#__codelineno-124-76"></a>
</span><span id="__span-124-77"><a id="__codelineno-124-77" name="__codelineno-124-77" href="#__codelineno-124-77"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OpenAIAsyncClient</span><span class="w"> </span><span class="nf">getClient</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ConfigurationException</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-78"><a id="__codelineno-124-78" name="__codelineno-124-78" href="#__codelineno-124-78"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">propertiesFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;conf.properties&quot;</span><span class="p">;</span>
</span><span id="__span-124-79"><a id="__codelineno-124-79" name="__codelineno-124-79" href="#__codelineno-124-79"></a>
</span><span id="__span-124-80"><a id="__codelineno-124-80" name="__codelineno-124-80" href="#__codelineno-124-80"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getClassLoader</span><span class="p">().</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="n">propertiesFile</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-81"><a id="__codelineno-124-81" name="__codelineno-124-81" href="#__codelineno-124-81"></a>
</span><span id="__span-124-82"><a id="__codelineno-124-82" name="__codelineno-124-82" href="#__codelineno-124-82"></a><span class="w">            </span><span class="n">Properties</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span>
</span><span id="__span-124-83"><a id="__codelineno-124-83" name="__codelineno-124-83" href="#__codelineno-124-83"></a><span class="w">            </span><span class="n">properties</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">is</span><span class="p">);</span>
</span><span id="__span-124-84"><a id="__codelineno-124-84" name="__codelineno-124-84" href="#__codelineno-124-84"></a>
</span><span id="__span-124-85"><a id="__codelineno-124-85" name="__codelineno-124-85" href="#__codelineno-124-85"></a><span class="w">            </span><span class="n">OpenAIClientProvider</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OpenAIClientProvider</span><span class="p">((</span><span class="n">Map</span><span class="p">)</span><span class="w"> </span><span class="n">properties</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
</span><span id="__span-124-86"><a id="__codelineno-124-86" name="__codelineno-124-86" href="#__codelineno-124-86"></a>
</span><span id="__span-124-87"><a id="__codelineno-124-87" name="__codelineno-124-87" href="#__codelineno-124-87"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">provider</span><span class="p">.</span><span class="na">getAsyncClient</span><span class="p">();</span>
</span><span id="__span-124-88"><a id="__codelineno-124-88" name="__codelineno-124-88" href="#__codelineno-124-88"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-124-89"><a id="__codelineno-124-89" name="__codelineno-124-89" href="#__codelineno-124-89"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span id="__span-124-90"><a id="__codelineno-124-90" name="__codelineno-124-90" href="#__codelineno-124-90"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-124-91"><a id="__codelineno-124-91" name="__codelineno-124-91" href="#__codelineno-124-91"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-124-92"><a id="__codelineno-124-92" name="__codelineno-124-92" href="#__codelineno-124-92"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="the-narration-skill">The Narration skill</h4>
<p>With skills, you can encapsulate AI capabilities into a single unit of functionality. Semantic Kernel skills implement the <a href="https://platform.openai.com/docs/plugins/getting-started/plugin-manifest">OpenAI Plugin specification</a> also known as "skills". To narrate a fight, we need to create a <code>NarrateFight</code> function. For that, you need to create a set of directories unders <code>rest-narration/src/main/resources/NarrationSkill/NarrateFight</code>.</p>
<p>Under the <code>NarrationSkill/NarrateFight</code> directory, create the following files:</p>
<ul>
<li>
<p><code>skprompt.txt</code>: the prompt that will be sent to OpenAI/Azure OpenAI</p>
</li>
<li>
<p><code>config.json</code>: the configuration of the skill</p>
</li>
</ul>
<p>Under <code>src/main/resources/NarrationSkill/NarrateFight/</code>, create the <code>skprompt.txt</code> file with the following content. Notice that the prompt uses expression language to get the fight data (e.g., <code>{{$winner_name}}</code>).</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>ACT LIKE YOU WERE A MARVEL COMICS WRITTER, EXPERT IN ALL SORTS OF SUPER HEROES AND SUPER VILLAINS.
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a>NARRATE THE FIGHT BETWEEN A SUPER HERO AND A SUPER VILLAIN.
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a>DURING THE NARRATION DON&#39;T REPEAT &quot;super hero&quot; OR &quot;super villain&quot; WE KNOW WHO IS WHO.
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a>WRITE 4 PARAGRAPHS MAXIMUM.
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a>THE NARRATION MUST BE:
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a>- G RATED
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a>- WORKPLACE/FAMILY SAFE
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a>NO SEXISM, RACISM OR OTHER BIAS/BIGOTRY
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a>BE CREATIVE.
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a>
</span><span id="__span-125-13"><a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a>HERE IS THE DATA YOU WILL USE FOR THE WINNER:
</span><span id="__span-125-14"><a id="__codelineno-125-14" name="__codelineno-125-14" href="#__codelineno-125-14"></a>
</span><span id="__span-125-15"><a id="__codelineno-125-15" name="__codelineno-125-15" href="#__codelineno-125-15"></a>+++++
</span><span id="__span-125-16"><a id="__codelineno-125-16" name="__codelineno-125-16" href="#__codelineno-125-16"></a>name:   {{$winner_name}}
</span><span id="__span-125-17"><a id="__codelineno-125-17" name="__codelineno-125-17" href="#__codelineno-125-17"></a>powers: {{$winner_powers}}
</span><span id="__span-125-18"><a id="__codelineno-125-18" name="__codelineno-125-18" href="#__codelineno-125-18"></a>level:  {{$winner_level}}
</span><span id="__span-125-19"><a id="__codelineno-125-19" name="__codelineno-125-19" href="#__codelineno-125-19"></a>+++++
</span><span id="__span-125-20"><a id="__codelineno-125-20" name="__codelineno-125-20" href="#__codelineno-125-20"></a>
</span><span id="__span-125-21"><a id="__codelineno-125-21" name="__codelineno-125-21" href="#__codelineno-125-21"></a>HERE IS THE DATA YOU WILL USE FOR THE LOSER:
</span><span id="__span-125-22"><a id="__codelineno-125-22" name="__codelineno-125-22" href="#__codelineno-125-22"></a>
</span><span id="__span-125-23"><a id="__codelineno-125-23" name="__codelineno-125-23" href="#__codelineno-125-23"></a>+++++
</span><span id="__span-125-24"><a id="__codelineno-125-24" name="__codelineno-125-24" href="#__codelineno-125-24"></a>name:   {{$loser_name}}
</span><span id="__span-125-25"><a id="__codelineno-125-25" name="__codelineno-125-25" href="#__codelineno-125-25"></a>powers: {{$loser_powers}}
</span><span id="__span-125-26"><a id="__codelineno-125-26" name="__codelineno-125-26" href="#__codelineno-125-26"></a>level:  {{$loser_level}}
</span><span id="__span-125-27"><a id="__codelineno-125-27" name="__codelineno-125-27" href="#__codelineno-125-27"></a>+++++
</span><span id="__span-125-28"><a id="__codelineno-125-28" name="__codelineno-125-28" href="#__codelineno-125-28"></a>
</span><span id="__span-125-29"><a id="__codelineno-125-29" name="__codelineno-125-29" href="#__codelineno-125-29"></a>HERE IS THE DATA YOU WILL USE FOR THE FIGHT:
</span><span id="__span-125-30"><a id="__codelineno-125-30" name="__codelineno-125-30" href="#__codelineno-125-30"></a>
</span><span id="__span-125-31"><a id="__codelineno-125-31" name="__codelineno-125-31" href="#__codelineno-125-31"></a>+++++
</span><span id="__span-125-32"><a id="__codelineno-125-32" name="__codelineno-125-32" href="#__codelineno-125-32"></a>{{$winner_name}} WHO IS A {{$winner_team}} HAS WON THE FIGHT AGAINST {{$loser_name}} WHO IS A {{$loser_team}}.
</span><span id="__span-125-33"><a id="__codelineno-125-33" name="__codelineno-125-33" href="#__codelineno-125-33"></a>+++++
</span></code></pre></div>
<p>Under <code>src/main/resources/NarrationSkill/NarrateFight/</code>, create the <code>config.json</code> file with the following content:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="p">{</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="w">    </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Narrates the fight between a Super Hero and a Super Villain using a single prompt&quot;</span><span class="p">,</span>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;completion&quot;</span><span class="p">,</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="w">    </span><span class="nt">&quot;completion&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a><span class="w">        </span><span class="nt">&quot;max_tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="w">        </span><span class="nt">&quot;temperature&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.9</span><span class="p">,</span>
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a><span class="w">        </span><span class="nt">&quot;top_p&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a><span class="w">        </span><span class="nt">&quot;presence_penalty&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="__span-126-10"><a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a><span class="w">        </span><span class="nt">&quot;frequency_penalty&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span>
</span><span id="__span-126-11"><a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-126-12"><a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a><span class="w">    </span><span class="nt">&quot;input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-13"><a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a><span class="w">        </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-126-14"><a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-15"><a id="__codelineno-126-15" name="__codelineno-126-15" href="#__codelineno-126-15"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;winner_name&quot;</span><span class="p">,</span>
</span><span id="__span-126-16"><a id="__codelineno-126-16" name="__codelineno-126-16" href="#__codelineno-126-16"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The name of the winner&quot;</span><span class="p">,</span>
</span><span id="__span-126-17"><a id="__codelineno-126-17" name="__codelineno-126-17" href="#__codelineno-126-17"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Darth Vader&quot;</span>
</span><span id="__span-126-18"><a id="__codelineno-126-18" name="__codelineno-126-18" href="#__codelineno-126-18"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-126-19"><a id="__codelineno-126-19" name="__codelineno-126-19" href="#__codelineno-126-19"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-20"><a id="__codelineno-126-20" name="__codelineno-126-20" href="#__codelineno-126-20"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;winner_powers&quot;</span><span class="p">,</span>
</span><span id="__span-126-21"><a id="__codelineno-126-21" name="__codelineno-126-21" href="#__codelineno-126-21"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The comma separated list of powers of the winner&quot;</span><span class="p">,</span>
</span><span id="__span-126-22"><a id="__codelineno-126-22" name="__codelineno-126-22" href="#__codelineno-126-22"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Accelerated Healing, Agility, Astral Projection, Cloaking, Danger Sense, Durability, Electrokinesis, Energy Blasts, Enhanced Hearing, Enhanced Senses, Force Fields, Hypnokinesis, Illusions, Intelligence, Jump, Light Control, Marksmanship, Precognition, Psionic Powers, Reflexes, Stealth, Super Speed, Telekinesis, Telepathy, The Force, Weapons Master&quot;</span>
</span><span id="__span-126-23"><a id="__codelineno-126-23" name="__codelineno-126-23" href="#__codelineno-126-23"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-126-24"><a id="__codelineno-126-24" name="__codelineno-126-24" href="#__codelineno-126-24"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-25"><a id="__codelineno-126-25" name="__codelineno-126-25" href="#__codelineno-126-25"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;winner_level&quot;</span><span class="p">,</span>
</span><span id="__span-126-26"><a id="__codelineno-126-26" name="__codelineno-126-26" href="#__codelineno-126-26"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A number representing the level of the winner&quot;</span><span class="p">,</span>
</span><span id="__span-126-27"><a id="__codelineno-126-27" name="__codelineno-126-27" href="#__codelineno-126-27"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;13&quot;</span>
</span><span id="__span-126-28"><a id="__codelineno-126-28" name="__codelineno-126-28" href="#__codelineno-126-28"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-126-29"><a id="__codelineno-126-29" name="__codelineno-126-29" href="#__codelineno-126-29"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-30"><a id="__codelineno-126-30" name="__codelineno-126-30" href="#__codelineno-126-30"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;loser_name&quot;</span><span class="p">,</span>
</span><span id="__span-126-31"><a id="__codelineno-126-31" name="__codelineno-126-31" href="#__codelineno-126-31"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The name of the loser&quot;</span><span class="p">,</span>
</span><span id="__span-126-32"><a id="__codelineno-126-32" name="__codelineno-126-32" href="#__codelineno-126-32"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chewbacca&quot;</span>
</span><span id="__span-126-33"><a id="__codelineno-126-33" name="__codelineno-126-33" href="#__codelineno-126-33"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-126-34"><a id="__codelineno-126-34" name="__codelineno-126-34" href="#__codelineno-126-34"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-35"><a id="__codelineno-126-35" name="__codelineno-126-35" href="#__codelineno-126-35"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;loser_powers&quot;</span><span class="p">,</span>
</span><span id="__span-126-36"><a id="__codelineno-126-36" name="__codelineno-126-36" href="#__codelineno-126-36"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The comma separated list of powers of the loser&quot;</span><span class="p">,</span>
</span><span id="__span-126-37"><a id="__codelineno-126-37" name="__codelineno-126-37" href="#__codelineno-126-37"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Agility, Longevity, Marksmanship, Natural Weapons, Stealth, Super Strength, Weapons Master&quot;</span>
</span><span id="__span-126-38"><a id="__codelineno-126-38" name="__codelineno-126-38" href="#__codelineno-126-38"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-126-39"><a id="__codelineno-126-39" name="__codelineno-126-39" href="#__codelineno-126-39"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-40"><a id="__codelineno-126-40" name="__codelineno-126-40" href="#__codelineno-126-40"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;loser_level&quot;</span><span class="p">,</span>
</span><span id="__span-126-41"><a id="__codelineno-126-41" name="__codelineno-126-41" href="#__codelineno-126-41"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A number representing the level of the loser&quot;</span><span class="p">,</span>
</span><span id="__span-126-42"><a id="__codelineno-126-42" name="__codelineno-126-42" href="#__codelineno-126-42"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span>
</span><span id="__span-126-43"><a id="__codelineno-126-43" name="__codelineno-126-43" href="#__codelineno-126-43"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-126-44"><a id="__codelineno-126-44" name="__codelineno-126-44" href="#__codelineno-126-44"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-45"><a id="__codelineno-126-45" name="__codelineno-126-45" href="#__codelineno-126-45"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;winner_team&quot;</span><span class="p">,</span>
</span><span id="__span-126-46"><a id="__codelineno-126-46" name="__codelineno-126-46" href="#__codelineno-126-46"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The team winning. Can be either &#39;heroes&#39; or &#39;villains&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-126-47"><a id="__codelineno-126-47" name="__codelineno-126-47" href="#__codelineno-126-47"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;villains&quot;</span>
</span><span id="__span-126-48"><a id="__codelineno-126-48" name="__codelineno-126-48" href="#__codelineno-126-48"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-126-49"><a id="__codelineno-126-49" name="__codelineno-126-49" href="#__codelineno-126-49"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-126-50"><a id="__codelineno-126-50" name="__codelineno-126-50" href="#__codelineno-126-50"></a><span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;loser_team&quot;</span><span class="p">,</span>
</span><span id="__span-126-51"><a id="__codelineno-126-51" name="__codelineno-126-51" href="#__codelineno-126-51"></a><span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The team winning. Can be either &#39;heroes&#39; or &#39;villains&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-126-52"><a id="__codelineno-126-52" name="__codelineno-126-52" href="#__codelineno-126-52"></a><span class="w">                </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;heroes&quot;</span>
</span><span id="__span-126-53"><a id="__codelineno-126-53" name="__codelineno-126-53" href="#__codelineno-126-53"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-126-54"><a id="__codelineno-126-54" name="__codelineno-126-54" href="#__codelineno-126-54"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-126-55"><a id="__codelineno-126-55" name="__codelineno-126-55" href="#__codelineno-126-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-126-56"><a id="__codelineno-126-56" name="__codelineno-126-56" href="#__codelineno-126-56"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="configuring-openaiazure-openai-access">Configuring OpenAI/Azure OpenAI access</h4>
<p>Configuring the OpenAI/Azure OpenAI access is made thanks to the <code>conf.properties</code>. Depending if you have previously chosen OpenAI or Azure OpenAI, you either need to use the <code>client.openai</code> or <code>client.azureopenai</code> configuration keys.</p>
<table><tbody><tr><td><i title="Warning"></i></td><td><p>Make sure that you have previously either created an Azure AI or OpenAI subscription. </p></td></tr></tbody></table>

<p>If you use OpenAI, create the <code>rest-narration/src/main/resources/conf.properties</code> file and add the following configuration:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="na">client.openai.key</span><span class="o">=</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="na">client.openai.organizationid</span><span class="o">=</span>
</span></code></pre></div>
<p>For Azure OpenAI, use the following configuration in the <code>rest-narration/src/main/resources/conf.properties</code> file:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="na">client.azureopenai.key</span><span class="o">=</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="na">client.azureopenai.endpoint</span><span class="o">=</span>
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="na">client.azureopenai.deploymentname</span><span class="o">=</span>
</span></code></pre></div>
<p>We also set the port of the Narration microservice to be 8086. And to have a better view of what’s happening behind the scene with Semantic Kernel, we can increase the log level. Just add the following configuration to the Quarkus <code>application.properties</code> file:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="c1">## HTTP configuration</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="na">quarkus.http.port</span><span class="o">=</span><span class="s">8086</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="c1">## Custom banner file path</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="na">quarkus.banner.path</span><span class="o">=</span><span class="s">banner.txt</span>
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a>
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="c1">## CORS</span>
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="na">quarkus.http.cors</span><span class="o">=</span><span class="s">true</span>
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="na">quarkus.http.cors.origins</span><span class="o">=</span><span class="s">*</span>
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="c1">## Logging configuration</span>
</span><span id="__span-129-11"><a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a><span class="na">quarkus.log.category.&quot;com.microsoft.semantickernel&quot;.level</span><span class="o">=</span><span class="s">DEBUG</span>
</span></code></pre></div>
<h4 id="testing-the-narration-microservice">Testing the Narration Microservice</h4>
<p>Time for some tests! But before creating the test class, we need to add the Mockito dependency to the project. That’s because we want to mock the Semantic Kernel client.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>quarkus-junit5-mockito<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="w">    </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>Open the <code>io.quarkus.workshop.superheroes.narration.NarrationResourceTest</code> class and copy the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.narration</span><span class="p">;</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.InjectMock</span><span class="p">;</span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.junit.QuarkusTest</span><span class="p">;</span>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.BeforeEach</span><span class="p">;</span>
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.mockito.Mockito</span><span class="p">;</span>
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a>
</span><span id="__span-131-9"><a id="__codelineno-131-9" name="__codelineno-131-9" href="#__codelineno-131-9"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">io.restassured.RestAssured.given</span><span class="p">;</span>
</span><span id="__span-131-10"><a id="__codelineno-131-10" name="__codelineno-131-10" href="#__codelineno-131-10"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.ACCEPT</span><span class="p">;</span>
</span><span id="__span-131-11"><a id="__codelineno-131-11" name="__codelineno-131-11" href="#__codelineno-131-11"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.HttpHeaders.CONTENT_TYPE</span><span class="p">;</span>
</span><span id="__span-131-12"><a id="__codelineno-131-12" name="__codelineno-131-12" href="#__codelineno-131-12"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.APPLICATION_JSON</span><span class="p">;</span>
</span><span id="__span-131-13"><a id="__codelineno-131-13" name="__codelineno-131-13" href="#__codelineno-131-13"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.TEXT_PLAIN</span><span class="p">;</span>
</span><span id="__span-131-14"><a id="__codelineno-131-14" name="__codelineno-131-14" href="#__codelineno-131-14"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.CREATED</span><span class="p">;</span>
</span><span id="__span-131-15"><a id="__codelineno-131-15" name="__codelineno-131-15" href="#__codelineno-131-15"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.Response.Status.OK</span><span class="p">;</span>
</span><span id="__span-131-16"><a id="__codelineno-131-16" name="__codelineno-131-16" href="#__codelineno-131-16"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">org.hamcrest.CoreMatchers.is</span><span class="p">;</span>
</span><span id="__span-131-17"><a id="__codelineno-131-17" name="__codelineno-131-17" href="#__codelineno-131-17"></a>
</span><span id="__span-131-18"><a id="__codelineno-131-18" name="__codelineno-131-18" href="#__codelineno-131-18"></a><span class="nd">@QuarkusTest</span>
</span><span id="__span-131-19"><a id="__codelineno-131-19" name="__codelineno-131-19" href="#__codelineno-131-19"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NarrationResourceTest</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-20"><a id="__codelineno-131-20" name="__codelineno-131-20" href="#__codelineno-131-20"></a>
</span><span id="__span-131-21"><a id="__codelineno-131-21" name="__codelineno-131-21" href="#__codelineno-131-21"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">HERO_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Baguette&quot;</span><span class="p">;</span>
</span><span id="__span-131-22"><a id="__codelineno-131-22" name="__codelineno-131-22" href="#__codelineno-131-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HERO_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-131-23"><a id="__codelineno-131-23" name="__codelineno-131-23" href="#__codelineno-131-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">HERO_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Eats baguette in less than a second&quot;</span><span class="p">;</span>
</span><span id="__span-131-24"><a id="__codelineno-131-24" name="__codelineno-131-24" href="#__codelineno-131-24"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">VILLAIN_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Super Chocolatine&quot;</span><span class="p">;</span>
</span><span id="__span-131-25"><a id="__codelineno-131-25" name="__codelineno-131-25" href="#__codelineno-131-25"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">VILLAIN_LEVEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">43</span><span class="p">;</span>
</span><span id="__span-131-26"><a id="__codelineno-131-26" name="__codelineno-131-26" href="#__codelineno-131-26"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">VILLAIN_POWERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Transforms chocolatine into pain au chocolat&quot;</span><span class="p">;</span>
</span><span id="__span-131-27"><a id="__codelineno-131-27" name="__codelineno-131-27" href="#__codelineno-131-27"></a>
</span><span id="__span-131-28"><a id="__codelineno-131-28" name="__codelineno-131-28" href="#__codelineno-131-28"></a><span class="w">    </span><span class="nd">@InjectMock</span>
</span><span id="__span-131-29"><a id="__codelineno-131-29" name="__codelineno-131-29" href="#__codelineno-131-29"></a><span class="w">    </span><span class="n">NarrationService</span><span class="w"> </span><span class="n">narrationService</span><span class="p">;</span>
</span><span id="__span-131-30"><a id="__codelineno-131-30" name="__codelineno-131-30" href="#__codelineno-131-30"></a>
</span><span id="__span-131-31"><a id="__codelineno-131-31" name="__codelineno-131-31" href="#__codelineno-131-31"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="nf">getFight</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-32"><a id="__codelineno-131-32" name="__codelineno-131-32" href="#__codelineno-131-32"></a><span class="w">        </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Fight</span><span class="p">();</span>
</span><span id="__span-131-33"><a id="__codelineno-131-33" name="__codelineno-131-33" href="#__codelineno-131-33"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VILLAIN_NAME</span><span class="p">;</span>
</span><span id="__span-131-34"><a id="__codelineno-131-34" name="__codelineno-131-34" href="#__codelineno-131-34"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VILLAIN_LEVEL</span><span class="p">;</span>
</span><span id="__span-131-35"><a id="__codelineno-131-35" name="__codelineno-131-35" href="#__codelineno-131-35"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VILLAIN_POWERS</span><span class="p">;</span>
</span><span id="__span-131-36"><a id="__codelineno-131-36" name="__codelineno-131-36" href="#__codelineno-131-36"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HERO_NAME</span><span class="p">;</span>
</span><span id="__span-131-37"><a id="__codelineno-131-37" name="__codelineno-131-37" href="#__codelineno-131-37"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HERO_LEVEL</span><span class="p">;</span>
</span><span id="__span-131-38"><a id="__codelineno-131-38" name="__codelineno-131-38" href="#__codelineno-131-38"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HERO_POWERS</span><span class="p">;</span>
</span><span id="__span-131-39"><a id="__codelineno-131-39" name="__codelineno-131-39" href="#__codelineno-131-39"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;villains&quot;</span><span class="p">;</span>
</span><span id="__span-131-40"><a id="__codelineno-131-40" name="__codelineno-131-40" href="#__codelineno-131-40"></a><span class="w">        </span><span class="n">fight</span><span class="p">.</span><span class="na">loserTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;heroes&quot;</span><span class="p">;</span>
</span><span id="__span-131-41"><a id="__codelineno-131-41" name="__codelineno-131-41" href="#__codelineno-131-41"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fight</span><span class="p">;</span>
</span><span id="__span-131-42"><a id="__codelineno-131-42" name="__codelineno-131-42" href="#__codelineno-131-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-131-43"><a id="__codelineno-131-43" name="__codelineno-131-43" href="#__codelineno-131-43"></a>
</span><span id="__span-131-44"><a id="__codelineno-131-44" name="__codelineno-131-44" href="#__codelineno-131-44"></a><span class="w">    </span><span class="nd">@BeforeEach</span>
</span><span id="__span-131-45"><a id="__codelineno-131-45" name="__codelineno-131-45" href="#__codelineno-131-45"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-46"><a id="__codelineno-131-46" name="__codelineno-131-46" href="#__codelineno-131-46"></a><span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">narrationService</span><span class="p">.</span><span class="na">narrate</span><span class="p">(</span><span class="n">getFight</span><span class="p">())).</span><span class="na">thenReturn</span><span class="p">(</span><span class="s">&quot;Lorem ipsum dolor sit amet&quot;</span><span class="p">);</span>
</span><span id="__span-131-47"><a id="__codelineno-131-47" name="__codelineno-131-47" href="#__codelineno-131-47"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-131-48"><a id="__codelineno-131-48" name="__codelineno-131-48" href="#__codelineno-131-48"></a>
</span><span id="__span-131-49"><a id="__codelineno-131-49" name="__codelineno-131-49" href="#__codelineno-131-49"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-131-50"><a id="__codelineno-131-50" name="__codelineno-131-50" href="#__codelineno-131-50"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldPingOpenAPI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-51"><a id="__codelineno-131-51" name="__codelineno-131-51" href="#__codelineno-131-51"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-131-52"><a id="__codelineno-131-52" name="__codelineno-131-52" href="#__codelineno-131-52"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-131-53"><a id="__codelineno-131-53" name="__codelineno-131-53" href="#__codelineno-131-53"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/q/openapi&quot;</span><span class="p">)</span>
</span><span id="__span-131-54"><a id="__codelineno-131-54" name="__codelineno-131-54" href="#__codelineno-131-54"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-131-55"><a id="__codelineno-131-55" name="__codelineno-131-55" href="#__codelineno-131-55"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">OK</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-131-56"><a id="__codelineno-131-56" name="__codelineno-131-56" href="#__codelineno-131-56"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-131-57"><a id="__codelineno-131-57" name="__codelineno-131-57" href="#__codelineno-131-57"></a>
</span><span id="__span-131-58"><a id="__codelineno-131-58" name="__codelineno-131-58" href="#__codelineno-131-58"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-131-59"><a id="__codelineno-131-59" name="__codelineno-131-59" href="#__codelineno-131-59"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testHelloEndpoint</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-60"><a id="__codelineno-131-60" name="__codelineno-131-60" href="#__codelineno-131-60"></a><span class="w">        </span><span class="n">given</span><span class="p">()</span>
</span><span id="__span-131-61"><a id="__codelineno-131-61" name="__codelineno-131-61" href="#__codelineno-131-61"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;/api/narration/hello&quot;</span><span class="p">)</span>
</span><span id="__span-131-62"><a id="__codelineno-131-62" name="__codelineno-131-62" href="#__codelineno-131-62"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-131-63"><a id="__codelineno-131-63" name="__codelineno-131-63" href="#__codelineno-131-63"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-131-64"><a id="__codelineno-131-64" name="__codelineno-131-64" href="#__codelineno-131-64"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello Narration Resource&quot;</span><span class="p">));</span>
</span><span id="__span-131-65"><a id="__codelineno-131-65" name="__codelineno-131-65" href="#__codelineno-131-65"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-131-66"><a id="__codelineno-131-66" name="__codelineno-131-66" href="#__codelineno-131-66"></a>
</span><span id="__span-131-67"><a id="__codelineno-131-67" name="__codelineno-131-67" href="#__codelineno-131-67"></a><span class="w">    </span><span class="nd">@Test</span>
</span><span id="__span-131-68"><a id="__codelineno-131-68" name="__codelineno-131-68" href="#__codelineno-131-68"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNarrateAFight</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-69"><a id="__codelineno-131-69" name="__codelineno-131-69" href="#__codelineno-131-69"></a><span class="w">        </span><span class="n">given</span><span class="p">().</span><span class="na">log</span><span class="p">().</span><span class="na">all</span><span class="p">()</span>
</span><span id="__span-131-70"><a id="__codelineno-131-70" name="__codelineno-131-70" href="#__codelineno-131-70"></a><span class="w">            </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">getFight</span><span class="p">())</span>
</span><span id="__span-131-71"><a id="__codelineno-131-71" name="__codelineno-131-71" href="#__codelineno-131-71"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-131-72"><a id="__codelineno-131-72" name="__codelineno-131-72" href="#__codelineno-131-72"></a><span class="w">            </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-131-73"><a id="__codelineno-131-73" name="__codelineno-131-73" href="#__codelineno-131-73"></a><span class="w">            </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-131-74"><a id="__codelineno-131-74" name="__codelineno-131-74" href="#__codelineno-131-74"></a><span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/narration&quot;</span><span class="p">)</span>
</span><span id="__span-131-75"><a id="__codelineno-131-75" name="__codelineno-131-75" href="#__codelineno-131-75"></a><span class="w">            </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-131-76"><a id="__codelineno-131-76" name="__codelineno-131-76" href="#__codelineno-131-76"></a><span class="w">            </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">CREATED</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
</span><span id="__span-131-77"><a id="__codelineno-131-77" name="__codelineno-131-77" href="#__codelineno-131-77"></a><span class="c1">//            .body(startsWith(&quot;Lorem ipsum dolor sit amet&quot;));</span>
</span><span id="__span-131-78"><a id="__codelineno-131-78" name="__codelineno-131-78" href="#__codelineno-131-78"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-131-79"><a id="__codelineno-131-79" name="__codelineno-131-79" href="#__codelineno-131-79"></a><span class="p">}</span>
</span></code></pre></div>
<p>Make sure the tests pass by executing the command <code>./mvnw test</code> (or from your IDE).</p>
<h4 id="running-the-narration-microservice">Running the Narration Microservice</h4>
<p>Now that the tests are green, we are ready to run our Narration microservice.</p>
<p>Use <code>./mvnw quarkus:dev</code> to start it. Once the Narration microservice is started, create a new narration with the following cUrl command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w">  </span><span class="s1">&#39;{&quot;winnerName&quot;:&quot;Super winner&quot;, &quot;winnerLevel&quot;:42, &quot;winnerPowers&quot;:&quot;jumping&quot;, &quot;loserName&quot;:&quot;Super loser&quot;, &quot;loserLevel&quot;:2, &quot;loserPowers&quot;:&quot;leaping&quot;, &quot;winnerTeam&quot;:&quot;heroes&quot;, &quot;loserTeam&quot;:&quot;villains&quot; }&#39;</span><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>http://localhost:8086/api/narration<span class="w"> </span>-v
</span></code></pre></div>
<p>You should get something similar to the following response:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>&lt; HTTP/1.1 201 Created
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>&lt; Content-Type: text/plain;charset=UTF-8
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a>The battle between the towering Chewbacca and the dark and menacing Darth Vader was one for the ages. Chewbacca&#39;s incredible strength and agility were no match for Vader&#39;s mastery of the Force and his arsenal of weapons. The two clashed in a flurry of blows and energy blasts, each trying to gain the upper hand.
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a>Despite Chewbacca&#39;s valiant efforts, it was clear that Vader was the superior fighter. His precognition and danger sense allowed him to anticipate every move Chewbacca made, and his energy blasts and electrokinesis were devastating. In the end, Vader emerged victorious, leaving Chewbacca battered and defeated.
</span></code></pre></div>
<p>The cUrl command returns the narration of the fight as <code>text/plain</code>.</p>
<h3 id="invoking-the-narration-microservice-from-the-fight-microservice">Invoking the Narration Microservice from the Fight Microservice</h3>
<p>Now that we have a narration microservice up and running, we can invoke it from the fight microservice.</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-bcc9a67d5e52ee470086718c8e13ab73.png" /></p>
<h4 id="adding-narration-to-the-fight-microservice">Adding narration to the Fight Microservice</h4>
<p>We now need to add a new endpoint to the Fight microservice to invoke the Narration microservice. Because it uses a remote call, we need to use the <code>@RegisterRestClient</code> annotation to register the <code>NarrationProxy</code> as a REST client.</p>
<p>Go back to the <code>io.quarkus.workshop.superheroes.fight.FightResource</code> class and add the new <code>narrateFight</code> method:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="nd">@POST</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/narrate&quot;</span><span class="p">)</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="nd">@Consumes</span><span class="p">(</span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a><span class="nd">@Produces</span><span class="p">(</span><span class="n">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a><span class="kd">public</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="nf">narrateFight</span><span class="p">(</span><span class="nd">@Valid</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a><span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Narrate the fight &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fight</span><span class="p">);</span>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">narration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="na">narrateFight</span><span class="p">(</span><span class="n">fight</span><span class="p">);</span>
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Response</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="na">Status</span><span class="p">.</span><span class="na">CREATED</span><span class="p">).</span><span class="na">entity</span><span class="p">(</span><span class="n">narration</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>FightResource</code> invokes a new method of the <code>FightService</code>. Add the following method to the <code>io.quarkus.workshop.superheroes.fight.FightService</code> class and make sure to inject the <code>NarrationProxy</code>:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="nd">@RestClient</span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="n">NarrationProxy</span><span class="w"> </span><span class="n">narrationProxy</span><span class="p">;</span>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">narrateFight</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">narrationProxy</span><span class="p">.</span><span class="na">narrate</span><span class="p">(</span><span class="n">fight</span><span class="p">);</span>
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>Under the <code>client</code> package, where all the other proxies are already located, create a new <code>NarrationProxy</code> class:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.Fight</span><span class="p">;</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Consumes</span><span class="p">;</span>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.POST</span><span class="p">;</span>
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Path</span><span class="p">;</span>
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.Produces</span><span class="p">;</span>
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType</span><span class="p">;</span>
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.rest.client.inject.RegisterRestClient</span><span class="p">;</span>
</span><span id="__span-136-10"><a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a>
</span><span id="__span-136-11"><a id="__codelineno-136-11" name="__codelineno-136-11" href="#__codelineno-136-11"></a><span class="nd">@Path</span><span class="p">(</span><span class="s">&quot;/api/narration&quot;</span><span class="p">)</span>
</span><span id="__span-136-12"><a id="__codelineno-136-12" name="__codelineno-136-12" href="#__codelineno-136-12"></a><span class="nd">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-136-13"><a id="__codelineno-136-13" name="__codelineno-136-13" href="#__codelineno-136-13"></a><span class="nd">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-136-14"><a id="__codelineno-136-14" name="__codelineno-136-14" href="#__codelineno-136-14"></a><span class="nd">@RegisterRestClient</span><span class="p">(</span><span class="n">configKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;narration&quot;</span><span class="p">)</span>
</span><span id="__span-136-15"><a id="__codelineno-136-15" name="__codelineno-136-15" href="#__codelineno-136-15"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">NarrationProxy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-16"><a id="__codelineno-136-16" name="__codelineno-136-16" href="#__codelineno-136-16"></a>
</span><span id="__span-136-17"><a id="__codelineno-136-17" name="__codelineno-136-17" href="#__codelineno-136-17"></a><span class="w">    </span><span class="nd">@POST</span>
</span><span id="__span-136-18"><a id="__codelineno-136-18" name="__codelineno-136-18" href="#__codelineno-136-18"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">narrate</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">);</span>
</span><span id="__span-136-19"><a id="__codelineno-136-19" name="__codelineno-136-19" href="#__codelineno-136-19"></a><span class="p">}</span>
</span></code></pre></div>
<p>To link both microservices, we need to add the following configuration to the <code>rest-fights/src/main/resources/application.properties</code> file of the fight microservice:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="na">quarkus.rest-client.narration.url</span><span class="o">=</span><span class="s">http://localhost:8086</span>
</span></code></pre></div>
<h4 id="test-and-mock-the-narration-microservice-invocation">Test and mock the Narration microservice invocation</h4>
<p>Like the other dependencies, the Narration microservice needs to be mocked so we can test the Fight microservice in isolation.</p>
<p>Add the following <code>shouldNarrate</code> test to the <code>io.quarkus.workshop.superheroes.fight.FightResourceTest</code> class. And make sure you use the right imports:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Instant</span><span class="p">;</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="kn">import static</span><span class="w"> </span><span class="nn">jakarta.ws.rs.core.MediaType.TEXT_PLAIN</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-java highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="nd">@Test</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">shouldNarrate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="w">    </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Fight</span><span class="p">();</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">fightDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_NAME</span><span class="p">;</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_LEVEL</span><span class="p">;</span>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_POWERS</span><span class="p">;</span>
</span><span id="__span-139-8"><a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerPicture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_WINNER_PICTURE</span><span class="p">;</span>
</span><span id="__span-139-9"><a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">loserName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_NAME</span><span class="p">;</span>
</span><span id="__span-139-10"><a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">loserLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_LEVEL</span><span class="p">;</span>
</span><span id="__span-139-11"><a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPowers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_POWERS</span><span class="p">;</span>
</span><span id="__span-139-12"><a id="__codelineno-139-12" name="__codelineno-139-12" href="#__codelineno-139-12"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">loserPicture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_LOSER_PICTURE</span><span class="p">;</span>
</span><span id="__span-139-13"><a id="__codelineno-139-13" name="__codelineno-139-13" href="#__codelineno-139-13"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;villains&quot;</span><span class="p">;</span>
</span><span id="__span-139-14"><a id="__codelineno-139-14" name="__codelineno-139-14" href="#__codelineno-139-14"></a><span class="w">    </span><span class="n">fight</span><span class="p">.</span><span class="na">loserTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;heroes&quot;</span><span class="p">;</span>
</span><span id="__span-139-15"><a id="__codelineno-139-15" name="__codelineno-139-15" href="#__codelineno-139-15"></a>
</span><span id="__span-139-16"><a id="__codelineno-139-16" name="__codelineno-139-16" href="#__codelineno-139-16"></a><span class="w">    </span><span class="n">given</span><span class="p">().</span><span class="na">body</span><span class="p">(</span><span class="n">fight</span><span class="p">)</span>
</span><span id="__span-139-17"><a id="__codelineno-139-17" name="__codelineno-139-17" href="#__codelineno-139-17"></a><span class="w">        </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">CONTENT_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">APPLICATION_JSON</span><span class="p">)</span>
</span><span id="__span-139-18"><a id="__codelineno-139-18" name="__codelineno-139-18" href="#__codelineno-139-18"></a><span class="w">        </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="n">ACCEPT</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT_PLAIN</span><span class="p">)</span>
</span><span id="__span-139-19"><a id="__codelineno-139-19" name="__codelineno-139-19" href="#__codelineno-139-19"></a><span class="w">        </span><span class="p">.</span><span class="na">when</span><span class="p">()</span>
</span><span id="__span-139-20"><a id="__codelineno-139-20" name="__codelineno-139-20" href="#__codelineno-139-20"></a><span class="w">        </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/api/fights/narrate&quot;</span><span class="p">)</span>
</span><span id="__span-139-21"><a id="__codelineno-139-21" name="__codelineno-139-21" href="#__codelineno-139-21"></a><span class="w">        </span><span class="p">.</span><span class="na">then</span><span class="p">()</span>
</span><span id="__span-139-22"><a id="__codelineno-139-22" name="__codelineno-139-22" href="#__codelineno-139-22"></a><span class="w">        </span><span class="p">.</span><span class="na">statusCode</span><span class="p">(</span><span class="n">CREATED</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">())</span>
</span><span id="__span-139-23"><a id="__codelineno-139-23" name="__codelineno-139-23" href="#__codelineno-139-23"></a><span class="w">        </span><span class="p">.</span><span class="na">body</span><span class="p">(</span><span class="n">startsWith</span><span class="p">(</span><span class="s">&quot;Lorem ipsum dolor sit amet&quot;</span><span class="p">));</span>
</span><span id="__span-139-24"><a id="__codelineno-139-24" name="__codelineno-139-24" href="#__codelineno-139-24"></a><span class="p">}</span>
</span></code></pre></div>
<p>Create the <code>io.quarkus.workshop.superheroes.fight.client.MockNarrationProxy</code> class and add the new <code>narrateFight</code> method:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.client</span><span class="p">;</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.test.Mock</span><span class="p">;</span>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.fight.Fight</span><span class="p">;</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.rest.client.inject.RestClient</span><span class="p">;</span>
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="nd">@Mock</span>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-140-10"><a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a><span class="nd">@RestClient</span>
</span><span id="__span-140-11"><a id="__codelineno-140-11" name="__codelineno-140-11" href="#__codelineno-140-11"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MockNarrationProxy</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">NarrationProxy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-140-12"><a id="__codelineno-140-12" name="__codelineno-140-12" href="#__codelineno-140-12"></a>
</span><span id="__span-140-13"><a id="__codelineno-140-13" name="__codelineno-140-13" href="#__codelineno-140-13"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-140-14"><a id="__codelineno-140-14" name="__codelineno-140-14" href="#__codelineno-140-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">narrate</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-140-15"><a id="__codelineno-140-15" name="__codelineno-140-15" href="#__codelineno-140-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;&quot;</span>
</span><span id="__span-140-16"><a id="__codelineno-140-16" name="__codelineno-140-16" href="#__codelineno-140-16"></a><span class="s">            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</span>
</span><span id="__span-140-17"><a id="__codelineno-140-17" name="__codelineno-140-17" href="#__codelineno-140-17"></a><span class="s">            Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</span>
</span><span id="__span-140-18"><a id="__codelineno-140-18" name="__codelineno-140-18" href="#__codelineno-140-18"></a><span class="s">            Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</span>
</span><span id="__span-140-19"><a id="__codelineno-140-19" name="__codelineno-140-19" href="#__codelineno-140-19"></a><span class="s">            Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span>
</span><span id="__span-140-20"><a id="__codelineno-140-20" name="__codelineno-140-20" href="#__codelineno-140-20"></a><span class="s">            &quot;&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-140-21"><a id="__codelineno-140-21" name="__codelineno-140-21" href="#__codelineno-140-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-140-22"><a id="__codelineno-140-22" name="__codelineno-140-22" href="#__codelineno-140-22"></a><span class="p">}</span>
</span></code></pre></div>
<p>Now execute <code>./mvnw test</code> and make sure that all the tests pass.</p>
<h3 id="running-testing-and-packaging-the-application_2">Running, Testing and Packaging the Application</h3>
<p>Time to run the entire application! For that, start all the microservices (Heroes, Villains, Fight and Narration) as well as the frontend. When all the microservices are started, access the frontend at <a href="http://localhost:8080/">http://localhost:8080</a> and click on the <code>Fight</code> button. The result of the fight is displayed, and below, you have a "Narrate the fight" button. Click on it, wait a few seconds (remember that the Narration microservice access a remote AI service that takes time) and the narration of the fight is displayed. Being <em>Generative AI</em>, you can click several times on the button and you will get different narrations.</p>
<p><img alt="react ui ai" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/react-ui-ai.png" /></p>
<h2 id="event-driven-and-reactive-microservices">Event-driven and Reactive microservices</h2>
<hr />
<p>So far, we have build microservices that all use HTTP to interact. However, HTTP has significant flaws, such as temporal coupling between the different microservices. If the service is not there or is slow, the caller is directly impacted. Also, it’s hard to guess the capacity of the service you call; maybe you should not call it right now because this service is under heavy load.</p>
<p>Fortunately, event-driven microservices are rising and avoid most of these issues. By using events (wrapped in messages), the different microservices enforce a looser coupling. Depending on the messaging protocol you use, it may handle durability (avoiding the temporal coupling) and back-pressure (avoiding the overload).</p>
<p>In this section, we are going to see how Quarkus let you build event-driven microservices. More specially, you are going to see how to:</p>
<ul>
<li>
<p>Send messages and process them</p>
</li>
<li>
<p>Connect a Quarkus application to Apache Kafka</p>
</li>
<li>
<p>Write Kafka records and read them</p>
</li>
<li>
<p>Use reactive programming to compute statistics on the fly</p>
</li>
<li>
<p>Send messages to the browser using web sockets</p>
</li>
</ul>
<p>Quarkus uses MicroProfile Reactive Messaging to interact with Apache Kafka, and other messaging middleware (such as AMQP)</p>
<p>In this chapter, we are going to use events as a way for microservices to interact. You are going to extend the current system with the <code>stats</code> group depicted on the next figure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-b8001327378a8c5b7b28523fbf0a3a1e.png" /></p>
<p>When the application persists a new fight, in the <em>fight</em> microservice, you are going to send it to a Kafka topic. These messages are read in the <em>statistics</em> microservice, processed, and the result is sent to a UI using web sockets.</p>
<table><tbody><tr><td><i title="Important"></i></td><td>This service is exposed on the port 8085.</td></tr></tbody></table>

<h3 id="sending-messages-to-kafka">Sending Messages to Kafka</h3>
<p>In this section, you are going to see how you can send messages to a Kafka topic</p>
<h4 id="directory-structure_8">Directory Structure</h4>
<p>In this section we are going to extend the <strong>Fight microservice</strong>. In the following tree, we are going to edit the marked classes</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-9e91c56d3735dd8a4cff29f7dca44466.png" /></p>
<h4 id="adding-the-reactive-messaging-dependency">Adding the Reactive Messaging Dependency</h4>
<p>The Kafka extension was already imported during the project creation. In doubt, you can run in the Fight microservice:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a>./mvnw<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot; io.quarkus:quarkus-messaging-kafka&quot;</span>
</span></code></pre></div>
<p>The previous command adds the following dependency:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>quarkus-messaging-kafka<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>If not yet started, start the microservice using <code>./mvnw quarkus:dev</code>.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Quarkus starts a Kafka broker automatically. You can check that by executing the <code>docker container ls</code> command.</p></td></tr></tbody></table>

<h4 id="connecting-imperative-and-reactive-using-an-emitter">Connecting Imperative and Reactive Using an Emitter</h4>
<p>Now edit the <code>FightService</code> class. First, add the following field:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="nd">@Channel</span><span class="p">(</span><span class="s">&quot;fights&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Emitter</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">emitter</span><span class="p">;</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>You will also need to add the following imports:</p><div><pre><code data-lang="java">import org.eclipse.microprofile.reactive.messaging.Channel;
import org.eclipse.microprofile.reactive.messaging.Emitter;</code></pre></div></td></tr></tbody></table>

<p>This field is an <em>emitter</em>, and lets you send events or messages (here, we are sending fights) to the <em>channel</em> specified with the <code>@Channel</code> annotation. A <em>channel</em> is a <em>virtual</em> destination.</p>
<p>In the <code>persistFight</code> method, add the following line just before the <code>return</code> statement:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="n">emitter</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">fight</span><span class="p">).</span><span class="na">toCompletableFuture</span><span class="p">().</span><span class="na">join</span><span class="p">();</span>
</span></code></pre></div>
<p>With this in place, every time the application persists a <code>fight</code>, it also sends the <code>fight</code> to the <code>fights</code> <em>channel</em>. You may wonder why we need <code>.toCompletableFuture().join()</code>. Sending a message to Kafka is an asynchronous operation, and we need to be sure that the fight is not accessed outside the transaction. Thus, we wait until Kafka confirms the reception before returning.</p>
<h4 id="connecting-to-kafka">Connecting to Kafka</h4>
<p>At this point, the serialized fights are sent to the <code>fights</code> channel. You need to connect this <code>channel</code> to a Kafka topic.</p>
<p>For this, edit the <code>application.properties</code> file and add the following properties:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="na">mp.messaging.outgoing.fights.connector</span><span class="o">=</span><span class="s">smallrye-kafka</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="na">mp.messaging.outgoing.fights.value.serializer</span><span class="o">=</span><span class="s">io.quarkus.kafka.client.serialization.ObjectMapperSerializer</span>
</span></code></pre></div>
<p>These properties are structured as follows:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="na">mp.messaging.[incoming|outgoing].channel.attribute</span><span class="o">=</span><span class="s">value</span>
</span></code></pre></div>
<p>For example, <code>mp.messaging.outgoing.fights.connector</code> configures the connector used for the <code>outgoing</code> channel <code>fights</code>.</p>
<p>The <code>mp.messaging.outgoing.fights.value.serializer</code> configures the serializer used to write the message in Kafka. When omitted, the Kafka topic reuses the channel name (<code>fights</code>).</p>
<p>Now, you have connected the fight microservice to Kafka, and you are sending new fights to the Kafka topic. Let’s see how you can read these messages in the <code>stats</code> microservice.</p>
<h3 id="receiving-messages-from-kafka">Receiving Messages from Kafka</h3>
<p>In this section, you are going to see how you can receive messages from a Kafka topic. For this, you are going to create a new microservice, named <code>stats</code>. This microservice computes statistics based on the results of the fights. For example, it determines if villains win more battle than heroes, and who is the superhero or super-villain having won the most fights.</p>
<h4 id="directory-structure_9">Directory Structure</h4>
<p>In this section, we are going to develop the following structure:</p>
<p><img alt="Diagram" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/diag-plantuml-md5-f89665c3e6c4d2cc2e28626926d56331.png" /></p>
<h4 id="bootstrapping-the-statistics-rest-endpoint">Bootstrapping the Statistics REST Endpoint</h4>
<p>Like for the other microservice, the easiest way to create this new Quarkus project is to use a Maven command. Under the <code>quarkus-workshop-super-heroes/super-heroes</code> root directory where you have all your code.</p>
<p>Open a terminal and run the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a>./mvnw<span class="w"> </span>io.quarkus:quarkus-maven-plugin:3.9.1:create<span class="w">    </span>-<span class="s2">&quot;DplatformVersion=3.9.1&quot;</span><span class="w"> </span>-<span class="s2">&quot;DprojectGroupId=io.quarkus.workshop.super-heroes&quot;</span><span class="w"> </span>-<span class="s2">&quot;DprojectArtifactId=event-statistics&quot;</span><span class="w"> </span>-DclassName<span class="o">=</span><span class="s2">&quot;io.quarkus.workshop.superheroes.statistics.StatisticResource&quot;</span><span class="w">   </span>-Dpath<span class="o">=</span><span class="s2">&quot;api/stats&quot;</span><span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;kafka, resteasy-jackson, websockets&quot;</span>
</span></code></pre></div>
<p>If you want your IDE to manage this new Maven project, you can declare it in the parent POM by adding this new module in the <code>&lt;modules&gt;</code> section:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="nt">&lt;module&gt;</span>super-heroes/event-statistics<span class="nt">&lt;/module&gt;</span>
</span></code></pre></div>
<p>Delete all the classes under the <code>io.quarkus.workshop.superheroes.statistics</code> package as well as the associated test classes. There are just examples.</p>
<h4 id="consuming-fight">Consuming Fight</h4>
<p>This service receives the <code>Fight</code> from the fight microservice. So, naturally, we need a fight class.</p>
<p>Create the <code>io.quarkus.workshop.superheroes.statistics.Fight</code> class with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Instant</span><span class="p">;</span>
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a>
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.runtime.annotations.RegisterForReflection</span><span class="p">;</span>
</span><span id="__span-149-6"><a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a>
</span><span id="__span-149-7"><a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="nd">@RegisterForReflection</span>
</span><span id="__span-149-8"><a id="__codelineno-149-8" name="__codelineno-149-8" href="#__codelineno-149-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Fight</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-149-9"><a id="__codelineno-149-9" name="__codelineno-149-9" href="#__codelineno-149-9"></a>
</span><span id="__span-149-10"><a id="__codelineno-149-10" name="__codelineno-149-10" href="#__codelineno-149-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">fightDate</span><span class="p">;</span>
</span><span id="__span-149-11"><a id="__codelineno-149-11" name="__codelineno-149-11" href="#__codelineno-149-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerName</span><span class="p">;</span>
</span><span id="__span-149-12"><a id="__codelineno-149-12" name="__codelineno-149-12" href="#__codelineno-149-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">winnerLevel</span><span class="p">;</span>
</span><span id="__span-149-13"><a id="__codelineno-149-13" name="__codelineno-149-13" href="#__codelineno-149-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerPicture</span><span class="p">;</span>
</span><span id="__span-149-14"><a id="__codelineno-149-14" name="__codelineno-149-14" href="#__codelineno-149-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserName</span><span class="p">;</span>
</span><span id="__span-149-15"><a id="__codelineno-149-15" name="__codelineno-149-15" href="#__codelineno-149-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">loserLevel</span><span class="p">;</span>
</span><span id="__span-149-16"><a id="__codelineno-149-16" name="__codelineno-149-16" href="#__codelineno-149-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserPicture</span><span class="p">;</span>
</span><span id="__span-149-17"><a id="__codelineno-149-17" name="__codelineno-149-17" href="#__codelineno-149-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">winnerTeam</span><span class="p">;</span>
</span><span id="__span-149-18"><a id="__codelineno-149-18" name="__codelineno-149-18" href="#__codelineno-149-18"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">loserTeam</span><span class="p">;</span>
</span><span id="__span-149-19"><a id="__codelineno-149-19" name="__codelineno-149-19" href="#__codelineno-149-19"></a><span class="p">}</span>
</span></code></pre></div>
<p>We also need to a deserializer that will receive the Kafka record and create the <code>Fight</code> instances. Create the <code>io.quarkus.workshop.superheroes.statistics.FightDeserializer</code> class with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.kafka.client.serialization.ObjectMapperDeserializer</span><span class="p">;</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a>
</span><span id="__span-150-5"><a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FightDeserializer</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ObjectMapperDeserializer</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-150-6"><a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a>
</span><span id="__span-150-7"><a id="__codelineno-150-7" name="__codelineno-150-7" href="#__codelineno-150-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">FightDeserializer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-150-8"><a id="__codelineno-150-8" name="__codelineno-150-8" href="#__codelineno-150-8"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">Fight</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span id="__span-150-9"><a id="__codelineno-150-9" name="__codelineno-150-9" href="#__codelineno-150-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-150-10"><a id="__codelineno-150-10" name="__codelineno-150-10" href="#__codelineno-150-10"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="computing-statistics">Computing Statistics</h4>
<p>Now, create the <code>io.quarkus.workshop.superheroes.statistics.SuperStats</code> class with the following content. This class contains two methods annotated with <code>@Incoming</code> and <code>@Outgoing</code>, both consuming the <code>Fight</code> coming from Kafka.</p>
<p>The <code>computeTeamStats</code> method transforms the fight stream into a stream of ratio indicating the amount of victories for heroes and villains. It calls <code>onItem().transform</code> method for each received fight. It sends the computed ratios on the channel <code>team-stats</code>.</p>
<p>The <code>computeTopWinners</code> method uses more advanced reactive programming constructs such as <code>group</code> and <code>scan</code>:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Multi</span><span class="p">;</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Incoming</span><span class="p">;</span>
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Outgoing</span><span class="p">;</span>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a>
</span><span id="__span-151-8"><a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-151-9"><a id="__codelineno-151-9" name="__codelineno-151-9" href="#__codelineno-151-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
</span><span id="__span-151-10"><a id="__codelineno-151-10" name="__codelineno-151-10" href="#__codelineno-151-10"></a>
</span><span id="__span-151-11"><a id="__codelineno-151-11" name="__codelineno-151-11" href="#__codelineno-151-11"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-151-12"><a id="__codelineno-151-12" name="__codelineno-151-12" href="#__codelineno-151-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SuperStats</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-151-13"><a id="__codelineno-151-13" name="__codelineno-151-13" href="#__codelineno-151-13"></a>
</span><span id="__span-151-14"><a id="__codelineno-151-14" name="__codelineno-151-14" href="#__codelineno-151-14"></a><span class="w">    </span><span class="nd">@Inject</span>
</span><span id="__span-151-15"><a id="__codelineno-151-15" name="__codelineno-151-15" href="#__codelineno-151-15"></a><span class="w">    </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-151-16"><a id="__codelineno-151-16" name="__codelineno-151-16" href="#__codelineno-151-16"></a>
</span><span id="__span-151-17"><a id="__codelineno-151-17" name="__codelineno-151-17" href="#__codelineno-151-17"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Ranking</span><span class="w"> </span><span class="n">topWinners</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Ranking</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span id="__span-151-18"><a id="__codelineno-151-18" name="__codelineno-151-18" href="#__codelineno-151-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">TeamStats</span><span class="w"> </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TeamStats</span><span class="p">();</span>
</span><span id="__span-151-19"><a id="__codelineno-151-19" name="__codelineno-151-19" href="#__codelineno-151-19"></a>
</span><span id="__span-151-20"><a id="__codelineno-151-20" name="__codelineno-151-20" href="#__codelineno-151-20"></a><span class="w">    </span><span class="nd">@Incoming</span><span class="p">(</span><span class="s">&quot;fights&quot;</span><span class="p">)</span>
</span><span id="__span-151-21"><a id="__codelineno-151-21" name="__codelineno-151-21" href="#__codelineno-151-21"></a><span class="w">    </span><span class="nd">@Outgoing</span><span class="p">(</span><span class="s">&quot;team-stats&quot;</span><span class="p">)</span>
</span><span id="__span-151-22"><a id="__codelineno-151-22" name="__codelineno-151-22" href="#__codelineno-151-22"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Multi</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">computeTeamStats</span><span class="p">(</span><span class="n">Multi</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-151-23"><a id="__codelineno-151-23" name="__codelineno-151-23" href="#__codelineno-151-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">results</span>
</span><span id="__span-151-24"><a id="__codelineno-151-24" name="__codelineno-151-24" href="#__codelineno-151-24"></a><span class="w">            </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">transform</span><span class="p">(</span><span class="n">stats</span><span class="p">::</span><span class="n">add</span><span class="p">)</span>
</span><span id="__span-151-25"><a id="__codelineno-151-25" name="__codelineno-151-25" href="#__codelineno-151-25"></a><span class="w">            </span><span class="p">.</span><span class="na">invoke</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Fight received. Computed the team statistics&quot;</span><span class="p">));</span>
</span><span id="__span-151-26"><a id="__codelineno-151-26" name="__codelineno-151-26" href="#__codelineno-151-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-151-27"><a id="__codelineno-151-27" name="__codelineno-151-27" href="#__codelineno-151-27"></a>
</span><span id="__span-151-28"><a id="__codelineno-151-28" name="__codelineno-151-28" href="#__codelineno-151-28"></a><span class="w">    </span><span class="nd">@Incoming</span><span class="p">(</span><span class="s">&quot;fights&quot;</span><span class="p">)</span>
</span><span id="__span-151-29"><a id="__codelineno-151-29" name="__codelineno-151-29" href="#__codelineno-151-29"></a><span class="w">    </span><span class="nd">@Outgoing</span><span class="p">(</span><span class="s">&quot;winner-stats&quot;</span><span class="p">)</span>
</span><span id="__span-151-30"><a id="__codelineno-151-30" name="__codelineno-151-30" href="#__codelineno-151-30"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Multi</span><span class="o">&lt;</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Score</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nf">computeTopWinners</span><span class="p">(</span><span class="n">Multi</span><span class="o">&lt;</span><span class="n">Fight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-151-31"><a id="__codelineno-151-31" name="__codelineno-151-31" href="#__codelineno-151-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">results</span>
</span><span id="__span-151-32"><a id="__codelineno-151-32" name="__codelineno-151-32" href="#__codelineno-151-32"></a><span class="w">            </span><span class="p">.</span><span class="na">group</span><span class="p">().</span><span class="na">by</span><span class="p">(</span><span class="n">fight</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerName</span><span class="p">)</span>
</span><span id="__span-151-33"><a id="__codelineno-151-33" name="__codelineno-151-33" href="#__codelineno-151-33"></a><span class="w">            </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">transformToMultiAndMerge</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-151-34"><a id="__codelineno-151-34" name="__codelineno-151-34" href="#__codelineno-151-34"></a><span class="w">                </span><span class="n">group</span>
</span><span id="__span-151-35"><a id="__codelineno-151-35" name="__codelineno-151-35" href="#__codelineno-151-35"></a><span class="w">                    </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">scan</span><span class="p">(</span><span class="n">Score</span><span class="p">::</span><span class="k">new</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">incrementScore</span><span class="p">))</span>
</span><span id="__span-151-36"><a id="__codelineno-151-36" name="__codelineno-151-36" href="#__codelineno-151-36"></a><span class="w">            </span><span class="p">.</span><span class="na">onItem</span><span class="p">().</span><span class="na">transform</span><span class="p">(</span><span class="n">topWinners</span><span class="p">::</span><span class="n">onNewScore</span><span class="p">)</span>
</span><span id="__span-151-37"><a id="__codelineno-151-37" name="__codelineno-151-37" href="#__codelineno-151-37"></a><span class="w">            </span><span class="p">.</span><span class="na">invoke</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Fight received. Computed the top winners&quot;</span><span class="p">));</span>
</span><span id="__span-151-38"><a id="__codelineno-151-38" name="__codelineno-151-38" href="#__codelineno-151-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-151-39"><a id="__codelineno-151-39" name="__codelineno-151-39" href="#__codelineno-151-39"></a>
</span><span id="__span-151-40"><a id="__codelineno-151-40" name="__codelineno-151-40" href="#__codelineno-151-40"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="nf">incrementScore</span><span class="p">(</span><span class="n">Score</span><span class="w"> </span><span class="n">score</span><span class="p">,</span><span class="w"> </span><span class="n">Fight</span><span class="w"> </span><span class="n">fight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-151-41"><a id="__codelineno-151-41" name="__codelineno-151-41" href="#__codelineno-151-41"></a><span class="w">        </span><span class="n">score</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fight</span><span class="p">.</span><span class="na">winnerName</span><span class="p">;</span>
</span><span id="__span-151-42"><a id="__codelineno-151-42" name="__codelineno-151-42" href="#__codelineno-151-42"></a><span class="w">        </span><span class="n">score</span><span class="p">.</span><span class="na">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">score</span><span class="p">.</span><span class="na">score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-151-43"><a id="__codelineno-151-43" name="__codelineno-151-43" href="#__codelineno-151-43"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">score</span><span class="p">;</span>
</span><span id="__span-151-44"><a id="__codelineno-151-44" name="__codelineno-151-44" href="#__codelineno-151-44"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-151-45"><a id="__codelineno-151-45" name="__codelineno-151-45" href="#__codelineno-151-45"></a><span class="p">}</span>
</span></code></pre></div>
<p>In addition, create the <code>io.quarkus.workshop.superheroes.statistics.Ranking</code>, <code>io.quarkus.workshop.superheroes.statistics.Score</code> and <code>io.quarkus.workshop.superheroes.statistics.TeamStats</code> classes with the following contents:</p>
<p>Then, create the <code>Ranking</code> class, used to compute a floating top 10, with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collections</span><span class="p">;</span>
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Comparator</span><span class="p">;</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.LinkedList</span><span class="p">;</span>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Ranking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">;</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Score</span><span class="o">&gt;</span><span class="w"> </span><span class="n">comparator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Comparator</span><span class="p">.</span><span class="na">comparingInt</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">score</span><span class="p">);</span>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a>
</span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Score</span><span class="o">&gt;</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-152-14"><a id="__codelineno-152-14" name="__codelineno-152-14" href="#__codelineno-152-14"></a>
</span><span id="__span-152-15"><a id="__codelineno-152-15" name="__codelineno-152-15" href="#__codelineno-152-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Ranking</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-16"><a id="__codelineno-152-16" name="__codelineno-152-16" href="#__codelineno-152-16"></a><span class="w">        </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
</span><span id="__span-152-17"><a id="__codelineno-152-17" name="__codelineno-152-17" href="#__codelineno-152-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-152-18"><a id="__codelineno-152-18" name="__codelineno-152-18" href="#__codelineno-152-18"></a>
</span><span id="__span-152-19"><a id="__codelineno-152-19" name="__codelineno-152-19" href="#__codelineno-152-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Score</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onNewScore</span><span class="p">(</span><span class="n">Score</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-20"><a id="__codelineno-152-20" name="__codelineno-152-20" href="#__codelineno-152-20"></a><span class="w">        </span><span class="c1">// Remove score if already present,</span>
</span><span id="__span-152-21"><a id="__codelineno-152-21" name="__codelineno-152-21" href="#__codelineno-152-21"></a><span class="w">        </span><span class="n">top</span><span class="p">.</span><span class="na">removeIf</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">name</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">score</span><span class="p">.</span><span class="na">name</span><span class="p">));</span>
</span><span id="__span-152-22"><a id="__codelineno-152-22" name="__codelineno-152-22" href="#__codelineno-152-22"></a><span class="w">        </span><span class="c1">// Add the score</span>
</span><span id="__span-152-23"><a id="__codelineno-152-23" name="__codelineno-152-23" href="#__codelineno-152-23"></a><span class="w">        </span><span class="n">top</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">score</span><span class="p">);</span>
</span><span id="__span-152-24"><a id="__codelineno-152-24" name="__codelineno-152-24" href="#__codelineno-152-24"></a><span class="w">        </span><span class="c1">// Sort</span>
</span><span id="__span-152-25"><a id="__codelineno-152-25" name="__codelineno-152-25" href="#__codelineno-152-25"></a><span class="w">        </span><span class="n">top</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">comparator</span><span class="p">);</span>
</span><span id="__span-152-26"><a id="__codelineno-152-26" name="__codelineno-152-26" href="#__codelineno-152-26"></a>
</span><span id="__span-152-27"><a id="__codelineno-152-27" name="__codelineno-152-27" href="#__codelineno-152-27"></a><span class="w">        </span><span class="c1">// Drop on overflow</span>
</span><span id="__span-152-28"><a id="__codelineno-152-28" name="__codelineno-152-28" href="#__codelineno-152-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">top</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-29"><a id="__codelineno-152-29" name="__codelineno-152-29" href="#__codelineno-152-29"></a><span class="w">            </span><span class="n">top</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">top</span><span class="p">.</span><span class="na">getLast</span><span class="p">());</span>
</span><span id="__span-152-30"><a id="__codelineno-152-30" name="__codelineno-152-30" href="#__codelineno-152-30"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-152-31"><a id="__codelineno-152-31" name="__codelineno-152-31" href="#__codelineno-152-31"></a>
</span><span id="__span-152-32"><a id="__codelineno-152-32" name="__codelineno-152-32" href="#__codelineno-152-32"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">unmodifiableList</span><span class="p">(</span><span class="n">top</span><span class="p">);</span>
</span><span id="__span-152-33"><a id="__codelineno-152-33" name="__codelineno-152-33" href="#__codelineno-152-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-152-34"><a id="__codelineno-152-34" name="__codelineno-152-34" href="#__codelineno-152-34"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>Score</code> class is a simple structure storing the name of a hero or villain and its actual score, <em>i.e.</em> the number of won battles.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.quarkus.runtime.annotations.RegisterForReflection</span><span class="p">;</span>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a>
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a><span class="nd">@RegisterForReflection</span>
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Score</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-153-7"><a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-153-8"><a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="p">;</span>
</span><span id="__span-153-9"><a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a>
</span><span id="__span-153-10"><a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Score</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-153-11"><a id="__codelineno-153-11" name="__codelineno-153-11" href="#__codelineno-153-11"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-153-12"><a id="__codelineno-153-12" name="__codelineno-153-12" href="#__codelineno-153-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-153-13"><a id="__codelineno-153-13" name="__codelineno-153-13" href="#__codelineno-153-13"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>TeamStats</code> class is an object keeping track of the number of battles won by heroes and villains.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="kd">class</span> <span class="nc">TeamStats</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a>
</span><span id="__span-154-5"><a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-154-6"><a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">heroes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-154-7"><a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a>
</span><span id="__span-154-8"><a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">Fight</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-9"><a id="__codelineno-154-9" name="__codelineno-154-9" href="#__codelineno-154-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">winnerTeam</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="s">&quot;heroes&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-10"><a id="__codelineno-154-10" name="__codelineno-154-10" href="#__codelineno-154-10"></a><span class="w">            </span><span class="n">heroes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">heroes</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-154-11"><a id="__codelineno-154-11" name="__codelineno-154-11" href="#__codelineno-154-11"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-12"><a id="__codelineno-154-12" name="__codelineno-154-12" href="#__codelineno-154-12"></a><span class="w">            </span><span class="n">villains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">villains</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-154-13"><a id="__codelineno-154-13" name="__codelineno-154-13" href="#__codelineno-154-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-154-14"><a id="__codelineno-154-14" name="__codelineno-154-14" href="#__codelineno-154-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">heroes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">heroes</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">villains</span><span class="p">));</span>
</span><span id="__span-154-15"><a id="__codelineno-154-15" name="__codelineno-154-15" href="#__codelineno-154-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-154-16"><a id="__codelineno-154-16" name="__codelineno-154-16" href="#__codelineno-154-16"></a><span class="p">}</span>
</span></code></pre></div>
<table><tbody><tr><td><i title="Tip"></i></td><td><p>The <code>@RegisterForReflection</code> annotation instructs the native compilation to allow reflection access to the class. Without, the serialization/deserialization would not work when running the native executable.</p></td></tr></tbody></table>

<h4 id="reading-messages-from-kafka">Reading Messages from Kafka</h4>
<p>It’s now time to connect the <code>fights</code> channel with the Kafka topic.</p>
<p>Edit the <code>application.properties</code> file and add the following content:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="na">quarkus.http.port</span><span class="o">=</span><span class="s">8085</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a>
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="c1">## Custom banner file path</span>
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="na">quarkus.banner.path</span><span class="o">=</span><span class="s">banner.txt</span>
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a>
</span><span id="__span-155-6"><a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a><span class="c1">## Kafka configuration</span>
</span><span id="__span-155-7"><a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a><span class="na">mp.messaging.incoming.fights.connector</span><span class="o">=</span><span class="s">smallrye-kafka</span>
</span><span id="__span-155-8"><a id="__codelineno-155-8" name="__codelineno-155-8" href="#__codelineno-155-8"></a><span class="na">mp.messaging.incoming.fights.auto.offset.reset</span><span class="o">=</span><span class="s">earliest</span>
</span><span id="__span-155-9"><a id="__codelineno-155-9" name="__codelineno-155-9" href="#__codelineno-155-9"></a><span class="na">mp.messaging.incoming.fights.broadcast</span><span class="o">=</span><span class="s">true</span>
</span></code></pre></div>
<p>As for the writing side, it configures the Kafka connector. The <code>mp.messaging.incoming.fights.auto.offset.reset=earliest</code> property indicates that the topic is read from the earliest available record. Check the Kafka configuration to see all the available settings.</p>
<h3 id="sending-events-on-websockets">Sending Events on WebSockets</h3>
<p>At this point, you read the <em>fights</em> from Kafka and computes statistics. Actually, even if you start the application, nothing will happen as nobody consumes these statistics.</p>
<p>In this section, we are going to consume these statistics and send them to two WebSockets. For this, we are going to add two classes and a simple presentation page:</p>
<ul>
<li>
<p><code>TeamStatsWebSocket</code></p>
</li>
<li>
<p><code>TopWinnerWebSocket</code></p>
</li>
<li>
<p><code>index.html</code></p>
</li>
</ul>
<p>Quarkus uses the <a href="http://jcp.org/en/jsr/detail?id=356">JSR 356</a> providing an annotation-driven approach to implement WebSockets.</p>
<h4 id="the-teamstats-websocket">The TeamStats WebSocket</h4>
<p>Create the <code>io.quarkus.workshop.superheroes.statistics.TeamStatsWebSocket</code> class with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Multi</span><span class="p">;</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.subscription.Cancellable</span><span class="p">;</span>
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.annotation.PostConstruct</span><span class="p">;</span>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.annotation.PreDestroy</span><span class="p">;</span>
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Channel</span><span class="p">;</span>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-156-9"><a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a>
</span><span id="__span-156-10"><a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-156-11"><a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
</span><span id="__span-156-12"><a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.OnClose</span><span class="p">;</span>
</span><span id="__span-156-13"><a id="__codelineno-156-13" name="__codelineno-156-13" href="#__codelineno-156-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.OnOpen</span><span class="p">;</span>
</span><span id="__span-156-14"><a id="__codelineno-156-14" name="__codelineno-156-14" href="#__codelineno-156-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.Session</span><span class="p">;</span>
</span><span id="__span-156-15"><a id="__codelineno-156-15" name="__codelineno-156-15" href="#__codelineno-156-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.server.ServerEndpoint</span><span class="p">;</span>
</span><span id="__span-156-16"><a id="__codelineno-156-16" name="__codelineno-156-16" href="#__codelineno-156-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-156-17"><a id="__codelineno-156-17" name="__codelineno-156-17" href="#__codelineno-156-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CopyOnWriteArrayList</span><span class="p">;</span>
</span><span id="__span-156-18"><a id="__codelineno-156-18" name="__codelineno-156-18" href="#__codelineno-156-18"></a>
</span><span id="__span-156-19"><a id="__codelineno-156-19" name="__codelineno-156-19" href="#__codelineno-156-19"></a><span class="nd">@ServerEndpoint</span><span class="p">(</span><span class="s">&quot;/stats/team&quot;</span><span class="p">)</span>
</span><span id="__span-156-20"><a id="__codelineno-156-20" name="__codelineno-156-20" href="#__codelineno-156-20"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-156-21"><a id="__codelineno-156-21" name="__codelineno-156-21" href="#__codelineno-156-21"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TeamStatsWebSocket</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-22"><a id="__codelineno-156-22" name="__codelineno-156-22" href="#__codelineno-156-22"></a>
</span><span id="__span-156-23"><a id="__codelineno-156-23" name="__codelineno-156-23" href="#__codelineno-156-23"></a><span class="w">    </span><span class="nd">@Channel</span><span class="p">(</span><span class="s">&quot;team-stats&quot;</span><span class="p">)</span>
</span><span id="__span-156-24"><a id="__codelineno-156-24" name="__codelineno-156-24" href="#__codelineno-156-24"></a><span class="w">    </span><span class="n">Multi</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stream</span><span class="p">;</span>
</span><span id="__span-156-25"><a id="__codelineno-156-25" name="__codelineno-156-25" href="#__codelineno-156-25"></a>
</span><span id="__span-156-26"><a id="__codelineno-156-26" name="__codelineno-156-26" href="#__codelineno-156-26"></a><span class="w">    </span><span class="nd">@Inject</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-156-27"><a id="__codelineno-156-27" name="__codelineno-156-27" href="#__codelineno-156-27"></a>
</span><span id="__span-156-28"><a id="__codelineno-156-28" name="__codelineno-156-28" href="#__codelineno-156-28"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-156-29"><a id="__codelineno-156-29" name="__codelineno-156-29" href="#__codelineno-156-29"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Cancellable</span><span class="w"> </span><span class="n">cancellable</span><span class="p">;</span>
</span><span id="__span-156-30"><a id="__codelineno-156-30" name="__codelineno-156-30" href="#__codelineno-156-30"></a>
</span><span id="__span-156-31"><a id="__codelineno-156-31" name="__codelineno-156-31" href="#__codelineno-156-31"></a><span class="w">    </span><span class="nd">@OnOpen</span>
</span><span id="__span-156-32"><a id="__codelineno-156-32" name="__codelineno-156-32" href="#__codelineno-156-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOpen</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-33"><a id="__codelineno-156-33" name="__codelineno-156-33" href="#__codelineno-156-33"></a><span class="w">        </span><span class="n">sessions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
</span><span id="__span-156-34"><a id="__codelineno-156-34" name="__codelineno-156-34" href="#__codelineno-156-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-156-35"><a id="__codelineno-156-35" name="__codelineno-156-35" href="#__codelineno-156-35"></a>
</span><span id="__span-156-36"><a id="__codelineno-156-36" name="__codelineno-156-36" href="#__codelineno-156-36"></a><span class="w">    </span><span class="nd">@OnClose</span>
</span><span id="__span-156-37"><a id="__codelineno-156-37" name="__codelineno-156-37" href="#__codelineno-156-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClose</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-38"><a id="__codelineno-156-38" name="__codelineno-156-38" href="#__codelineno-156-38"></a><span class="w">        </span><span class="n">sessions</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
</span><span id="__span-156-39"><a id="__codelineno-156-39" name="__codelineno-156-39" href="#__codelineno-156-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-156-40"><a id="__codelineno-156-40" name="__codelineno-156-40" href="#__codelineno-156-40"></a>
</span><span id="__span-156-41"><a id="__codelineno-156-41" name="__codelineno-156-41" href="#__codelineno-156-41"></a><span class="w">    </span><span class="nd">@PostConstruct</span>
</span><span id="__span-156-42"><a id="__codelineno-156-42" name="__codelineno-156-42" href="#__codelineno-156-42"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-43"><a id="__codelineno-156-43" name="__codelineno-156-43" href="#__codelineno-156-43"></a><span class="w">        </span><span class="n">cancellable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="na">subscribe</span><span class="p">()</span>
</span><span id="__span-156-44"><a id="__codelineno-156-44" name="__codelineno-156-44" href="#__codelineno-156-44"></a><span class="w">            </span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="n">ratio</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sessions</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">ratio</span><span class="p">)));</span>
</span><span id="__span-156-45"><a id="__codelineno-156-45" name="__codelineno-156-45" href="#__codelineno-156-45"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-156-46"><a id="__codelineno-156-46" name="__codelineno-156-46" href="#__codelineno-156-46"></a>
</span><span id="__span-156-47"><a id="__codelineno-156-47" name="__codelineno-156-47" href="#__codelineno-156-47"></a><span class="w">    </span><span class="nd">@PreDestroy</span>
</span><span id="__span-156-48"><a id="__codelineno-156-48" name="__codelineno-156-48" href="#__codelineno-156-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-49"><a id="__codelineno-156-49" name="__codelineno-156-49" href="#__codelineno-156-49"></a><span class="w">        </span><span class="n">cancellable</span><span class="p">.</span><span class="na">cancel</span><span class="p">();</span>
</span><span id="__span-156-50"><a id="__codelineno-156-50" name="__codelineno-156-50" href="#__codelineno-156-50"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-156-51"><a id="__codelineno-156-51" name="__codelineno-156-51" href="#__codelineno-156-51"></a>
</span><span id="__span-156-52"><a id="__codelineno-156-52" name="__codelineno-156-52" href="#__codelineno-156-52"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ratio</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-53"><a id="__codelineno-156-53" name="__codelineno-156-53" href="#__codelineno-156-53"></a><span class="w">        </span><span class="n">session</span><span class="p">.</span><span class="na">getAsyncRemote</span><span class="p">().</span><span class="na">sendText</span><span class="p">(</span><span class="n">Double</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">ratio</span><span class="p">),</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-54"><a id="__codelineno-156-54" name="__codelineno-156-54" href="#__codelineno-156-54"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getException</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-55"><a id="__codelineno-156-55" name="__codelineno-156-55" href="#__codelineno-156-55"></a><span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to write message to web socket&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">getException</span><span class="p">());</span>
</span><span id="__span-156-56"><a id="__codelineno-156-56" name="__codelineno-156-56" href="#__codelineno-156-56"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-156-57"><a id="__codelineno-156-57" name="__codelineno-156-57" href="#__codelineno-156-57"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-156-58"><a id="__codelineno-156-58" name="__codelineno-156-58" href="#__codelineno-156-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-156-59"><a id="__codelineno-156-59" name="__codelineno-156-59" href="#__codelineno-156-59"></a><span class="p">}</span>
</span></code></pre></div>
<p>This component is a WebSocket as specified by the <code>@ServerEndpoint("/stats/team")</code> annotation. It handles the <code>/stats/team</code> WebSocket.</p>
<p>When a client (like a browser) connects to the WebSocket, it keeps track of the session. This session is released when the client disconnects.</p>
<p>The <code>TeamStatsWebSocket</code> also injects a <code>Multi</code> attached to the <code>team-stats</code> channel. After creation, the component subscribes to this stream and broadcasts the fights to the different clients connected to the web socket.</p>
<p>The <em>subscription</em> is an essential part of the stream lifecycle. It indicates that someone is interested in the items transiting on the stream, and it triggers the emission. In this case, it triggers the connection to Kafka and starts receiving the messages from Kafka. Without it, items would not be emitted.</p>
<h4 id="the-topwinner-websocket">The TopWinner WebSocket</h4>
<p>The <code>io.quarkus.workshop.superheroes.statistics.TopWinnerWebSocket</code> follows the same pattern but subscribes to the <code>winner-stats</code> channel.</p>
<p>Create the <code>io.quarkus.workshop.superheroes.statistics.TopWinnerWebSocket</code> with the following content:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">io.quarkus.workshop.superheroes.statistics</span><span class="p">;</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.Multi</span><span class="p">;</span>
</span><span id="__span-157-5"><a id="__codelineno-157-5" name="__codelineno-157-5" href="#__codelineno-157-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.subscription.Cancellable</span><span class="p">;</span>
</span><span id="__span-157-6"><a id="__codelineno-157-6" name="__codelineno-157-6" href="#__codelineno-157-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io.smallrye.mutiny.unchecked.Unchecked</span><span class="p">;</span>
</span><span id="__span-157-7"><a id="__codelineno-157-7" name="__codelineno-157-7" href="#__codelineno-157-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.annotation.PostConstruct</span><span class="p">;</span>
</span><span id="__span-157-8"><a id="__codelineno-157-8" name="__codelineno-157-8" href="#__codelineno-157-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.annotation.PreDestroy</span><span class="p">;</span>
</span><span id="__span-157-9"><a id="__codelineno-157-9" name="__codelineno-157-9" href="#__codelineno-157-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.eclipse.microprofile.reactive.messaging.Channel</span><span class="p">;</span>
</span><span id="__span-157-10"><a id="__codelineno-157-10" name="__codelineno-157-10" href="#__codelineno-157-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.jboss.logging.Logger</span><span class="p">;</span>
</span><span id="__span-157-11"><a id="__codelineno-157-11" name="__codelineno-157-11" href="#__codelineno-157-11"></a>
</span><span id="__span-157-12"><a id="__codelineno-157-12" name="__codelineno-157-12" href="#__codelineno-157-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.enterprise.context.ApplicationScoped</span><span class="p">;</span>
</span><span id="__span-157-13"><a id="__codelineno-157-13" name="__codelineno-157-13" href="#__codelineno-157-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.inject.Inject</span><span class="p">;</span>
</span><span id="__span-157-14"><a id="__codelineno-157-14" name="__codelineno-157-14" href="#__codelineno-157-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.OnClose</span><span class="p">;</span>
</span><span id="__span-157-15"><a id="__codelineno-157-15" name="__codelineno-157-15" href="#__codelineno-157-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.OnOpen</span><span class="p">;</span>
</span><span id="__span-157-16"><a id="__codelineno-157-16" name="__codelineno-157-16" href="#__codelineno-157-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.Session</span><span class="p">;</span>
</span><span id="__span-157-17"><a id="__codelineno-157-17" name="__codelineno-157-17" href="#__codelineno-157-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.websocket.server.ServerEndpoint</span><span class="p">;</span>
</span><span id="__span-157-18"><a id="__codelineno-157-18" name="__codelineno-157-18" href="#__codelineno-157-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
</span><span id="__span-157-19"><a id="__codelineno-157-19" name="__codelineno-157-19" href="#__codelineno-157-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.CopyOnWriteArrayList</span><span class="p">;</span>
</span><span id="__span-157-20"><a id="__codelineno-157-20" name="__codelineno-157-20" href="#__codelineno-157-20"></a>
</span><span id="__span-157-21"><a id="__codelineno-157-21" name="__codelineno-157-21" href="#__codelineno-157-21"></a><span class="nd">@ServerEndpoint</span><span class="p">(</span><span class="s">&quot;/stats/winners&quot;</span><span class="p">)</span>
</span><span id="__span-157-22"><a id="__codelineno-157-22" name="__codelineno-157-22" href="#__codelineno-157-22"></a><span class="nd">@ApplicationScoped</span>
</span><span id="__span-157-23"><a id="__codelineno-157-23" name="__codelineno-157-23" href="#__codelineno-157-23"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TopWinnerWebSocket</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-24"><a id="__codelineno-157-24" name="__codelineno-157-24" href="#__codelineno-157-24"></a>
</span><span id="__span-157-25"><a id="__codelineno-157-25" name="__codelineno-157-25" href="#__codelineno-157-25"></a><span class="w">    </span><span class="nd">@Inject</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
</span><span id="__span-157-26"><a id="__codelineno-157-26" name="__codelineno-157-26" href="#__codelineno-157-26"></a>
</span><span id="__span-157-27"><a id="__codelineno-157-27" name="__codelineno-157-27" href="#__codelineno-157-27"></a><span class="w">    </span><span class="nd">@Inject</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span>
</span><span id="__span-157-28"><a id="__codelineno-157-28" name="__codelineno-157-28" href="#__codelineno-157-28"></a>
</span><span id="__span-157-29"><a id="__codelineno-157-29" name="__codelineno-157-29" href="#__codelineno-157-29"></a><span class="w">    </span><span class="nd">@Channel</span><span class="p">(</span><span class="s">&quot;winner-stats&quot;</span><span class="p">)</span>
</span><span id="__span-157-30"><a id="__codelineno-157-30" name="__codelineno-157-30" href="#__codelineno-157-30"></a><span class="w">    </span><span class="n">Multi</span><span class="o">&lt;</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Score</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">winners</span><span class="p">;</span>
</span><span id="__span-157-31"><a id="__codelineno-157-31" name="__codelineno-157-31" href="#__codelineno-157-31"></a>
</span><span id="__span-157-32"><a id="__codelineno-157-32" name="__codelineno-157-32" href="#__codelineno-157-32"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Session</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-157-33"><a id="__codelineno-157-33" name="__codelineno-157-33" href="#__codelineno-157-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Cancellable</span><span class="w"> </span><span class="n">cancellable</span><span class="p">;</span>
</span><span id="__span-157-34"><a id="__codelineno-157-34" name="__codelineno-157-34" href="#__codelineno-157-34"></a>
</span><span id="__span-157-35"><a id="__codelineno-157-35" name="__codelineno-157-35" href="#__codelineno-157-35"></a><span class="w">    </span><span class="nd">@OnOpen</span>
</span><span id="__span-157-36"><a id="__codelineno-157-36" name="__codelineno-157-36" href="#__codelineno-157-36"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onOpen</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-37"><a id="__codelineno-157-37" name="__codelineno-157-37" href="#__codelineno-157-37"></a><span class="w">        </span><span class="n">sessions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
</span><span id="__span-157-38"><a id="__codelineno-157-38" name="__codelineno-157-38" href="#__codelineno-157-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-157-39"><a id="__codelineno-157-39" name="__codelineno-157-39" href="#__codelineno-157-39"></a>
</span><span id="__span-157-40"><a id="__codelineno-157-40" name="__codelineno-157-40" href="#__codelineno-157-40"></a><span class="w">    </span><span class="nd">@OnClose</span>
</span><span id="__span-157-41"><a id="__codelineno-157-41" name="__codelineno-157-41" href="#__codelineno-157-41"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClose</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-42"><a id="__codelineno-157-42" name="__codelineno-157-42" href="#__codelineno-157-42"></a><span class="w">        </span><span class="n">sessions</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
</span><span id="__span-157-43"><a id="__codelineno-157-43" name="__codelineno-157-43" href="#__codelineno-157-43"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-157-44"><a id="__codelineno-157-44" name="__codelineno-157-44" href="#__codelineno-157-44"></a>
</span><span id="__span-157-45"><a id="__codelineno-157-45" name="__codelineno-157-45" href="#__codelineno-157-45"></a><span class="w">    </span><span class="nd">@PostConstruct</span>
</span><span id="__span-157-46"><a id="__codelineno-157-46" name="__codelineno-157-46" href="#__codelineno-157-46"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-47"><a id="__codelineno-157-47" name="__codelineno-157-47" href="#__codelineno-157-47"></a><span class="w">        </span><span class="n">cancellable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">winners</span>
</span><span id="__span-157-48"><a id="__codelineno-157-48" name="__codelineno-157-48" href="#__codelineno-157-48"></a><span class="w">            </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">Unchecked</span><span class="p">.</span><span class="na">function</span><span class="p">(</span><span class="n">scores</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">scores</span><span class="p">)))</span>
</span><span id="__span-157-49"><a id="__codelineno-157-49" name="__codelineno-157-49" href="#__codelineno-157-49"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">().</span><span class="na">with</span><span class="p">(</span><span class="n">serialized</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sessions</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">session</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">serialized</span><span class="p">)));</span>
</span><span id="__span-157-50"><a id="__codelineno-157-50" name="__codelineno-157-50" href="#__codelineno-157-50"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-157-51"><a id="__codelineno-157-51" name="__codelineno-157-51" href="#__codelineno-157-51"></a>
</span><span id="__span-157-52"><a id="__codelineno-157-52" name="__codelineno-157-52" href="#__codelineno-157-52"></a><span class="w">    </span><span class="nd">@PreDestroy</span>
</span><span id="__span-157-53"><a id="__codelineno-157-53" name="__codelineno-157-53" href="#__codelineno-157-53"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-54"><a id="__codelineno-157-54" name="__codelineno-157-54" href="#__codelineno-157-54"></a><span class="w">        </span><span class="n">cancellable</span><span class="p">.</span><span class="na">cancel</span><span class="p">();</span>
</span><span id="__span-157-55"><a id="__codelineno-157-55" name="__codelineno-157-55" href="#__codelineno-157-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-157-56"><a id="__codelineno-157-56" name="__codelineno-157-56" href="#__codelineno-157-56"></a>
</span><span id="__span-157-57"><a id="__codelineno-157-57" name="__codelineno-157-57" href="#__codelineno-157-57"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="n">Session</span><span class="w"> </span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">serialized</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-58"><a id="__codelineno-157-58" name="__codelineno-157-58" href="#__codelineno-157-58"></a><span class="w">        </span><span class="n">session</span><span class="p">.</span><span class="na">getAsyncRemote</span><span class="p">().</span><span class="na">sendText</span><span class="p">(</span><span class="n">serialized</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-59"><a id="__codelineno-157-59" name="__codelineno-157-59" href="#__codelineno-157-59"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getException</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-157-60"><a id="__codelineno-157-60" name="__codelineno-157-60" href="#__codelineno-157-60"></a><span class="w">                </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to write message to web socket&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">getException</span><span class="p">());</span>
</span><span id="__span-157-61"><a id="__codelineno-157-61" name="__codelineno-157-61" href="#__codelineno-157-61"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-157-62"><a id="__codelineno-157-62" name="__codelineno-157-62" href="#__codelineno-157-62"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-157-63"><a id="__codelineno-157-63" name="__codelineno-157-63" href="#__codelineno-157-63"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-157-64"><a id="__codelineno-157-64" name="__codelineno-157-64" href="#__codelineno-157-64"></a><span class="p">}</span>
</span></code></pre></div>
<p>Because the items (top 10) need to be serialized, the <code>TopWinnerWebSocket</code> also use Jackson to transform the object into a serialized form.</p>
<h4 id="the-ui">The UI</h4>
<p>Finally, you need a UI to watch these live statistics.</p>
<p>Replace the <code>META-INF/resources/index.html</code> file with the following content:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="nt">&lt;html</span><span class="w"> </span><span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="nt">&lt;head&gt;</span>
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="w">    </span><span class="nt">&lt;meta</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="w">    </span><span class="nt">&lt;title&gt;</span>Super<span class="w"> </span>Battle<span class="w"> </span>Stats<span class="nt">&lt;/title&gt;</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-8"><a id="__codelineno-158-8" name="__codelineno-158-8" href="#__codelineno-158-8"></a><span class="w">    </span><span class="nt">&lt;link</span><span class="w"> </span><span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-9"><a id="__codelineno-158-9" name="__codelineno-158-9" href="#__codelineno-158-9"></a>
</span><span id="__span-158-10"><a id="__codelineno-158-10" name="__codelineno-158-10" href="#__codelineno-158-10"></a><span class="w">    </span><span class="nt">&lt;style&gt;</span>
</span><span id="__span-158-11"><a id="__codelineno-158-11" name="__codelineno-158-11" href="#__codelineno-158-11"></a><span class="w">        </span>.page-title<span class="w"> </span>{
</span><span id="__span-158-12"><a id="__codelineno-158-12" name="__codelineno-158-12" href="#__codelineno-158-12"></a><span class="w">            </span>font-size:<span class="w"> </span>xx-large;
</span><span id="__span-158-13"><a id="__codelineno-158-13" name="__codelineno-158-13" href="#__codelineno-158-13"></a><span class="w">        </span>}
</span><span id="__span-158-14"><a id="__codelineno-158-14" name="__codelineno-158-14" href="#__codelineno-158-14"></a>
</span><span id="__span-158-15"><a id="__codelineno-158-15" name="__codelineno-158-15" href="#__codelineno-158-15"></a><span class="w">        </span>.progress<span class="w"> </span>{
</span><span id="__span-158-16"><a id="__codelineno-158-16" name="__codelineno-158-16" href="#__codelineno-158-16"></a><span class="w">            </span>background-color:<span class="w"> </span>firebrick;
</span><span id="__span-158-17"><a id="__codelineno-158-17" name="__codelineno-158-17" href="#__codelineno-158-17"></a><span class="w">        </span>}
</span><span id="__span-158-18"><a id="__codelineno-158-18" name="__codelineno-158-18" href="#__codelineno-158-18"></a>
</span><span id="__span-158-19"><a id="__codelineno-158-19" name="__codelineno-158-19" href="#__codelineno-158-19"></a><span class="w">        </span>.progress-bar<span class="w"> </span>{
</span><span id="__span-158-20"><a id="__codelineno-158-20" name="__codelineno-158-20" href="#__codelineno-158-20"></a><span class="w">            </span>background:<span class="w"> </span>dodgerblue;
</span><span id="__span-158-21"><a id="__codelineno-158-21" name="__codelineno-158-21" href="#__codelineno-158-21"></a><span class="w">        </span>}
</span><span id="__span-158-22"><a id="__codelineno-158-22" name="__codelineno-158-22" href="#__codelineno-158-22"></a>
</span><span id="__span-158-23"><a id="__codelineno-158-23" name="__codelineno-158-23" href="#__codelineno-158-23"></a><span class="w">    </span><span class="nt">&lt;/style&gt;</span>
</span><span id="__span-158-24"><a id="__codelineno-158-24" name="__codelineno-158-24" href="#__codelineno-158-24"></a><span class="nt">&lt;/head&gt;</span>
</span><span id="__span-158-25"><a id="__codelineno-158-25" name="__codelineno-158-25" href="#__codelineno-158-25"></a><span class="nt">&lt;body&gt;</span>
</span><span id="__span-158-26"><a id="__codelineno-158-26" name="__codelineno-158-26" href="#__codelineno-158-26"></a><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-27"><a id="__codelineno-158-27" name="__codelineno-158-27" href="#__codelineno-158-27"></a><span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-28"><a id="__codelineno-158-28" name="__codelineno-158-28" href="#__codelineno-158-28"></a><span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col&quot;</span><span class="nt">&gt;&lt;h1</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;page-title&quot;</span><span class="nt">&gt;</span>Super<span class="w"> </span>Stats<span class="nt">&lt;/h1&gt;&lt;/div&gt;</span>
</span><span id="__span-158-29"><a id="__codelineno-158-29" name="__codelineno-158-29" href="#__codelineno-158-29"></a><span class="w">    </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-30"><a id="__codelineno-158-30" name="__codelineno-158-30" href="#__codelineno-158-30"></a><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-31"><a id="__codelineno-158-31" name="__codelineno-158-31" href="#__codelineno-158-31"></a><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;container container-cards-pf&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-32"><a id="__codelineno-158-32" name="__codelineno-158-32" href="#__codelineno-158-32"></a><span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;row row-cards-pf&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-33"><a id="__codelineno-158-33" name="__codelineno-158-33" href="#__codelineno-158-33"></a><span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-xs-12 col-sm-6 col-md-4 col-lg-3&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-34"><a id="__codelineno-158-34" name="__codelineno-158-34" href="#__codelineno-158-34"></a><span class="w">            </span><span class="cm">&lt;!-- Top winners --&gt;</span>
</span><span id="__span-158-35"><a id="__codelineno-158-35" name="__codelineno-158-35" href="#__codelineno-158-35"></a><span class="w">            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;card-pf card-pf-view card-pf-view-select&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-36"><a id="__codelineno-158-36" name="__codelineno-158-36" href="#__codelineno-158-36"></a><span class="w">                </span><span class="nt">&lt;h2</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;card-pf-title&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-37"><a id="__codelineno-158-37" name="__codelineno-158-37" href="#__codelineno-158-37"></a><span class="w">                    </span><span class="nt">&lt;i</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;fa fa-trophy&quot;</span><span class="nt">&gt;&lt;/i&gt;</span><span class="w"> </span>Top<span class="w"> </span>Winner
</span><span id="__span-158-38"><a id="__codelineno-158-38" name="__codelineno-158-38" href="#__codelineno-158-38"></a><span class="w">                </span><span class="nt">&lt;/h2&gt;</span>
</span><span id="__span-158-39"><a id="__codelineno-158-39" name="__codelineno-158-39" href="#__codelineno-158-39"></a><span class="w">                </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;card-pf-body&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-40"><a id="__codelineno-158-40" name="__codelineno-158-40" href="#__codelineno-158-40"></a><span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;top-winner&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-41"><a id="__codelineno-158-41" name="__codelineno-158-41" href="#__codelineno-158-41"></a>
</span><span id="__span-158-42"><a id="__codelineno-158-42" name="__codelineno-158-42" href="#__codelineno-158-42"></a><span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-43"><a id="__codelineno-158-43" name="__codelineno-158-43" href="#__codelineno-158-43"></a><span class="w">                </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-44"><a id="__codelineno-158-44" name="__codelineno-158-44" href="#__codelineno-158-44"></a><span class="w">            </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-45"><a id="__codelineno-158-45" name="__codelineno-158-45" href="#__codelineno-158-45"></a><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-46"><a id="__codelineno-158-46" name="__codelineno-158-46" href="#__codelineno-158-46"></a>
</span><span id="__span-158-47"><a id="__codelineno-158-47" name="__codelineno-158-47" href="#__codelineno-158-47"></a><span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-xs-12 col-sm-8 col-md-6 col-lg-6&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-48"><a id="__codelineno-158-48" name="__codelineno-158-48" href="#__codelineno-158-48"></a><span class="w">            </span><span class="cm">&lt;!-- Top losers --&gt;</span>
</span><span id="__span-158-49"><a id="__codelineno-158-49" name="__codelineno-158-49" href="#__codelineno-158-49"></a><span class="w">            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;card-pf card-pf-view card-pf-view-select&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-50"><a id="__codelineno-158-50" name="__codelineno-158-50" href="#__codelineno-158-50"></a><span class="w">                </span><span class="nt">&lt;h2</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;card-pf-title&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-51"><a id="__codelineno-158-51" name="__codelineno-158-51" href="#__codelineno-158-51"></a><span class="w">                    </span><span class="nt">&lt;i</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;fa pficon-rebalance&quot;</span><span class="nt">&gt;&lt;/i&gt;</span><span class="w"> </span>Heroes<span class="w"> </span>vs.<span class="w"> </span>Villains
</span><span id="__span-158-52"><a id="__codelineno-158-52" name="__codelineno-158-52" href="#__codelineno-158-52"></a><span class="w">                </span><span class="nt">&lt;/h2&gt;</span>
</span><span id="__span-158-53"><a id="__codelineno-158-53" name="__codelineno-158-53" href="#__codelineno-158-53"></a><span class="w">                </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;card-pf-body&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-54"><a id="__codelineno-158-54" name="__codelineno-158-54" href="#__codelineno-158-54"></a><span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;progress-container progress-description-left progress-label-right&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-55"><a id="__codelineno-158-55" name="__codelineno-158-55" href="#__codelineno-158-55"></a><span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;progress-description&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-56"><a id="__codelineno-158-56" name="__codelineno-158-56" href="#__codelineno-158-56"></a><span class="w">                            </span>Heroes
</span><span id="__span-158-57"><a id="__codelineno-158-57" name="__codelineno-158-57" href="#__codelineno-158-57"></a><span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-58"><a id="__codelineno-158-58" name="__codelineno-158-58" href="#__codelineno-158-58"></a><span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;progress&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-59"><a id="__codelineno-158-59" name="__codelineno-158-59" href="#__codelineno-158-59"></a><span class="w">                            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;balance&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;progress-bar&quot;</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;progressbar&quot;</span><span class="w"> </span><span class="na">aria-valuenow=</span><span class="s">&quot;50&quot;</span><span class="w"> </span><span class="na">aria-valuemin=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">aria-valuemax=</span><span class="s">&quot;100&quot;</span><span class="w"> </span><span class="na">style=</span><span class="s">&quot;width: 50%;&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-158-60"><a id="__codelineno-158-60" name="__codelineno-158-60" href="#__codelineno-158-60"></a><span class="w">                                </span><span class="nt">&lt;span&gt;</span>Villains<span class="nt">&lt;/span&gt;</span>
</span><span id="__span-158-61"><a id="__codelineno-158-61" name="__codelineno-158-61" href="#__codelineno-158-61"></a><span class="w">                            </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-62"><a id="__codelineno-158-62" name="__codelineno-158-62" href="#__codelineno-158-62"></a><span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-63"><a id="__codelineno-158-63" name="__codelineno-158-63" href="#__codelineno-158-63"></a><span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-64"><a id="__codelineno-158-64" name="__codelineno-158-64" href="#__codelineno-158-64"></a><span class="w">                </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-65"><a id="__codelineno-158-65" name="__codelineno-158-65" href="#__codelineno-158-65"></a><span class="w">            </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-66"><a id="__codelineno-158-66" name="__codelineno-158-66" href="#__codelineno-158-66"></a><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-67"><a id="__codelineno-158-67" name="__codelineno-158-67" href="#__codelineno-158-67"></a><span class="w">    </span><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-68"><a id="__codelineno-158-68" name="__codelineno-158-68" href="#__codelineno-158-68"></a><span class="nt">&lt;/div&gt;</span>
</span><span id="__span-158-69"><a id="__codelineno-158-69" name="__codelineno-158-69" href="#__codelineno-158-69"></a>
</span><span id="__span-158-70"><a id="__codelineno-158-70" name="__codelineno-158-70" href="#__codelineno-158-70"></a><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span id="__span-158-71"><a id="__codelineno-158-71" name="__codelineno-158-71" href="#__codelineno-158-71"></a><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span id="__span-158-72"><a id="__codelineno-158-72" name="__codelineno-158-72" href="#__codelineno-158-72"></a><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/js/patternfly.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span id="__span-158-73"><a id="__codelineno-158-73" name="__codelineno-158-73" href="#__codelineno-158-73"></a><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.11/c3.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span id="__span-158-74"><a id="__codelineno-158-74" name="__codelineno-158-74" href="#__codelineno-158-74"></a><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span id="__span-158-75"><a id="__codelineno-158-75" name="__codelineno-158-75" href="#__codelineno-158-75"></a>
</span><span id="__span-158-76"><a id="__codelineno-158-76" name="__codelineno-158-76" href="#__codelineno-158-76"></a><span class="nt">&lt;script&gt;</span>
</span><span id="__span-158-77"><a id="__codelineno-158-77" name="__codelineno-158-77" href="#__codelineno-158-77"></a><span class="w">    </span>$(document).ready(function()<span class="w"> </span>{
</span><span id="__span-158-78"><a id="__codelineno-158-78" name="__codelineno-158-78" href="#__codelineno-158-78"></a><span class="w">        </span>var<span class="w"> </span>host<span class="w"> </span>=<span class="w"> </span>window.location.host;
</span><span id="__span-158-79"><a id="__codelineno-158-79" name="__codelineno-158-79" href="#__codelineno-158-79"></a><span class="w">        </span>var<span class="w"> </span>protocol<span class="w"> </span>=<span class="w"> </span>(window.location.protocol<span class="w"> </span>==<span class="w"> </span>&quot;https:&quot;)<span class="w"> </span>?<span class="w"> </span>&quot;wss&quot;<span class="w"> </span>:<span class="w"> </span>&quot;ws&quot;;
</span><span id="__span-158-80"><a id="__codelineno-158-80" name="__codelineno-158-80" href="#__codelineno-158-80"></a>
</span><span id="__span-158-81"><a id="__codelineno-158-81" name="__codelineno-158-81" href="#__codelineno-158-81"></a><span class="w">        </span>var<span class="w"> </span>top<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>WebSocket(protocol<span class="w"> </span>+<span class="w"> </span>&quot;://&quot;<span class="w"> </span>+<span class="w"> </span>host<span class="w"> </span>+<span class="w"> </span>&quot;/stats/winners&quot;);
</span><span id="__span-158-82"><a id="__codelineno-158-82" name="__codelineno-158-82" href="#__codelineno-158-82"></a><span class="w">        </span>top.onmessage<span class="w"> </span>=<span class="w"> </span>function<span class="w"> </span>(event)<span class="w"> </span>{
</span><span id="__span-158-83"><a id="__codelineno-158-83" name="__codelineno-158-83" href="#__codelineno-158-83"></a><span class="w">            </span>updateTop(event.data);
</span><span id="__span-158-84"><a id="__codelineno-158-84" name="__codelineno-158-84" href="#__codelineno-158-84"></a><span class="w">        </span>};
</span><span id="__span-158-85"><a id="__codelineno-158-85" name="__codelineno-158-85" href="#__codelineno-158-85"></a><span class="w">        </span>var<span class="w"> </span>team<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>WebSocket(protocol<span class="w"> </span>+<span class="w"> </span>&quot;://&quot;<span class="w"> </span>+<span class="w"> </span>host<span class="w"> </span>+<span class="w"> </span>&quot;/stats/team&quot;);
</span><span id="__span-158-86"><a id="__codelineno-158-86" name="__codelineno-158-86" href="#__codelineno-158-86"></a><span class="w">        </span>team.onmessage<span class="w"> </span>=<span class="w"> </span>function(event)<span class="w"> </span>{
</span><span id="__span-158-87"><a id="__codelineno-158-87" name="__codelineno-158-87" href="#__codelineno-158-87"></a><span class="w">            </span>console.log(event.data);
</span><span id="__span-158-88"><a id="__codelineno-158-88" name="__codelineno-158-88" href="#__codelineno-158-88"></a><span class="w">            </span>updateRatio(event.data);
</span><span id="__span-158-89"><a id="__codelineno-158-89" name="__codelineno-158-89" href="#__codelineno-158-89"></a><span class="w">        </span>};
</span><span id="__span-158-90"><a id="__codelineno-158-90" name="__codelineno-158-90" href="#__codelineno-158-90"></a><span class="w">    </span>});
</span><span id="__span-158-91"><a id="__codelineno-158-91" name="__codelineno-158-91" href="#__codelineno-158-91"></a>
</span><span id="__span-158-92"><a id="__codelineno-158-92" name="__codelineno-158-92" href="#__codelineno-158-92"></a>
</span><span id="__span-158-93"><a id="__codelineno-158-93" name="__codelineno-158-93" href="#__codelineno-158-93"></a><span class="w">    </span>function<span class="w"> </span>updateTop(scores)<span class="w"> </span>{
</span><span id="__span-158-94"><a id="__codelineno-158-94" name="__codelineno-158-94" href="#__codelineno-158-94"></a><span class="w">        </span>$(&quot;#top-winner&quot;).children(&quot;p&quot;).remove();
</span><span id="__span-158-95"><a id="__codelineno-158-95" name="__codelineno-158-95" href="#__codelineno-158-95"></a><span class="w">        </span>JSON.parse(scores).forEach(function(score)<span class="w"> </span>{
</span><span id="__span-158-96"><a id="__codelineno-158-96" name="__codelineno-158-96" href="#__codelineno-158-96"></a><span class="w">            </span>$(&quot;#top-winner&quot;).append($(&quot;<span class="nt">&lt;p&gt;</span>&quot;<span class="w"> </span>+<span class="w"> </span>score.name<span class="w"> </span>+<span class="w"> </span>&quot;<span class="w"> </span>[&quot;<span class="w"> </span>+<span class="w"> </span>score.score<span class="w"> </span>+<span class="w"> </span>&quot;]<span class="nt">&lt;/p&gt;</span>&quot;))
</span><span id="__span-158-97"><a id="__codelineno-158-97" name="__codelineno-158-97" href="#__codelineno-158-97"></a><span class="w">        </span>});
</span><span id="__span-158-98"><a id="__codelineno-158-98" name="__codelineno-158-98" href="#__codelineno-158-98"></a><span class="w">    </span>}
</span><span id="__span-158-99"><a id="__codelineno-158-99" name="__codelineno-158-99" href="#__codelineno-158-99"></a>
</span><span id="__span-158-100"><a id="__codelineno-158-100" name="__codelineno-158-100" href="#__codelineno-158-100"></a><span class="w">    </span>function<span class="w"> </span>updateRatio(ratio)<span class="w"> </span>{
</span><span id="__span-158-101"><a id="__codelineno-158-101" name="__codelineno-158-101" href="#__codelineno-158-101"></a><span class="w">        </span>var<span class="w"> </span>percent<span class="w"> </span>=<span class="w"> </span>ratio<span class="w"> </span>*<span class="w"> </span>100;
</span><span id="__span-158-102"><a id="__codelineno-158-102" name="__codelineno-158-102" href="#__codelineno-158-102"></a><span class="w">        </span>$(&quot;#balance&quot;).attr(&quot;aria-valuenow&quot;,<span class="w"> </span>ratio<span class="w"> </span>*<span class="w"> </span>100).attr(&quot;style&quot;,<span class="w"> </span>&quot;width:<span class="w"> </span>&quot;<span class="w"> </span>+<span class="w"> </span>percent<span class="w"> </span>+<span class="w"> </span>&quot;%;&quot;);
</span><span id="__span-158-103"><a id="__codelineno-158-103" name="__codelineno-158-103" href="#__codelineno-158-103"></a><span class="w">    </span>}
</span><span id="__span-158-104"><a id="__codelineno-158-104" name="__codelineno-158-104" href="#__codelineno-158-104"></a><span class="nt">&lt;/script&gt;</span>
</span><span id="__span-158-105"><a id="__codelineno-158-105" name="__codelineno-158-105" href="#__codelineno-158-105"></a><span class="nt">&lt;/body&gt;</span>
</span><span id="__span-158-106"><a id="__codelineno-158-106" name="__codelineno-158-106" href="#__codelineno-158-106"></a><span class="nt">&lt;/html&gt;</span>
</span></code></pre></div>
<h4 id="running-the-application_3">Running the Application</h4>
<p>You are all set!</p>
<p>Time to start the application using:</p>
<p>Then, open <code>[http://localhost:8085](http://localhost:8085/)</code> in a new browser window. Trigger some fights, and you should see the live statistics moving.</p>
<p><img alt="react ui stats" src="../Quarkus%20Super-Heroes%20Workshop%202024-03-11%20Quarkus%203.6.0/react-ui-stats.png" /></p>
<p>Quarkus automatically reuse the Kafka broker from the fight service. So, make sure the fight service is started.</p>
<h2 id="building-native-executables">Building Native Executables</h2>
<hr />
<p>Let’s now produce native executables for our application. Thanks to its GraalVM integration, Quarkus can easily generate native executables. Just like Go, native executables don’t need a VM to run; they contain the whole application, like an <code>.exe</code> file on Windows.</p>
<h3 id="building-native-executables-with-quarkus">Building Native Executables with Quarkus</h3>
<p>Having native executables for our microservices improves their startup time and produces a minimal disk footprint. This can be a big plus if your microservices run in a serverless environment where scaling from zero is important. The produced binary has everything to run the application, including the needed parts of the "JVM" (shrunk to be just enough to run the application), and the application itself.</p>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Choosing JVM execution vs. native executable execution depends on your application needs and environment.</p></td></tr></tbody></table>

<p>To be able to build native executables, you need GraalVM to be installed. And make sure you have the <code>GRAALVM_HOME</code> environment variable defined and pointing to where you installed GraalVM. Then, if you look at all the <code>pom.xml</code> files, you will find the following profile. This allows you to build a native executable just by invoking <code>./mvnw package -Pnative</code>.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="nt">&lt;profile&gt;</span>
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="w">    </span><span class="nt">&lt;id&gt;</span>native<span class="nt">&lt;/id&gt;</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a><span class="w">    </span><span class="nt">&lt;activation&gt;</span>
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="w">        </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-159-5"><a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a><span class="w">            </span><span class="nt">&lt;name&gt;</span>native<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-159-6"><a id="__codelineno-159-6" name="__codelineno-159-6" href="#__codelineno-159-6"></a><span class="w">        </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-159-7"><a id="__codelineno-159-7" name="__codelineno-159-7" href="#__codelineno-159-7"></a><span class="w">    </span><span class="nt">&lt;/activation&gt;</span>
</span><span id="__span-159-8"><a id="__codelineno-159-8" name="__codelineno-159-8" href="#__codelineno-159-8"></a><span class="w">    </span><span class="nt">&lt;properties&gt;</span>
</span><span id="__span-159-9"><a id="__codelineno-159-9" name="__codelineno-159-9" href="#__codelineno-159-9"></a><span class="w">        </span><span class="nt">&lt;skipITs&gt;</span>false<span class="nt">&lt;/skipITs&gt;</span>
</span><span id="__span-159-10"><a id="__codelineno-159-10" name="__codelineno-159-10" href="#__codelineno-159-10"></a><span class="w">        </span><span class="nt">&lt;quarkus.package.type&gt;</span>native<span class="nt">&lt;/quarkus.package.type&gt;</span>
</span><span id="__span-159-11"><a id="__codelineno-159-11" name="__codelineno-159-11" href="#__codelineno-159-11"></a><span class="w">    </span><span class="nt">&lt;/properties&gt;</span>
</span><span id="__span-159-12"><a id="__codelineno-159-12" name="__codelineno-159-12" href="#__codelineno-159-12"></a><span class="nt">&lt;/profile&gt;</span>
</span></code></pre></div>
<h3 id="building-native-executables-for-our-microservices">Building Native Executables for our Microservices</h3>
<p>Let’s create native executables for all our microservices. Well, maybe not all of them. Let’s see.</p>
<p>From the root <code>super-heroes</code> directory, run the following commands (to speed up the compilation you can also skip the tests by adding <code>-Dmaven.test.skip=true</code>):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-fights/pom.xml<span class="w"> </span>package<span class="w"> </span>-Pnative
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-heroes/pom.xml<span class="w"> </span>package<span class="w"> </span>-Pnative
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-villains/pom.xml<span class="w"> </span>package<span class="w"> </span>-Pnative
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>ui-super-heroes/pom.xml<span class="w"> </span>package<span class="w"> </span>-Pnative
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>event-statistics/pom.xml<span class="w"> </span>package<span class="w"> </span>-Pnative
</span></code></pre></div>
<table><tbody><tr><td><i title="Warning"></i></td><td><p>Creating a native executable requires a lot of memory and CPU. It also takes a few minutes, even for a simple application like the Villain microservice. Most of the time is spent during the dead code elimination, as it traverses the whole (closed) world.</p></td></tr></tbody></table>

<p>During the compilation of each microservice, you see a lot of information about the native compilation. Below is a summary of the output for that you will get.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a>===========================================================================================
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a>GraalVM Native Image: Generating &#39;rest-heroes-1.0.0-SNAPSHOT-runner&#39; (executable)...
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a>===========================================================================================
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a>[1/8] Initializing...                                                      (24.3s @ 0.53GB)
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a>[2/8] Performing analysis...
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a>[3/8] Building universe...                                                  (6.9s @ 4.64GB)
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a>[4/8] Parsing methods...      [***]                                         (5.1s @ 2.80GB)
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a>[5/8] Inlining methods...     [***]                                         (2.1s @ 4.71GB)
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9" href="#__codelineno-161-9"></a>[6/8] Compiling methods...    [********]                                  (67.6s @ 10.11GB)
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10" href="#__codelineno-161-10"></a>[7/8] Layouting methods...    [***]                                         (9.4s @ 4.04GB)
</span><span id="__span-161-11"><a id="__codelineno-161-11" name="__codelineno-161-11" href="#__codelineno-161-11"></a>[8/8] Creating image...       [***]                                         (9.1s @ 5.41GB)
</span></code></pre></div>
<p>If you try to execute <code>./mvnw package -Pnative</code> in the Narration microservice, the compilation will fail. You will get something like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a>===========================================================================================
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a>GraalVM Native Image: Generating &#39;rest-narration-1.0.0-SNAPSHOT-runner&#39; (executable)...
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a>===========================================================================================
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a>[1/8] Initializing...                                                      (24.3s @ 0.53GB)
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5" href="#__codelineno-162-5"></a>[2/8] Performing analysis...
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6" href="#__codelineno-162-6"></a>ERROR [com.azu.cor.imp.jac.XmlMapperFactory] Failed to retrieve MethodHandles used to create XmlMapper. XML serialization won&#39;t be supported until &#39;com.fasterxml.jackson.dataformat:jackson-dataformat-xml&#39;
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7" href="#__codelineno-162-7"></a>ERROR [com.azu.cor.imp.jac.ObjectMapperShim] Package versions: jackson-core=2.15.2, jackson-databind=2.15.2, jackson-dataformat-xml=unknown, jackson-datatype-jsr310=2.15.2
</span><span id="__span-162-8"><a id="__codelineno-162-8" name="__codelineno-162-8" href="#__codelineno-162-8"></a>Error: Classes that should be initialized at run time got initialized during image building
</span></code></pre></div>
<p>That’s because the Narration microservice uses external libraries that are not easily compilable with GraaVM. Not all libraries are compatible with GraalVM out of the box. Therefore, we will keep on running the Narration microservice in JVM mode, not in native mode.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-narration/pom.xml<span class="w"> </span>clean<span class="w"> </span>package
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Do you remember the <code>@RegisterForReflection</code> annotation that we used in the Statistics microservice? Well, this annotation instructs the native compilation to allow reflection access to the class. Without it, the serialization/deserialization would not work when running the native executable. This information is required when running the application as a native executable.</p></td></tr></tbody></table>

<h3 id="running-the-application-in-native-mode">Running the Application in Native mode</h3>
<p>The native compilation takes a while. In addition to the regular files, the build also produces <code>target/xxx-yyy-1.0.0-SNAPSHOT-runner</code> files. Notice that there is no <code>.jar</code> file extension. It’s just a binary file that you can execute directly like any other binary. Let’s execute the entire application in native mode.</p>
<p>Native mode is using the <code>prod</code> profile, meaning that the infrastructure needs to be up and running (<code>docker compose -f docker-compose.yaml up -d</code>). Then, from the root <code>super-heroes</code> directory, run the following commands (to speed up the compilation you can also skip the tests by adding <code>-Dmaven.test.skip=true</code>):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a>./rest-fights/target/rest-fights-1.0.0-SNAPSHOT-runner
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a>./rest-heroes/target/rest-heroes-1.0.0-SNAPSHOT-runner
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a>./rest-villains/target/rest-villains-1.0.0-SNAPSHOT-runner
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a>./ui-super-heroes/target/ui-super-heroes-1.0.0-SNAPSHOT-runner
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a>./event-statistics/target/event-statistics-1.0.0-SNAPSHOT-runner
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a>./rest-narration/target/quarkus-app/quarkus-run.jar
</span></code></pre></div>
<h2 id="building-containers">Building Containers</h2>
<hr />
<p>In this chapter we will build containers out of our Quarkus microservices and execute them locally thanks to Docker Compose. Thanks to Quarkus Cloud Native capabilities, we will be able to build and execute containers easily. We will also produce Linux 64 bits native executables and runs them in a container. The native compilation uses the OS and architecture of the host system.</p>
<h3 id="building-containers-with-quarkus">Building Containers with Quarkus</h3>
<p>When we bootstrapped our microservices with the Maven Quarkus plugin, a set of <code>Dockerfiles</code> have been generated under <code>src/main/docker</code>:</p>
<ul>
<li>
<p><code>Dockerfile.jvm</code>: Dockerfile is used in order to build a container that runs the Quarkus application in JVM mode.</p>
</li>
<li>
<p><code>Dockerfile.legacy-jar</code>: Deprecated Dockerfile building a container in JVM mode.</p>
</li>
<li>
<p><code>Dockerfile.native</code>: Dockerfile is used in order to build a container that runs the Quarkus application in native (no JVM) mode.</p>
</li>
<li>
<p><code>Dockerfile.native-micro</code>: Same as above but it uses a micro base image, tuned for Quarkus native executables.</p>
</li>
</ul>
<p>Quarkus is able to build a container image automatically. It proposes multiple approaches to do so, but we recommend using <a href="https://github.com/GoogleContainerTools/jib">jib</a>. As you have guessed by now, using jib is as simple as adding a Quarkus extension to each project.</p>
<h3 id="building-containers-for-our-microservices-in-jvm-mode">Building Containers for our Microservices in JVM Mode</h3>
<p>The <code>Dockerfile.jvm</code> file is for running the application in JVM mode. It looks like this:</p>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">registry.access.redhat.com/ubi8/openjdk-17:1.18</span>
</span><span id="__span-165-2"><a id="__codelineno-165-2" name="__codelineno-165-2" href="#__codelineno-165-2"></a>
</span><span id="__span-165-3"><a id="__codelineno-165-3" name="__codelineno-165-3" href="#__codelineno-165-3"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">LANGUAGE</span><span class="o">=</span><span class="s1">&#39;en_US:en&#39;</span>
</span><span id="__span-165-4"><a id="__codelineno-165-4" name="__codelineno-165-4" href="#__codelineno-165-4"></a>
</span><span id="__span-165-5"><a id="__codelineno-165-5" name="__codelineno-165-5" href="#__codelineno-165-5"></a>
</span><span id="__span-165-6"><a id="__codelineno-165-6" name="__codelineno-165-6" href="#__codelineno-165-6"></a><span class="c"># We make four distinct layers so if there are application changes the library layers can be re-used</span>
</span><span id="__span-165-7"><a id="__codelineno-165-7" name="__codelineno-165-7" href="#__codelineno-165-7"></a><span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span><span class="m">185</span><span class="w"> </span>target/quarkus-app/lib/<span class="w"> </span>/deployments/lib/
</span><span id="__span-165-8"><a id="__codelineno-165-8" name="__codelineno-165-8" href="#__codelineno-165-8"></a><span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span><span class="m">185</span><span class="w"> </span>target/quarkus-app/*.jar<span class="w"> </span>/deployments/
</span><span id="__span-165-9"><a id="__codelineno-165-9" name="__codelineno-165-9" href="#__codelineno-165-9"></a><span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span><span class="m">185</span><span class="w"> </span>target/quarkus-app/app/<span class="w"> </span>/deployments/app/
</span><span id="__span-165-10"><a id="__codelineno-165-10" name="__codelineno-165-10" href="#__codelineno-165-10"></a><span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span><span class="m">185</span><span class="w"> </span>target/quarkus-app/quarkus/<span class="w"> </span>/deployments/quarkus/
</span><span id="__span-165-11"><a id="__codelineno-165-11" name="__codelineno-165-11" href="#__codelineno-165-11"></a>
</span><span id="__span-165-12"><a id="__codelineno-165-12" name="__codelineno-165-12" href="#__codelineno-165-12"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-165-13"><a id="__codelineno-165-13" name="__codelineno-165-13" href="#__codelineno-165-13"></a><span class="k">USER</span><span class="w"> </span><span class="s">185</span>
</span><span id="__span-165-14"><a id="__codelineno-165-14" name="__codelineno-165-14" href="#__codelineno-165-14"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">JAVA_OPTS_APPEND</span><span class="o">=</span><span class="s2">&quot;-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager&quot;</span>
</span><span id="__span-165-15"><a id="__codelineno-165-15" name="__codelineno-165-15" href="#__codelineno-165-15"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">JAVA_APP_JAR</span><span class="o">=</span><span class="s2">&quot;/deployments/quarkus-run.jar&quot;</span>
</span><span id="__span-165-16"><a id="__codelineno-165-16" name="__codelineno-165-16" href="#__codelineno-165-16"></a>
</span><span id="__span-165-17"><a id="__codelineno-165-17" name="__codelineno-165-17" href="#__codelineno-165-17"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;/opt/jboss/container/java/run/run-java.sh&quot;</span><span class="w"> </span><span class="p">]</span>
</span></code></pre></div>
<p>To start using it, we first need to install the jib extension in all our projects.</p>
<p>Add the <code>quarkus-container-image-jib</code> extension executing the following commands from the root <code>super-heroes</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-fights/pom.xml<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jib&quot;</span>
</span><span id="__span-166-2"><a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-heroes/pom.xml<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jib&quot;</span>
</span><span id="__span-166-3"><a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-villains/pom.xml<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jib&quot;</span>
</span><span id="__span-166-4"><a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>ui-super-heroes/pom.xml<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jib&quot;</span>
</span><span id="__span-166-5"><a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>event-statistics/pom.xml<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jib&quot;</span>
</span><span id="__span-166-6"><a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-narration/pom.xml<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;jib&quot;</span>
</span></code></pre></div>
<p>It adds the following dependency to the <code>pom.xml</code> files:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-167-2"><a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-167-3"><a id="__codelineno-167-3" name="__codelineno-167-3" href="#__codelineno-167-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>quarkus-container-image-jib<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-167-4"><a id="__codelineno-167-4" name="__codelineno-167-4" href="#__codelineno-167-4"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>Then, from the root <code>super-heroes</code> directory, execute the following commands to build the applications and create the container image (add <code>-Dmaven.test.skip=true</code> if you want to skip the tests):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-fights/pom.xml<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.container-image.build<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-168-2"><a id="__codelineno-168-2" name="__codelineno-168-2" href="#__codelineno-168-2"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-heroes/pom.xml<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.container-image.build<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-168-3"><a id="__codelineno-168-3" name="__codelineno-168-3" href="#__codelineno-168-3"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-villains/pom.xml<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.container-image.build<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-168-4"><a id="__codelineno-168-4" name="__codelineno-168-4" href="#__codelineno-168-4"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>ui-super-heroes/pom.xml<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.container-image.build<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-168-5"><a id="__codelineno-168-5" name="__codelineno-168-5" href="#__codelineno-168-5"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>event-statistics/pom.xml<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.container-image.build<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-168-6"><a id="__codelineno-168-6" name="__codelineno-168-6" href="#__codelineno-168-6"></a>./mvnw<span class="w"> </span>--file<span class="w"> </span>rest-narration/pom.xml<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.container-image.build<span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
<p>Check that you have all the Docker images installed locally:</p>
<p>The output should look like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a>REPOSITORY                      TAG                  IMAGE ID       SIZE
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a>&lt;org&gt;/rest-fights             1.0.0-SNAPSHOT       adb8a546a66b   419MB
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a>&lt;org&gt;/rest-heroes             1.0.0-SNAPSHOT       d9e6ae6e3e23   402MB
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a>&lt;org&gt;/rest-villains           1.0.0-SNAPSHOT       60a5c813f59a   402MB
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a>&lt;org&gt;/ui-super-heroes         1.0.0-SNAPSHOT       82fce62c11a5   379MB
</span><span id="__span-169-6"><a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a>&lt;org&gt;/event-statistics        1.0.0-SNAPSHOT       a5472c5bd576   395MB
</span><span id="__span-169-7"><a id="__codelineno-169-7" name="__codelineno-169-7" href="#__codelineno-169-7"></a>&lt;org&gt;/rest-narration          1.0.0-SNAPSHOT       fcfe334594f3   390MB
</span></code></pre></div>
<h3 id="running-jvm-mode-containers-locally">Running JVM Mode Containers Locally</h3>
<p>Now that we have all our Docker images created, let’s execute them all to be sure that everything is working.</p>
<p>Under <code>super-heroes/infrastructure</code> you will find the <code>docker-compose-app-local.yaml</code> file. It declares all the needed infrastructure (databases, Kafka) as well as our microservices.</p>
<table><tbody><tr><td><i title="Warning"></i></td><td><p>In the <code>docker-compose-app-local.yaml</code> file, you need to update the <code>image</code> property of each microservice to match the name of the image you just built. For example, replace <code>quarkus/rest-villains</code> by <code><org>/rest-villains</code> (<`org`> being your DockerHub / Quay.io username).</p></td></tr></tbody></table>

<p>Execute it with:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose-app-local.yaml<span class="w"> </span>up
</span></code></pre></div>
<p>To know that all your containers are started, you can use the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose-app-local.yaml<span class="w"> </span>ps
</span></code></pre></div>
<p>You should get something similar to the following list. Make sure all your containers are in <em>running</em> status:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a>NAME               IMAGE                                         STATUS         PORTS
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a>ui-super-heroes    agoncal&lt;org/ui-super-heroes:1.0.0-SNAPSHOT    Up             0.0.0.0:8080-&gt;8080/tcp
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a>rest-fights        agoncal&lt;org/rest-fights:1.0.0-SNAPSHOT        Up             0.0.0.0:8082-&gt;8082/tcp
</span><span id="__span-172-4"><a id="__codelineno-172-4" name="__codelineno-172-4" href="#__codelineno-172-4"></a>rest-heroes        agoncal&lt;org/rest-heroes:1.0.0-SNAPSHOT        Up             0.0.0.0:8083-&gt;8083/tcp
</span><span id="__span-172-5"><a id="__codelineno-172-5" name="__codelineno-172-5" href="#__codelineno-172-5"></a>rest-villains      agoncal&lt;org/rest-villains:1.0.0-SNAPSHOT      Up             0.0.0.0:8084-&gt;8084/tcp
</span><span id="__span-172-6"><a id="__codelineno-172-6" name="__codelineno-172-6" href="#__codelineno-172-6"></a>event-statistics   agoncal&lt;org/event-statistics:1.0.0-SNAPSHOT   Up             0.0.0.0:8085-&gt;8085/tcp
</span><span id="__span-172-7"><a id="__codelineno-172-7" name="__codelineno-172-7" href="#__codelineno-172-7"></a>rest-narration     agoncal&lt;org/rest-narration:1.0.0-SNAPSHOT     Up             0.0.0.0:8086-&gt;8086/tcp
</span><span id="__span-172-8"><a id="__codelineno-172-8" name="__codelineno-172-8" href="#__codelineno-172-8"></a>super-database     postgres:14                                   Up (healthy)   0.0.0.0:5432-&gt;5432/tcp
</span><span id="__span-172-9"><a id="__codelineno-172-9" name="__codelineno-172-9" href="#__codelineno-172-9"></a>super-kafka        quay.io/strimzi/kafka:0.28.0-kafka-3.1.0      Up             0.0.0.0:9092-&gt;9092/tcp
</span></code></pre></div>
<p>Once all the containers are started, you can:</p>
<ul>
<li>
<p>Go to <a href="http://localhost:8080/">http://localhost:8080</a> to check the main UI</p>
</li>
<li>
<p>Go to <a href="http://localhost:8085/">http://localhost:8085</a> to check the statistics UI</p>
</li>
<li>
<p>curl <a href="http://localhost:8084/api/villains">http://localhost:8084/api/villains</a> | jq</p>
</li>
<li>
<p>curl <a href="http://localhost:8083/api/heroes">http://localhost:8083/api/heroes</a> | jq</p>
</li>
<li>
<p>curl <a href="http://localhost:8082/api/fights/randomfighters">http://localhost:8082/api/fights/randomfighters</a> | jq</p>
</li>
</ul>
<p>Then, make sure you shut down the entire application with:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose-app-local.yaml<span class="w"> </span>down
</span></code></pre></div>
<h3 id="building-containers-for-our-microservices-in-native-mode">Building Containers for our Microservices in Native Mode</h3>
<p>And… Linux Containers are … <em>Linux</em>. So before being able to build a container with our native executable, we need to produce compatible native executables. If you are using a Linux 64 bits machine, you are good to go. If not, Quarkus comes with a trick to produce these executable:</p>
<p>The <code>Dockerfile.native</code> file is for running the application in native mode. It looks like this:</p>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">registry.access.redhat.com/ubi8/ubi-minimal:8.9</span>
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/work/</span>
</span><span id="__span-174-3"><a id="__codelineno-174-3" name="__codelineno-174-3" href="#__codelineno-174-3"></a><span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span><span class="m">1001</span><span class="w"> </span>/work<span class="w"> </span><span class="se">\</span>
</span><span id="__span-174-4"><a id="__codelineno-174-4" name="__codelineno-174-4" href="#__codelineno-174-4"></a><span class="w">    </span><span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span><span class="w"> </span>chmod<span class="w"> </span><span class="s2">&quot;g+rwX&quot;</span><span class="w"> </span>/work<span class="w"> </span><span class="se">\</span>
</span><span id="__span-174-5"><a id="__codelineno-174-5" name="__codelineno-174-5" href="#__codelineno-174-5"></a><span class="w">    </span><span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span><span class="w"> </span>chown<span class="w"> </span><span class="m">1001</span>:root<span class="w"> </span>/work
</span><span id="__span-174-6"><a id="__codelineno-174-6" name="__codelineno-174-6" href="#__codelineno-174-6"></a><span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span><span class="m">1001</span>:root<span class="w"> </span>target/*-runner<span class="w"> </span>/work/application
</span><span id="__span-174-7"><a id="__codelineno-174-7" name="__codelineno-174-7" href="#__codelineno-174-7"></a>
</span><span id="__span-174-8"><a id="__codelineno-174-8" name="__codelineno-174-8" href="#__codelineno-174-8"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-174-9"><a id="__codelineno-174-9" name="__codelineno-174-9" href="#__codelineno-174-9"></a><span class="k">USER</span><span class="w"> </span><span class="s">1001</span>
</span><span id="__span-174-10"><a id="__codelineno-174-10" name="__codelineno-174-10" href="#__codelineno-174-10"></a>
</span><span id="__span-174-11"><a id="__codelineno-174-11" name="__codelineno-174-11" href="#__codelineno-174-11"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./application&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-Dquarkus.http.host=0.0.0.0&quot;</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a>./mvnw clean package -Pnative -Dquarkus.native.container-build=true -DskipTests
</span></code></pre></div>
<p>The <code>-Dquarkus.native.container-build=true</code> allows running the native compilation inside a container (provided by Quarkus). The result is a Linux 64 bits executable.</p>
<table><tbody><tr><td><i title="Tip"></i></td><td><p>Building a native executable takes time, CPU, and memory. It’s even more accurate in the container. So, first, be sure that your container system has enough memory to build the executable. It requires at least 6Gb of memory, 8Gb is recommended.</p></td></tr></tbody></table>

<p>Execute the above command for all our microservices. We also copy the UI into the fight service, to simplify the process:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="nb">cd</span><span class="w"> </span>rest-hero
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a>./mvnw<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Pnative<span class="w"> </span>-Dquarkus.native.container-build<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DskipTests
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="nb">cd</span><span class="w"> </span>rest-villains
</span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a>./mvnw<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Pnative<span class="w"> </span>-Dquarkus.native.container-build<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DskipTests
</span><span id="__span-176-6"><a id="__codelineno-176-6" name="__codelineno-176-6" href="#__codelineno-176-6"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-176-7"><a id="__codelineno-176-7" name="__codelineno-176-7" href="#__codelineno-176-7"></a><span class="nb">cd</span><span class="w"> </span>rest-fight
</span><span id="__span-176-8"><a id="__codelineno-176-8" name="__codelineno-176-8" href="#__codelineno-176-8"></a>cp<span class="w"> </span>-R<span class="w"> </span>../ui-super-heroes/dist/*<span class="w"> </span>src/main/resources/META-INF/resources
</span><span id="__span-176-9"><a id="__codelineno-176-9" name="__codelineno-176-9" href="#__codelineno-176-9"></a>./mvnw<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Pnative<span class="w"> </span>-Dquarkus.native.container-build<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DskipTests
</span><span id="__span-176-10"><a id="__codelineno-176-10" name="__codelineno-176-10" href="#__codelineno-176-10"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-176-11"><a id="__codelineno-176-11" name="__codelineno-176-11" href="#__codelineno-176-11"></a><span class="nb">cd</span><span class="w"> </span>event-statistics
</span><span id="__span-176-12"><a id="__codelineno-176-12" name="__codelineno-176-12" href="#__codelineno-176-12"></a>./mvnw<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Pnative<span class="w"> </span>-Dquarkus.native.container-build<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DskipTests
</span><span id="__span-176-13"><a id="__codelineno-176-13" name="__codelineno-176-13" href="#__codelineno-176-13"></a><span class="nb">cd</span><span class="w"> </span>..
</span></code></pre></div>
<h3 id="building-native-containers">Building native containers</h3>
<p>Now that we have the native executables, we can build containers. When you create projects, Quarkus generates two <code>Dockerfiles</code>:</p>
<ol>
<li>
<p><code>Dockerfile.jvm</code> - A <code>Dockerfile</code> for running the application in JVM mode</p>
</li>
<li>
<p><code>Dockerfile.native</code> - A <code>Dockerfile</code> for running the application in native mode</p>
</li>
</ol>
<p>We are interested in this second file. Open one of these <code>Dockerfile.native</code> files:</p>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">registry.access.redhat.com/ubi8/ubi-minimal</span>
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/work/</span>
</span><span id="__span-177-3"><a id="__codelineno-177-3" name="__codelineno-177-3" href="#__codelineno-177-3"></a><span class="k">COPY</span><span class="w"> </span>target/*-runner<span class="w"> </span>/work/application
</span><span id="__span-177-4"><a id="__codelineno-177-4" name="__codelineno-177-4" href="#__codelineno-177-4"></a><span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span>/work
</span><span id="__span-177-5"><a id="__codelineno-177-5" name="__codelineno-177-5" href="#__codelineno-177-5"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-177-6"><a id="__codelineno-177-6" name="__codelineno-177-6" href="#__codelineno-177-6"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./application&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-Dquarkus.http.host=0.0.0.0&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>It’s a pretty straightforward <code>Dockerfile</code> taking a minimal base image and copying the generated native executable. It also exposes the port 8080. Wait, our microservices are not configured to run on the port 8080. We need to override this property as well as a few other such as the HTTP client endpoints, and database locations.</p>
<p>To build the containers, use the following scripts:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ORG</span><span class="o">=</span>xxxx
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a><span class="nb">cd</span><span class="w"> </span>rest-hero
</span><span id="__span-178-3"><a id="__codelineno-178-3" name="__codelineno-178-3" href="#__codelineno-178-3"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>src/main/docker/Dockerfile.native<span class="w"> </span>-t<span class="w"> </span><span class="nv">$ORG</span>/quarkus-workshop-hero<span class="w"> </span>.
</span><span id="__span-178-4"><a id="__codelineno-178-4" name="__codelineno-178-4" href="#__codelineno-178-4"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-178-5"><a id="__codelineno-178-5" name="__codelineno-178-5" href="#__codelineno-178-5"></a><span class="nb">cd</span><span class="w"> </span>rest-villains
</span><span id="__span-178-6"><a id="__codelineno-178-6" name="__codelineno-178-6" href="#__codelineno-178-6"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>src/main/docker/Dockerfile.native<span class="w"> </span>-t<span class="w"> </span><span class="nv">$ORG</span>/quarkus-workshop-villain<span class="w"> </span>.
</span><span id="__span-178-7"><a id="__codelineno-178-7" name="__codelineno-178-7" href="#__codelineno-178-7"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-178-8"><a id="__codelineno-178-8" name="__codelineno-178-8" href="#__codelineno-178-8"></a><span class="nb">cd</span><span class="w"> </span>rest-fight
</span><span id="__span-178-9"><a id="__codelineno-178-9" name="__codelineno-178-9" href="#__codelineno-178-9"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>src/main/docker/Dockerfile.native<span class="w"> </span>-t<span class="w"> </span><span class="nv">$ORG</span>/quarkus-workshop-fight<span class="w"> </span>.
</span><span id="__span-178-10"><a id="__codelineno-178-10" name="__codelineno-178-10" href="#__codelineno-178-10"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-178-11"><a id="__codelineno-178-11" name="__codelineno-178-11" href="#__codelineno-178-11"></a><span class="nb">cd</span><span class="w"> </span>event-statistics
</span><span id="__span-178-12"><a id="__codelineno-178-12" name="__codelineno-178-12" href="#__codelineno-178-12"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>src/main/docker/Dockerfile.native<span class="w"> </span>-t<span class="w"> </span><span class="nv">$ORG</span>/quarkus-workshop-stats<span class="w"> </span>.
</span><span id="__span-178-13"><a id="__codelineno-178-13" name="__codelineno-178-13" href="#__codelineno-178-13"></a><span class="nb">cd</span><span class="w"> </span>..
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><p>Replace <code>ORG</code> with your DockerHub / Quay.io username.</p></td></tr></tbody></table>

<h3 id="running-native-mode-containers-locally">Running Native Mode Containers Locally</h3>
<h3 id="building-a-container-running-a-native-executable">Building a container running a native executable</h3>
<p>We’ve just created a container that embeds the Java application and a JVM. But you can also build and use the native executable. To do this, runs the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a>./mvnw<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.container-image.build<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-Pnative<span class="w"> </span>-Dquarkus.native.container-build<span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
<p><code>-Dquarkus.native.container-build=true</code> is indicating that we need a Linux 64bits executable. This option is not required if you use Linux.</p>
<h2 id="deploying-with-kubernetes">Deploying with Kubernetes</h2>
<hr />
<p>This chapter explores how you can deploy containerized Quarkus applications in Cloud platforms using Kubernetes. There are many different approaches to achieve these deployments. In this chapter, we are focusing on deploying our containers in Kubernetes.</p>
<h3 id="deploying-on-kubernetes">Deploying on Kubernetes</h3>
<p>This section is going to deploy our microservices on Kubernetes. It is required to have access to a Kubernetes or OpenShift cluster.</p>
<table><tbody><tr><td><i title="Important"></i></td><td><p>To deploy your microservices, push the built container images to an image registry accessible by your cluster, such as Quay.io or DockerHub.</p></td></tr></tbody></table>

<p>We recommend using a specific namespace to deploy your system. In the following sections, we use the <code>quarkus-workshop</code> namespace.</p>
<h4 id="deploying-the-infrastructure">Deploying the infrastructure</h4>
<p>The first thing to deploy is the required infrastructure:</p>
<ul>
<li>
<p>3 PostgreSQL instances</p>
</li>
<li>
<p>Kafka brokers (3 brokers with 3 Zookeeper to follow the recommended approach)</p>
</li>
</ul>
<p>There are many ways to deploy this infrastructure. Here, we are going to use two operators:</p>
<ul>
<li>
<p>PostgreSQL Operator by Dev4Ddevs.com</p>
</li>
<li>
<p>Strimzi Apache Kafka Operator by Red Hat</p>
</li>
</ul>
<p>With these operators installed, you can create the required infrastructure with the following custom resource definition (CRD):</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql.dev4devs.com/v1alpha1</span>
</span><span id="__span-180-2"><a id="__codelineno-180-2" name="__codelineno-180-2" href="#__codelineno-180-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Database</span>
</span><span id="__span-180-3"><a id="__codelineno-180-3" name="__codelineno-180-3" href="#__codelineno-180-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-180-4"><a id="__codelineno-180-4" name="__codelineno-180-4" href="#__codelineno-180-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">heroes-database</span>
</span><span id="__span-180-5"><a id="__codelineno-180-5" name="__codelineno-180-5" href="#__codelineno-180-5"></a><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarkus-workshop</span>
</span><span id="__span-180-6"><a id="__codelineno-180-6" name="__codelineno-180-6" href="#__codelineno-180-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-180-7"><a id="__codelineno-180-7" name="__codelineno-180-7" href="#__codelineno-180-7"></a><span class="w">    </span><span class="nt">databaseCpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30m</span>
</span><span id="__span-180-8"><a id="__codelineno-180-8" name="__codelineno-180-8" href="#__codelineno-180-8"></a><span class="w">    </span><span class="nt">databaseCpuLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60m</span>
</span><span id="__span-180-9"><a id="__codelineno-180-9" name="__codelineno-180-9" href="#__codelineno-180-9"></a><span class="w">    </span><span class="nt">databaseMemoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
</span><span id="__span-180-10"><a id="__codelineno-180-10" name="__codelineno-180-10" href="#__codelineno-180-10"></a><span class="w">    </span><span class="nt">databaseMemoryRequest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
</span><span id="__span-180-11"><a id="__codelineno-180-11" name="__codelineno-180-11" href="#__codelineno-180-11"></a><span class="w">    </span><span class="nt">databaseName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">heroes-database</span>
</span><span id="__span-180-12"><a id="__codelineno-180-12" name="__codelineno-180-12" href="#__codelineno-180-12"></a><span class="w">    </span><span class="nt">databaseNameKeyEnvVar</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRESQL_DATABASE</span>
</span><span id="__span-180-13"><a id="__codelineno-180-13" name="__codelineno-180-13" href="#__codelineno-180-13"></a><span class="w">    </span><span class="nt">databasePassword</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">superman</span>
</span><span id="__span-180-14"><a id="__codelineno-180-14" name="__codelineno-180-14" href="#__codelineno-180-14"></a><span class="w">    </span><span class="nt">databasePasswordKeyEnvVar</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRESQL_PASSWORD</span>
</span><span id="__span-180-15"><a id="__codelineno-180-15" name="__codelineno-180-15" href="#__codelineno-180-15"></a><span class="w">    </span><span class="nt">databaseStorageRequest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-180-16"><a id="__codelineno-180-16" name="__codelineno-180-16" href="#__codelineno-180-16"></a><span class="w">    </span><span class="nt">databaseUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">superman</span>
</span><span id="__span-180-17"><a id="__codelineno-180-17" name="__codelineno-180-17" href="#__codelineno-180-17"></a><span class="w">    </span><span class="nt">databaseUserKeyEnvVar</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRESQL_USER</span>
</span><span id="__span-180-18"><a id="__codelineno-180-18" name="__codelineno-180-18" href="#__codelineno-180-18"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">centos/postgresql-96-centos7</span>
</span><span id="__span-180-19"><a id="__codelineno-180-19" name="__codelineno-180-19" href="#__codelineno-180-19"></a><span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span></code></pre></div>
<p>This CRD creates the database for the Hero microservice. Duplicate this CRD for the fight and villain databases.</p>
<p>For the Kafka broker, create the following CRD:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka.strimzi.io/v1beta1</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2" href="#__codelineno-181-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kafka</span>
</span><span id="__span-181-3"><a id="__codelineno-181-3" name="__codelineno-181-3" href="#__codelineno-181-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-181-4"><a id="__codelineno-181-4" name="__codelineno-181-4" href="#__codelineno-181-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-kafka</span>
</span><span id="__span-181-5"><a id="__codelineno-181-5" name="__codelineno-181-5" href="#__codelineno-181-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarkus-workshop</span>
</span><span id="__span-181-6"><a id="__codelineno-181-6" name="__codelineno-181-6" href="#__codelineno-181-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-181-7"><a id="__codelineno-181-7" name="__codelineno-181-7" href="#__codelineno-181-7"></a><span class="w">  </span><span class="nt">kafka</span><span class="p">:</span>
</span><span id="__span-181-8"><a id="__codelineno-181-8" name="__codelineno-181-8" href="#__codelineno-181-8"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.3.0</span>
</span><span id="__span-181-9"><a id="__codelineno-181-9" name="__codelineno-181-9" href="#__codelineno-181-9"></a><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-181-10"><a id="__codelineno-181-10" name="__codelineno-181-10" href="#__codelineno-181-10"></a><span class="w">    </span><span class="nt">listeners</span><span class="p">:</span>
</span><span id="__span-181-11"><a id="__codelineno-181-11" name="__codelineno-181-11" href="#__codelineno-181-11"></a><span class="w">      </span><span class="nt">plain</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-181-12"><a id="__codelineno-181-12" name="__codelineno-181-12" href="#__codelineno-181-12"></a><span class="w">      </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-181-13"><a id="__codelineno-181-13" name="__codelineno-181-13" href="#__codelineno-181-13"></a><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-181-14"><a id="__codelineno-181-14" name="__codelineno-181-14" href="#__codelineno-181-14"></a><span class="w">      </span><span class="nt">offsets.topic.replication.factor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-181-15"><a id="__codelineno-181-15" name="__codelineno-181-15" href="#__codelineno-181-15"></a><span class="w">      </span><span class="nt">transaction.state.log.replication.factor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-181-16"><a id="__codelineno-181-16" name="__codelineno-181-16" href="#__codelineno-181-16"></a><span class="w">      </span><span class="nt">transaction.state.log.min.isr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-181-17"><a id="__codelineno-181-17" name="__codelineno-181-17" href="#__codelineno-181-17"></a><span class="w">      </span><span class="nt">log.message.format.version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.3&#39;</span>
</span><span id="__span-181-18"><a id="__codelineno-181-18" name="__codelineno-181-18" href="#__codelineno-181-18"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span>
</span><span id="__span-181-19"><a id="__codelineno-181-19" name="__codelineno-181-19" href="#__codelineno-181-19"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ephemeral</span>
</span><span id="__span-181-20"><a id="__codelineno-181-20" name="__codelineno-181-20" href="#__codelineno-181-20"></a><span class="w">  </span><span class="nt">zookeeper</span><span class="p">:</span>
</span><span id="__span-181-21"><a id="__codelineno-181-21" name="__codelineno-181-21" href="#__codelineno-181-21"></a><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-181-22"><a id="__codelineno-181-22" name="__codelineno-181-22" href="#__codelineno-181-22"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span>
</span><span id="__span-181-23"><a id="__codelineno-181-23" name="__codelineno-181-23" href="#__codelineno-181-23"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ephemeral</span>
</span><span id="__span-181-24"><a id="__codelineno-181-24" name="__codelineno-181-24" href="#__codelineno-181-24"></a><span class="w">  </span><span class="nt">entityOperator</span><span class="p">:</span>
</span><span id="__span-181-25"><a id="__codelineno-181-25" name="__codelineno-181-25" href="#__codelineno-181-25"></a><span class="w">    </span><span class="nt">topicOperator</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-181-26"><a id="__codelineno-181-26" name="__codelineno-181-26" href="#__codelineno-181-26"></a><span class="w">    </span><span class="nt">userOperator</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span></code></pre></div>
<p>This CRD creates the brokers and the Zookeeper instances.</p>
<p>It’s also recommended to create the topic.</p>
<p>For this, create the following CRD:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kafka.strimzi.io/v1beta1</span>
</span><span id="__span-182-2"><a id="__codelineno-182-2" name="__codelineno-182-2" href="#__codelineno-182-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KafkaTopic</span>
</span><span id="__span-182-3"><a id="__codelineno-182-3" name="__codelineno-182-3" href="#__codelineno-182-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-182-4"><a id="__codelineno-182-4" name="__codelineno-182-4" href="#__codelineno-182-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fights</span>
</span><span id="__span-182-5"><a id="__codelineno-182-5" name="__codelineno-182-5" href="#__codelineno-182-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-182-6"><a id="__codelineno-182-6" name="__codelineno-182-6" href="#__codelineno-182-6"></a><span class="w">    </span><span class="nt">strimzi.io/cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-kafka</span>
</span><span id="__span-182-7"><a id="__codelineno-182-7" name="__codelineno-182-7" href="#__codelineno-182-7"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarkus-workshop</span>
</span><span id="__span-182-8"><a id="__codelineno-182-8" name="__codelineno-182-8" href="#__codelineno-182-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-182-9"><a id="__codelineno-182-9" name="__codelineno-182-9" href="#__codelineno-182-9"></a><span class="w">  </span><span class="nt">partitions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-182-10"><a id="__codelineno-182-10" name="__codelineno-182-10" href="#__codelineno-182-10"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-182-11"><a id="__codelineno-182-11" name="__codelineno-182-11" href="#__codelineno-182-11"></a><span class="w">  </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-182-12"><a id="__codelineno-182-12" name="__codelineno-182-12" href="#__codelineno-182-12"></a><span class="w">    </span><span class="nt">retention.ms</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">604800000</span>
</span><span id="__span-182-13"><a id="__codelineno-182-13" name="__codelineno-182-13" href="#__codelineno-182-13"></a><span class="w">    </span><span class="nt">segment.bytes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1073741824</span>
</span></code></pre></div>
<p>Once everything is created, you should have the following resources:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>database
</span><span id="__span-183-2"><a id="__codelineno-183-2" name="__codelineno-183-2" href="#__codelineno-183-2"></a>NAME<span class="w">                </span>AGE
</span><span id="__span-183-3"><a id="__codelineno-183-3" name="__codelineno-183-3" href="#__codelineno-183-3"></a>fights-database<span class="w">     </span>16h
</span><span id="__span-183-4"><a id="__codelineno-183-4" name="__codelineno-183-4" href="#__codelineno-183-4"></a>heroes-database<span class="w">     </span>16h
</span><span id="__span-183-5"><a id="__codelineno-183-5" name="__codelineno-183-5" href="#__codelineno-183-5"></a>villains-database<span class="w">   </span>16h
</span><span id="__span-183-6"><a id="__codelineno-183-6" name="__codelineno-183-6" href="#__codelineno-183-6"></a>
</span><span id="__span-183-7"><a id="__codelineno-183-7" name="__codelineno-183-7" href="#__codelineno-183-7"></a>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>kafka
</span><span id="__span-183-8"><a id="__codelineno-183-8" name="__codelineno-183-8" href="#__codelineno-183-8"></a>NAME<span class="w">       </span>DESIRED<span class="w"> </span>KAFKA<span class="w"> </span>REPLICAS<span class="w">   </span>DESIRED<span class="w"> </span>ZK<span class="w"> </span>REPLICAS
</span><span id="__span-183-9"><a id="__codelineno-183-9" name="__codelineno-183-9" href="#__codelineno-183-9"></a>my-kafka<span class="w">   </span><span class="m">3</span>
</span></code></pre></div>
<h4 id="deploying-the-hero-villain-microservices">Deploying the Hero &amp; Villain microservices</h4>
<p>Now that the infrastructure is in place, we can deploy our microservices. Let’s start with the hero and villain microservices.</p>
<p>For each, we need to override the port and data source URL.</p>
<p>Create a config map with the following content:</p>
<p>Listing 1. config-hero.yaml</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2" href="#__codelineno-184-2"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3" href="#__codelineno-184-3"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
</span><span id="__span-184-4"><a id="__codelineno-184-4" name="__codelineno-184-4" href="#__codelineno-184-4"></a><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jdbc:postgresql://heroes-database:5432/heroes-database&quot;</span>
</span><span id="__span-184-5"><a id="__codelineno-184-5" name="__codelineno-184-5" href="#__codelineno-184-5"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
</span><span id="__span-184-6"><a id="__codelineno-184-6" name="__codelineno-184-6" href="#__codelineno-184-6"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-184-7"><a id="__codelineno-184-7" name="__codelineno-184-7" href="#__codelineno-184-7"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hero-config</span>
</span></code></pre></div>
<p>Do the same for the villain microservice. Then, apply these resources:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config-hero.yaml
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2" href="#__codelineno-185-2"></a>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config-villain.yaml
</span></code></pre></div>
<p>Once the config maps are created, we can deploy the microservices.</p>
<p>Create a <code>deployment-hero.yaml</code> file with the following content:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span>
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2" href="#__codelineno-186-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;List&quot;</span>
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3" href="#__codelineno-186-3"></a><span class="nt">items</span><span class="p">:</span>
</span><span id="__span-186-4"><a id="__codelineno-186-4" name="__codelineno-186-4" href="#__codelineno-186-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;v1&quot;</span>
</span><span id="__span-186-5"><a id="__codelineno-186-5" name="__codelineno-186-5" href="#__codelineno-186-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Service&quot;</span>
</span><span id="__span-186-6"><a id="__codelineno-186-6" name="__codelineno-186-6" href="#__codelineno-186-6"></a><span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-186-7"><a id="__codelineno-186-7" name="__codelineno-186-7" href="#__codelineno-186-7"></a><span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-186-8"><a id="__codelineno-186-8" name="__codelineno-186-8" href="#__codelineno-186-8"></a><span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-9"><a id="__codelineno-186-9" name="__codelineno-186-9" href="#__codelineno-186-9"></a><span class="w">              </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;01&quot;</span>
</span><span id="__span-186-10"><a id="__codelineno-186-10" name="__codelineno-186-10" href="#__codelineno-186-10"></a><span class="w">              </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$ORG&quot;</span>
</span><span id="__span-186-11"><a id="__codelineno-186-11" name="__codelineno-186-11" href="#__codelineno-186-11"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-12"><a id="__codelineno-186-12" name="__codelineno-186-12" href="#__codelineno-186-12"></a><span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-186-13"><a id="__codelineno-186-13" name="__codelineno-186-13" href="#__codelineno-186-13"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-186-14"><a id="__codelineno-186-14" name="__codelineno-186-14" href="#__codelineno-186-14"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
</span><span id="__span-186-15"><a id="__codelineno-186-15" name="__codelineno-186-15" href="#__codelineno-186-15"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-186-16"><a id="__codelineno-186-16" name="__codelineno-186-16" href="#__codelineno-186-16"></a><span class="w">                </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-186-17"><a id="__codelineno-186-17" name="__codelineno-186-17" href="#__codelineno-186-17"></a><span class="w">          </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-186-18"><a id="__codelineno-186-18" name="__codelineno-186-18" href="#__codelineno-186-18"></a><span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-19"><a id="__codelineno-186-19" name="__codelineno-186-19" href="#__codelineno-186-19"></a><span class="w">              </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;01&quot;</span>
</span><span id="__span-186-20"><a id="__codelineno-186-20" name="__codelineno-186-20" href="#__codelineno-186-20"></a><span class="w">              </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$ORG&quot;</span>
</span><span id="__span-186-21"><a id="__codelineno-186-21" name="__codelineno-186-21" href="#__codelineno-186-21"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ClusterIP&quot;</span>
</span><span id="__span-186-22"><a id="__codelineno-186-22" name="__codelineno-186-22" href="#__codelineno-186-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apps/v1&quot;</span>
</span><span id="__span-186-23"><a id="__codelineno-186-23" name="__codelineno-186-23" href="#__codelineno-186-23"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deployment&quot;</span>
</span><span id="__span-186-24"><a id="__codelineno-186-24" name="__codelineno-186-24" href="#__codelineno-186-24"></a><span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-186-25"><a id="__codelineno-186-25" name="__codelineno-186-25" href="#__codelineno-186-25"></a><span class="w">          </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-186-26"><a id="__codelineno-186-26" name="__codelineno-186-26" href="#__codelineno-186-26"></a><span class="w">              </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-27"><a id="__codelineno-186-27" name="__codelineno-186-27" href="#__codelineno-186-27"></a><span class="w">              </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;01&quot;</span>
</span><span id="__span-186-28"><a id="__codelineno-186-28" name="__codelineno-186-28" href="#__codelineno-186-28"></a><span class="w">              </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$ORG&quot;</span>
</span><span id="__span-186-29"><a id="__codelineno-186-29" name="__codelineno-186-29" href="#__codelineno-186-29"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-30"><a id="__codelineno-186-30" name="__codelineno-186-30" href="#__codelineno-186-30"></a><span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-186-31"><a id="__codelineno-186-31" name="__codelineno-186-31" href="#__codelineno-186-31"></a><span class="w">          </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-186-32"><a id="__codelineno-186-32" name="__codelineno-186-32" href="#__codelineno-186-32"></a><span class="w">          </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-186-33"><a id="__codelineno-186-33" name="__codelineno-186-33" href="#__codelineno-186-33"></a><span class="w">              </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-186-34"><a id="__codelineno-186-34" name="__codelineno-186-34" href="#__codelineno-186-34"></a><span class="w">                  </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-35"><a id="__codelineno-186-35" name="__codelineno-186-35" href="#__codelineno-186-35"></a><span class="w">                  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;01&quot;</span>
</span><span id="__span-186-36"><a id="__codelineno-186-36" name="__codelineno-186-36" href="#__codelineno-186-36"></a><span class="w">                  </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$ORG&quot;</span>
</span><span id="__span-186-37"><a id="__codelineno-186-37" name="__codelineno-186-37" href="#__codelineno-186-37"></a><span class="w">          </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-186-38"><a id="__codelineno-186-38" name="__codelineno-186-38" href="#__codelineno-186-38"></a><span class="w">              </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-186-39"><a id="__codelineno-186-39" name="__codelineno-186-39" href="#__codelineno-186-39"></a><span class="w">                  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-186-40"><a id="__codelineno-186-40" name="__codelineno-186-40" href="#__codelineno-186-40"></a><span class="w">                      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-41"><a id="__codelineno-186-41" name="__codelineno-186-41" href="#__codelineno-186-41"></a><span class="w">                      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;01&quot;</span>
</span><span id="__span-186-42"><a id="__codelineno-186-42" name="__codelineno-186-42" href="#__codelineno-186-42"></a><span class="w">                      </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$ORG&quot;</span>
</span><span id="__span-186-43"><a id="__codelineno-186-43" name="__codelineno-186-43" href="#__codelineno-186-43"></a><span class="w">              </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-186-44"><a id="__codelineno-186-44" name="__codelineno-186-44" href="#__codelineno-186-44"></a><span class="w">                  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-186-45"><a id="__codelineno-186-45" name="__codelineno-186-45" href="#__codelineno-186-45"></a><span class="w">                      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$ORG/quarkus-workshop-hero:latest&quot;</span>
</span><span id="__span-186-46"><a id="__codelineno-186-46" name="__codelineno-186-46" href="#__codelineno-186-46"></a><span class="w">                        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;IfNotPresent&quot;</span>
</span><span id="__span-186-47"><a id="__codelineno-186-47" name="__codelineno-186-47" href="#__codelineno-186-47"></a><span class="w">                        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quarkus-workshop-hero&quot;</span>
</span><span id="__span-186-48"><a id="__codelineno-186-48" name="__codelineno-186-48" href="#__codelineno-186-48"></a><span class="w">                        </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-186-49"><a id="__codelineno-186-49" name="__codelineno-186-49" href="#__codelineno-186-49"></a><span class="w">                            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-186-50"><a id="__codelineno-186-50" name="__codelineno-186-50" href="#__codelineno-186-50"></a><span class="w">                              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
</span><span id="__span-186-51"><a id="__codelineno-186-51" name="__codelineno-186-51" href="#__codelineno-186-51"></a><span class="w">                              </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TCP&quot;</span>
</span><span id="__span-186-52"><a id="__codelineno-186-52" name="__codelineno-186-52" href="#__codelineno-186-52"></a><span class="w">                        </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-186-53"><a id="__codelineno-186-53" name="__codelineno-186-53" href="#__codelineno-186-53"></a><span class="w">                            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;KUBERNETES_NAMESPACE&quot;</span>
</span><span id="__span-186-54"><a id="__codelineno-186-54" name="__codelineno-186-54" href="#__codelineno-186-54"></a><span class="w">                              </span><span class="nt">valueFrom</span><span class="p">:</span>
</span><span id="__span-186-55"><a id="__codelineno-186-55" name="__codelineno-186-55" href="#__codelineno-186-55"></a><span class="w">                                  </span><span class="nt">fieldRef</span><span class="p">:</span>
</span><span id="__span-186-56"><a id="__codelineno-186-56" name="__codelineno-186-56" href="#__codelineno-186-56"></a><span class="w">                                      </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;metadata.namespace&quot;</span>
</span><span id="__span-186-57"><a id="__codelineno-186-57" name="__codelineno-186-57" href="#__codelineno-186-57"></a>
</span><span id="__span-186-58"><a id="__codelineno-186-58" name="__codelineno-186-58" href="#__codelineno-186-58"></a><span class="w">                            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QUARKUS_DATASOURCE_URL</span>
</span><span id="__span-186-59"><a id="__codelineno-186-59" name="__codelineno-186-59" href="#__codelineno-186-59"></a><span class="w">                              </span><span class="nt">valueFrom</span><span class="p">:</span>
</span><span id="__span-186-60"><a id="__codelineno-186-60" name="__codelineno-186-60" href="#__codelineno-186-60"></a><span class="w">                                  </span><span class="nt">configMapKeyRef</span><span class="p">:</span>
</span><span id="__span-186-61"><a id="__codelineno-186-61" name="__codelineno-186-61" href="#__codelineno-186-61"></a><span class="w">                                      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hero-config</span>
</span><span id="__span-186-62"><a id="__codelineno-186-62" name="__codelineno-186-62" href="#__codelineno-186-62"></a><span class="w">                                      </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-186-63"><a id="__codelineno-186-63" name="__codelineno-186-63" href="#__codelineno-186-63"></a>
</span><span id="__span-186-64"><a id="__codelineno-186-64" name="__codelineno-186-64" href="#__codelineno-186-64"></a><span class="w">                            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QUARKUS_HTTP_PORT</span>
</span><span id="__span-186-65"><a id="__codelineno-186-65" name="__codelineno-186-65" href="#__codelineno-186-65"></a><span class="w">                              </span><span class="nt">valueFrom</span><span class="p">:</span>
</span><span id="__span-186-66"><a id="__codelineno-186-66" name="__codelineno-186-66" href="#__codelineno-186-66"></a><span class="w">                                  </span><span class="nt">configMapKeyRef</span><span class="p">:</span>
</span><span id="__span-186-67"><a id="__codelineno-186-67" name="__codelineno-186-67" href="#__codelineno-186-67"></a><span class="w">                                      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hero-config</span>
</span><span id="__span-186-68"><a id="__codelineno-186-68" name="__codelineno-186-68" href="#__codelineno-186-68"></a><span class="w">                                      </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">port</span>
</span></code></pre></div>
<p>This descriptor declares:</p>
<ol>
<li>
<p>A service to expose the HTTP endpoint</p>
</li>
<li>
<p>A deployment that instantiates the application</p>
</li>
</ol>
<p>The deployment declares one container using the container image we built earlier. It also overrides the configuration for the HTTP port and database URL.</p>
<p>Don’t forget to create the equivalent files for the villain microservice.</p>
<p>Then, deploy the microservice with:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment-hero.yaml
</span><span id="__span-187-2"><a id="__codelineno-187-2" name="__codelineno-187-2" href="#__codelineno-187-2"></a>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deployment-villain.yaml
</span></code></pre></div>
<h4 id="deploying-the-fight-microservice">Deploying the Fight microservice</h4>
<p>Follow the same approach for the fight microservice. Note that there are more properties to configure from the config map:</p>
<ul>
<li>
<p>The location of the hero and villain microservice</p>
</li>
<li>
<p>The location of the Kafka broker</p>
</li>
</ul>
<p>Once everything is configured and deployed, your system is now running on Kubernetes.</p>
<h2 id="from-container-to-kubernetes">From Container to Kubernetes</h2>
<table><tbody><tr><td><i title="Note"></i></td><td><p>This section is optional and demonstrates how to ask Quarkus to create a container and deploy it to Kubernetes. We will need a running Kubernetes. We will use Rancher Desktop as indicated in the prerequisites.</p></td></tr></tbody></table>

<h3 id="prerequisites">Prerequisites</h3>
<ol>
<li>
<p>Make sure that Docker Desktop (if installed) is turned off</p>
</li>
<li>
<p>Make sure Rancher Desktop is started. The container runtime must be <em>dockerd</em> (Preferences → Container Runtime → dockerd (moby)).</p>
</li>
</ol>
<h3 id="deploying-to-kubernetes">Deploying to Kubernetes</h3>
<p>Quarkus can also run our application in Kubernetes and compute the Kubernetes descriptor. In addition to allow customizing any part of the descriptor, it is possible to configure config maps, secrets…</p>
<table><tbody><tr><td><i title="Important"></i></td><td><p>As mentioned above, we will use Rancher Desktop. Adapt the instructions for your Kubernetes:</p><div><ol><li><p>Make sure you are logged in</p></li><li><p>Make sure you use the correct namespace</p></li></ol></div></td></tr></tbody></table>

<p>Edit the <code>src/main/resources/application.properties</code> to add the following lines:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="na">quarkus.kubernetes.namespace</span><span class="o">=</span><span class="s">default # Added</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a><span class="na">quarkus.kubernetes.image-pull-policy</span><span class="o">=</span><span class="s">IfNotPresent # Added</span>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a>
</span><span id="__span-188-4"><a id="__codelineno-188-4" name="__codelineno-188-4" href="#__codelineno-188-4"></a><span class="na">%prod.quarkus.http.port</span><span class="o">=</span><span class="s">8080 # Added</span>
</span><span id="__span-188-5"><a id="__codelineno-188-5" name="__codelineno-188-5" href="#__codelineno-188-5"></a><span class="na">%prod.quarkus.datasource.username</span><span class="o">=</span><span class="s">superbad</span>
</span><span id="__span-188-6"><a id="__codelineno-188-6" name="__codelineno-188-6" href="#__codelineno-188-6"></a><span class="na">%prod.quarkus.datasource.password</span><span class="o">=</span><span class="s">superbad</span>
</span><span id="__span-188-7"><a id="__codelineno-188-7" name="__codelineno-188-7" href="#__codelineno-188-7"></a><span class="na">%prod.quarkus.datasource.jdbc.url</span><span class="o">=</span><span class="s">jdbc:postgresql://my-villains-db-postgresql:5432/villains_database # Updated</span>
</span><span id="__span-188-8"><a id="__codelineno-188-8" name="__codelineno-188-8" href="#__codelineno-188-8"></a><span class="na">%prod.quarkus.hibernate-orm.sql-load-script</span><span class="o">=</span><span class="s">import.sql</span>
</span></code></pre></div>
<p>Add the <code>quarkus-kubernetes</code> extension using the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a>./mvnw<span class="w"> </span>quarkus:add-extension<span class="w"> </span>-Dextensions<span class="o">=</span><span class="s2">&quot;kubernetes&quot;</span>
</span></code></pre></div>
<p>Alternatively, you can add the following dependency to the <code>pom.xml</code> file directly:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2" href="#__codelineno-190-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3" href="#__codelineno-190-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>quarkus-kubernetes<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4" href="#__codelineno-190-4"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>Rancher Desktop authentication use elliptic algorithms not supported by default in Java. So, we also need to add the following dependency to the project:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a><span class="nt">&lt;dependency&gt;</span>
</span><span id="__span-191-2"><a id="__codelineno-191-2" name="__codelineno-191-2" href="#__codelineno-191-2"></a><span class="w">  </span><span class="nt">&lt;groupId&gt;</span>org.bouncycastle<span class="nt">&lt;/groupId&gt;</span>
</span><span id="__span-191-3"><a id="__codelineno-191-3" name="__codelineno-191-3" href="#__codelineno-191-3"></a><span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>bcpkix-jdk18on<span class="nt">&lt;/artifactId&gt;</span>
</span><span id="__span-191-4"><a id="__codelineno-191-4" name="__codelineno-191-4" href="#__codelineno-191-4"></a><span class="w">  </span><span class="nt">&lt;version&gt;</span>1.71<span class="nt">&lt;/version&gt;</span>
</span><span id="__span-191-5"><a id="__codelineno-191-5" name="__codelineno-191-5" href="#__codelineno-191-5"></a><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></div>
<p>Before deploying our application, we need to deploy the database. To achieve this, we are going to use <a href="https://helm.sh/">helm</a> (installed alongside Rancher Desktop) and the following <a href="https://artifacthub.io/packages/helm/bitnami/postgresql">postgresql package</a>.</p>
<p>Run the following commands:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w"> </span>https://charts.bitnami.com/bitnami
</span><span id="__span-192-2"><a id="__codelineno-192-2" name="__codelineno-192-2" href="#__codelineno-192-2"></a>helm<span class="w"> </span>install<span class="w"> </span>my-villains-db<span class="w"> </span><span class="se">\</span>
</span><span id="__span-192-3"><a id="__codelineno-192-3" name="__codelineno-192-3" href="#__codelineno-192-3"></a><span class="w">    </span>--set<span class="w"> </span>auth.postgresPassword<span class="o">=</span>superbad<span class="w"> </span><span class="se">\</span>
</span><span id="__span-192-4"><a id="__codelineno-192-4" name="__codelineno-192-4" href="#__codelineno-192-4"></a><span class="w">    </span>--set<span class="w"> </span>auth.username<span class="o">=</span>superbad<span class="w"> </span><span class="se">\</span>
</span><span id="__span-192-5"><a id="__codelineno-192-5" name="__codelineno-192-5" href="#__codelineno-192-5"></a><span class="w">    </span>--set<span class="w"> </span>auth.password<span class="o">=</span>superbad<span class="w"> </span><span class="se">\</span>
</span><span id="__span-192-6"><a id="__codelineno-192-6" name="__codelineno-192-6" href="#__codelineno-192-6"></a><span class="w">    </span>--set<span class="w"> </span>auth.database<span class="o">=</span>villains_database<span class="w"> </span>bitnami/postgresql
</span></code></pre></div>
<p>Finally, deploy the application using:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a>./mvnw<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.kubernetes.deploy<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-DskipTests
</span></code></pre></div>
<p>Check the pods with the following command:</p>
<p>You should see something like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-194-1"><a id="__codelineno-194-1" name="__codelineno-194-1" href="#__codelineno-194-1"></a>NAME                             READY   STATUS    RESTARTS   AGE
</span><span id="__span-194-2"><a id="__codelineno-194-2" name="__codelineno-194-2" href="#__codelineno-194-2"></a>my-villains-db-postgresql-0      1/1     Running   0          28m
</span><span id="__span-194-3"><a id="__codelineno-194-3" name="__codelineno-194-3" href="#__codelineno-194-3"></a>rest-villains-7c7479b959-7fn64   1/1     Running   0          12m
</span></code></pre></div>
<p>Make sure you wait for the <code>rest-villains</code> pod to be ready (1/1).</p>
<p>Enable port-forwarding to port 8080 either from the rancher desktop UI (Preferences → Port Forwarding → default / rest-villains / http), or using the following command line:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-195-1"><a id="__codelineno-195-1" name="__codelineno-195-1" href="#__codelineno-195-1"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>pods/rest-villains-7c7479b959-7fn64<span class="w"> </span><span class="m">8080</span>:8080
</span></code></pre></div>
<h3 id="deploying-to-open-shift">Deploying to Open Shift</h3>
<h2 id="conclusion">Conclusion</h2>
<hr />
<p>This is the end of the Super Hero workshop. We hope you liked it, learnt a few things, and more importantly, will be able to take this knowledge back to your projects.</p>
<p>This workshop started making sure your development environment was ready to develop the entire application. Then, there was some brief terminology to help you in understanding some concepts around Quarkus. If you find it was too short and need more details on Quarkus, Microservices, MicroProfile, Cloud Native, or GraalVM, check the Quarkus website for more references</p>
<p>Then, we focused on developing several isolated microservices. Some written in pure JAX-RS (such as the Villain) others with Reactive JAX-RS and Reactive Hibernate (such as the Hero). These microservices return data in JSON, validate data thanks to Bean Validation, store and retrieve data from a relational database with the help of JPA, Panache and JTA.</p>
<p>You then installed an already coded React application on another instance of Quarkus. At this stage, the React application couldn’t access the microservices because of CORS issues that we quickly fixed.</p>
<p>Then, we made the microservices communicate with each other in HTTP thanks to REST Client. But HTTP-related technologies usually use synchronous communication and therefore need to deal with invocation failure. With Fault Tolerance, it was just a matter of using a few annotations and we can get some fallback when the communication fails.</p>
<p>That’s also why we introduced Reactive Messaging with Kafka: so we don’t have a temporal coupling between the microservices.</p>
<p>We’ve also added some Artificial Intelligence. Thanks to Semantic Kernel, with a few lines of code, we allowed our Narration microservice to narrate the fight between a Super Hero and a Super Villain.</p>
<p>Then, came production time. With Quarkus it’s very easy to build executable JARs. With a JVM installed you can execute these JARs which are optimal for production. And if you need to turn your microservice into an executable binary (thanks to GraalVM), that’s easy too. Quarkus supports GraalVM since the beginning and makes its integration smooth. Same if you want to package microservices into Docker containers. Quarkus supports Jib. So with a simple Maven command you can turn your microservice into a container.</p>
<h3 id="references">References</h3>
<ul>
<li>
<p><a href="https://github.com/cescoffier/quarkus-todo-app">https://github.com/cescoffier/quarkus-todo-app</a></p>
</li>
<li>
<p><a href="https://github.com/agoncal/baking-microservice-pie">https://github.com/agoncal/baking-microservice-pie</a></p>
</li>
<li>
<p><a href="https://forge.jboss.org/document/hands-on-lab">https://forge.jboss.org/document/hands-on-lab</a></p>
</li>
<li>
<p><a href="https://bit.ly/forge-hol">https://bit.ly/forge-hol</a></p>
</li>
<li>
<p><a href="https://quarkus.io/">https://quarkus.io</a></p>
</li>
<li>
<p><a href="https://code.quarkus.io/">https://code.quarkus.io</a></p>
</li>
<li>
<p><a href="https://quarkus.io/guides/all-config">https://quarkus.io/guides/all-config</a></p>
</li>
<li>
<p><a href="https://azure.microsoft.com/services/container-apps">Azure Container Apps Overview</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/azure/container-apps">Azure Container Apps Documentation</a></p>
</li>
<li>
<p><a href="https://github.com/ozangunalp/managed-kafka-quarkus/tree/main/azure-event-hub">Managed Kafka Quarkus</a></p>
</li>
</ul>
<h3 id="apache-maven-39x">Apache Maven 3.9.x</h3>
<p>All the examples of this workshop are built and tested using Maven Maven offers a building solution, shared libraries, and a plugin platform for your projects, allowing you to do quality control, documentation, teamwork, and so forth. Based on the "convention over configuration" principle, Maven brings a standard project description and a number of conventions such as a standard directory structure. With an extensible architecture based on plugins, Maven can offer many different services.</p>
<h4 id="installing-maven">Installing Maven</h4>
<p>The examples of this workshop have been developed with Apache Maven 3.9.x. For this workshop, it is <strong>not</strong> necessary to install Maven. You can just use the Maven wrapper in your working directory, <code>./mvnw</code>. The wrapper is always at a suitable Maven version.</p>
<p>However, if you’d prefer to have a global installation of Maven (<code>mvn</code>), here’s how. Once you have installed JDK 21, make sure the <code>JAVA_HOME</code> environment variable is set. Then, download Maven from <a href="http://maven.apache.org/">http://maven.apache.org/</a>, unzip the file on your hard drive and add the <code>apache-maven/bin</code> directory to your <code>PATH</code> variable. More details about the installation process are available on <a href="https://maven.apache.org/install.html">https://maven.apache.org/install.html</a>.</p>
<h4 id="checking-for-maven-installation">Checking for Maven Installation</h4>
<p>Once you’ve got Maven installed, open a command line and enter <code>mvn -version</code> to validate your installation. Maven should print its version and the JDK version it uses (which is handy as you might have different JDK versions installed on the same machine).</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-196-1"><a id="__codelineno-196-1" name="__codelineno-196-1" href="#__codelineno-196-1"></a>$ mvn -version
</span><span id="__span-196-2"><a id="__codelineno-196-2" name="__codelineno-196-2" href="#__codelineno-196-2"></a>Apache Maven 3.9.4 (ea98e05a04480131370aa0c110b8c54cf726c06f)
</span><span id="__span-196-3"><a id="__codelineno-196-3" name="__codelineno-196-3" href="#__codelineno-196-3"></a>Maven home: /usr/local/Cellar/maven/3.9.4/libexec
</span><span id="__span-196-4"><a id="__codelineno-196-4" name="__codelineno-196-4" href="#__codelineno-196-4"></a>Java version: 21.0.0, vendor: AdoptOpenJDK, runtime: /Users/clement/.sdkman/candidates/java/11.0.15.hs-adpt
</span><span id="__span-196-5"><a id="__codelineno-196-5" name="__codelineno-196-5" href="#__codelineno-196-5"></a>Default locale: en_FR, platform encoding: UTF-8
</span><span id="__span-196-6"><a id="__codelineno-196-6" name="__codelineno-196-6" href="#__codelineno-196-6"></a>OS name: &quot;mac os x&quot;, version: &quot;21.5&quot;, arch: &quot;x86_64&quot;, family: &quot;mac&quot;
</span></code></pre></div>
<p>Be aware that Maven needs Internet access to download plugins and project dependencies from the Maven Central and other remote repositories</p>
<h4 id="some-maven-commands">Some Maven Commands</h4>
<p>Maven is a command-line utility where you can use several parameters and options to build, test, or package your code. To get some help on the commands, you can type, use the following command:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-197-1"><a id="__codelineno-197-1" name="__codelineno-197-1" href="#__codelineno-197-1"></a>$ mvn --help
</span><span id="__span-197-2"><a id="__codelineno-197-2" name="__codelineno-197-2" href="#__codelineno-197-2"></a>
</span><span id="__span-197-3"><a id="__codelineno-197-3" name="__codelineno-197-3" href="#__codelineno-197-3"></a>usage: mvn [options] [&lt;goal(s)&gt;] [&lt;phase(s)&gt;]
</span></code></pre></div>
<p>Here are some commands that you will be using to run the examples in the workshop. Each invokes a different phase of the project life cycle (clean, compile, install, etc.) and use the <code>pom.xml</code> to download libraries, customize the compilation, or extend some behaviors with plugins:</p>
<ul>
<li>
<p><code>mvn clean</code>: Deletes all generated files (compiled classes, generated code, artifacts etc.).</p>
</li>
<li>
<p><code>mvn compile</code>: Compiles the main Java classes.</p>
</li>
<li>
<p><code>mvn test-compile</code>: Compiles the test classes.</p>
</li>
<li>
<p><code>mvn test</code>: Compiles the main Java classes as well as the test classes and executes the tests.</p>
</li>
<li>
<p><code>mvn package</code>: Compiles, executes the tests, and packages the code into an archive.</p>
</li>
<li>
<p><code>mvn install</code>: Builds and installs the artifacts in your local repository.</p>
</li>
<li>
<p><code>mvn clean install</code>: Cleans and installs (note that you can add several commands separated by a space, like <code>mvn clean compile test</code>).</p>
</li>
</ul>
<h3 id="curl">cURL</h3>
<p>To invoke the REST Web Services described in this workshop, we often use cURL cURL is a command-line tool and library to do reliable data transfers with various protocols, including HTTP. It is free, open-source (available under the MIT Licence), and has been ported to several operating systems. If your operating system does not already include cURL (most do), here is how to install it.</p>
<h4 id="installing-curl">Installing cURL</h4>
<h4 id="checking-for-curl-installation">Checking for cURL Installation</h4>
<p>Once installed, check for cURL by running <code>curl --version</code> in the terminal. It should display cURL version:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-198-1"><a id="__codelineno-198-1" name="__codelineno-198-1" href="#__codelineno-198-1"></a>$<span class="w"> </span>curl<span class="w"> </span>--version
</span><span id="__span-198-2"><a id="__codelineno-198-2" name="__codelineno-198-2" href="#__codelineno-198-2"></a>curl<span class="w"> </span><span class="m">7</span>.64.1<span class="w"> </span><span class="o">(</span>x86_64-apple-darwin20.0<span class="o">)</span><span class="w"> </span>libcurl/7.64.1<span class="w"> </span><span class="o">(</span>SecureTransport<span class="o">)</span><span class="w"> </span>LibreSSL/2.8.3<span class="w"> </span>zlib/1.2.11<span class="w"> </span>nghttp2/1.41.0
</span><span id="__span-198-3"><a id="__codelineno-198-3" name="__codelineno-198-3" href="#__codelineno-198-3"></a>Release-Date:<span class="w"> </span><span class="m">2019</span>-03-27
</span><span id="__span-198-4"><a id="__codelineno-198-4" name="__codelineno-198-4" href="#__codelineno-198-4"></a>Protocols:<span class="w"> </span>dict<span class="w"> </span>file<span class="w"> </span>ftp<span class="w"> </span>ftps<span class="w"> </span>gopher<span class="w"> </span>http<span class="w"> </span>https<span class="w"> </span>imap<span class="w"> </span>imaps<span class="w"> </span>ldap<span class="w"> </span>ldaps<span class="w"> </span>pop3<span class="w"> </span>pop3s<span class="w"> </span>rtsp<span class="w"> </span>smb<span class="w"> </span>smbs<span class="w"> </span>smtp<span class="w"> </span>smtps<span class="w"> </span>telnet<span class="w"> </span>tftp
</span><span id="__span-198-5"><a id="__codelineno-198-5" name="__codelineno-198-5" href="#__codelineno-198-5"></a>Features:<span class="w"> </span>AsynchDNS<span class="w"> </span>GSS-API<span class="w"> </span>HTTP2<span class="w"> </span>HTTPS-proxy<span class="w"> </span>IPv6<span class="w"> </span>Kerberos<span class="w"> </span>Largefile<span class="w"> </span>libz<span class="w"> </span>MultiSSL<span class="w"> </span>NTLM<span class="w"> </span>NTLM_WB<span class="w"> </span>SPNEGO<span class="w"> </span>SSL<span class="w"> </span>UnixSockets
</span></code></pre></div>
<h4 id="some-curl-commands">Some cURL Commands</h4>
<p>cURL is a command-line utility where you can use several parameters and options to invoke URLs. You invoke <code>curl</code> with zero, one, or several command-line options to accompany the URL (or set of URLs) you want the transfer to be about. cURL supports over two hundred different options, and I would recommend reading the documentation for more help To get some help on the commands and options, you can type, use the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-199-1"><a id="__codelineno-199-1" name="__codelineno-199-1" href="#__codelineno-199-1"></a>$<span class="w"> </span>curl<span class="w"> </span>--help
</span><span id="__span-199-2"><a id="__codelineno-199-2" name="__codelineno-199-2" href="#__codelineno-199-2"></a>
</span><span id="__span-199-3"><a id="__codelineno-199-3" name="__codelineno-199-3" href="#__codelineno-199-3"></a>Usage:<span class="w"> </span>curl<span class="w"> </span><span class="o">[</span>options...<span class="o">]</span><span class="w"> </span>&lt;url&gt;
</span></code></pre></div>
<p>You can also opt to use <code>curl --manual</code>, which will output the entire man page for cURL plus an appended tutorial for the most common use cases.</p>
<p>Here are some commands you will use to invoke the RESTful web service examples in this workshop.</p>
<ul>
<li>
<p><code>curl [http://localhost:8083/api/heroes/hello](http://localhost:8083/api/heroes/hello)</code>: HTTP GET on a given URL.</p>
</li>
<li>
<p><code>curl -X GET [http://localhost:8083/api/heroes/hello](http://localhost:8083/api/heroes/hello)</code>: Same effect as the previous command, an HTTP GET on a given URL.</p>
</li>
<li>
<p><code>curl -v [http://localhost:8083/api/heroes/hello](http://localhost:8083/api/heroes/hello)</code>: HTTP GET on a given URL with verbose mode on.</p>
</li>
<li>
<p><code>curl -H 'Content-Type: application/json' [http://localhost:8083/api/heroes/hello](http://localhost:8083/api/heroes/hello)</code>: HTTP GET on a given URL passing the JSON Content Type in the HTTP Header.</p>
</li>
<li>
<p><code>curl -X DELETE [http://localhost:8083/api/heroes/1](http://localhost:8083/api/heroes/1)</code>: HTTP DELETE on a given URL.</p>
</li>
</ul>
<h3 id="warming-the-caches">Warming the caches</h3>
<p>This workshop needs internet access to download all sorts of Maven artifacts, Docker images, and even pictures. Some of these artifacts are large, and because we have to share internet connexions at the workshop, it is better to download them before the workshop.</p>
<p>If you’re getting ready for a workshop, you might find it helpful to pre-download some Docker images. This can save strain on shared bandwidth. If, however, you’re already attending a workshop, don’t worry about warming anything up.</p>
<h4 id="warming-up-maven">Warming up Maven</h4>
<h5 id="download-the-workshop-scaffolding_1">Download the workshop scaffolding</h5>
<h5 id="download-the-maven-dependencies">Download the Maven dependencies</h5>
<p>Now that you have the initial structure in place, navigate to the root directory and run:</p>
<p>By running this command, it downloads all the required dependencies.</p>
<h4 id="warming-up-docker-images">Warming up Docker images</h4>
<p>To warm up your Docker image repository, navigate to the <code>quarkus-workshop-super-heroes/super-heroes/infrastructure</code> directory. Here, you will find a <code>docker-compose.yaml</code> file which defines all the needed Docker images. Notice that there is a <code>db-init</code> directory with an <code>initialize-databases.sql</code> script which sets up our databases, and a <code>monitoring</code> directory (all that will be explained later).</p>
<p>Then execute the following command which will download all the Docker images and start the containers:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-200-1"><a id="__codelineno-200-1" name="__codelineno-200-1" href="#__codelineno-200-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yaml<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<table><tbody><tr><td><i title="Warning"></i></td><td><p>If you have an issue creating the roles for the database with the <code>initialize-databases.sql</code> file, you have to execute the following commands:</p><div><pre><code data-lang="shell">docker exec -it --user postgres super-database psql -c "CREATE ROLE superman LOGIN PASSWORD 'superman' NOSUPERUSER INHERIT NOCREATEDB NOCREATEROLE NOREPLICATION"
docker exec -it --user postgres super-database psql -c "CREATE ROLE superbad LOGIN PASSWORD 'superbad' NOSUPERUSER INHERIT NOCREATEDB NOCREATEROLE NOREPLICATION"
docker exec -it --user postgres super-database psql -c "CREATE ROLE superfight LOGIN PASSWORD 'superfight' NOSUPERUSER INHERIT NOCREATEDB NOCREATEROLE NOREPLICATION"</code></pre></div></td></tr></tbody></table>

<p>After this, verify the containers are running using the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-201-1"><a id="__codelineno-201-1" name="__codelineno-201-1" href="#__codelineno-201-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yaml<span class="w"> </span>ps
</span></code></pre></div>
<p>The output should resemble something like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-202-1"><a id="__codelineno-202-1" name="__codelineno-202-1" href="#__codelineno-202-1"></a>     Name                   Command               State           Ports
</span><span id="__span-202-2"><a id="__codelineno-202-2" name="__codelineno-202-2" href="#__codelineno-202-2"></a>--------------------------------------------------------------------------------
</span><span id="__span-202-3"><a id="__codelineno-202-3" name="__codelineno-202-3" href="#__codelineno-202-3"></a>kafka            sh -c bin/kafka-server-sta ...   Up      0.0.0.0:9092-&gt;9092/tcp
</span><span id="__span-202-4"><a id="__codelineno-202-4" name="__codelineno-202-4" href="#__codelineno-202-4"></a>super-database   docker-entrypoint.sh postgres    Up      0.0.0.0:5432-&gt;5432/tcp
</span><span id="__span-202-5"><a id="__codelineno-202-5" name="__codelineno-202-5" href="#__codelineno-202-5"></a>super-visor      /bin/prometheus --config.f ...   Up      0.0.0.0:9090-&gt;9090/tcp
</span><span id="__span-202-6"><a id="__codelineno-202-6" name="__codelineno-202-6" href="#__codelineno-202-6"></a>zookeeper        sh -c bin/zookeeper-server ...   Up      0.0.0.0:2181-&gt;2181/tcp
</span></code></pre></div>
<p>Once all the containers are up and running, you can shut them down and remove their volumes with the commands:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-203-1"><a id="__codelineno-203-1" name="__codelineno-203-1" href="#__codelineno-203-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yaml<span class="w"> </span>down
</span><span id="__span-203-2"><a id="__codelineno-203-2" name="__codelineno-203-2" href="#__codelineno-203-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yaml<span class="w"> </span>rm
</span></code></pre></div>
<table><tbody><tr><td><i title="Note"></i></td><td><div><p>What’s this infra?</p><p>Any microservice system is going to rely on a set of technical services. In our context, we are going to use PostgreSQL as the database, Prometheus as the monitoring tool, and Kafka as the event/message bus. This infrastructure starts all these services, so you don’t have to worry about them.</p></div><p>This infra will only be used when we run our services in <em>prod</em> mode. In <em>dev</em> mode, Quarkus will start everything for us.</p></td></tr></tbody></table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>